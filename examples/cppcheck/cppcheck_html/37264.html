<html><head><title>valueflow.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="sourcestyles.css" />
</head><body link="blue" vlink="blue">
<h3>File: /home/crippenre/dev/cpp/cppcheck/lib/valueflow.cpp</h3>
<SCRIPT>
defaultStatus = "File: /home/crippenre/dev/cpp/cppcheck/lib/valueflow.cpp";
top.document.title  = "valueflow.cpp";
</SCRIPT>
<pre><span class="default"></span><a name="1"><font size=-1>1     </font></a><span class="default"></span><span class="comment">/*</span>
<a name="2"><font size=-1>2     </font></a><span class="comment"> * Cppcheck - A tool for static C/C++ code analysis</span>
<a name="3"><font size=-1>3     </font></a><span class="comment"> * Copyright (C) 2007-2019 Cppcheck team.</span>
<a name="4"><font size=-1>4     </font></a><span class="comment"> *</span>
<a name="5"><font size=-1>5     </font></a><span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="6"><font size=-1>6     </font></a><span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="7"><font size=-1>7     </font></a><span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="8"><font size=-1>8     </font></a><span class="comment"> * (at your option) any later version.</span>
<a name="9"><font size=-1>9     </font></a><span class="comment"> *</span>
<a name="10"><font size=-1>10     </font></a><span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="11"><font size=-1>11     </font></a><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="12"><font size=-1>12     </font></a><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="13"><font size=-1>13     </font></a><span class="comment"> * GNU General Public License for more details.</span>
<a name="14"><font size=-1>14     </font></a><span class="comment"> *</span>
<a name="15"><font size=-1>15     </font></a><span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="16"><font size=-1>16     </font></a><span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="17"><font size=-1>17     </font></a><span class="comment"> */</span>
<a name="18"><font size=-1>18     </font></a><span class="comment"></span>
<a name="19"><font size=-1>19     </font></a><span class="comment">/**</span>
<a name="20"><font size=-1>20     </font></a><span class="comment"> * @brief This is the ValueFlow component in Cppcheck.</span>
<a name="21"><font size=-1>21     </font></a><span class="comment"> *</span>
<a name="22"><font size=-1>22     </font></a><span class="comment"> * Each @sa Token in the token list has a list of values. These are</span>
<a name="23"><font size=-1>23     </font></a><span class="comment"> * the &quot;possible&quot; values for the Token at runtime.</span>
<a name="24"><font size=-1>24     </font></a><span class="comment"> *</span>
<a name="25"><font size=-1>25     </font></a><span class="comment"> * In the --debug and --debug-normal output you can see the ValueFlow data. For example:</span>
<a name="26"><font size=-1>26     </font></a><span class="comment"> *</span>
<a name="27"><font size=-1>27     </font></a><span class="comment"> *     int f()</span>
<a name="28"><font size=-1>28     </font></a><span class="comment"> *     {</span>
<a name="29"><font size=-1>29     </font></a><span class="comment"> *         int x = 10;</span>
<a name="30"><font size=-1>30     </font></a><span class="comment"> *         return 4 * x + 2;</span>
<a name="31"><font size=-1>31     </font></a><span class="comment"> *     }</span>
<a name="32"><font size=-1>32     </font></a><span class="comment"> *</span>
<a name="33"><font size=-1>33     </font></a><span class="comment"> * The --debug-normal output says:</span>
<a name="34"><font size=-1>34     </font></a><span class="comment"> *</span>
<a name="35"><font size=-1>35     </font></a><span class="comment"> *     ##Value flow</span>
<a name="36"><font size=-1>36     </font></a><span class="comment"> *     Line 3</span>
<a name="37"><font size=-1>37     </font></a><span class="comment"> *       10 always 10</span>
<a name="38"><font size=-1>38     </font></a><span class="comment"> *     Line 4</span>
<a name="39"><font size=-1>39     </font></a><span class="comment"> *       4 always 4</span>
<a name="40"><font size=-1>40     </font></a><span class="comment"> *       * always 40</span>
<a name="41"><font size=-1>41     </font></a><span class="comment"> *       x always 10</span>
<a name="42"><font size=-1>42     </font></a><span class="comment"> *       + always 42</span>
<a name="43"><font size=-1>43     </font></a><span class="comment"> *       2 always 2</span>
<a name="44"><font size=-1>44     </font></a><span class="comment"> *</span>
<a name="45"><font size=-1>45     </font></a><span class="comment"> * All value flow analysis is executed in the ValueFlow::setValues() function. The ValueFlow analysis is executed after</span>
<a name="46"><font size=-1>46     </font></a><span class="comment"> * the tokenizer/ast/symboldatabase/etc.. The ValueFlow analysis is done in a series of valueFlow* function calls, where</span>
<a name="47"><font size=-1>47     </font></a><span class="comment"> * each such function call can only use results from previous function calls. The function calls should be arranged so</span>
<a name="48"><font size=-1>48     </font></a><span class="comment"> * that valueFlow* that do not require previous ValueFlow information should be first.</span>
<a name="49"><font size=-1>49     </font></a><span class="comment"> *</span>
<a name="50"><font size=-1>50     </font></a><span class="comment"> * Type of analysis</span>
<a name="51"><font size=-1>51     </font></a><span class="comment"> * ================</span>
<a name="52"><font size=-1>52     </font></a><span class="comment"> *</span>
<a name="53"><font size=-1>53     </font></a><span class="comment"> * This is &quot;flow sensitive&quot; value flow analysis. We _usually_ track the value for 1 variable at a time.</span>
<a name="54"><font size=-1>54     </font></a><span class="comment"> *</span>
<a name="55"><font size=-1>55     </font></a><span class="comment"> * How are calculations handled</span>
<a name="56"><font size=-1>56     </font></a><span class="comment"> * ============================</span>
<a name="57"><font size=-1>57     </font></a><span class="comment"> *</span>
<a name="58"><font size=-1>58     </font></a><span class="comment"> * Here is an example code:</span>
<a name="59"><font size=-1>59     </font></a><span class="comment"> *</span>
<a name="60"><font size=-1>60     </font></a><span class="comment"> *   x = 3 + 4;</span>
<a name="61"><font size=-1>61     </font></a><span class="comment"> *</span>
<a name="62"><font size=-1>62     </font></a><span class="comment"> * The valueFlowNumber set the values for the &quot;3&quot; and &quot;4&quot; tokens by calling setTokenValue().</span>
<a name="63"><font size=-1>63     </font></a><span class="comment"> * The setTokenValue() handle the calculations automatically. When both &quot;3&quot; and &quot;4&quot; have values, the &quot;+&quot; can be</span>
<a name="64"><font size=-1>64     </font></a><span class="comment"> * calculated. setTokenValue() recursively calls itself when parents in calculations can be calculated.</span>
<a name="65"><font size=-1>65     </font></a><span class="comment"> *</span>
<a name="66"><font size=-1>66     </font></a><span class="comment"> * Forward / Reverse flow analysis</span>
<a name="67"><font size=-1>67     </font></a><span class="comment"> * ===============================</span>
<a name="68"><font size=-1>68     </font></a><span class="comment"> *</span>
<a name="69"><font size=-1>69     </font></a><span class="comment"> * In forward value flow analysis we know a value and see what happens when we are stepping the program forward. Like</span>
<a name="70"><font size=-1>70     </font></a><span class="comment"> * normal execution. The valueFlowForwardVariable is used in this analysis.</span>
<a name="71"><font size=-1>71     </font></a><span class="comment"> *</span>
<a name="72"><font size=-1>72     </font></a><span class="comment"> * In reverse value flow analysis we know the value of a variable at line X. And try to &quot;execute backwards&quot; to determine</span>
<a name="73"><font size=-1>73     </font></a><span class="comment"> * possible values before line X. The valueFlowReverse is used in this analysis.</span>
<a name="74"><font size=-1>74     </font></a><span class="comment"> *</span>
<a name="75"><font size=-1>75     </font></a><span class="comment"> *</span>
<a name="76"><font size=-1>76     </font></a><span class="comment"> */</span>
<a name="77"><font size=-1>77     </font></a><span class="comment"></span>
<a name="78"><font size=-1>78     </font></a><span class="comment"></span><span class="preproc">#include </span><span class="string">&quot;valueflow.h&quot;</span>
<a name="79"><font size=-1>79     </font></a><span class="string"></span>
<a name="80"><font size=-1>80     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;astutils.h&quot;</span>
<a name="81"><font size=-1>81     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;errorlogger.h&quot;</span>
<a name="82"><font size=-1>82     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;library.h&quot;</span>
<a name="83"><font size=-1>83     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;mathlib.h&quot;</span>
<a name="84"><font size=-1>84     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;platform.h&quot;</span>
<a name="85"><font size=-1>85     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;settings.h&quot;</span>
<a name="86"><font size=-1>86     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;standards.h&quot;</span>
<a name="87"><font size=-1>87     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;symboldatabase.h&quot;</span>
<a name="88"><font size=-1>88     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;token.h&quot;</span>
<a name="89"><font size=-1>89     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;tokenlist.h&quot;</span>
<a name="90"><font size=-1>90     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;utils.h&quot;</span>
<a name="91"><font size=-1>91     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;path.h&quot;</span>
<a name="92"><font size=-1>92     </font></a><span class="string"></span>
<a name="93"><font size=-1>93     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;algorithm&gt;</span>
<a name="94"><font size=-1>94     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;cassert&gt;</span>
<a name="95"><font size=-1>95     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;cstddef&gt;</span>
<a name="96"><font size=-1>96     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;functional&gt;</span>
<a name="97"><font size=-1>97     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;iterator&gt;</span>
<a name="98"><font size=-1>98     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;limits&gt;</span>
<a name="99"><font size=-1>99     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;map&gt;</span>
<a name="100"><font size=-1>100     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;set&gt;</span>
<a name="101"><font size=-1>101     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;stack&gt;</span>
<a name="102"><font size=-1>102     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;vector&gt;</span>
<a name="103"><font size=-1>103     </font></a><span class="string"></span>
<a name="104"><font size=-1>104     </font></a><span class="string"></span><span class="keyword">static const int </span><span class="default">TIMEOUT = </span><span class="number">10</span><span class="default">; </span><span class="comment">// Do not repeat ValueFlow analysis more than 10 seconds</span>
<a name="105"><font size=-1>105     </font></a><span class="comment"></span>
<a name="106"><font size=-1>106     </font></a><span class="comment"></span><span class="keyword">namespace </span><span class="default">{</span>
<a name="107"><font size=-1>107     </font></a><span class="default">    </span><span class="keyword">struct </span><span class="default">ProgramMemory {</span>
<a name="108"><font size=-1>108     </font></a><span class="default">        std::map&lt;</span><span class="keyword">int</span><span class="default">, ValueFlow::Value&gt; values;</span>
<a name="109"><font size=-1>109     </font></a><span class="default"></span>
<a name="110"><font size=-1>110     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">setValue(nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value) {</span>
<a name="111"><font size=-1>111     </font></a><span class="default">            values[varid] = value;</span>
<a name="112"><font size=-1>112     </font></a><span class="default">        }</span>
<a name="113"><font size=-1>113     </font></a><span class="default"></span>
<a name="114"><font size=-1>114     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">getIntValue(nonneg </span><span class="keyword">int </span><span class="default">varid, MathLib::bigint* result) </span><span class="keyword">const </span><span class="default">{</span>
<a name="115"><font size=-1>115     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::map&lt;</span><span class="keyword">int</span><span class="default">, ValueFlow::Value&gt;::const_iterator it = values.find(varid);</span>
<a name="116"><font size=-1>116     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">found = it != values.end() &amp;&amp; it-&gt;second.isIntValue();</span>
<a name="117"><font size=-1>117     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(found)</span>
<a name="118"><font size=-1>118     </font></a><span class="default">                *result = it-&gt;second.intvalue;</span>
<a name="119"><font size=-1>119     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">found;</span>
<a name="120"><font size=-1>120     </font></a><span class="default">        }</span>
<a name="121"><font size=-1>121     </font></a><span class="default"></span>
<a name="122"><font size=-1>122     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">setIntValue(nonneg </span><span class="keyword">int </span><span class="default">varid, MathLib::bigint value) {</span>
<a name="123"><font size=-1>123     </font></a><span class="default">            values[varid] = ValueFlow::Value(value);</span>
<a name="124"><font size=-1>124     </font></a><span class="default">        }</span>
<a name="125"><font size=-1>125     </font></a><span class="default"></span>
<a name="126"><font size=-1>126     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">getTokValue(nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">Token** result) </span><span class="keyword">const </span><span class="default">{</span>
<a name="127"><font size=-1>127     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::map&lt;</span><span class="keyword">int</span><span class="default">, ValueFlow::Value&gt;::const_iterator it = values.find(varid);</span>
<a name="128"><font size=-1>128     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">found = it != values.end() &amp;&amp; it-&gt;second.isTokValue();</span>
<a name="129"><font size=-1>129     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(found)</span>
<a name="130"><font size=-1>130     </font></a><span class="default">                *result = it-&gt;second.tokvalue;</span>
<a name="131"><font size=-1>131     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">found;</span>
<a name="132"><font size=-1>132     </font></a><span class="default">        }</span>
<a name="133"><font size=-1>133     </font></a><span class="default"></span>
<a name="134"><font size=-1>134     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">hasValue(nonneg </span><span class="keyword">int </span><span class="default">varid) {</span>
<a name="135"><font size=-1>135     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">values.find(varid) != values.end();</span>
<a name="136"><font size=-1>136     </font></a><span class="default">        }</span>
<a name="137"><font size=-1>137     </font></a><span class="default"></span>
<a name="138"><font size=-1>138     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">swap(ProgramMemory &amp;pm) {</span>
<a name="139"><font size=-1>139     </font></a><span class="default">            values.swap(pm.values);</span>
<a name="140"><font size=-1>140     </font></a><span class="default">        }</span>
<a name="141"><font size=-1>141     </font></a><span class="default"></span>
<a name="142"><font size=-1>142     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">clear() {</span>
<a name="143"><font size=-1>143     </font></a><span class="default">            values.clear();</span>
<a name="144"><font size=-1>144     </font></a><span class="default">        }</span>
<a name="145"><font size=-1>145     </font></a><span class="default"></span>
<a name="146"><font size=-1>146     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">empty() </span><span class="keyword">const </span><span class="default">{</span>
<a name="147"><font size=-1>147     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">values.empty();</span>
<a name="148"><font size=-1>148     </font></a><span class="default">        }</span>
<a name="149"><font size=-1>149     </font></a><span class="default"></span>
<a name="150"><font size=-1>150     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">replace(</span><span class="keyword">const </span><span class="default">ProgramMemory &amp;pm) {</span>
<a name="151"><font size=-1>151     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">auto</span><span class="default">&amp;&amp; p:pm.values)</span>
<a name="152"><font size=-1>152     </font></a><span class="default">                values[p.first] = p.second;</span>
<a name="153"><font size=-1>153     </font></a><span class="default">        }</span>
<a name="154"><font size=-1>154     </font></a><span class="default"></span>
<a name="155"><font size=-1>155     </font></a><span class="default">        </span><span class="keyword">void </span><span class="default">insert(</span><span class="keyword">const </span><span class="default">ProgramMemory &amp;pm) {</span>
<a name="156"><font size=-1>156     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">auto</span><span class="default">&amp;&amp; p:pm.values)</span>
<a name="157"><font size=-1>157     </font></a><span class="default">                values.insert(p);</span>
<a name="158"><font size=-1>158     </font></a><span class="default">        }</span>
<a name="159"><font size=-1>159     </font></a><span class="default">    };</span>
<a name="160"><font size=-1>160     </font></a><span class="default">}</span>
<a name="161"><font size=-1>161     </font></a><span class="default"></span>
<a name="162"><font size=-1>162     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">execute(</span><span class="keyword">const </span><span class="default">Token *expr,</span>
<a name="163"><font size=-1>163     </font></a><span class="default">                    ProgramMemory * </span><span class="keyword">const </span><span class="default">programMemory,</span>
<a name="164"><font size=-1>164     </font></a><span class="default">                    MathLib::bigint *result,</span>
<a name="165"><font size=-1>165     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">*error);</span>
<a name="166"><font size=-1>166     </font></a><span class="default"></span>
<a name="167"><font size=-1>167     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">bailoutInternal(TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;what, </span><span class="keyword">const </span><span class="default">std::string &amp;file, </span><span class="keyword">int </span><span class="default">line, </span><span class="keyword">const </span><span class="default">std::string &amp;function)</span>
<a name="168"><font size=-1>168     </font></a><span class="default">{</span>
<a name="169"><font size=-1>169     </font></a><span class="default">    std::list&lt;ErrorLogger::ErrorMessage::FileLocation&gt; callstack(</span><span class="number">1</span><span class="default">, ErrorLogger::ErrorMessage::FileLocation(tok, tokenlist));</span>
<a name="170"><font size=-1>170     </font></a><span class="default">    ErrorLogger::ErrorMessage errmsg(callstack, tokenlist-&gt;getSourceFilePath(), Severity::debug,</span>
<a name="171"><font size=-1>171     </font></a><span class="default">                                     Path::stripDirectoryPart(file) + </span><span class="string">&quot;:&quot; </span><span class="default">+ MathLib::toString(line) + </span><span class="string">&quot;:&quot; </span><span class="default">+ function + </span><span class="string">&quot; bailout: &quot; </span><span class="default">+ what, </span><span class="string">&quot;valueFlowBailout&quot;</span><span class="default">, </span><span class="keyword">false</span><span class="default">);</span>
<a name="172"><font size=-1>172     </font></a><span class="default">    errorLogger-&gt;reportErr(errmsg);</span>
<a name="173"><font size=-1>173     </font></a><span class="default">}</span>
<a name="174"><font size=-1>174     </font></a><span class="default"></span>
<a name="175"><font size=-1>175     </font></a><span class="default"></span><span class="preproc">#if </span><span class="default">(</span><span class="preproc">defined </span><span class="default">__cplusplus) &amp;&amp; __cplusplus &gt;= </span><span class="number">201103L</span>
<a name="176"><font size=-1>176     </font></a><span class="number"></span><span class="preproc">#define </span><span class="default">bailout(tokenlist, errorLogger, tok, what) bailoutInternal(tokenlist, errorLogger, tok, what, __FILE__, __LINE__, __func__)</span>
<a name="177"><font size=-1>177     </font></a><span class="default"></span><span class="preproc">#elif </span><span class="default">(</span><span class="preproc">defined </span><span class="default">__GNUC__) || (</span><span class="preproc">defined </span><span class="default">__clang__) || (</span><span class="preproc">defined </span><span class="default">_MSC_VER)</span>
<a name="178"><font size=-1>178     </font></a><span class="default"></span><span class="preproc">#define </span><span class="default">bailout(tokenlist, errorLogger, tok, what) bailoutInternal(tokenlist, errorLogger, tok, what, __FILE__, __LINE__, __FUNCTION__)</span>
<a name="179"><font size=-1>179     </font></a><span class="default"></span><span class="preproc">#else</span>
<a name="180"><font size=-1>180     </font></a><span class="preproc">#define </span><span class="default">bailout(tokenlist, errorLogger, tok, what) bailoutInternal(tokenlist, errorLogger, tok, what, __FILE__, __LINE__, </span><span class="string">&quot;(valueFlow)&quot;</span><span class="default">)</span>
<a name="181"><font size=-1>181     </font></a><span class="default"></span><span class="preproc">#endif</span>
<a name="182"><font size=-1>182     </font></a><span class="preproc"></span>
<a name="183"><font size=-1>183     </font></a><span class="preproc"></span><span class="keyword">static void </span><span class="default">changeKnownToPossible(std::list&lt;ValueFlow::Value&gt; &amp;values, </span><span class="keyword">int </span><span class="default">indirect=-</span><span class="number">1</span><span class="default">)</span>
<a name="184"><font size=-1>184     </font></a><span class="default">{</span>
<a name="185"><font size=-1>185     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(ValueFlow::Value&amp; v: values) {</span>
<a name="186"><font size=-1>186     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(indirect &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; v.indirect != indirect)</span>
<a name="187"><font size=-1>187     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="188"><font size=-1>188     </font></a><span class="default">        v.changeKnownToPossible();</span>
<a name="189"><font size=-1>189     </font></a><span class="default">    }</span>
<a name="190"><font size=-1>190     </font></a><span class="default">}</span>
<a name="191"><font size=-1>191     </font></a><span class="default"></span>
<a name="192"><font size=-1>192     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">removeImpossible(std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">int </span><span class="default">indirect = -</span><span class="number">1</span><span class="default">)</span>
<a name="193"><font size=-1>193     </font></a><span class="default">{</span>
<a name="194"><font size=-1>194     </font></a><span class="default">    values.remove_if([&amp;](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="195"><font size=-1>195     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(indirect &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; v.indirect != indirect)</span>
<a name="196"><font size=-1>196     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="197"><font size=-1>197     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">v.isImpossible();</span>
<a name="198"><font size=-1>198     </font></a><span class="default">    });</span>
<a name="199"><font size=-1>199     </font></a><span class="default">}</span>
<a name="200"><font size=-1>200     </font></a><span class="default"></span>
<a name="201"><font size=-1>201     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">lowerToPossible(std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">int </span><span class="default">indirect = -</span><span class="number">1</span><span class="default">)</span>
<a name="202"><font size=-1>202     </font></a><span class="default">{</span>
<a name="203"><font size=-1>203     </font></a><span class="default">    changeKnownToPossible(values, indirect);</span>
<a name="204"><font size=-1>204     </font></a><span class="default">    removeImpossible(values, indirect);</span>
<a name="205"><font size=-1>205     </font></a><span class="default">}</span>
<a name="206"><font size=-1>206     </font></a><span class="default"></span>
<a name="207"><font size=-1>207     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">lowerToInconclusive(std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">const </span><span class="default">Settings* settings, </span><span class="keyword">int </span><span class="default">indirect = -</span><span class="number">1</span><span class="default">)</span>
<a name="208"><font size=-1>208     </font></a><span class="default">{</span>
<a name="209"><font size=-1>209     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(settings-&gt;inconclusive) {</span>
<a name="210"><font size=-1>210     </font></a><span class="default">        removeImpossible(values, indirect);</span>
<a name="211"><font size=-1>211     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(ValueFlow::Value&amp; v : values) {</span>
<a name="212"><font size=-1>212     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(indirect &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; v.indirect != indirect)</span>
<a name="213"><font size=-1>213     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="214"><font size=-1>214     </font></a><span class="default">            v.setInconclusive();</span>
<a name="215"><font size=-1>215     </font></a><span class="default">        }</span>
<a name="216"><font size=-1>216     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="217"><font size=-1>217     </font></a><span class="default">        </span><span class="comment">// Remove all values if the inconclusive flags is not set</span>
<a name="218"><font size=-1>218     </font></a><span class="comment">        </span><span class="default">values.remove_if([&amp;](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="219"><font size=-1>219     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(indirect &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; v.indirect != indirect)</span>
<a name="220"><font size=-1>220     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="221"><font size=-1>221     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="222"><font size=-1>222     </font></a><span class="default">        });</span>
<a name="223"><font size=-1>223     </font></a><span class="default">    }</span>
<a name="224"><font size=-1>224     </font></a><span class="default">}</span>
<a name="225"><font size=-1>225     </font></a><span class="default"></span>
<a name="226"><font size=-1>226     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">changePossibleToKnown(std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">int </span><span class="default">indirect = -</span><span class="number">1</span><span class="default">)</span>
<a name="227"><font size=-1>227     </font></a><span class="default">{</span>
<a name="228"><font size=-1>228     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(ValueFlow::Value&amp; v : values) {</span>
<a name="229"><font size=-1>229     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(indirect &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; v.indirect != indirect)</span>
<a name="230"><font size=-1>230     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="231"><font size=-1>231     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!v.isPossible())</span>
<a name="232"><font size=-1>232     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="233"><font size=-1>233     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(v.bound != ValueFlow::Value::Bound::Point)</span>
<a name="234"><font size=-1>234     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="235"><font size=-1>235     </font></a><span class="default">        v.setKnown();</span>
<a name="236"><font size=-1>236     </font></a><span class="default">    }</span>
<a name="237"><font size=-1>237     </font></a><span class="default">}</span>
<a name="238"><font size=-1>238     </font></a><span class="default"></span>
<a name="239"><font size=-1>239     </font></a><span class="default"></span><span class="comment">/**</span>
<a name="240"><font size=-1>240     </font></a><span class="comment"> * Is condition always false when variable has given value?</span>
<a name="241"><font size=-1>241     </font></a><span class="comment"> * \param condition   top ast token in condition</span>
<a name="242"><font size=-1>242     </font></a><span class="comment"> * \param programMemory   program memory</span>
<a name="243"><font size=-1>243     </font></a><span class="comment"> */</span>
<a name="244"><font size=-1>244     </font></a><span class="comment"></span><span class="keyword">static bool </span><span class="default">conditionIsFalse(</span><span class="keyword">const </span><span class="default">Token *condition, </span><span class="keyword">const </span><span class="default">ProgramMemory &amp;programMemory)</span>
<a name="245"><font size=-1>245     </font></a><span class="default">{</span>
<a name="246"><font size=-1>246     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!condition)</span>
<a name="247"><font size=-1>247     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="248"><font size=-1>248     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(condition-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">) {</span>
<a name="249"><font size=-1>249     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">conditionIsFalse(condition-&gt;astOperand1(), programMemory) ||</span>
<a name="250"><font size=-1>250     </font></a><span class="default">               conditionIsFalse(condition-&gt;astOperand2(), programMemory);</span>
<a name="251"><font size=-1>251     </font></a><span class="default">    }</span>
<a name="252"><font size=-1>252     </font></a><span class="default">    ProgramMemory progmem(programMemory);</span>
<a name="253"><font size=-1>253     </font></a><span class="default">    MathLib::bigint result = </span><span class="number">0</span><span class="default">;</span>
<a name="254"><font size=-1>254     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">error = </span><span class="keyword">false</span><span class="default">;</span>
<a name="255"><font size=-1>255     </font></a><span class="default">    execute(condition, &amp;progmem, &amp;result, &amp;error);</span>
<a name="256"><font size=-1>256     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">!error &amp;&amp; result == </span><span class="number">0</span><span class="default">;</span>
<a name="257"><font size=-1>257     </font></a><span class="default">}</span>
<a name="258"><font size=-1>258     </font></a><span class="default"></span>
<a name="259"><font size=-1>259     </font></a><span class="default"></span><span class="comment">/**</span>
<a name="260"><font size=-1>260     </font></a><span class="comment"> * Is condition always true when variable has given value?</span>
<a name="261"><font size=-1>261     </font></a><span class="comment"> * \param condition   top ast token in condition</span>
<a name="262"><font size=-1>262     </font></a><span class="comment"> * \param programMemory   program memory</span>
<a name="263"><font size=-1>263     </font></a><span class="comment"> */</span>
<a name="264"><font size=-1>264     </font></a><span class="comment"></span><span class="keyword">static bool </span><span class="default">conditionIsTrue(</span><span class="keyword">const </span><span class="default">Token *condition, </span><span class="keyword">const </span><span class="default">ProgramMemory &amp;programMemory)</span>
<a name="265"><font size=-1>265     </font></a><span class="default">{</span>
<a name="266"><font size=-1>266     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!condition)</span>
<a name="267"><font size=-1>267     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="268"><font size=-1>268     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(condition-&gt;str() == </span><span class="string">&quot;||&quot;</span><span class="default">) {</span>
<a name="269"><font size=-1>269     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">conditionIsTrue(condition-&gt;astOperand1(), programMemory) ||</span>
<a name="270"><font size=-1>270     </font></a><span class="default">               conditionIsTrue(condition-&gt;astOperand2(), programMemory);</span>
<a name="271"><font size=-1>271     </font></a><span class="default">    }</span>
<a name="272"><font size=-1>272     </font></a><span class="default">    ProgramMemory progmem(programMemory);</span>
<a name="273"><font size=-1>273     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">error = </span><span class="keyword">false</span><span class="default">;</span>
<a name="274"><font size=-1>274     </font></a><span class="default">    MathLib::bigint result = </span><span class="number">0</span><span class="default">;</span>
<a name="275"><font size=-1>275     </font></a><span class="default">    execute(condition, &amp;progmem, &amp;result, &amp;error);</span>
<a name="276"><font size=-1>276     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">!error &amp;&amp; result == </span><span class="number">1</span><span class="default">;</span>
<a name="277"><font size=-1>277     </font></a><span class="default">}</span>
<a name="278"><font size=-1>278     </font></a><span class="default"></span>
<a name="279"><font size=-1>279     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">setValueUpperBound(ValueFlow::Value&amp; value, </span><span class="keyword">bool </span><span class="default">upper)</span>
<a name="280"><font size=-1>280     </font></a><span class="default">{</span>
<a name="281"><font size=-1>281     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(upper)</span>
<a name="282"><font size=-1>282     </font></a><span class="default">        value.bound = ValueFlow::Value::Bound::Upper;</span>
<a name="283"><font size=-1>283     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="284"><font size=-1>284     </font></a><span class="keyword">        </span><span class="default">value.bound = ValueFlow::Value::Bound::Lower;</span>
<a name="285"><font size=-1>285     </font></a><span class="default">}</span>
<a name="286"><font size=-1>286     </font></a><span class="default"></span>
<a name="287"><font size=-1>287     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">setValueBound(ValueFlow::Value&amp; value, </span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">bool </span><span class="default">invert)</span>
<a name="288"><font size=-1>288     </font></a><span class="default">{</span>
<a name="289"><font size=-1>289     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;&lt;|&lt;=&quot;</span><span class="default">)) {</span>
<a name="290"><font size=-1>290     </font></a><span class="default">        setValueUpperBound(value, !invert);</span>
<a name="291"><font size=-1>291     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;&gt;|&gt;=&quot;</span><span class="default">)) {</span>
<a name="292"><font size=-1>292     </font></a><span class="default">        setValueUpperBound(value, invert);</span>
<a name="293"><font size=-1>293     </font></a><span class="default">    }</span>
<a name="294"><font size=-1>294     </font></a><span class="default">}</span>
<a name="295"><font size=-1>295     </font></a><span class="default"></span>
<a name="296"><font size=-1>296     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">setConditionalValues(</span><span class="keyword">const </span><span class="default">Token *tok,</span>
<a name="297"><font size=-1>297     </font></a><span class="default">                                 </span><span class="keyword">bool </span><span class="default">invert,</span>
<a name="298"><font size=-1>298     </font></a><span class="default">                                 MathLib::bigint value,</span>
<a name="299"><font size=-1>299     </font></a><span class="default">                                 ValueFlow::Value &amp;true_value,</span>
<a name="300"><font size=-1>300     </font></a><span class="default">                                 ValueFlow::Value &amp;false_value)</span>
<a name="301"><font size=-1>301     </font></a><span class="default">{</span>
<a name="302"><font size=-1>302     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;==|!=|&gt;=|&lt;=&quot;</span><span class="default">)) {</span>
<a name="303"><font size=-1>303     </font></a><span class="default">        true_value = ValueFlow::Value{tok, value};</span>
<a name="304"><font size=-1>304     </font></a><span class="default">        </span><span class="keyword">const char</span><span class="default">* greaterThan = </span><span class="string">&quot;&gt;=&quot;</span><span class="default">;</span>
<a name="305"><font size=-1>305     </font></a><span class="default">        </span><span class="keyword">const char</span><span class="default">* lessThan = </span><span class="string">&quot;&lt;=&quot;</span><span class="default">;</span>
<a name="306"><font size=-1>306     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(invert)</span>
<a name="307"><font size=-1>307     </font></a><span class="default">            std::swap(greaterThan, lessThan);</span>
<a name="308"><font size=-1>308     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, greaterThan)) {</span>
<a name="309"><font size=-1>309     </font></a><span class="default">            false_value = ValueFlow::Value{tok, value - </span><span class="number">1</span><span class="default">};</span>
<a name="310"><font size=-1>310     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, lessThan)) {</span>
<a name="311"><font size=-1>311     </font></a><span class="default">            false_value = ValueFlow::Value{tok, value + </span><span class="number">1</span><span class="default">};</span>
<a name="312"><font size=-1>312     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="313"><font size=-1>313     </font></a><span class="default">            false_value = ValueFlow::Value{tok, value};</span>
<a name="314"><font size=-1>314     </font></a><span class="default">        }</span>
<a name="315"><font size=-1>315     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="316"><font size=-1>316     </font></a><span class="default">        </span><span class="keyword">const char</span><span class="default">* greaterThan = </span><span class="string">&quot;&gt;&quot;</span><span class="default">;</span>
<a name="317"><font size=-1>317     </font></a><span class="default">        </span><span class="keyword">const char</span><span class="default">* lessThan = </span><span class="string">&quot;&lt;&quot;</span><span class="default">;</span>
<a name="318"><font size=-1>318     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(invert)</span>
<a name="319"><font size=-1>319     </font></a><span class="default">            std::swap(greaterThan, lessThan);</span>
<a name="320"><font size=-1>320     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, greaterThan)) {</span>
<a name="321"><font size=-1>321     </font></a><span class="default">            true_value = ValueFlow::Value{tok, value + </span><span class="number">1</span><span class="default">};</span>
<a name="322"><font size=-1>322     </font></a><span class="default">            false_value = ValueFlow::Value{tok, value};</span>
<a name="323"><font size=-1>323     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, lessThan)) {</span>
<a name="324"><font size=-1>324     </font></a><span class="default">            true_value = ValueFlow::Value{tok, value - </span><span class="number">1</span><span class="default">};</span>
<a name="325"><font size=-1>325     </font></a><span class="default">            false_value = ValueFlow::Value{tok, value};</span>
<a name="326"><font size=-1>326     </font></a><span class="default">        }</span>
<a name="327"><font size=-1>327     </font></a><span class="default">    }</span>
<a name="328"><font size=-1>328     </font></a><span class="default">    setValueBound(true_value, tok, invert);</span>
<a name="329"><font size=-1>329     </font></a><span class="default">    setValueBound(false_value, tok, !invert);</span>
<a name="330"><font size=-1>330     </font></a><span class="default">}</span>
<a name="331"><font size=-1>331     </font></a><span class="default"></span>
<a name="332"><font size=-1>332     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isSaturated(MathLib::bigint value)</span>
<a name="333"><font size=-1>333     </font></a><span class="default">{</span>
<a name="334"><font size=-1>334     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">value == std::numeric_limits&lt;MathLib::bigint&gt;::max() || value == std::numeric_limits&lt;MathLib::bigint&gt;::min();</span>
<a name="335"><font size=-1>335     </font></a><span class="default">}</span>
<a name="336"><font size=-1>336     </font></a><span class="default"></span>
<a name="337"><font size=-1>337     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token *parseCompareInt(</span><span class="keyword">const </span><span class="default">Token *tok, ValueFlow::Value &amp;true_value, ValueFlow::Value &amp;false_value)</span>
<a name="338"><font size=-1>338     </font></a><span class="default">{</span>
<a name="339"><font size=-1>339     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1() || !tok-&gt;astOperand2())</span>
<a name="340"><font size=-1>340     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="341"><font size=-1>341     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%comp%&quot;</span><span class="default">)) {</span>
<a name="342"><font size=-1>342     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;astOperand1()-&gt;hasKnownIntValue()) {</span>
<a name="343"><font size=-1>343     </font></a><span class="default">            MathLib::bigint value = tok-&gt;astOperand1()-&gt;values().front().intvalue;</span>
<a name="344"><font size=-1>344     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isSaturated(value))</span>
<a name="345"><font size=-1>345     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="346"><font size=-1>346     </font></a><span class="default">            setConditionalValues(tok, </span><span class="keyword">true</span><span class="default">, value, true_value, false_value);</span>
<a name="347"><font size=-1>347     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">tok-&gt;astOperand2();</span>
<a name="348"><font size=-1>348     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="349"><font size=-1>349     </font></a><span class="default">            MathLib::bigint value = tok-&gt;astOperand2()-&gt;values().front().intvalue;</span>
<a name="350"><font size=-1>350     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isSaturated(value))</span>
<a name="351"><font size=-1>351     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="352"><font size=-1>352     </font></a><span class="default">            setConditionalValues(tok, </span><span class="keyword">false</span><span class="default">, value, true_value, false_value);</span>
<a name="353"><font size=-1>353     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">tok-&gt;astOperand1();</span>
<a name="354"><font size=-1>354     </font></a><span class="default">        }</span>
<a name="355"><font size=-1>355     </font></a><span class="default">    }</span>
<a name="356"><font size=-1>356     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="357"><font size=-1>357     </font></a><span class="default">}</span>
<a name="358"><font size=-1>358     </font></a><span class="default"></span>
<a name="359"><font size=-1>359     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">programMemoryParseCondition(ProgramMemory&amp; pm, </span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">Token* endTok, </span><span class="keyword">const </span><span class="default">Settings* settings, </span><span class="keyword">bool </span><span class="default">then)</span>
<a name="360"><font size=-1>360     </font></a><span class="default">{</span>
<a name="361"><font size=-1>361     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;==|&gt;=|&lt;=|&lt;|&gt;|!=&quot;</span><span class="default">)) {</span>
<a name="362"><font size=-1>362     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(then &amp;&amp; !Token::Match(tok, </span><span class="string">&quot;==|&gt;=|&lt;=&quot;</span><span class="default">))</span>
<a name="363"><font size=-1>363     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="364"><font size=-1>364     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!then &amp;&amp; !Token::Match(tok, </span><span class="string">&quot;&lt;|&gt;|!=&quot;</span><span class="default">))</span>
<a name="365"><font size=-1>365     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="366"><font size=-1>366     </font></a><span class="default">        ValueFlow::Value truevalue;</span>
<a name="367"><font size=-1>367     </font></a><span class="default">        ValueFlow::Value falsevalue;</span>
<a name="368"><font size=-1>368     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token* vartok = parseCompareInt(tok, truevalue, falsevalue);</span>
<a name="369"><font size=-1>369     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!vartok)</span>
<a name="370"><font size=-1>370     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="371"><font size=-1>371     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vartok-&gt;varId() == </span><span class="number">0</span><span class="default">)</span>
<a name="372"><font size=-1>372     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="373"><font size=-1>373     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!truevalue.isIntValue())</span>
<a name="374"><font size=-1>374     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="375"><font size=-1>375     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isVariableChanged(tok-&gt;next(), endTok, vartok-&gt;varId(), </span><span class="keyword">false</span><span class="default">, settings, </span><span class="keyword">true</span><span class="default">))</span>
<a name="376"><font size=-1>376     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="377"><font size=-1>377     </font></a><span class="default">        pm.setIntValue(vartok-&gt;varId(),  then ? truevalue.intvalue : falsevalue.intvalue);</span>
<a name="378"><font size=-1>378     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var%&quot;</span><span class="default">)) {</span>
<a name="379"><font size=-1>379     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == </span><span class="number">0</span><span class="default">)</span>
<a name="380"><font size=-1>380     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="381"><font size=-1>381     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(then &amp;&amp; !astIsPointer(tok) &amp;&amp; !astIsBool(tok))</span>
<a name="382"><font size=-1>382     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="383"><font size=-1>383     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isVariableChanged(tok-&gt;next(), endTok, tok-&gt;varId(), </span><span class="keyword">false</span><span class="default">, settings, </span><span class="keyword">true</span><span class="default">))</span>
<a name="384"><font size=-1>384     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="385"><font size=-1>385     </font></a><span class="default">        pm.setIntValue(tok-&gt;varId(), then);</span>
<a name="386"><font size=-1>386     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;!&quot;</span><span class="default">)) {</span>
<a name="387"><font size=-1>387     </font></a><span class="default">        programMemoryParseCondition(pm, tok-&gt;astOperand1(), endTok, settings, !then);</span>
<a name="388"><font size=-1>388     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(then &amp;&amp; Token::simpleMatch(tok, </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">)) {</span>
<a name="389"><font size=-1>389     </font></a><span class="default">        programMemoryParseCondition(pm, tok-&gt;astOperand1(), endTok, settings, then);</span>
<a name="390"><font size=-1>390     </font></a><span class="default">        programMemoryParseCondition(pm, tok-&gt;astOperand2(), endTok, settings, then);</span>
<a name="391"><font size=-1>391     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(!then &amp;&amp; Token::simpleMatch(tok, </span><span class="string">&quot;||&quot;</span><span class="default">)) {</span>
<a name="392"><font size=-1>392     </font></a><span class="default">        programMemoryParseCondition(pm, tok-&gt;astOperand1(), endTok, settings, then);</span>
<a name="393"><font size=-1>393     </font></a><span class="default">        programMemoryParseCondition(pm, tok-&gt;astOperand2(), endTok, settings, then);</span>
<a name="394"><font size=-1>394     </font></a><span class="default">    }</span>
<a name="395"><font size=-1>395     </font></a><span class="default">}</span>
<a name="396"><font size=-1>396     </font></a><span class="default"></span>
<a name="397"><font size=-1>397     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">fillProgramMemoryFromConditions(ProgramMemory&amp; pm, </span><span class="keyword">const </span><span class="default">Scope* scope, </span><span class="keyword">const </span><span class="default">Token* endTok, </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="398"><font size=-1>398     </font></a><span class="default">{</span>
<a name="399"><font size=-1>399     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="400"><font size=-1>400     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="401"><font size=-1>401     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!scope-&gt;isLocal())</span>
<a name="402"><font size=-1>402     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="403"><font size=-1>403     </font></a><span class="default">    assert(scope != scope-&gt;nestedIn);</span>
<a name="404"><font size=-1>404     </font></a><span class="default">    fillProgramMemoryFromConditions(pm, scope-&gt;nestedIn, endTok, settings);</span>
<a name="405"><font size=-1>405     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(scope-&gt;type == Scope::eIf || scope-&gt;type == Scope::eWhile || scope-&gt;type == Scope::eElse) {</span>
<a name="406"><font size=-1>406     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * bodyStart = scope-&gt;bodyStart;</span>
<a name="407"><font size=-1>407     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope-&gt;type == Scope::eElse) {</span>
<a name="408"><font size=-1>408     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(bodyStart-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;} else {&quot;</span><span class="default">))</span>
<a name="409"><font size=-1>409     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="410"><font size=-1>410     </font></a><span class="default">            bodyStart = bodyStart-&gt;linkAt(-</span><span class="number">2</span><span class="default">);</span>
<a name="411"><font size=-1>411     </font></a><span class="default">        }</span>
<a name="412"><font size=-1>412     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * condEndTok = bodyStart-&gt;previous();</span>
<a name="413"><font size=-1>413     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(condEndTok, </span><span class="string">&quot;) {&quot;</span><span class="default">))</span>
<a name="414"><font size=-1>414     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="415"><font size=-1>415     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * condStartTok = condEndTok-&gt;link();</span>
<a name="416"><font size=-1>416     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!condStartTok)</span>
<a name="417"><font size=-1>417     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="418"><font size=-1>418     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(condStartTok-&gt;previous(), </span><span class="string">&quot;if|while (&quot;</span><span class="default">))</span>
<a name="419"><font size=-1>419     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="420"><font size=-1>420     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * condTok = condStartTok-&gt;astOperand2();</span>
<a name="421"><font size=-1>421     </font></a><span class="default">        programMemoryParseCondition(pm, condTok, endTok, settings, scope-&gt;type != Scope::eElse);</span>
<a name="422"><font size=-1>422     </font></a><span class="default">    }</span>
<a name="423"><font size=-1>423     </font></a><span class="default">}</span>
<a name="424"><font size=-1>424     </font></a><span class="default"></span>
<a name="425"><font size=-1>425     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">fillProgramMemoryFromConditions(ProgramMemory&amp; pm, </span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="426"><font size=-1>426     </font></a><span class="default">{</span>
<a name="427"><font size=-1>427     </font></a><span class="default">    fillProgramMemoryFromConditions(pm, tok-&gt;scope(), tok, settings);</span>
<a name="428"><font size=-1>428     </font></a><span class="default">}</span>
<a name="429"><font size=-1>429     </font></a><span class="default"></span>
<a name="430"><font size=-1>430     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">fillProgramMemoryFromAssignments(ProgramMemory&amp; pm, </span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">ProgramMemory&amp; state, std::unordered_map&lt;nonneg </span><span class="keyword">int</span><span class="default">, ValueFlow::Value&gt; vars)</span>
<a name="431"><font size=-1>431     </font></a><span class="default">{</span>
<a name="432"><font size=-1>432     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">indentlevel = </span><span class="number">0</span><span class="default">;</span>
<a name="433"><font size=-1>433     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok2 = tok; tok2; tok2 = tok2-&gt;previous()) {</span>
<a name="434"><font size=-1>434     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">setvar = </span><span class="keyword">false</span><span class="default">;</span>
<a name="435"><font size=-1>435     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[;{}] %var% = %var% ;&quot;</span><span class="default">)) {</span>
<a name="436"><font size=-1>436     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">auto</span><span class="default">&amp;&amp; p:vars) {</span>
<a name="437"><font size=-1>437     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(p.first != tok2-&gt;next()-&gt;varId())</span>
<a name="438"><font size=-1>438     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="439"><font size=-1>439     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *vartok = tok2-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="440"><font size=-1>440     </font></a><span class="default">                pm.setValue(vartok-&gt;varId(), p.second);</span>
<a name="441"><font size=-1>441     </font></a><span class="default">                setvar = </span><span class="keyword">true</span><span class="default">;</span>
<a name="442"><font size=-1>442     </font></a><span class="default">            }</span>
<a name="443"><font size=-1>443     </font></a><span class="default">        }</span>
<a name="444"><font size=-1>444     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!setvar &amp;&amp; (Token::Match(tok2, </span><span class="string">&quot;[;{}] %var% =&quot;</span><span class="default">) ||</span>
<a name="445"><font size=-1>445     </font></a><span class="default">                        Token::Match(tok2, </span><span class="string">&quot;[;{}] const| %type% %var% (&quot;</span><span class="default">))) {</span>
<a name="446"><font size=-1>446     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *vartok = tok2-&gt;next();</span>
<a name="447"><font size=-1>447     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(vartok-&gt;next()-&gt;isName())</span>
<a name="448"><font size=-1>448     </font></a><span class="default">                vartok = vartok-&gt;next();</span>
<a name="449"><font size=-1>449     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!pm.hasValue(vartok-&gt;varId())) {</span>
<a name="450"><font size=-1>450     </font></a><span class="default">                MathLib::bigint result = </span><span class="number">0</span><span class="default">;</span>
<a name="451"><font size=-1>451     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">error = </span><span class="keyword">false</span><span class="default">;</span>
<a name="452"><font size=-1>452     </font></a><span class="default">                execute(vartok-&gt;next()-&gt;astOperand2(), &amp;pm, &amp;result, &amp;error);</span>
<a name="453"><font size=-1>453     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!error)</span>
<a name="454"><font size=-1>454     </font></a><span class="default">                    pm.setIntValue(vartok-&gt;varId(), result);</span>
<a name="455"><font size=-1>455     </font></a><span class="default">            }</span>
<a name="456"><font size=-1>456     </font></a><span class="default">        }</span>
<a name="457"><font size=-1>457     </font></a><span class="default"></span>
<a name="458"><font size=-1>458     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">) {</span>
<a name="459"><font size=-1>459     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(indentlevel &lt;= </span><span class="number">0</span><span class="default">)</span>
<a name="460"><font size=-1>460     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="461"><font size=-1>461     </font></a><span class="default">            --indentlevel;</span>
<a name="462"><font size=-1>462     </font></a><span class="default">        }</span>
<a name="463"><font size=-1>463     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;}&quot;</span><span class="default">) {</span>
<a name="464"><font size=-1>464     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *cond = tok2-&gt;link();</span>
<a name="465"><font size=-1>465     </font></a><span class="default">            cond = Token::simpleMatch(cond-&gt;previous(), </span><span class="string">&quot;) {&quot;</span><span class="default">) ? cond-&gt;linkAt(-</span><span class="number">1</span><span class="default">) : nullptr;</span>
<a name="466"><font size=-1>466     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(cond &amp;&amp; conditionIsFalse(cond-&gt;astOperand2(), state))</span>
<a name="467"><font size=-1>467     </font></a><span class="default">                tok2 = cond-&gt;previous();</span>
<a name="468"><font size=-1>468     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(cond &amp;&amp; conditionIsTrue(cond-&gt;astOperand2(), state)) {</span>
<a name="469"><font size=-1>469     </font></a><span class="default">                ++indentlevel;</span>
<a name="470"><font size=-1>470     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="471"><font size=-1>471     </font></a><span class="default">            } </span><span class="keyword">else</span>
<a name="472"><font size=-1>472     </font></a><span class="keyword">                break</span><span class="default">;</span>
<a name="473"><font size=-1>473     </font></a><span class="default">        }</span>
<a name="474"><font size=-1>474     </font></a><span class="default">    }</span>
<a name="475"><font size=-1>475     </font></a><span class="default">}</span>
<a name="476"><font size=-1>476     </font></a><span class="default"></span>
<a name="477"><font size=-1>477     </font></a><span class="default"></span><span class="comment">/**</span>
<a name="478"><font size=-1>478     </font></a><span class="comment"> * Get program memory by looking backwards from given token.</span>
<a name="479"><font size=-1>479     </font></a><span class="comment"> */</span>
<a name="480"><font size=-1>480     </font></a><span class="comment"></span><span class="keyword">static </span><span class="default">ProgramMemory getProgramMemory(</span><span class="keyword">const </span><span class="default">Token *tok, nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value)</span>
<a name="481"><font size=-1>481     </font></a><span class="default">{</span>
<a name="482"><font size=-1>482     </font></a><span class="default">    ProgramMemory programMemory;</span>
<a name="483"><font size=-1>483     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.tokvalue)</span>
<a name="484"><font size=-1>484     </font></a><span class="default">        fillProgramMemoryFromConditions(programMemory, value.tokvalue, nullptr);</span>
<a name="485"><font size=-1>485     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.condition)</span>
<a name="486"><font size=-1>486     </font></a><span class="default">        fillProgramMemoryFromConditions(programMemory, value.condition, nullptr);</span>
<a name="487"><font size=-1>487     </font></a><span class="default">    programMemory.setValue(varid, value);</span>
<a name="488"><font size=-1>488     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.varId)</span>
<a name="489"><font size=-1>489     </font></a><span class="default">        programMemory.setIntValue(value.varId, value.varvalue);</span>
<a name="490"><font size=-1>490     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">ProgramMemory state = programMemory;</span>
<a name="491"><font size=-1>491     </font></a><span class="default">    fillProgramMemoryFromAssignments(programMemory, tok, state, {{varid, value}});</span>
<a name="492"><font size=-1>492     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">programMemory;</span>
<a name="493"><font size=-1>493     </font></a><span class="default">}</span>
<a name="494"><font size=-1>494     </font></a><span class="default"></span>
<a name="495"><font size=-1>495     </font></a><span class="default"></span><span class="comment">/**</span>
<a name="496"><font size=-1>496     </font></a><span class="comment"> * Should value be skipped because it's hidden inside &amp;&amp; || or ?: expression.</span>
<a name="497"><font size=-1>497     </font></a><span class="comment"> * Example: ((x!=NULL) &amp;&amp; (*x == 123))</span>
<a name="498"><font size=-1>498     </font></a><span class="comment"> * If 'valuetok' points at the x in '(*x == 123)'. Then the '&amp;&amp;' will be returned.</span>
<a name="499"><font size=-1>499     </font></a><span class="comment"> * @param valuetok original variable token</span>
<a name="500"><font size=-1>500     </font></a><span class="comment"> * @return NULL=&gt;don't skip, non-NULL=&gt;The operator token that cause the skip. For instance the '&amp;&amp;'.</span>
<a name="501"><font size=-1>501     </font></a><span class="comment"> * */</span>
<a name="502"><font size=-1>502     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">Token * skipValueInConditionalExpression(</span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">valuetok)</span>
<a name="503"><font size=-1>503     </font></a><span class="default">{</span>
<a name="504"><font size=-1>504     </font></a><span class="default">    </span><span class="comment">// Walk up the ast</span>
<a name="505"><font size=-1>505     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Token *prev = valuetok;</span>
<a name="506"><font size=-1>506     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = valuetok-&gt;astParent(); tok; tok = tok-&gt;astParent()) {</span>
<a name="507"><font size=-1>507     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">prevIsLhs = (prev == tok-&gt;astOperand1());</span>
<a name="508"><font size=-1>508     </font></a><span class="default">        prev = tok;</span>
<a name="509"><font size=-1>509     </font></a><span class="default"></span>
<a name="510"><font size=-1>510     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(prevIsLhs || !Token::Match(tok, </span><span class="string">&quot;%oror%|&amp;&amp;|?|:&quot;</span><span class="default">))</span>
<a name="511"><font size=-1>511     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="512"><font size=-1>512     </font></a><span class="default"></span>
<a name="513"><font size=-1>513     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownIntValue())</span>
<a name="514"><font size=-1>514     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">tok;</span>
<a name="515"><font size=-1>515     </font></a><span class="default"></span>
<a name="516"><font size=-1>516     </font></a><span class="default">        </span><span class="comment">// Is variable protected in LHS..</span>
<a name="517"><font size=-1>517     </font></a><span class="comment">        </span><span class="keyword">bool </span><span class="default">bailout = </span><span class="keyword">false</span><span class="default">;</span>
<a name="518"><font size=-1>518     </font></a><span class="default">        visitAstNodes(tok-&gt;astOperand1(), [&amp;](</span><span class="keyword">const </span><span class="default">Token *tok2) {</span>
<a name="519"><font size=-1>519     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;.&quot;</span><span class="default">)</span>
<a name="520"><font size=-1>520     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">ChildrenToVisit::none;</span>
<a name="521"><font size=-1>521     </font></a><span class="default">            </span><span class="comment">// A variable is seen..</span>
<a name="522"><font size=-1>522     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok2 != valuetok &amp;&amp; tok2-&gt;variable() &amp;&amp;</span>
<a name="523"><font size=-1>523     </font></a><span class="default">                (tok2-&gt;varId() == valuetok-&gt;varId() || (!tok2-&gt;variable()-&gt;isArgument() &amp;&amp; !tok2-&gt;hasKnownIntValue()))) {</span>
<a name="524"><font size=-1>524     </font></a><span class="default">                </span><span class="comment">// TODO: limit this bailout</span>
<a name="525"><font size=-1>525     </font></a><span class="comment">                </span><span class="default">bailout = </span><span class="keyword">true</span><span class="default">;</span>
<a name="526"><font size=-1>526     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">ChildrenToVisit::done;</span>
<a name="527"><font size=-1>527     </font></a><span class="default">            }</span>
<a name="528"><font size=-1>528     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">ChildrenToVisit::op1_and_op2;</span>
<a name="529"><font size=-1>529     </font></a><span class="default">        });</span>
<a name="530"><font size=-1>530     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(bailout)</span>
<a name="531"><font size=-1>531     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">tok;</span>
<a name="532"><font size=-1>532     </font></a><span class="default">    }</span>
<a name="533"><font size=-1>533     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="534"><font size=-1>534     </font></a><span class="default">}</span>
<a name="535"><font size=-1>535     </font></a><span class="default"></span>
<a name="536"><font size=-1>536     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isEscapeScope(</span><span class="keyword">const </span><span class="default">Token* tok, TokenList * tokenlist, </span><span class="keyword">bool </span><span class="default">unknown = </span><span class="keyword">false</span><span class="default">)</span>
<a name="537"><font size=-1>537     </font></a><span class="default">{</span>
<a name="538"><font size=-1>538     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;{&quot;</span><span class="default">))</span>
<a name="539"><font size=-1>539     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="540"><font size=-1>540     </font></a><span class="default">    </span><span class="comment">// TODO this search for termTok in all subscopes. It should check the end of the scope.</span>
<a name="541"><font size=-1>541     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Token * termTok = Token::findmatch(tok, </span><span class="string">&quot;return|continue|break|throw|goto&quot;</span><span class="default">, tok-&gt;link());</span>
<a name="542"><font size=-1>542     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(termTok &amp;&amp; termTok-&gt;scope() == tok-&gt;scope())</span>
<a name="543"><font size=-1>543     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="544"><font size=-1>544     </font></a><span class="default">    std::string unknownFunction;</span>
<a name="545"><font size=-1>545     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tokenlist &amp;&amp; tokenlist-&gt;getSettings()-&gt;library.isScopeNoReturn(tok-&gt;link(), &amp;unknownFunction))</span>
<a name="546"><font size=-1>546     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">unknownFunction.empty() || unknown;</span>
<a name="547"><font size=-1>547     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="548"><font size=-1>548     </font></a><span class="default">}</span>
<a name="549"><font size=-1>549     </font></a><span class="default"></span>
<a name="550"><font size=-1>550     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">bailoutSelfAssignment(</span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">tok)</span>
<a name="551"><font size=-1>551     </font></a><span class="default">{</span>
<a name="552"><font size=-1>552     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *parent = tok;</span>
<a name="553"><font size=-1>553     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(parent) {</span>
<a name="554"><font size=-1>554     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *op = parent;</span>
<a name="555"><font size=-1>555     </font></a><span class="default">        parent = parent-&gt;astParent();</span>
<a name="556"><font size=-1>556     </font></a><span class="default"></span>
<a name="557"><font size=-1>557     </font></a><span class="default">        </span><span class="comment">// Assignment where lhs variable exists in rhs =&gt; return true</span>
<a name="558"><font size=-1>558     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(parent                         != nullptr      &amp;&amp;</span>
<a name="559"><font size=-1>559     </font></a><span class="default">            parent-&gt;astOperand2()          == op           &amp;&amp;</span>
<a name="560"><font size=-1>560     </font></a><span class="default">            parent-&gt;astOperand1()          != nullptr      &amp;&amp;</span>
<a name="561"><font size=-1>561     </font></a><span class="default">            parent-&gt;str()                  == </span><span class="string">&quot;=&quot;</span><span class="default">) {</span>
<a name="562"><font size=-1>562     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *lhs = parent-&gt;astOperand1(); lhs; lhs = lhs-&gt;astOperand1()) {</span>
<a name="563"><font size=-1>563     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(lhs-&gt;varId() == tok-&gt;varId())</span>
<a name="564"><font size=-1>564     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="565"><font size=-1>565     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(lhs-&gt;astOperand2() &amp;&amp; lhs-&gt;astOperand2()-&gt;varId() == tok-&gt;varId())</span>
<a name="566"><font size=-1>566     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="567"><font size=-1>567     </font></a><span class="default">            }</span>
<a name="568"><font size=-1>568     </font></a><span class="default">        }</span>
<a name="569"><font size=-1>569     </font></a><span class="default">    }</span>
<a name="570"><font size=-1>570     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="571"><font size=-1>571     </font></a><span class="default">}</span>
<a name="572"><font size=-1>572     </font></a><span class="default"></span>
<a name="573"><font size=-1>573     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">ValueFlow::Value castValue(ValueFlow::Value value, </span><span class="keyword">const </span><span class="default">ValueType::Sign sign, nonneg </span><span class="keyword">int </span><span class="default">bit)</span>
<a name="574"><font size=-1>574     </font></a><span class="default">{</span>
<a name="575"><font size=-1>575     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.isFloatValue()) {</span>
<a name="576"><font size=-1>576     </font></a><span class="default">        value.valueType = ValueFlow::Value::INT;</span>
<a name="577"><font size=-1>577     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.floatValue &gt;= std::numeric_limits&lt;</span><span class="keyword">int</span><span class="default">&gt;::min() &amp;&amp; value.floatValue &lt;= std::numeric_limits&lt;</span><span class="keyword">int</span><span class="default">&gt;::max()) {</span>
<a name="578"><font size=-1>578     </font></a><span class="default">            value.intvalue = value.floatValue;</span>
<a name="579"><font size=-1>579     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{ </span><span class="comment">// don't perform UB</span>
<a name="580"><font size=-1>580     </font></a><span class="comment">            </span><span class="default">value.intvalue = </span><span class="number">0</span><span class="default">;</span>
<a name="581"><font size=-1>581     </font></a><span class="default">        }</span>
<a name="582"><font size=-1>582     </font></a><span class="default">    }</span>
<a name="583"><font size=-1>583     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(bit &lt; MathLib::bigint_bits) {</span>
<a name="584"><font size=-1>584     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">MathLib::biguint one = </span><span class="number">1</span><span class="default">;</span>
<a name="585"><font size=-1>585     </font></a><span class="default">        value.intvalue &amp;= (one &lt;&lt; bit) - </span><span class="number">1</span><span class="default">;</span>
<a name="586"><font size=-1>586     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(sign == ValueType::Sign::SIGNED &amp;&amp; value.intvalue &amp; (one &lt;&lt; (bit - </span><span class="number">1</span><span class="default">))) {</span>
<a name="587"><font size=-1>587     </font></a><span class="default">            value.intvalue |= ~((one &lt;&lt; bit) - </span><span class="number">1ULL</span><span class="default">);</span>
<a name="588"><font size=-1>588     </font></a><span class="default">        }</span>
<a name="589"><font size=-1>589     </font></a><span class="default">    }</span>
<a name="590"><font size=-1>590     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">value;</span>
<a name="591"><font size=-1>591     </font></a><span class="default">}</span>
<a name="592"><font size=-1>592     </font></a><span class="default"></span>
<a name="593"><font size=-1>593     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">combineValueProperties(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value1, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value2, ValueFlow::Value *result)</span>
<a name="594"><font size=-1>594     </font></a><span class="default">{</span>
<a name="595"><font size=-1>595     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value1.isKnown() &amp;&amp; value2.isKnown())</span>
<a name="596"><font size=-1>596     </font></a><span class="default">        result-&gt;setKnown();</span>
<a name="597"><font size=-1>597     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(value1.isImpossible() || value2.isImpossible())</span>
<a name="598"><font size=-1>598     </font></a><span class="default">        result-&gt;setImpossible();</span>
<a name="599"><font size=-1>599     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(value1.isInconclusive() || value2.isInconclusive())</span>
<a name="600"><font size=-1>600     </font></a><span class="default">        result-&gt;setInconclusive();</span>
<a name="601"><font size=-1>601     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="602"><font size=-1>602     </font></a><span class="keyword">        </span><span class="default">result-&gt;setPossible();</span>
<a name="603"><font size=-1>603     </font></a><span class="default">    result-&gt;condition = value1.condition ? value1.condition : value2.condition;</span>
<a name="604"><font size=-1>604     </font></a><span class="default">    result-&gt;varId = (value1.varId != </span><span class="number">0U</span><span class="default">) ? value1.varId : value2.varId;</span>
<a name="605"><font size=-1>605     </font></a><span class="default">    result-&gt;varvalue = (result-&gt;varId == value1.varId) ? value1.varvalue : value2.varvalue;</span>
<a name="606"><font size=-1>606     </font></a><span class="default">    result-&gt;errorPath = (value1.errorPath.empty() ? value2 : value1).errorPath;</span>
<a name="607"><font size=-1>607     </font></a><span class="default">    result-&gt;safe = value1.safe || value2.safe;</span>
<a name="608"><font size=-1>608     </font></a><span class="default">}</span>
<a name="609"><font size=-1>609     </font></a><span class="default"></span>
<a name="610"><font size=-1>610     </font></a><span class="default"></span>
<a name="611"><font size=-1>611     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token *getCastTypeStartToken(</span><span class="keyword">const </span><span class="default">Token *parent)</span>
<a name="612"><font size=-1>612     </font></a><span class="default">{</span>
<a name="613"><font size=-1>613     </font></a><span class="default">    </span><span class="comment">// TODO: This might be a generic utility function?</span>
<a name="614"><font size=-1>614     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!parent || parent-&gt;str() != </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="615"><font size=-1>615     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="616"><font size=-1>616     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!parent-&gt;astOperand2() &amp;&amp; Token::Match(parent,</span><span class="string">&quot;( %name%&quot;</span><span class="default">))</span>
<a name="617"><font size=-1>617     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">parent-&gt;next();</span>
<a name="618"><font size=-1>618     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(parent-&gt;astOperand2() &amp;&amp; Token::Match(parent-&gt;astOperand1(), </span><span class="string">&quot;const_cast|dynamic_cast|reinterpret_cast|static_cast &lt;&quot;</span><span class="default">))</span>
<a name="619"><font size=-1>619     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">parent-&gt;astOperand1()-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="620"><font size=-1>620     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="621"><font size=-1>621     </font></a><span class="default">}</span>
<a name="622"><font size=-1>622     </font></a><span class="default"></span>
<a name="623"><font size=-1>623     </font></a><span class="default"></span><span class="comment">/** Set token value for cast */</span>
<a name="624"><font size=-1>624     </font></a><span class="comment"></span><span class="keyword">static void </span><span class="default">setTokenValueCast(Token *parent, </span><span class="keyword">const </span><span class="default">ValueType &amp;valueType, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value, </span><span class="keyword">const </span><span class="default">Settings *settings);</span>
<a name="625"><font size=-1>625     </font></a><span class="default"></span>
<a name="626"><font size=-1>626     </font></a><span class="default"></span><span class="comment">/** set ValueFlow value and perform calculations if possible */</span>
<a name="627"><font size=-1>627     </font></a><span class="comment"></span><span class="keyword">static void </span><span class="default">setTokenValue(Token* tok, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="628"><font size=-1>628     </font></a><span class="default">{</span>
<a name="629"><font size=-1>629     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;addValue(value))</span>
<a name="630"><font size=-1>630     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="631"><font size=-1>631     </font></a><span class="default"></span>
<a name="632"><font size=-1>632     </font></a><span class="default">    Token *parent = tok-&gt;astParent();</span>
<a name="633"><font size=-1>633     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!parent)</span>
<a name="634"><font size=-1>634     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="635"><font size=-1>635     </font></a><span class="default"></span>
<a name="636"><font size=-1>636     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.isContainerSizeValue()) {</span>
<a name="637"><font size=-1>637     </font></a><span class="default">        </span><span class="comment">// .empty, .size, +&quot;abc&quot;, +'a'</span>
<a name="638"><font size=-1>638     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;+&quot;</span><span class="default">) {</span>
<a name="639"><font size=-1>639     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value1 : parent-&gt;astOperand1()-&gt;values()) {</span>
<a name="640"><font size=-1>640     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value2 : parent-&gt;astOperand2()-&gt;values()) {</span>
<a name="641"><font size=-1>641     </font></a><span class="default">                    ValueFlow::Value result;</span>
<a name="642"><font size=-1>642     </font></a><span class="default">                    result.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="643"><font size=-1>643     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(value1.isContainerSizeValue() &amp;&amp; value2.isContainerSizeValue())</span>
<a name="644"><font size=-1>644     </font></a><span class="default">                        result.intvalue = value1.intvalue + value2.intvalue;</span>
<a name="645"><font size=-1>645     </font></a><span class="default">                    </span><span class="keyword">else if </span><span class="default">(value1.isContainerSizeValue() &amp;&amp; value2.isTokValue() &amp;&amp; value2.tokvalue-&gt;tokType() == Token::eString)</span>
<a name="646"><font size=-1>646     </font></a><span class="default">                        result.intvalue = value1.intvalue + Token::getStrLength(value2.tokvalue);</span>
<a name="647"><font size=-1>647     </font></a><span class="default">                    </span><span class="keyword">else if </span><span class="default">(value2.isContainerSizeValue() &amp;&amp; value1.isTokValue() &amp;&amp; value1.tokvalue-&gt;tokType() == Token::eString)</span>
<a name="648"><font size=-1>648     </font></a><span class="default">                        result.intvalue = Token::getStrLength(value1.tokvalue) + value2.intvalue;</span>
<a name="649"><font size=-1>649     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="650"><font size=-1>650     </font></a><span class="keyword">                        continue</span><span class="default">;</span>
<a name="651"><font size=-1>651     </font></a><span class="default"></span>
<a name="652"><font size=-1>652     </font></a><span class="default">                    combineValueProperties(value1, value2, &amp;result);</span>
<a name="653"><font size=-1>653     </font></a><span class="default"></span>
<a name="654"><font size=-1>654     </font></a><span class="default">                    setTokenValue(parent, result, settings);</span>
<a name="655"><font size=-1>655     </font></a><span class="default">                }</span>
<a name="656"><font size=-1>656     </font></a><span class="default">            }</span>
<a name="657"><font size=-1>657     </font></a><span class="default">        }</span>
<a name="658"><font size=-1>658     </font></a><span class="default"></span>
<a name="659"><font size=-1>659     </font></a><span class="default"></span>
<a name="660"><font size=-1>660     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(parent, </span><span class="string">&quot;. %name% (&quot;</span><span class="default">) &amp;&amp; parent-&gt;astParent() == parent-&gt;tokAt(</span><span class="number">2</span><span class="default">) &amp;&amp; parent-&gt;astOperand1() &amp;&amp; parent-&gt;astOperand1()-&gt;valueType()) {</span>
<a name="661"><font size=-1>661     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Library::Container *c = parent-&gt;astOperand1()-&gt;valueType()-&gt;container;</span>
<a name="662"><font size=-1>662     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Library::Container::Yield yields = c ? c-&gt;getYield(parent-&gt;strAt(</span><span class="number">1</span><span class="default">)) : Library::Container::Yield::NO_YIELD;</span>
<a name="663"><font size=-1>663     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(yields == Library::Container::Yield::SIZE) {</span>
<a name="664"><font size=-1>664     </font></a><span class="default">                ValueFlow::Value v(value);</span>
<a name="665"><font size=-1>665     </font></a><span class="default">                v.valueType = ValueFlow::Value::ValueType::INT;</span>
<a name="666"><font size=-1>666     </font></a><span class="default">                setTokenValue(parent-&gt;astParent(), v, settings);</span>
<a name="667"><font size=-1>667     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(yields == Library::Container::Yield::EMPTY) {</span>
<a name="668"><font size=-1>668     </font></a><span class="default">                ValueFlow::Value v(value);</span>
<a name="669"><font size=-1>669     </font></a><span class="default">                v.intvalue = !v.intvalue;</span>
<a name="670"><font size=-1>670     </font></a><span class="default">                v.valueType = ValueFlow::Value::ValueType::INT;</span>
<a name="671"><font size=-1>671     </font></a><span class="default">                setTokenValue(parent-&gt;astParent(), v, settings);</span>
<a name="672"><font size=-1>672     </font></a><span class="default">            }</span>
<a name="673"><font size=-1>673     </font></a><span class="default">        }</span>
<a name="674"><font size=-1>674     </font></a><span class="default"></span>
<a name="675"><font size=-1>675     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="676"><font size=-1>676     </font></a><span class="default">    }</span>
<a name="677"><font size=-1>677     </font></a><span class="default"></span>
<a name="678"><font size=-1>678     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.isLifetimeValue()) {</span>
<a name="679"><font size=-1>679     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.lifetimeKind == ValueFlow::Value::LifetimeKind::Iterator &amp;&amp; astIsIterator(parent)) {</span>
<a name="680"><font size=-1>680     </font></a><span class="default">            setTokenValue(parent,value,settings);</span>
<a name="681"><font size=-1>681     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(astIsPointer(tok) &amp;&amp; astIsPointer(parent) &amp;&amp;</span>
<a name="682"><font size=-1>682     </font></a><span class="default">                   (parent-&gt;isArithmeticalOp() || Token::Match(parent, </span><span class="string">&quot;( %type%&quot;</span><span class="default">))) {</span>
<a name="683"><font size=-1>683     </font></a><span class="default">            setTokenValue(parent,value,settings);</span>
<a name="684"><font size=-1>684     </font></a><span class="default">        }</span>
<a name="685"><font size=-1>685     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="686"><font size=-1>686     </font></a><span class="default">    }</span>
<a name="687"><font size=-1>687     </font></a><span class="default"></span>
<a name="688"><font size=-1>688     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.isUninitValue()) {</span>
<a name="689"><font size=-1>689     </font></a><span class="default">        ValueFlow::Value pvalue = value;</span>
<a name="690"><font size=-1>690     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(parent-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">)) {</span>
<a name="691"><font size=-1>691     </font></a><span class="default">            pvalue.indirect++;</span>
<a name="692"><font size=-1>692     </font></a><span class="default">            setTokenValue(parent, pvalue, settings);</span>
<a name="693"><font size=-1>693     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(parent, </span><span class="string">&quot;. %var%&quot;</span><span class="default">) &amp;&amp; parent-&gt;astOperand1() == tok) {</span>
<a name="694"><font size=-1>694     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(parent-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot; </span><span class="default">&amp;&amp; pvalue.indirect &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="695"><font size=-1>695     </font></a><span class="default">                pvalue.indirect--;</span>
<a name="696"><font size=-1>696     </font></a><span class="default">            setTokenValue(parent-&gt;astOperand2(), pvalue, settings);</span>
<a name="697"><font size=-1>697     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(parent-&gt;astParent(), </span><span class="string">&quot;. %var%&quot;</span><span class="default">) &amp;&amp; parent-&gt;astParent()-&gt;astOperand1() == parent) {</span>
<a name="698"><font size=-1>698     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(parent-&gt;astParent()-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot; </span><span class="default">&amp;&amp; pvalue.indirect &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="699"><font size=-1>699     </font></a><span class="default">                pvalue.indirect--;</span>
<a name="700"><font size=-1>700     </font></a><span class="default">            setTokenValue(parent-&gt;astParent()-&gt;astOperand2(), pvalue, settings);</span>
<a name="701"><font size=-1>701     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(parent-&gt;isUnaryOp(</span><span class="string">&quot;*&quot;</span><span class="default">) &amp;&amp; pvalue.indirect &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="702"><font size=-1>702     </font></a><span class="default">            pvalue.indirect--;</span>
<a name="703"><font size=-1>703     </font></a><span class="default">            setTokenValue(parent, pvalue, settings);</span>
<a name="704"><font size=-1>704     </font></a><span class="default">        }</span>
<a name="705"><font size=-1>705     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="706"><font size=-1>706     </font></a><span class="default">    }</span>
<a name="707"><font size=-1>707     </font></a><span class="default"></span>
<a name="708"><font size=-1>708     </font></a><span class="default">    </span><span class="comment">// cast..</span>
<a name="709"><font size=-1>709     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *castType = getCastTypeStartToken(parent)) {</span>
<a name="710"><font size=-1>710     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(astIsPointer(tok) &amp;&amp; value.valueType == ValueFlow::Value::INT &amp;&amp;</span>
<a name="711"><font size=-1>711     </font></a><span class="default">            Token::simpleMatch(parent-&gt;astOperand1(), </span><span class="string">&quot;dynamic_cast&quot;</span><span class="default">))</span>
<a name="712"><font size=-1>712     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="713"><font size=-1>713     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">ValueType &amp;valueType = ValueType::parseDecl(castType, settings);</span>
<a name="714"><font size=-1>714     </font></a><span class="default">        setTokenValueCast(parent, valueType, value, settings);</span>
<a name="715"><font size=-1>715     </font></a><span class="default">    }</span>
<a name="716"><font size=-1>716     </font></a><span class="default"></span>
<a name="717"><font size=-1>717     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;:&quot;</span><span class="default">) {</span>
<a name="718"><font size=-1>718     </font></a><span class="default">        setTokenValue(parent,value,settings);</span>
<a name="719"><font size=-1>719     </font></a><span class="default">    }</span>
<a name="720"><font size=-1>720     </font></a><span class="default"></span>
<a name="721"><font size=-1>721     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;?&quot; </span><span class="default">&amp;&amp; tok-&gt;str() == </span><span class="string">&quot;:&quot; </span><span class="default">&amp;&amp; tok == parent-&gt;astOperand2() &amp;&amp; parent-&gt;astOperand1()) {</span>
<a name="722"><font size=-1>722     </font></a><span class="default">        </span><span class="comment">// is condition always true/false?</span>
<a name="723"><font size=-1>723     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(parent-&gt;astOperand1()-&gt;hasKnownValue()) {</span>
<a name="724"><font size=-1>724     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;condvalue = parent-&gt;astOperand1()-&gt;values().front();</span>
<a name="725"><font size=-1>725     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">cond(condvalue.isTokValue() || (condvalue.isIntValue() &amp;&amp; condvalue.intvalue != </span><span class="number">0</span><span class="default">));</span>
<a name="726"><font size=-1>726     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(cond &amp;&amp; !tok-&gt;astOperand1()) { </span><span class="comment">// true condition, no second operator</span>
<a name="727"><font size=-1>727     </font></a><span class="comment">                </span><span class="default">setTokenValue(parent, condvalue, settings);</span>
<a name="728"><font size=-1>728     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="729"><font size=-1>729     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *op = cond ? tok-&gt;astOperand1() : tok-&gt;astOperand2();</span>
<a name="730"><font size=-1>730     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!op) </span><span class="comment">// #7769 segmentation fault at setTokenValue()</span>
<a name="731"><font size=-1>731     </font></a><span class="comment">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="732"><font size=-1>732     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; &amp;values = op-&gt;values();</span>
<a name="733"><font size=-1>733     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(std::find(values.begin(), values.end(), value) != values.end())</span>
<a name="734"><font size=-1>734     </font></a><span class="default">                    setTokenValue(parent, value, settings);</span>
<a name="735"><font size=-1>735     </font></a><span class="default">            }</span>
<a name="736"><font size=-1>736     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="737"><font size=-1>737     </font></a><span class="default">            </span><span class="comment">// is condition only depending on 1 variable?</span>
<a name="738"><font size=-1>738     </font></a><span class="comment">            </span><span class="keyword">int </span><span class="default">varId = </span><span class="number">0</span><span class="default">;</span>
<a name="739"><font size=-1>739     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">ret = </span><span class="keyword">false</span><span class="default">;</span>
<a name="740"><font size=-1>740     </font></a><span class="default">            visitAstNodes(parent-&gt;astOperand1(),</span>
<a name="741"><font size=-1>741     </font></a><span class="default">            [&amp;](</span><span class="keyword">const </span><span class="default">Token *t) {</span>
<a name="742"><font size=-1>742     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(t-&gt;varId()) {</span>
<a name="743"><font size=-1>743     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(varId &gt; </span><span class="number">0 </span><span class="default">|| value.varId != </span><span class="number">0U</span><span class="default">)</span>
<a name="744"><font size=-1>744     </font></a><span class="default">                        ret = </span><span class="keyword">true</span><span class="default">;</span>
<a name="745"><font size=-1>745     </font></a><span class="default">                    varId = t-&gt;varId();</span>
<a name="746"><font size=-1>746     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(t-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; Token::Match(t-&gt;previous(), </span><span class="string">&quot;%name%&quot;</span><span class="default">))</span>
<a name="747"><font size=-1>747     </font></a><span class="default">                    ret = </span><span class="keyword">true</span><span class="default">; </span><span class="comment">// function call</span>
<a name="748"><font size=-1>748     </font></a><span class="comment">                </span><span class="keyword">return </span><span class="default">ret ? ChildrenToVisit::done : ChildrenToVisit::op1_and_op2;</span>
<a name="749"><font size=-1>749     </font></a><span class="default">            });</span>
<a name="750"><font size=-1>750     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ret)</span>
<a name="751"><font size=-1>751     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="752"><font size=-1>752     </font></a><span class="default"></span>
<a name="753"><font size=-1>753     </font></a><span class="default">            ValueFlow::Value v(value);</span>
<a name="754"><font size=-1>754     </font></a><span class="default">            v.conditional = </span><span class="keyword">true</span><span class="default">;</span>
<a name="755"><font size=-1>755     </font></a><span class="default">            v.changeKnownToPossible();</span>
<a name="756"><font size=-1>756     </font></a><span class="default"></span>
<a name="757"><font size=-1>757     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varId)</span>
<a name="758"><font size=-1>758     </font></a><span class="default">                v.varId = varId;</span>
<a name="759"><font size=-1>759     </font></a><span class="default"></span>
<a name="760"><font size=-1>760     </font></a><span class="default">            setTokenValue(parent, v, settings);</span>
<a name="761"><font size=-1>761     </font></a><span class="default">        }</span>
<a name="762"><font size=-1>762     </font></a><span class="default">    }</span>
<a name="763"><font size=-1>763     </font></a><span class="default"></span>
<a name="764"><font size=-1>764     </font></a><span class="default">    </span><span class="comment">// Calculations..</span>
<a name="765"><font size=-1>765     </font></a><span class="comment">    </span><span class="keyword">else if </span><span class="default">((parent-&gt;isArithmeticalOp() || parent-&gt;isComparisonOp() || (parent-&gt;tokType() == Token::eBitOp) || (parent-&gt;tokType() == Token::eLogicalOp)) &amp;&amp;</span>
<a name="766"><font size=-1>766     </font></a><span class="default">             parent-&gt;astOperand1() &amp;&amp;</span>
<a name="767"><font size=-1>767     </font></a><span class="default">             parent-&gt;astOperand2()) {</span>
<a name="768"><font size=-1>768     </font></a><span class="default"></span>
<a name="769"><font size=-1>769     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">noninvertible = parent-&gt;isComparisonOp() || Token::Match(parent, </span><span class="string">&quot;%|/|&amp;|%or%&quot;</span><span class="default">);</span>
<a name="770"><font size=-1>770     </font></a><span class="default"></span>
<a name="771"><font size=-1>771     </font></a><span class="default">        </span><span class="comment">// Skip operators with impossible values that are not invertible</span>
<a name="772"><font size=-1>772     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(noninvertible &amp;&amp; value.isImpossible())</span>
<a name="773"><font size=-1>773     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="774"><font size=-1>774     </font></a><span class="default"></span>
<a name="775"><font size=-1>775     </font></a><span class="default">        </span><span class="comment">// known result when a operand is 0.</span>
<a name="776"><font size=-1>776     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(parent, </span><span class="string">&quot;[&amp;*]&quot;</span><span class="default">) &amp;&amp; value.isKnown() &amp;&amp; value.isIntValue() &amp;&amp; value.intvalue==</span><span class="number">0</span><span class="default">) {</span>
<a name="777"><font size=-1>777     </font></a><span class="default">            setTokenValue(parent, value, settings);</span>
<a name="778"><font size=-1>778     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="779"><font size=-1>779     </font></a><span class="default">        }</span>
<a name="780"><font size=-1>780     </font></a><span class="default"></span>
<a name="781"><font size=-1>781     </font></a><span class="default">        </span><span class="comment">// known result when a operand is true.</span>
<a name="782"><font size=-1>782     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(parent, </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">) &amp;&amp; value.isKnown() &amp;&amp; value.isIntValue() &amp;&amp; value.intvalue==</span><span class="number">0</span><span class="default">) {</span>
<a name="783"><font size=-1>783     </font></a><span class="default">            setTokenValue(parent, value, settings);</span>
<a name="784"><font size=-1>784     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="785"><font size=-1>785     </font></a><span class="default">        }</span>
<a name="786"><font size=-1>786     </font></a><span class="default"></span>
<a name="787"><font size=-1>787     </font></a><span class="default">        </span><span class="comment">// known result when a operand is false.</span>
<a name="788"><font size=-1>788     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(parent, </span><span class="string">&quot;||&quot;</span><span class="default">) &amp;&amp; value.isKnown() &amp;&amp; value.isIntValue() &amp;&amp; value.intvalue!=</span><span class="number">0</span><span class="default">) {</span>
<a name="789"><font size=-1>789     </font></a><span class="default">            setTokenValue(parent, value, settings);</span>
<a name="790"><font size=-1>790     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="791"><font size=-1>791     </font></a><span class="default">        }</span>
<a name="792"><font size=-1>792     </font></a><span class="default"></span>
<a name="793"><font size=-1>793     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value1 : parent-&gt;astOperand1()-&gt;values()) {</span>
<a name="794"><font size=-1>794     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(noninvertible &amp;&amp; value1.isImpossible())</span>
<a name="795"><font size=-1>795     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="796"><font size=-1>796     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!value1.isIntValue() &amp;&amp; !value1.isFloatValue() &amp;&amp; !value1.isTokValue())</span>
<a name="797"><font size=-1>797     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="798"><font size=-1>798     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(value1.isTokValue() &amp;&amp; (!parent-&gt;isComparisonOp() || value1.tokvalue-&gt;tokType() != Token::eString))</span>
<a name="799"><font size=-1>799     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="800"><font size=-1>800     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value2 : parent-&gt;astOperand2()-&gt;values()) {</span>
<a name="801"><font size=-1>801     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(noninvertible &amp;&amp; value2.isImpossible())</span>
<a name="802"><font size=-1>802     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="803"><font size=-1>803     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!value2.isIntValue() &amp;&amp; !value2.isFloatValue() &amp;&amp; !value2.isTokValue())</span>
<a name="804"><font size=-1>804     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="805"><font size=-1>805     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(value2.isTokValue() &amp;&amp; (!parent-&gt;isComparisonOp() || value2.tokvalue-&gt;tokType() != Token::eString || value1.isTokValue()))</span>
<a name="806"><font size=-1>806     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="807"><font size=-1>807     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(value1.isKnown() || value2.isKnown() || value1.varId == </span><span class="number">0U </span><span class="default">|| value2.varId == </span><span class="number">0U </span><span class="default">||</span>
<a name="808"><font size=-1>808     </font></a><span class="default">                    (value1.varId == value2.varId &amp;&amp; value1.varvalue == value2.varvalue &amp;&amp; value1.isIntValue() &amp;&amp;</span>
<a name="809"><font size=-1>809     </font></a><span class="default">                     value2.isIntValue())) {</span>
<a name="810"><font size=-1>810     </font></a><span class="default">                    ValueFlow::Value result(</span><span class="number">0</span><span class="default">);</span>
<a name="811"><font size=-1>811     </font></a><span class="default">                    combineValueProperties(value1, value2, &amp;result);</span>
<a name="812"><font size=-1>812     </font></a><span class="default">                    </span><span class="keyword">const float </span><span class="default">floatValue1 = value1.isIntValue() ? value1.intvalue : value1.floatValue;</span>
<a name="813"><font size=-1>813     </font></a><span class="default">                    </span><span class="keyword">const float </span><span class="default">floatValue2 = value2.isIntValue() ? value2.intvalue : value2.floatValue;</span>
<a name="814"><font size=-1>814     </font></a><span class="default">                    </span><span class="keyword">switch </span><span class="default">(parent-&gt;str()[</span><span class="number">0</span><span class="default">]) {</span>
<a name="815"><font size=-1>815     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'+'</span><span class="default">:</span>
<a name="816"><font size=-1>816     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isTokValue() || value2.isTokValue())</span>
<a name="817"><font size=-1>817     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="818"><font size=-1>818     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isFloatValue() || value2.isFloatValue()) {</span>
<a name="819"><font size=-1>819     </font></a><span class="default">                            result.valueType = ValueFlow::Value::FLOAT;</span>
<a name="820"><font size=-1>820     </font></a><span class="default">                            result.floatValue = floatValue1 + floatValue2;</span>
<a name="821"><font size=-1>821     </font></a><span class="default">                        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="822"><font size=-1>822     </font></a><span class="default">                            result.intvalue = value1.intvalue + value2.intvalue;</span>
<a name="823"><font size=-1>823     </font></a><span class="default">                        }</span>
<a name="824"><font size=-1>824     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="825"><font size=-1>825     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="826"><font size=-1>826     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'-'</span><span class="default">:</span>
<a name="827"><font size=-1>827     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isTokValue() || value2.isTokValue())</span>
<a name="828"><font size=-1>828     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="829"><font size=-1>829     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isFloatValue() || value2.isFloatValue()) {</span>
<a name="830"><font size=-1>830     </font></a><span class="default">                            result.valueType = ValueFlow::Value::FLOAT;</span>
<a name="831"><font size=-1>831     </font></a><span class="default">                            result.floatValue = floatValue1 - floatValue2;</span>
<a name="832"><font size=-1>832     </font></a><span class="default">                        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="833"><font size=-1>833     </font></a><span class="default">                            result.intvalue = value1.intvalue - value2.intvalue;</span>
<a name="834"><font size=-1>834     </font></a><span class="default">                        }</span>
<a name="835"><font size=-1>835     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="836"><font size=-1>836     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="837"><font size=-1>837     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'*'</span><span class="default">:</span>
<a name="838"><font size=-1>838     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isTokValue() || value2.isTokValue())</span>
<a name="839"><font size=-1>839     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="840"><font size=-1>840     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isFloatValue() || value2.isFloatValue()) {</span>
<a name="841"><font size=-1>841     </font></a><span class="default">                            result.valueType = ValueFlow::Value::FLOAT;</span>
<a name="842"><font size=-1>842     </font></a><span class="default">                            result.floatValue = floatValue1 * floatValue2;</span>
<a name="843"><font size=-1>843     </font></a><span class="default">                        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="844"><font size=-1>844     </font></a><span class="default">                            result.intvalue = value1.intvalue * value2.intvalue;</span>
<a name="845"><font size=-1>845     </font></a><span class="default">                        }</span>
<a name="846"><font size=-1>846     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="847"><font size=-1>847     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="848"><font size=-1>848     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'/'</span><span class="default">:</span>
<a name="849"><font size=-1>849     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isTokValue() || value2.isTokValue() || value2.intvalue == </span><span class="number">0</span><span class="default">)</span>
<a name="850"><font size=-1>850     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="851"><font size=-1>851     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value1.isFloatValue() || value2.isFloatValue()) {</span>
<a name="852"><font size=-1>852     </font></a><span class="default">                            result.valueType = ValueFlow::Value::FLOAT;</span>
<a name="853"><font size=-1>853     </font></a><span class="default">                            result.floatValue = floatValue1 / floatValue2;</span>
<a name="854"><font size=-1>854     </font></a><span class="default">                        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="855"><font size=-1>855     </font></a><span class="default">                            result.intvalue = value1.intvalue / value2.intvalue;</span>
<a name="856"><font size=-1>856     </font></a><span class="default">                        }</span>
<a name="857"><font size=-1>857     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="858"><font size=-1>858     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="859"><font size=-1>859     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'%'</span><span class="default">:</span>
<a name="860"><font size=-1>860     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!value1.isIntValue() || !value2.isIntValue())</span>
<a name="861"><font size=-1>861     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="862"><font size=-1>862     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(value2.intvalue == </span><span class="number">0</span><span class="default">)</span>
<a name="863"><font size=-1>863     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="864"><font size=-1>864     </font></a><span class="default">                        result.intvalue = value1.intvalue % value2.intvalue;</span>
<a name="865"><font size=-1>865     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="866"><font size=-1>866     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="867"><font size=-1>867     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'='</span><span class="default">:</span>
<a name="868"><font size=-1>868     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;==&quot;</span><span class="default">) {</span>
<a name="869"><font size=-1>869     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">((value1.isIntValue() &amp;&amp; value2.isTokValue()) ||</span>
<a name="870"><font size=-1>870     </font></a><span class="default">                                (value1.isTokValue() &amp;&amp; value2.isIntValue())) {</span>
<a name="871"><font size=-1>871     </font></a><span class="default">                                result.intvalue = </span><span class="number">0</span><span class="default">;</span>
<a name="872"><font size=-1>872     </font></a><span class="default">                                setTokenValue(parent, result, settings);</span>
<a name="873"><font size=-1>873     </font></a><span class="default">                            } </span><span class="keyword">else if </span><span class="default">(value1.isIntValue() &amp;&amp; value2.isIntValue()) {</span>
<a name="874"><font size=-1>874     </font></a><span class="default">                                result.intvalue = value1.intvalue == value2.intvalue;</span>
<a name="875"><font size=-1>875     </font></a><span class="default">                                setTokenValue(parent, result, settings);</span>
<a name="876"><font size=-1>876     </font></a><span class="default">                            }</span>
<a name="877"><font size=-1>877     </font></a><span class="default">                        }</span>
<a name="878"><font size=-1>878     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="879"><font size=-1>879     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'!'</span><span class="default">:</span>
<a name="880"><font size=-1>880     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;!=&quot;</span><span class="default">) {</span>
<a name="881"><font size=-1>881     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">((value1.isIntValue() &amp;&amp; value2.isTokValue()) ||</span>
<a name="882"><font size=-1>882     </font></a><span class="default">                                (value1.isTokValue() &amp;&amp; value2.isIntValue())) {</span>
<a name="883"><font size=-1>883     </font></a><span class="default">                                result.intvalue = </span><span class="number">1</span><span class="default">;</span>
<a name="884"><font size=-1>884     </font></a><span class="default">                                setTokenValue(parent, result, settings);</span>
<a name="885"><font size=-1>885     </font></a><span class="default">                            } </span><span class="keyword">else if </span><span class="default">(value1.isIntValue() &amp;&amp; value2.isIntValue()) {</span>
<a name="886"><font size=-1>886     </font></a><span class="default">                                result.intvalue = value1.intvalue != value2.intvalue;</span>
<a name="887"><font size=-1>887     </font></a><span class="default">                                setTokenValue(parent, result, settings);</span>
<a name="888"><font size=-1>888     </font></a><span class="default">                            }</span>
<a name="889"><font size=-1>889     </font></a><span class="default">                        }</span>
<a name="890"><font size=-1>890     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="891"><font size=-1>891     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'&gt;'</span><span class="default">: {</span>
<a name="892"><font size=-1>892     </font></a><span class="default">                        </span><span class="keyword">const bool </span><span class="default">f = value1.isFloatValue() || value2.isFloatValue();</span>
<a name="893"><font size=-1>893     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!f &amp;&amp; !value1.isIntValue() &amp;&amp; !value2.isIntValue())</span>
<a name="894"><font size=-1>894     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="895"><font size=-1>895     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;&gt;&quot;</span><span class="default">)</span>
<a name="896"><font size=-1>896     </font></a><span class="default">                            result.intvalue = f ? (floatValue1 &gt; floatValue2) : (value1.intvalue &gt; value2.intvalue);</span>
<a name="897"><font size=-1>897     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;&gt;=&quot;</span><span class="default">)</span>
<a name="898"><font size=-1>898     </font></a><span class="default">                            result.intvalue = f ? (floatValue1 &gt;= floatValue2) : (value1.intvalue &gt;= value2.intvalue);</span>
<a name="899"><font size=-1>899     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(!f &amp;&amp; parent-&gt;str() == </span><span class="string">&quot;&gt;&gt;&quot; </span><span class="default">&amp;&amp; value1.intvalue &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; value2.intvalue &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; value2.intvalue &lt; MathLib::bigint_bits)</span>
<a name="900"><font size=-1>900     </font></a><span class="default">                            result.intvalue = value1.intvalue &gt;&gt; value2.intvalue;</span>
<a name="901"><font size=-1>901     </font></a><span class="default">                        </span><span class="keyword">else</span>
<a name="902"><font size=-1>902     </font></a><span class="keyword">                            break</span><span class="default">;</span>
<a name="903"><font size=-1>903     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="904"><font size=-1>904     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="905"><font size=-1>905     </font></a><span class="default">                    }</span>
<a name="906"><font size=-1>906     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'&lt;'</span><span class="default">: {</span>
<a name="907"><font size=-1>907     </font></a><span class="default">                        </span><span class="keyword">const bool </span><span class="default">f = value1.isFloatValue() || value2.isFloatValue();</span>
<a name="908"><font size=-1>908     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!f &amp;&amp; !value1.isIntValue() &amp;&amp; !value2.isIntValue())</span>
<a name="909"><font size=-1>909     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="910"><font size=-1>910     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;&lt;&quot;</span><span class="default">)</span>
<a name="911"><font size=-1>911     </font></a><span class="default">                            result.intvalue = f ? (floatValue1 &lt; floatValue2) : (value1.intvalue &lt; value2.intvalue);</span>
<a name="912"><font size=-1>912     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;&lt;=&quot;</span><span class="default">)</span>
<a name="913"><font size=-1>913     </font></a><span class="default">                            result.intvalue = f ? (floatValue1 &lt;= floatValue2) : (value1.intvalue &lt;= value2.intvalue);</span>
<a name="914"><font size=-1>914     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(!f &amp;&amp; parent-&gt;str() == </span><span class="string">&quot;&lt;&lt;&quot; </span><span class="default">&amp;&amp; value1.intvalue &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; value2.intvalue &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; value2.intvalue &lt; MathLib::bigint_bits)</span>
<a name="915"><font size=-1>915     </font></a><span class="default">                            result.intvalue = value1.intvalue &lt;&lt; value2.intvalue;</span>
<a name="916"><font size=-1>916     </font></a><span class="default">                        </span><span class="keyword">else</span>
<a name="917"><font size=-1>917     </font></a><span class="keyword">                            break</span><span class="default">;</span>
<a name="918"><font size=-1>918     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="919"><font size=-1>919     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="920"><font size=-1>920     </font></a><span class="default">                    }</span>
<a name="921"><font size=-1>921     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'&amp;'</span><span class="default">:</span>
<a name="922"><font size=-1>922     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!value1.isIntValue() || !value2.isIntValue())</span>
<a name="923"><font size=-1>923     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="924"><font size=-1>924     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="925"><font size=-1>925     </font></a><span class="default">                            result.intvalue = value1.intvalue &amp; value2.intvalue;</span>
<a name="926"><font size=-1>926     </font></a><span class="default">                        </span><span class="keyword">else</span>
<a name="927"><font size=-1>927     </font></a><span class="keyword">                            </span><span class="default">result.intvalue = value1.intvalue &amp;&amp; value2.intvalue;</span>
<a name="928"><font size=-1>928     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="929"><font size=-1>929     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="930"><font size=-1>930     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'|'</span><span class="default">:</span>
<a name="931"><font size=-1>931     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!value1.isIntValue() || !value2.isIntValue())</span>
<a name="932"><font size=-1>932     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="933"><font size=-1>933     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;|&quot;</span><span class="default">)</span>
<a name="934"><font size=-1>934     </font></a><span class="default">                            result.intvalue = value1.intvalue | value2.intvalue;</span>
<a name="935"><font size=-1>935     </font></a><span class="default">                        </span><span class="keyword">else</span>
<a name="936"><font size=-1>936     </font></a><span class="keyword">                            </span><span class="default">result.intvalue = value1.intvalue || value2.intvalue;</span>
<a name="937"><font size=-1>937     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="938"><font size=-1>938     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="939"><font size=-1>939     </font></a><span class="default">                    </span><span class="keyword">case </span><span class="string">'^'</span><span class="default">:</span>
<a name="940"><font size=-1>940     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!value1.isIntValue() || !value2.isIntValue())</span>
<a name="941"><font size=-1>941     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="942"><font size=-1>942     </font></a><span class="default">                        result.intvalue = value1.intvalue ^ value2.intvalue;</span>
<a name="943"><font size=-1>943     </font></a><span class="default">                        setTokenValue(parent, result, settings);</span>
<a name="944"><font size=-1>944     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="945"><font size=-1>945     </font></a><span class="default">                    </span><span class="keyword">default</span><span class="default">:</span>
<a name="946"><font size=-1>946     </font></a><span class="default">                        </span><span class="comment">// unhandled operator, do nothing</span>
<a name="947"><font size=-1>947     </font></a><span class="comment">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="948"><font size=-1>948     </font></a><span class="default">                    }</span>
<a name="949"><font size=-1>949     </font></a><span class="default">                }</span>
<a name="950"><font size=-1>950     </font></a><span class="default">            }</span>
<a name="951"><font size=-1>951     </font></a><span class="default">        }</span>
<a name="952"><font size=-1>952     </font></a><span class="default">    }</span>
<a name="953"><font size=-1>953     </font></a><span class="default"></span>
<a name="954"><font size=-1>954     </font></a><span class="default">    </span><span class="comment">// !</span>
<a name="955"><font size=-1>955     </font></a><span class="comment">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;!&quot;</span><span class="default">) {</span>
<a name="956"><font size=-1>956     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val : tok-&gt;values()) {</span>
<a name="957"><font size=-1>957     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!val.isIntValue())</span>
<a name="958"><font size=-1>958     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="959"><font size=-1>959     </font></a><span class="default">            ValueFlow::Value v(val);</span>
<a name="960"><font size=-1>960     </font></a><span class="default">            v.intvalue = !v.intvalue;</span>
<a name="961"><font size=-1>961     </font></a><span class="default">            setTokenValue(parent, v, settings);</span>
<a name="962"><font size=-1>962     </font></a><span class="default">        }</span>
<a name="963"><font size=-1>963     </font></a><span class="default">    }</span>
<a name="964"><font size=-1>964     </font></a><span class="default"></span>
<a name="965"><font size=-1>965     </font></a><span class="default">    </span><span class="comment">// ~</span>
<a name="966"><font size=-1>966     </font></a><span class="comment">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;~&quot;</span><span class="default">) {</span>
<a name="967"><font size=-1>967     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val : tok-&gt;values()) {</span>
<a name="968"><font size=-1>968     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!val.isIntValue())</span>
<a name="969"><font size=-1>969     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="970"><font size=-1>970     </font></a><span class="default">            ValueFlow::Value v(val);</span>
<a name="971"><font size=-1>971     </font></a><span class="default">            v.intvalue = ~v.intvalue;</span>
<a name="972"><font size=-1>972     </font></a><span class="default">            </span><span class="keyword">int </span><span class="default">bits = </span><span class="number">0</span><span class="default">;</span>
<a name="973"><font size=-1>973     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings &amp;&amp;</span>
<a name="974"><font size=-1>974     </font></a><span class="default">                tok-&gt;valueType() &amp;&amp;</span>
<a name="975"><font size=-1>975     </font></a><span class="default">                tok-&gt;valueType()-&gt;sign == ValueType::Sign::UNSIGNED &amp;&amp;</span>
<a name="976"><font size=-1>976     </font></a><span class="default">                tok-&gt;valueType()-&gt;pointer == </span><span class="number">0</span><span class="default">) {</span>
<a name="977"><font size=-1>977     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;valueType()-&gt;type == ValueType::Type::INT)</span>
<a name="978"><font size=-1>978     </font></a><span class="default">                    bits = settings-&gt;int_bit;</span>
<a name="979"><font size=-1>979     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(tok-&gt;valueType()-&gt;type == ValueType::Type::LONG)</span>
<a name="980"><font size=-1>980     </font></a><span class="default">                    bits = settings-&gt;long_bit;</span>
<a name="981"><font size=-1>981     </font></a><span class="default">            }</span>
<a name="982"><font size=-1>982     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(bits &gt; </span><span class="number">0 </span><span class="default">&amp;&amp; bits &lt; MathLib::bigint_bits)</span>
<a name="983"><font size=-1>983     </font></a><span class="default">                v.intvalue &amp;= (((MathLib::biguint)</span><span class="number">1</span><span class="default">)&lt;&lt;bits) - </span><span class="number">1</span><span class="default">;</span>
<a name="984"><font size=-1>984     </font></a><span class="default">            setTokenValue(parent, v, settings);</span>
<a name="985"><font size=-1>985     </font></a><span class="default">        }</span>
<a name="986"><font size=-1>986     </font></a><span class="default">    }</span>
<a name="987"><font size=-1>987     </font></a><span class="default"></span>
<a name="988"><font size=-1>988     </font></a><span class="default">    </span><span class="comment">// unary minus</span>
<a name="989"><font size=-1>989     </font></a><span class="comment">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;isUnaryOp(</span><span class="string">&quot;-&quot;</span><span class="default">)) {</span>
<a name="990"><font size=-1>990     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val : tok-&gt;values()) {</span>
<a name="991"><font size=-1>991     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!val.isIntValue() &amp;&amp; !val.isFloatValue())</span>
<a name="992"><font size=-1>992     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="993"><font size=-1>993     </font></a><span class="default">            ValueFlow::Value v(val);</span>
<a name="994"><font size=-1>994     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(v.isIntValue())</span>
<a name="995"><font size=-1>995     </font></a><span class="default">                v.intvalue = -v.intvalue;</span>
<a name="996"><font size=-1>996     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="997"><font size=-1>997     </font></a><span class="keyword">                </span><span class="default">v.floatValue = -v.floatValue;</span>
<a name="998"><font size=-1>998     </font></a><span class="default">            setTokenValue(parent, v, settings);</span>
<a name="999"><font size=-1>999     </font></a><span class="default">        }</span>
<a name="1000"><font size=-1>1000     </font></a><span class="default">    }</span>
<a name="1001"><font size=-1>1001     </font></a><span class="default"></span>
<a name="1002"><font size=-1>1002     </font></a><span class="default">    </span><span class="comment">// Array element</span>
<a name="1003"><font size=-1>1003     </font></a><span class="comment">    </span><span class="keyword">else if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;[&quot; </span><span class="default">&amp;&amp; parent-&gt;isBinaryOp()) {</span>
<a name="1004"><font size=-1>1004     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value1 : parent-&gt;astOperand1()-&gt;values()) {</span>
<a name="1005"><font size=-1>1005     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!value1.isTokValue())</span>
<a name="1006"><font size=-1>1006     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1007"><font size=-1>1007     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value2 : parent-&gt;astOperand2()-&gt;values()) {</span>
<a name="1008"><font size=-1>1008     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!value2.isIntValue())</span>
<a name="1009"><font size=-1>1009     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1010"><font size=-1>1010     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(value1.varId == </span><span class="number">0U </span><span class="default">|| value2.varId == </span><span class="number">0U </span><span class="default">||</span>
<a name="1011"><font size=-1>1011     </font></a><span class="default">                    (value1.varId == value2.varId &amp;&amp; value1.varvalue == value2.varvalue)) {</span>
<a name="1012"><font size=-1>1012     </font></a><span class="default">                    ValueFlow::Value result(</span><span class="number">0</span><span class="default">);</span>
<a name="1013"><font size=-1>1013     </font></a><span class="default">                    result.condition = value1.condition ? value1.condition : value2.condition;</span>
<a name="1014"><font size=-1>1014     </font></a><span class="default">                    result.setInconclusive(value1.isInconclusive() | value2.isInconclusive());</span>
<a name="1015"><font size=-1>1015     </font></a><span class="default">                    result.varId = (value1.varId != </span><span class="number">0U</span><span class="default">) ? value1.varId : value2.varId;</span>
<a name="1016"><font size=-1>1016     </font></a><span class="default">                    result.varvalue = (result.varId == value1.varId) ? value1.intvalue : value2.intvalue;</span>
<a name="1017"><font size=-1>1017     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(value1.valueKind == value2.valueKind)</span>
<a name="1018"><font size=-1>1018     </font></a><span class="default">                        result.valueKind = value1.valueKind;</span>
<a name="1019"><font size=-1>1019     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(value1.tokvalue-&gt;tokType() == Token::eString) {</span>
<a name="1020"><font size=-1>1020     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">std::string s = value1.tokvalue-&gt;strValue();</span>
<a name="1021"><font size=-1>1021     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">MathLib::bigint index = value2.intvalue;</span>
<a name="1022"><font size=-1>1022     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(index == s.size()) {</span>
<a name="1023"><font size=-1>1023     </font></a><span class="default">                            result.intvalue = </span><span class="number">0</span><span class="default">;</span>
<a name="1024"><font size=-1>1024     </font></a><span class="default">                            setTokenValue(parent, result, settings);</span>
<a name="1025"><font size=-1>1025     </font></a><span class="default">                        } </span><span class="keyword">else if </span><span class="default">(index &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; index &lt; s.size()) {</span>
<a name="1026"><font size=-1>1026     </font></a><span class="default">                            result.intvalue = s[index];</span>
<a name="1027"><font size=-1>1027     </font></a><span class="default">                            setTokenValue(parent, result, settings);</span>
<a name="1028"><font size=-1>1028     </font></a><span class="default">                        }</span>
<a name="1029"><font size=-1>1029     </font></a><span class="default">                    } </span><span class="keyword">else if </span><span class="default">(value1.tokvalue-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">) {</span>
<a name="1030"><font size=-1>1030     </font></a><span class="default">                        MathLib::bigint index = value2.intvalue;</span>
<a name="1031"><font size=-1>1031     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Token *element = value1.tokvalue-&gt;next();</span>
<a name="1032"><font size=-1>1032     </font></a><span class="default">                        </span><span class="keyword">while </span><span class="default">(index &gt; </span><span class="number">0 </span><span class="default">&amp;&amp; element-&gt;str() != </span><span class="string">&quot;}&quot;</span><span class="default">) {</span>
<a name="1033"><font size=-1>1033     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(element-&gt;str() == </span><span class="string">&quot;,&quot;</span><span class="default">)</span>
<a name="1034"><font size=-1>1034     </font></a><span class="default">                                --index;</span>
<a name="1035"><font size=-1>1035     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(Token::Match(element, </span><span class="string">&quot;[{}()[]]&quot;</span><span class="default">))</span>
<a name="1036"><font size=-1>1036     </font></a><span class="default">                                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1037"><font size=-1>1037     </font></a><span class="default">                            element = element-&gt;next();</span>
<a name="1038"><font size=-1>1038     </font></a><span class="default">                        }</span>
<a name="1039"><font size=-1>1039     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(element, </span><span class="string">&quot;%num% [,}]&quot;</span><span class="default">)) {</span>
<a name="1040"><font size=-1>1040     </font></a><span class="default">                            result.intvalue = MathLib::toLongNumber(element-&gt;str());</span>
<a name="1041"><font size=-1>1041     </font></a><span class="default">                            setTokenValue(parent, result, settings);</span>
<a name="1042"><font size=-1>1042     </font></a><span class="default">                        }</span>
<a name="1043"><font size=-1>1043     </font></a><span class="default">                    }</span>
<a name="1044"><font size=-1>1044     </font></a><span class="default">                }</span>
<a name="1045"><font size=-1>1045     </font></a><span class="default">            }</span>
<a name="1046"><font size=-1>1046     </font></a><span class="default">        }</span>
<a name="1047"><font size=-1>1047     </font></a><span class="default">    }</span>
<a name="1048"><font size=-1>1048     </font></a><span class="default">}</span>
<a name="1049"><font size=-1>1049     </font></a><span class="default"></span>
<a name="1050"><font size=-1>1050     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">setTokenValueCast(Token *parent, </span><span class="keyword">const </span><span class="default">ValueType &amp;valueType, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1051"><font size=-1>1051     </font></a><span class="default">{</span>
<a name="1052"><font size=-1>1052     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(valueType.pointer)</span>
<a name="1053"><font size=-1>1053     </font></a><span class="default">        setTokenValue(parent,value,settings);</span>
<a name="1054"><font size=-1>1054     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(valueType.type == ValueType::Type::CHAR)</span>
<a name="1055"><font size=-1>1055     </font></a><span class="default">        setTokenValue(parent, castValue(value, valueType.sign, settings-&gt;char_bit), settings);</span>
<a name="1056"><font size=-1>1056     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(valueType.type == ValueType::Type::SHORT)</span>
<a name="1057"><font size=-1>1057     </font></a><span class="default">        setTokenValue(parent, castValue(value, valueType.sign, settings-&gt;short_bit), settings);</span>
<a name="1058"><font size=-1>1058     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(valueType.type == ValueType::Type::INT)</span>
<a name="1059"><font size=-1>1059     </font></a><span class="default">        setTokenValue(parent, castValue(value, valueType.sign, settings-&gt;int_bit), settings);</span>
<a name="1060"><font size=-1>1060     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(valueType.type == ValueType::Type::LONG)</span>
<a name="1061"><font size=-1>1061     </font></a><span class="default">        setTokenValue(parent, castValue(value, valueType.sign, settings-&gt;long_bit), settings);</span>
<a name="1062"><font size=-1>1062     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(valueType.type == ValueType::Type::LONGLONG)</span>
<a name="1063"><font size=-1>1063     </font></a><span class="default">        setTokenValue(parent, castValue(value, valueType.sign, settings-&gt;long_long_bit), settings);</span>
<a name="1064"><font size=-1>1064     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(value.isIntValue()) {</span>
<a name="1065"><font size=-1>1065     </font></a><span class="default">        </span><span class="keyword">const long long </span><span class="default">charMax = settings-&gt;signedCharMax();</span>
<a name="1066"><font size=-1>1066     </font></a><span class="default">        </span><span class="keyword">const long long </span><span class="default">charMin = settings-&gt;signedCharMin();</span>
<a name="1067"><font size=-1>1067     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(charMin &lt;= value.intvalue &amp;&amp; value.intvalue &lt;= charMax) {</span>
<a name="1068"><font size=-1>1068     </font></a><span class="default">            </span><span class="comment">// unknown type, but value is small so there should be no truncation etc</span>
<a name="1069"><font size=-1>1069     </font></a><span class="comment">            </span><span class="default">setTokenValue(parent,value,settings);</span>
<a name="1070"><font size=-1>1070     </font></a><span class="default">        }</span>
<a name="1071"><font size=-1>1071     </font></a><span class="default">    }</span>
<a name="1072"><font size=-1>1072     </font></a><span class="default">}</span>
<a name="1073"><font size=-1>1073     </font></a><span class="default"></span>
<a name="1074"><font size=-1>1074     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">nonneg </span><span class="keyword">int </span><span class="default">getSizeOfType(</span><span class="keyword">const </span><span class="default">Token *typeTok, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1075"><font size=-1>1075     </font></a><span class="default">{</span>
<a name="1076"><font size=-1>1076     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string &amp;typeStr = typeTok-&gt;str();</span>
<a name="1077"><font size=-1>1077     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(typeStr == </span><span class="string">&quot;char&quot;</span><span class="default">)</span>
<a name="1078"><font size=-1>1078     </font></a><span class="default">        </span><span class="keyword">return </span><span class="number">1</span><span class="default">;</span>
<a name="1079"><font size=-1>1079     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(typeStr == </span><span class="string">&quot;short&quot;</span><span class="default">)</span>
<a name="1080"><font size=-1>1080     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_short;</span>
<a name="1081"><font size=-1>1081     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(typeStr == </span><span class="string">&quot;int&quot;</span><span class="default">)</span>
<a name="1082"><font size=-1>1082     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_int;</span>
<a name="1083"><font size=-1>1083     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(typeStr == </span><span class="string">&quot;long&quot;</span><span class="default">)</span>
<a name="1084"><font size=-1>1084     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">typeTok-&gt;isLong() ? settings-&gt;sizeof_long_long : settings-&gt;sizeof_long;</span>
<a name="1085"><font size=-1>1085     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(typeStr == </span><span class="string">&quot;wchar_t&quot;</span><span class="default">)</span>
<a name="1086"><font size=-1>1086     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_wchar_t;</span>
<a name="1087"><font size=-1>1087     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="1088"><font size=-1>1088     </font></a><span class="keyword">        return </span><span class="number">0</span><span class="default">;</span>
<a name="1089"><font size=-1>1089     </font></a><span class="default">}</span>
<a name="1090"><font size=-1>1090     </font></a><span class="default"></span>
<a name="1091"><font size=-1>1091     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">size_t getSizeOf(</span><span class="keyword">const </span><span class="default">ValueType &amp;vt, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1092"><font size=-1>1092     </font></a><span class="default">{</span>
<a name="1093"><font size=-1>1093     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(vt.pointer)</span>
<a name="1094"><font size=-1>1094     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_pointer;</span>
<a name="1095"><font size=-1>1095     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::CHAR)</span>
<a name="1096"><font size=-1>1096     </font></a><span class="default">        </span><span class="keyword">return </span><span class="number">1</span><span class="default">;</span>
<a name="1097"><font size=-1>1097     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::SHORT)</span>
<a name="1098"><font size=-1>1098     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_short;</span>
<a name="1099"><font size=-1>1099     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::WCHAR_T)</span>
<a name="1100"><font size=-1>1100     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_wchar_t;</span>
<a name="1101"><font size=-1>1101     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::INT)</span>
<a name="1102"><font size=-1>1102     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_int;</span>
<a name="1103"><font size=-1>1103     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::LONG)</span>
<a name="1104"><font size=-1>1104     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_long;</span>
<a name="1105"><font size=-1>1105     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::LONGLONG)</span>
<a name="1106"><font size=-1>1106     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_long_long;</span>
<a name="1107"><font size=-1>1107     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::FLOAT)</span>
<a name="1108"><font size=-1>1108     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_float;</span>
<a name="1109"><font size=-1>1109     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(vt.type == ValueType::Type::DOUBLE)</span>
<a name="1110"><font size=-1>1110     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">settings-&gt;sizeof_double;</span>
<a name="1111"><font size=-1>1111     </font></a><span class="default"></span>
<a name="1112"><font size=-1>1112     </font></a><span class="default">    </span><span class="keyword">return </span><span class="number">0</span><span class="default">;</span>
<a name="1113"><font size=-1>1113     </font></a><span class="default">}</span>
<a name="1114"><font size=-1>1114     </font></a><span class="default"></span>
<a name="1115"><font size=-1>1115     </font></a><span class="default"></span><span class="comment">// Handle various constants..</span>
<a name="1116"><font size=-1>1116     </font></a><span class="comment"></span><span class="keyword">static </span><span class="default">Token * valueFlowSetConstantValue(Token *tok, </span><span class="keyword">const </span><span class="default">Settings *settings, </span><span class="keyword">bool </span><span class="default">cpp)</span>
<a name="1117"><font size=-1>1117     </font></a><span class="default">{</span>
<a name="1118"><font size=-1>1118     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">((tok-&gt;isNumber() &amp;&amp; MathLib::isInt(tok-&gt;str())) || (tok-&gt;tokType() == Token::eChar)) {</span>
<a name="1119"><font size=-1>1119     </font></a><span class="default">        ValueFlow::Value value(MathLib::toLongNumber(tok-&gt;str()));</span>
<a name="1120"><font size=-1>1120     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1121"><font size=-1>1121     </font></a><span class="default">            value.setKnown();</span>
<a name="1122"><font size=-1>1122     </font></a><span class="default">        setTokenValue(tok, value, settings);</span>
<a name="1123"><font size=-1>1123     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;isNumber() &amp;&amp; MathLib::isFloat(tok-&gt;str())) {</span>
<a name="1124"><font size=-1>1124     </font></a><span class="default">        ValueFlow::Value value;</span>
<a name="1125"><font size=-1>1125     </font></a><span class="default">        value.valueType = ValueFlow::Value::FLOAT;</span>
<a name="1126"><font size=-1>1126     </font></a><span class="default">        value.floatValue = MathLib::toDoubleNumber(tok-&gt;str());</span>
<a name="1127"><font size=-1>1127     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1128"><font size=-1>1128     </font></a><span class="default">            value.setKnown();</span>
<a name="1129"><font size=-1>1129     </font></a><span class="default">        setTokenValue(tok, value, settings);</span>
<a name="1130"><font size=-1>1130     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;enumerator() &amp;&amp; tok-&gt;enumerator()-&gt;value_known) {</span>
<a name="1131"><font size=-1>1131     </font></a><span class="default">        ValueFlow::Value value(tok-&gt;enumerator()-&gt;value);</span>
<a name="1132"><font size=-1>1132     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1133"><font size=-1>1133     </font></a><span class="default">            value.setKnown();</span>
<a name="1134"><font size=-1>1134     </font></a><span class="default">        setTokenValue(tok, value, settings);</span>
<a name="1135"><font size=-1>1135     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;NULL&quot; </span><span class="default">|| (cpp &amp;&amp; tok-&gt;str() == </span><span class="string">&quot;nullptr&quot;</span><span class="default">)) {</span>
<a name="1136"><font size=-1>1136     </font></a><span class="default">        ValueFlow::Value value(</span><span class="number">0</span><span class="default">);</span>
<a name="1137"><font size=-1>1137     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1138"><font size=-1>1138     </font></a><span class="default">            value.setKnown();</span>
<a name="1139"><font size=-1>1139     </font></a><span class="default">        setTokenValue(tok, value, settings);</span>
<a name="1140"><font size=-1>1140     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;sizeof (&quot;</span><span class="default">)) {</span>
<a name="1141"><font size=-1>1141     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *tok2 = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1142"><font size=-1>1142     </font></a><span class="default">        </span><span class="comment">// skip over tokens to find variable or type</span>
<a name="1143"><font size=-1>1143     </font></a><span class="comment">        </span><span class="keyword">while </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;%name% ::|.|[&quot;</span><span class="default">)) {</span>
<a name="1144"><font size=-1>1144     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;next()-&gt;str() == </span><span class="string">&quot;[&quot;</span><span class="default">)</span>
<a name="1145"><font size=-1>1145     </font></a><span class="default">                tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="1146"><font size=-1>1146     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="1147"><font size=-1>1147     </font></a><span class="keyword">                </span><span class="default">tok2 = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1148"><font size=-1>1148     </font></a><span class="default">        }</span>
<a name="1149"><font size=-1>1149     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;sizeof ( *&quot;</span><span class="default">)) {</span>
<a name="1150"><font size=-1>1150     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueType *vt = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;valueType();</span>
<a name="1151"><font size=-1>1151     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">size_t sz = vt ? getSizeOf(*vt, settings) : </span><span class="number">0</span><span class="default">;</span>
<a name="1152"><font size=-1>1152     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(sz &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="1153"><font size=-1>1153     </font></a><span class="default">                ValueFlow::Value value(sz);</span>
<a name="1154"><font size=-1>1154     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok2-&gt;isTemplateArg() &amp;&amp; settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1155"><font size=-1>1155     </font></a><span class="default">                    value.setKnown();</span>
<a name="1156"><font size=-1>1156     </font></a><span class="default">                setTokenValue(tok-&gt;next(), value, settings);</span>
<a name="1157"><font size=-1>1157     </font></a><span class="default">            }</span>
<a name="1158"><font size=-1>1158     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;enumerator() &amp;&amp; tok2-&gt;enumerator()-&gt;scope) {</span>
<a name="1159"><font size=-1>1159     </font></a><span class="default">            </span><span class="keyword">long long </span><span class="default">size = settings-&gt;sizeof_int;</span>
<a name="1160"><font size=-1>1160     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * type = tok2-&gt;enumerator()-&gt;scope-&gt;enumType;</span>
<a name="1161"><font size=-1>1161     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(type) {</span>
<a name="1162"><font size=-1>1162     </font></a><span class="default">                size = getSizeOfType(type, settings);</span>
<a name="1163"><font size=-1>1163     </font></a><span class="default">            }</span>
<a name="1164"><font size=-1>1164     </font></a><span class="default">            ValueFlow::Value value(size);</span>
<a name="1165"><font size=-1>1165     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!tok2-&gt;isTemplateArg() &amp;&amp; settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1166"><font size=-1>1166     </font></a><span class="default">                value.setKnown();</span>
<a name="1167"><font size=-1>1167     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="1168"><font size=-1>1168     </font></a><span class="default">            setTokenValue(tok-&gt;next(), value, settings);</span>
<a name="1169"><font size=-1>1169     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;type() &amp;&amp; tok2-&gt;type()-&gt;isEnumType()) {</span>
<a name="1170"><font size=-1>1170     </font></a><span class="default">            </span><span class="keyword">long long </span><span class="default">size = settings-&gt;sizeof_int;</span>
<a name="1171"><font size=-1>1171     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;type()-&gt;classScope) {</span>
<a name="1172"><font size=-1>1172     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * type = tok2-&gt;type()-&gt;classScope-&gt;enumType;</span>
<a name="1173"><font size=-1>1173     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(type) {</span>
<a name="1174"><font size=-1>1174     </font></a><span class="default">                    size = getSizeOfType(type, settings);</span>
<a name="1175"><font size=-1>1175     </font></a><span class="default">                }</span>
<a name="1176"><font size=-1>1176     </font></a><span class="default">            }</span>
<a name="1177"><font size=-1>1177     </font></a><span class="default">            ValueFlow::Value value(size);</span>
<a name="1178"><font size=-1>1178     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!tok2-&gt;isTemplateArg() &amp;&amp; settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1179"><font size=-1>1179     </font></a><span class="default">                value.setKnown();</span>
<a name="1180"><font size=-1>1180     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="1181"><font size=-1>1181     </font></a><span class="default">            setTokenValue(tok-&gt;next(), value, settings);</span>
<a name="1182"><font size=-1>1182     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;sizeof ( %var% ) / sizeof (&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;astParent() == tok-&gt;tokAt(</span><span class="number">4</span><span class="default">)) {</span>
<a name="1183"><font size=-1>1183     </font></a><span class="default">            </span><span class="comment">// Get number of elements in array</span>
<a name="1184"><font size=-1>1184     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token *sz1 = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1185"><font size=-1>1185     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *sz2 = tok-&gt;tokAt(</span><span class="number">7</span><span class="default">);</span>
<a name="1186"><font size=-1>1186     </font></a><span class="default">            </span><span class="keyword">const int </span><span class="default">varid1 = sz1-&gt;varId();</span>
<a name="1187"><font size=-1>1187     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varid1 &amp;&amp;</span>
<a name="1188"><font size=-1>1188     </font></a><span class="default">                sz1-&gt;variable() &amp;&amp;</span>
<a name="1189"><font size=-1>1189     </font></a><span class="default">                sz1-&gt;variable()-&gt;isArray() &amp;&amp;</span>
<a name="1190"><font size=-1>1190     </font></a><span class="default">                !sz1-&gt;variable()-&gt;dimensions().empty() &amp;&amp;</span>
<a name="1191"><font size=-1>1191     </font></a><span class="default">                sz1-&gt;variable()-&gt;dimensionKnown(</span><span class="number">0</span><span class="default">) &amp;&amp;</span>
<a name="1192"><font size=-1>1192     </font></a><span class="default">                (Token::Match(sz2, </span><span class="string">&quot;* %varid% )&quot;</span><span class="default">, varid1) || Token::Match(sz2, </span><span class="string">&quot;%varid% [ 0 ] )&quot;</span><span class="default">, varid1))) {</span>
<a name="1193"><font size=-1>1193     </font></a><span class="default">                ValueFlow::Value value(sz1-&gt;variable()-&gt;dimension(</span><span class="number">0</span><span class="default">));</span>
<a name="1194"><font size=-1>1194     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok2-&gt;isTemplateArg() &amp;&amp; settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1195"><font size=-1>1195     </font></a><span class="default">                    value.setKnown();</span>
<a name="1196"><font size=-1>1196     </font></a><span class="default">                setTokenValue(tok-&gt;tokAt(</span><span class="number">4</span><span class="default">), value, settings);</span>
<a name="1197"><font size=-1>1197     </font></a><span class="default">            }</span>
<a name="1198"><font size=-1>1198     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;%var% )&quot;</span><span class="default">)) {</span>
<a name="1199"><font size=-1>1199     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *var = tok2-&gt;variable();</span>
<a name="1200"><font size=-1>1200     </font></a><span class="default">            </span><span class="comment">// only look for single token types (no pointers or references yet)</span>
<a name="1201"><font size=-1>1201     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;typeStartToken() == var-&gt;typeEndToken()) {</span>
<a name="1202"><font size=-1>1202     </font></a><span class="default">                </span><span class="comment">// find the size of the type</span>
<a name="1203"><font size=-1>1203     </font></a><span class="comment">                </span><span class="default">size_t size = </span><span class="number">0</span><span class="default">;</span>
<a name="1204"><font size=-1>1204     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;isEnumType()) {</span>
<a name="1205"><font size=-1>1205     </font></a><span class="default">                    size = settings-&gt;sizeof_int;</span>
<a name="1206"><font size=-1>1206     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var-&gt;type()-&gt;classScope &amp;&amp; var-&gt;type()-&gt;classScope-&gt;enumType)</span>
<a name="1207"><font size=-1>1207     </font></a><span class="default">                        size = getSizeOfType(var-&gt;type()-&gt;classScope-&gt;enumType, settings);</span>
<a name="1208"><font size=-1>1208     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(var-&gt;valueType()) {</span>
<a name="1209"><font size=-1>1209     </font></a><span class="default">                    size = getSizeOf(*var-&gt;valueType(), settings);</span>
<a name="1210"><font size=-1>1210     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(!var-&gt;type()) {</span>
<a name="1211"><font size=-1>1211     </font></a><span class="default">                    size = getSizeOfType(var-&gt;typeStartToken(), settings);</span>
<a name="1212"><font size=-1>1212     </font></a><span class="default">                }</span>
<a name="1213"><font size=-1>1213     </font></a><span class="default">                </span><span class="comment">// find the number of elements</span>
<a name="1214"><font size=-1>1214     </font></a><span class="comment">                </span><span class="default">size_t count = </span><span class="number">1</span><span class="default">;</span>
<a name="1215"><font size=-1>1215     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(size_t i = </span><span class="number">0</span><span class="default">; i &lt; var-&gt;dimensions().size(); ++i) {</span>
<a name="1216"><font size=-1>1216     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var-&gt;dimensionKnown(i))</span>
<a name="1217"><font size=-1>1217     </font></a><span class="default">                        count *= var-&gt;dimension(i);</span>
<a name="1218"><font size=-1>1218     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="1219"><font size=-1>1219     </font></a><span class="keyword">                        </span><span class="default">count = </span><span class="number">0</span><span class="default">;</span>
<a name="1220"><font size=-1>1220     </font></a><span class="default">                }</span>
<a name="1221"><font size=-1>1221     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(size &amp;&amp; count &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="1222"><font size=-1>1222     </font></a><span class="default">                    ValueFlow::Value value(count * size);</span>
<a name="1223"><font size=-1>1223     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1224"><font size=-1>1224     </font></a><span class="default">                        value.setKnown();</span>
<a name="1225"><font size=-1>1225     </font></a><span class="default">                    setTokenValue(tok, value, settings);</span>
<a name="1226"><font size=-1>1226     </font></a><span class="default">                    setTokenValue(tok-&gt;next(), value, settings);</span>
<a name="1227"><font size=-1>1227     </font></a><span class="default">                }</span>
<a name="1228"><font size=-1>1228     </font></a><span class="default">            }</span>
<a name="1229"><font size=-1>1229     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(!tok2-&gt;type()) {</span>
<a name="1230"><font size=-1>1230     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueType &amp;vt = ValueType::parseDecl(tok2,settings);</span>
<a name="1231"><font size=-1>1231     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">size_t sz = getSizeOf(vt, settings);</span>
<a name="1232"><font size=-1>1232     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(sz &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="1233"><font size=-1>1233     </font></a><span class="default">                ValueFlow::Value value(sz);</span>
<a name="1234"><font size=-1>1234     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok2-&gt;isTemplateArg() &amp;&amp; settings-&gt;platformType != cppcheck::Platform::Unspecified)</span>
<a name="1235"><font size=-1>1235     </font></a><span class="default">                    value.setKnown();</span>
<a name="1236"><font size=-1>1236     </font></a><span class="default">                setTokenValue(tok-&gt;next(), value, settings);</span>
<a name="1237"><font size=-1>1237     </font></a><span class="default">            }</span>
<a name="1238"><font size=-1>1238     </font></a><span class="default">        }</span>
<a name="1239"><font size=-1>1239     </font></a><span class="default">        </span><span class="comment">// skip over enum</span>
<a name="1240"><font size=-1>1240     </font></a><span class="comment">        </span><span class="default">tok = tok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="1241"><font size=-1>1241     </font></a><span class="default">    }</span>
<a name="1242"><font size=-1>1242     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">tok-&gt;next();</span>
<a name="1243"><font size=-1>1243     </font></a><span class="default">}</span>
<a name="1244"><font size=-1>1244     </font></a><span class="default"></span>
<a name="1245"><font size=-1>1245     </font></a><span class="default"></span>
<a name="1246"><font size=-1>1246     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowNumber(TokenList *tokenlist)</span>
<a name="1247"><font size=-1>1247     </font></a><span class="default">{</span>
<a name="1248"><font size=-1>1248     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok;) {</span>
<a name="1249"><font size=-1>1249     </font></a><span class="default">        tok = valueFlowSetConstantValue(tok, tokenlist-&gt;getSettings(), tokenlist-&gt;isCPP());</span>
<a name="1250"><font size=-1>1250     </font></a><span class="default">    }</span>
<a name="1251"><font size=-1>1251     </font></a><span class="default"></span>
<a name="1252"><font size=-1>1252     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tokenlist-&gt;isCPP()) {</span>
<a name="1253"><font size=-1>1253     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1254"><font size=-1>1254     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;isName() &amp;&amp; !tok-&gt;varId() &amp;&amp; Token::Match(tok, </span><span class="string">&quot;false|true&quot;</span><span class="default">)) {</span>
<a name="1255"><font size=-1>1255     </font></a><span class="default">                ValueFlow::Value value(tok-&gt;str() == </span><span class="string">&quot;true&quot;</span><span class="default">);</span>
<a name="1256"><font size=-1>1256     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1257"><font size=-1>1257     </font></a><span class="default">                    value.setKnown();</span>
<a name="1258"><font size=-1>1258     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1259"><font size=-1>1259     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[(,] NULL [,)]&quot;</span><span class="default">)) {</span>
<a name="1260"><font size=-1>1260     </font></a><span class="default">                </span><span class="comment">// NULL function parameters are not simplified in the</span>
<a name="1261"><font size=-1>1261     </font></a><span class="comment">                // normal tokenlist</span>
<a name="1262"><font size=-1>1262     </font></a><span class="comment">                </span><span class="default">ValueFlow::Value value(</span><span class="number">0</span><span class="default">);</span>
<a name="1263"><font size=-1>1263     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok-&gt;isTemplateArg())</span>
<a name="1264"><font size=-1>1264     </font></a><span class="default">                    value.setKnown();</span>
<a name="1265"><font size=-1>1265     </font></a><span class="default">                setTokenValue(tok-&gt;next(), value, tokenlist-&gt;getSettings());</span>
<a name="1266"><font size=-1>1266     </font></a><span class="default">            }</span>
<a name="1267"><font size=-1>1267     </font></a><span class="default">        }</span>
<a name="1268"><font size=-1>1268     </font></a><span class="default">    }</span>
<a name="1269"><font size=-1>1269     </font></a><span class="default">}</span>
<a name="1270"><font size=-1>1270     </font></a><span class="default"></span>
<a name="1271"><font size=-1>1271     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowString(TokenList *tokenlist)</span>
<a name="1272"><font size=-1>1272     </font></a><span class="default">{</span>
<a name="1273"><font size=-1>1273     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1274"><font size=-1>1274     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;tokType() == Token::eString) {</span>
<a name="1275"><font size=-1>1275     </font></a><span class="default">            ValueFlow::Value strvalue;</span>
<a name="1276"><font size=-1>1276     </font></a><span class="default">            strvalue.valueType = ValueFlow::Value::TOK;</span>
<a name="1277"><font size=-1>1277     </font></a><span class="default">            strvalue.tokvalue = tok;</span>
<a name="1278"><font size=-1>1278     </font></a><span class="default">            strvalue.setKnown();</span>
<a name="1279"><font size=-1>1279     </font></a><span class="default">            setTokenValue(tok, strvalue, tokenlist-&gt;getSettings());</span>
<a name="1280"><font size=-1>1280     </font></a><span class="default">        }</span>
<a name="1281"><font size=-1>1281     </font></a><span class="default">    }</span>
<a name="1282"><font size=-1>1282     </font></a><span class="default">}</span>
<a name="1283"><font size=-1>1283     </font></a><span class="default"></span>
<a name="1284"><font size=-1>1284     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowArray(TokenList *tokenlist)</span>
<a name="1285"><font size=-1>1285     </font></a><span class="default">{</span>
<a name="1286"><font size=-1>1286     </font></a><span class="default">    std::map&lt;</span><span class="keyword">int</span><span class="default">, </span><span class="keyword">const </span><span class="default">Token *&gt; constantArrays;</span>
<a name="1287"><font size=-1>1287     </font></a><span class="default"></span>
<a name="1288"><font size=-1>1288     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1289"><font size=-1>1289     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() &gt; </span><span class="number">0U</span><span class="default">) {</span>
<a name="1290"><font size=-1>1290     </font></a><span class="default">            </span><span class="comment">// array</span>
<a name="1291"><font size=-1>1291     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">std::map&lt;</span><span class="keyword">int</span><span class="default">, </span><span class="keyword">const </span><span class="default">Token *&gt;::const_iterator it = constantArrays.find(tok-&gt;varId());</span>
<a name="1292"><font size=-1>1292     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(it != constantArrays.end()) {</span>
<a name="1293"><font size=-1>1293     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="1294"><font size=-1>1294     </font></a><span class="default">                value.valueType = ValueFlow::Value::TOK;</span>
<a name="1295"><font size=-1>1295     </font></a><span class="default">                value.tokvalue = it-&gt;second;</span>
<a name="1296"><font size=-1>1296     </font></a><span class="default">                value.setKnown();</span>
<a name="1297"><font size=-1>1297     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1298"><font size=-1>1298     </font></a><span class="default">            }</span>
<a name="1299"><font size=-1>1299     </font></a><span class="default"></span>
<a name="1300"><font size=-1>1300     </font></a><span class="default">            </span><span class="comment">// pointer = array</span>
<a name="1301"><font size=-1>1301     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(tok-&gt;variable() &amp;&amp;</span>
<a name="1302"><font size=-1>1302     </font></a><span class="default">                     tok-&gt;variable()-&gt;isArray() &amp;&amp;</span>
<a name="1303"><font size=-1>1303     </font></a><span class="default">                     Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;=&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1304"><font size=-1>1304     </font></a><span class="default">                     tok == tok-&gt;astParent()-&gt;astOperand2() &amp;&amp;</span>
<a name="1305"><font size=-1>1305     </font></a><span class="default">                     tok-&gt;astParent()-&gt;astOperand1() &amp;&amp;</span>
<a name="1306"><font size=-1>1306     </font></a><span class="default">                     tok-&gt;astParent()-&gt;astOperand1()-&gt;variable() &amp;&amp;</span>
<a name="1307"><font size=-1>1307     </font></a><span class="default">                     tok-&gt;astParent()-&gt;astOperand1()-&gt;variable()-&gt;isPointer()) {</span>
<a name="1308"><font size=-1>1308     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="1309"><font size=-1>1309     </font></a><span class="default">                value.valueType = ValueFlow::Value::TOK;</span>
<a name="1310"><font size=-1>1310     </font></a><span class="default">                value.tokvalue = tok;</span>
<a name="1311"><font size=-1>1311     </font></a><span class="default">                value.setKnown();</span>
<a name="1312"><font size=-1>1312     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1313"><font size=-1>1313     </font></a><span class="default">            }</span>
<a name="1314"><font size=-1>1314     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1315"><font size=-1>1315     </font></a><span class="default">        }</span>
<a name="1316"><font size=-1>1316     </font></a><span class="default"></span>
<a name="1317"><font size=-1>1317     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;const %type% %var% [ %num%| ] = {&quot;</span><span class="default">)) {</span>
<a name="1318"><font size=-1>1318     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *vartok = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1319"><font size=-1>1319     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *rhstok = vartok-&gt;next()-&gt;link()-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1320"><font size=-1>1320     </font></a><span class="default">            constantArrays[vartok-&gt;varId()] = rhstok;</span>
<a name="1321"><font size=-1>1321     </font></a><span class="default">            tok = rhstok-&gt;link();</span>
<a name="1322"><font size=-1>1322     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1323"><font size=-1>1323     </font></a><span class="default">        }</span>
<a name="1324"><font size=-1>1324     </font></a><span class="default"></span>
<a name="1325"><font size=-1>1325     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;const char %var% [ %num%| ] = %str% ;&quot;</span><span class="default">)) {</span>
<a name="1326"><font size=-1>1326     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *vartok = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1327"><font size=-1>1327     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *strtok = vartok-&gt;next()-&gt;link()-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1328"><font size=-1>1328     </font></a><span class="default">            constantArrays[vartok-&gt;varId()] = strtok;</span>
<a name="1329"><font size=-1>1329     </font></a><span class="default">            tok = strtok-&gt;next();</span>
<a name="1330"><font size=-1>1330     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1331"><font size=-1>1331     </font></a><span class="default">        }</span>
<a name="1332"><font size=-1>1332     </font></a><span class="default">    }</span>
<a name="1333"><font size=-1>1333     </font></a><span class="default">}</span>
<a name="1334"><font size=-1>1334     </font></a><span class="default"></span>
<a name="1335"><font size=-1>1335     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isNonZero(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1336"><font size=-1>1336     </font></a><span class="default">{</span>
<a name="1337"><font size=-1>1337     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">tok &amp;&amp; (!tok-&gt;hasKnownIntValue() || tok-&gt;values().front().intvalue != </span><span class="number">0</span><span class="default">);</span>
<a name="1338"><font size=-1>1338     </font></a><span class="default">}</span>
<a name="1339"><font size=-1>1339     </font></a><span class="default"></span>
<a name="1340"><font size=-1>1340     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token *getOtherOperand(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1341"><font size=-1>1341     </font></a><span class="default">{</span>
<a name="1342"><font size=-1>1342     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="1343"><font size=-1>1343     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="1344"><font size=-1>1344     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;astParent())</span>
<a name="1345"><font size=-1>1345     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="1346"><font size=-1>1346     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;astParent()-&gt;astOperand1() != tok)</span>
<a name="1347"><font size=-1>1347     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">tok-&gt;astParent()-&gt;astOperand1();</span>
<a name="1348"><font size=-1>1348     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;astParent()-&gt;astOperand2() != tok)</span>
<a name="1349"><font size=-1>1349     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">tok-&gt;astParent()-&gt;astOperand2();</span>
<a name="1350"><font size=-1>1350     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="1351"><font size=-1>1351     </font></a><span class="default">}</span>
<a name="1352"><font size=-1>1352     </font></a><span class="default"></span>
<a name="1353"><font size=-1>1353     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowArrayBool(TokenList *tokenlist)</span>
<a name="1354"><font size=-1>1354     </font></a><span class="default">{</span>
<a name="1355"><font size=-1>1355     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1356"><font size=-1>1356     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownIntValue())</span>
<a name="1357"><font size=-1>1357     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1358"><font size=-1>1358     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var = nullptr;</span>
<a name="1359"><font size=-1>1359     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">known = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1360"><font size=-1>1360     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt;::const_iterator val =</span>
<a name="1361"><font size=-1>1361     </font></a><span class="default">            std::find_if(tok-&gt;values().begin(), tok-&gt;values().end(), std::mem_fn(&amp;ValueFlow::Value::isTokValue));</span>
<a name="1362"><font size=-1>1362     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(val == tok-&gt;values().end()) {</span>
<a name="1363"><font size=-1>1363     </font></a><span class="default">            var = tok-&gt;variable();</span>
<a name="1364"><font size=-1>1364     </font></a><span class="default">            known = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1365"><font size=-1>1365     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1366"><font size=-1>1366     </font></a><span class="default">            var = val-&gt;tokvalue-&gt;variable();</span>
<a name="1367"><font size=-1>1367     </font></a><span class="default">            known = val-&gt;isKnown();</span>
<a name="1368"><font size=-1>1368     </font></a><span class="default">        }</span>
<a name="1369"><font size=-1>1369     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="1370"><font size=-1>1370     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1371"><font size=-1>1371     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;isArray() || var-&gt;isArgument() || var-&gt;isStlType())</span>
<a name="1372"><font size=-1>1372     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1373"><font size=-1>1373     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isNonZero(getOtherOperand(tok)) &amp;&amp; Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;%comp%&quot;</span><span class="default">))</span>
<a name="1374"><font size=-1>1374     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1375"><font size=-1>1375     </font></a><span class="default">        </span><span class="comment">// TODO: Check for function argument</span>
<a name="1376"><font size=-1>1376     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">((astIsBool(tok-&gt;astParent()) &amp;&amp; !Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;(|%name%&quot;</span><span class="default">)) ||</span>
<a name="1377"><font size=-1>1377     </font></a><span class="default">            (tok-&gt;astParent() &amp;&amp; Token::Match(tok-&gt;astParent()-&gt;previous(), </span><span class="string">&quot;if|while|for (&quot;</span><span class="default">))) {</span>
<a name="1378"><font size=-1>1378     </font></a><span class="default">            ValueFlow::Value value{</span><span class="number">1</span><span class="default">};</span>
<a name="1379"><font size=-1>1379     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(known)</span>
<a name="1380"><font size=-1>1380     </font></a><span class="default">                value.setKnown();</span>
<a name="1381"><font size=-1>1381     </font></a><span class="default">            setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1382"><font size=-1>1382     </font></a><span class="default">        }</span>
<a name="1383"><font size=-1>1383     </font></a><span class="default">    }</span>
<a name="1384"><font size=-1>1384     </font></a><span class="default">}</span>
<a name="1385"><font size=-1>1385     </font></a><span class="default"></span>
<a name="1386"><font size=-1>1386     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowPointerAlias(TokenList *tokenlist)</span>
<a name="1387"><font size=-1>1387     </font></a><span class="default">{</span>
<a name="1388"><font size=-1>1388     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1389"><font size=-1>1389     </font></a><span class="default">        </span><span class="comment">// not address of</span>
<a name="1390"><font size=-1>1390     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">))</span>
<a name="1391"><font size=-1>1391     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1392"><font size=-1>1392     </font></a><span class="default"></span>
<a name="1393"><font size=-1>1393     </font></a><span class="default">        </span><span class="comment">// parent should be a '='</span>
<a name="1394"><font size=-1>1394     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;=&quot;</span><span class="default">))</span>
<a name="1395"><font size=-1>1395     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1396"><font size=-1>1396     </font></a><span class="default"></span>
<a name="1397"><font size=-1>1397     </font></a><span class="default">        </span><span class="comment">// child should be some buffer or variable</span>
<a name="1398"><font size=-1>1398     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">Token *vartok = tok-&gt;astOperand1();</span>
<a name="1399"><font size=-1>1399     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(vartok) {</span>
<a name="1400"><font size=-1>1400     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vartok-&gt;str() == </span><span class="string">&quot;[&quot;</span><span class="default">)</span>
<a name="1401"><font size=-1>1401     </font></a><span class="default">                vartok = vartok-&gt;astOperand1();</span>
<a name="1402"><font size=-1>1402     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(vartok-&gt;str() == </span><span class="string">&quot;.&quot; </span><span class="default">|| vartok-&gt;str() == </span><span class="string">&quot;::&quot;</span><span class="default">)</span>
<a name="1403"><font size=-1>1403     </font></a><span class="default">                vartok = vartok-&gt;astOperand2();</span>
<a name="1404"><font size=-1>1404     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="1405"><font size=-1>1405     </font></a><span class="keyword">                break</span><span class="default">;</span>
<a name="1406"><font size=-1>1406     </font></a><span class="default">        }</span>
<a name="1407"><font size=-1>1407     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!(vartok &amp;&amp; vartok-&gt;variable() &amp;&amp; !vartok-&gt;variable()-&gt;isPointer()))</span>
<a name="1408"><font size=-1>1408     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1409"><font size=-1>1409     </font></a><span class="default"></span>
<a name="1410"><font size=-1>1410     </font></a><span class="default">        ValueFlow::Value value;</span>
<a name="1411"><font size=-1>1411     </font></a><span class="default">        value.valueType = ValueFlow::Value::TOK;</span>
<a name="1412"><font size=-1>1412     </font></a><span class="default">        value.tokvalue = tok;</span>
<a name="1413"><font size=-1>1413     </font></a><span class="default">        setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1414"><font size=-1>1414     </font></a><span class="default">    }</span>
<a name="1415"><font size=-1>1415     </font></a><span class="default">}</span>
<a name="1416"><font size=-1>1416     </font></a><span class="default"></span>
<a name="1417"><font size=-1>1417     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowPointerAliasDeref(TokenList *tokenlist)</span>
<a name="1418"><font size=-1>1418     </font></a><span class="default">{</span>
<a name="1419"><font size=-1>1419     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1420"><font size=-1>1420     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;isUnaryOp(</span><span class="string">&quot;*&quot;</span><span class="default">))</span>
<a name="1421"><font size=-1>1421     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1422"><font size=-1>1422     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!astIsPointer(tok-&gt;astOperand1()))</span>
<a name="1423"><font size=-1>1423     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1424"><font size=-1>1424     </font></a><span class="default"></span>
<a name="1425"><font size=-1>1425     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token* lifeTok = nullptr;</span>
<a name="1426"><font size=-1>1426     </font></a><span class="default">        ErrorPath errorPath;</span>
<a name="1427"><font size=-1>1427     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v:tok-&gt;astOperand1()-&gt;values()) {</span>
<a name="1428"><font size=-1>1428     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!v.isLocalLifetimeValue())</span>
<a name="1429"><font size=-1>1429     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1430"><font size=-1>1430     </font></a><span class="default">            lifeTok = v.tokvalue;</span>
<a name="1431"><font size=-1>1431     </font></a><span class="default">            errorPath = v.errorPath;</span>
<a name="1432"><font size=-1>1432     </font></a><span class="default">        }</span>
<a name="1433"><font size=-1>1433     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!lifeTok)</span>
<a name="1434"><font size=-1>1434     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1435"><font size=-1>1435     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(lifeTok-&gt;varId() == </span><span class="number">0</span><span class="default">)</span>
<a name="1436"><font size=-1>1436     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1437"><font size=-1>1437     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable * var = lifeTok-&gt;variable();</span>
<a name="1438"><font size=-1>1438     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="1439"><font size=-1>1439     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1440"><font size=-1>1440     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;isConst() &amp;&amp; isVariableChanged(lifeTok-&gt;next(), tok, lifeTok-&gt;varId(), !var-&gt;isLocal(), tokenlist-&gt;getSettings(), tokenlist-&gt;isCPP()))</span>
<a name="1441"><font size=-1>1441     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1442"><font size=-1>1442     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v:lifeTok-&gt;values()) {</span>
<a name="1443"><font size=-1>1443     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(v.isLifetimeValue())</span>
<a name="1444"><font size=-1>1444     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1445"><font size=-1>1445     </font></a><span class="default">            ValueFlow::Value value = v;</span>
<a name="1446"><font size=-1>1446     </font></a><span class="default">            value.errorPath.insert(value.errorPath.begin(), errorPath.begin(), errorPath.end());</span>
<a name="1447"><font size=-1>1447     </font></a><span class="default">            setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="1448"><font size=-1>1448     </font></a><span class="default">        }</span>
<a name="1449"><font size=-1>1449     </font></a><span class="default">    }</span>
<a name="1450"><font size=-1>1450     </font></a><span class="default">}</span>
<a name="1451"><font size=-1>1451     </font></a><span class="default"></span>
<a name="1452"><font size=-1>1452     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowBitAnd(TokenList *tokenlist)</span>
<a name="1453"><font size=-1>1453     </font></a><span class="default">{</span>
<a name="1454"><font size=-1>1454     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1455"><font size=-1>1455     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="1456"><font size=-1>1456     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1457"><font size=-1>1457     </font></a><span class="default"></span>
<a name="1458"><font size=-1>1458     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="1459"><font size=-1>1459     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1460"><font size=-1>1460     </font></a><span class="default"></span>
<a name="1461"><font size=-1>1461     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1() || !tok-&gt;astOperand2())</span>
<a name="1462"><font size=-1>1462     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1463"><font size=-1>1463     </font></a><span class="default"></span>
<a name="1464"><font size=-1>1464     </font></a><span class="default">        MathLib::bigint number;</span>
<a name="1465"><font size=-1>1465     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(MathLib::isInt(tok-&gt;astOperand1()-&gt;str()))</span>
<a name="1466"><font size=-1>1466     </font></a><span class="default">            number = MathLib::toLongNumber(tok-&gt;astOperand1()-&gt;str());</span>
<a name="1467"><font size=-1>1467     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(MathLib::isInt(tok-&gt;astOperand2()-&gt;str()))</span>
<a name="1468"><font size=-1>1468     </font></a><span class="default">            number = MathLib::toLongNumber(tok-&gt;astOperand2()-&gt;str());</span>
<a name="1469"><font size=-1>1469     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="1470"><font size=-1>1470     </font></a><span class="keyword">            continue</span><span class="default">;</span>
<a name="1471"><font size=-1>1471     </font></a><span class="default"></span>
<a name="1472"><font size=-1>1472     </font></a><span class="default">        </span><span class="keyword">int </span><span class="default">bit = </span><span class="number">0</span><span class="default">;</span>
<a name="1473"><font size=-1>1473     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(bit &lt;= (MathLib::bigint_bits - </span><span class="number">2</span><span class="default">) &amp;&amp; ((((MathLib::bigint)</span><span class="number">1</span><span class="default">) &lt;&lt; bit) &lt; number))</span>
<a name="1474"><font size=-1>1474     </font></a><span class="default">            ++bit;</span>
<a name="1475"><font size=-1>1475     </font></a><span class="default"></span>
<a name="1476"><font size=-1>1476     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">((((MathLib::bigint)</span><span class="number">1</span><span class="default">) &lt;&lt; bit) == number) {</span>
<a name="1477"><font size=-1>1477     </font></a><span class="default">            setTokenValue(tok, ValueFlow::Value(</span><span class="number">0</span><span class="default">), tokenlist-&gt;getSettings());</span>
<a name="1478"><font size=-1>1478     </font></a><span class="default">            setTokenValue(tok, ValueFlow::Value(number), tokenlist-&gt;getSettings());</span>
<a name="1479"><font size=-1>1479     </font></a><span class="default">        }</span>
<a name="1480"><font size=-1>1480     </font></a><span class="default">    }</span>
<a name="1481"><font size=-1>1481     </font></a><span class="default">}</span>
<a name="1482"><font size=-1>1482     </font></a><span class="default"></span>
<a name="1483"><font size=-1>1483     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSameExpressions(TokenList *tokenlist)</span>
<a name="1484"><font size=-1>1484     </font></a><span class="default">{</span>
<a name="1485"><font size=-1>1485     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1486"><font size=-1>1486     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="1487"><font size=-1>1487     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1488"><font size=-1>1488     </font></a><span class="default"></span>
<a name="1489"><font size=-1>1489     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1() || !tok-&gt;astOperand2())</span>
<a name="1490"><font size=-1>1490     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1491"><font size=-1>1491     </font></a><span class="default"></span>
<a name="1492"><font size=-1>1492     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;astOperand1()-&gt;isLiteral() || tok-&gt;astOperand2()-&gt;isLiteral())</span>
<a name="1493"><font size=-1>1493     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1494"><font size=-1>1494     </font></a><span class="default"></span>
<a name="1495"><font size=-1>1495     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!astIsIntegral(tok-&gt;astOperand1(), </span><span class="keyword">false</span><span class="default">) &amp;&amp; !astIsIntegral(tok-&gt;astOperand2(), </span><span class="keyword">false</span><span class="default">))</span>
<a name="1496"><font size=-1>1496     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1497"><font size=-1>1497     </font></a><span class="default"></span>
<a name="1498"><font size=-1>1498     </font></a><span class="default">        ValueFlow::Value val;</span>
<a name="1499"><font size=-1>1499     </font></a><span class="default"></span>
<a name="1500"><font size=-1>1500     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;==|&gt;=|&lt;=|/&quot;</span><span class="default">)) {</span>
<a name="1501"><font size=-1>1501     </font></a><span class="default">            val = ValueFlow::Value(</span><span class="number">1</span><span class="default">);</span>
<a name="1502"><font size=-1>1502     </font></a><span class="default">            val.setKnown();</span>
<a name="1503"><font size=-1>1503     </font></a><span class="default">        }</span>
<a name="1504"><font size=-1>1504     </font></a><span class="default"></span>
<a name="1505"><font size=-1>1505     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;!=|&gt;|&lt;|%|-&quot;</span><span class="default">)) {</span>
<a name="1506"><font size=-1>1506     </font></a><span class="default">            val = ValueFlow::Value(</span><span class="number">0</span><span class="default">);</span>
<a name="1507"><font size=-1>1507     </font></a><span class="default">            val.setKnown();</span>
<a name="1508"><font size=-1>1508     </font></a><span class="default">        }</span>
<a name="1509"><font size=-1>1509     </font></a><span class="default"></span>
<a name="1510"><font size=-1>1510     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!val.isKnown())</span>
<a name="1511"><font size=-1>1511     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1512"><font size=-1>1512     </font></a><span class="default"></span>
<a name="1513"><font size=-1>1513     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isSameExpression(tokenlist-&gt;isCPP(), </span><span class="keyword">false</span><span class="default">, tok-&gt;astOperand1(), tok-&gt;astOperand2(), tokenlist-&gt;getSettings()-&gt;library, </span><span class="keyword">true</span><span class="default">, </span><span class="keyword">true</span><span class="default">, &amp;val.errorPath)) {</span>
<a name="1514"><font size=-1>1514     </font></a><span class="default">            setTokenValue(tok, val, tokenlist-&gt;getSettings());</span>
<a name="1515"><font size=-1>1515     </font></a><span class="default">        }</span>
<a name="1516"><font size=-1>1516     </font></a><span class="default">    }</span>
<a name="1517"><font size=-1>1517     </font></a><span class="default">}</span>
<a name="1518"><font size=-1>1518     </font></a><span class="default"></span>
<a name="1519"><font size=-1>1519     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowTerminatingCondition(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1520"><font size=-1>1520     </font></a><span class="default">{</span>
<a name="1521"><font size=-1>1521     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">cpp = symboldatabase-&gt;isCPP();</span>
<a name="1522"><font size=-1>1522     </font></a><span class="default">    </span><span class="keyword">typedef </span><span class="default">std::pair&lt;</span><span class="keyword">const </span><span class="default">Token*, </span><span class="keyword">const </span><span class="default">Scope*&gt; Condition;</span>
<a name="1523"><font size=-1>1523     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : symboldatabase-&gt;functionScopes) {</span>
<a name="1524"><font size=-1>1524     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">skipFunction = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1525"><font size=-1>1525     </font></a><span class="default">        std::vector&lt;Condition&gt; conds;</span>
<a name="1526"><font size=-1>1526     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* tok = scope-&gt;bodyStart; tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="1527"><font size=-1>1527     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;isIncompleteVar()) {</span>
<a name="1528"><font size=-1>1528     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1529"><font size=-1>1529     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;Skipping function due to incomplete variable &quot; </span><span class="default">+ tok-&gt;str());</span>
<a name="1530"><font size=-1>1530     </font></a><span class="default">                skipFunction = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1531"><font size=-1>1531     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1532"><font size=-1>1532     </font></a><span class="default">            }</span>
<a name="1533"><font size=-1>1533     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;if (&quot;</span><span class="default">))</span>
<a name="1534"><font size=-1>1534     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1535"><font size=-1>1535     </font></a><span class="default">            </span><span class="comment">// Skip known values</span>
<a name="1536"><font size=-1>1536     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok-&gt;next()-&gt;hasKnownValue())</span>
<a name="1537"><font size=-1>1537     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1538"><font size=-1>1538     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * condTok = tok-&gt;next();</span>
<a name="1539"><font size=-1>1539     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(condTok-&gt;link(), </span><span class="string">&quot;) {&quot;</span><span class="default">))</span>
<a name="1540"><font size=-1>1540     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1541"><font size=-1>1541     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * blockTok = condTok-&gt;link()-&gt;tokAt(</span><span class="number">1</span><span class="default">);</span>
<a name="1542"><font size=-1>1542     </font></a><span class="default">            </span><span class="comment">// Check if the block terminates early</span>
<a name="1543"><font size=-1>1543     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!isEscapeScope(blockTok, tokenlist))</span>
<a name="1544"><font size=-1>1544     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1545"><font size=-1>1545     </font></a><span class="default">            </span><span class="comment">// Check if any variables are modified in scope</span>
<a name="1546"><font size=-1>1546     </font></a><span class="comment">            </span><span class="keyword">bool </span><span class="default">bail = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1547"><font size=-1>1547     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token * tok2=condTok-&gt;next(); tok2 != condTok-&gt;link(); tok2 = tok2-&gt;next()) {</span>
<a name="1548"><font size=-1>1548     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable * var = tok2-&gt;variable();</span>
<a name="1549"><font size=-1>1549     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="1550"><font size=-1>1550     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1551"><font size=-1>1551     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var-&gt;scope())</span>
<a name="1552"><font size=-1>1552     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1553"><font size=-1>1553     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * endToken = var-&gt;scope()-&gt;bodyEnd;</span>
<a name="1554"><font size=-1>1554     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var-&gt;isLocal() &amp;&amp; !var-&gt;isConst() &amp;&amp; !var-&gt;isArgument()) {</span>
<a name="1555"><font size=-1>1555     </font></a><span class="default">                    bail = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1556"><font size=-1>1556     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1557"><font size=-1>1557     </font></a><span class="default">                }</span>
<a name="1558"><font size=-1>1558     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;isStatic() &amp;&amp; !var-&gt;isConst()) {</span>
<a name="1559"><font size=-1>1559     </font></a><span class="default">                    bail = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1560"><font size=-1>1560     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1561"><font size=-1>1561     </font></a><span class="default">                }</span>
<a name="1562"><font size=-1>1562     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var-&gt;isConst() &amp;&amp; var-&gt;declEndToken() &amp;&amp; isVariableChanged(var-&gt;declEndToken()-&gt;next(), endToken, tok2-&gt;varId(), </span><span class="keyword">false</span><span class="default">, settings, cpp)) {</span>
<a name="1563"><font size=-1>1563     </font></a><span class="default">                    bail = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1564"><font size=-1>1564     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1565"><font size=-1>1565     </font></a><span class="default">                }</span>
<a name="1566"><font size=-1>1566     </font></a><span class="default">            }</span>
<a name="1567"><font size=-1>1567     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(bail)</span>
<a name="1568"><font size=-1>1568     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1569"><font size=-1>1569     </font></a><span class="default">            </span><span class="comment">// TODO: Handle multiple conditions</span>
<a name="1570"><font size=-1>1570     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(condTok-&gt;astOperand2(), </span><span class="string">&quot;%oror%|%or%|&amp;|&amp;&amp;&quot;</span><span class="default">))</span>
<a name="1571"><font size=-1>1571     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1572"><font size=-1>1572     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope * condScope = nullptr;</span>
<a name="1573"><font size=-1>1573     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * parent = condTok-&gt;scope(); parent; parent = parent-&gt;nestedIn) {</span>
<a name="1574"><font size=-1>1574     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(parent-&gt;type == Scope::eIf ||</span>
<a name="1575"><font size=-1>1575     </font></a><span class="default">                    parent-&gt;type == Scope::eWhile ||</span>
<a name="1576"><font size=-1>1576     </font></a><span class="default">                    parent-&gt;type == Scope::eSwitch) {</span>
<a name="1577"><font size=-1>1577     </font></a><span class="default">                    condScope = parent;</span>
<a name="1578"><font size=-1>1578     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1579"><font size=-1>1579     </font></a><span class="default">                }</span>
<a name="1580"><font size=-1>1580     </font></a><span class="default">            }</span>
<a name="1581"><font size=-1>1581     </font></a><span class="default">            conds.emplace_back(condTok-&gt;astOperand2(), condScope);</span>
<a name="1582"><font size=-1>1582     </font></a><span class="default">        }</span>
<a name="1583"><font size=-1>1583     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(skipFunction)</span>
<a name="1584"><font size=-1>1584     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1585"><font size=-1>1585     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Condition cond:conds) {</span>
<a name="1586"><font size=-1>1586     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!cond.first)</span>
<a name="1587"><font size=-1>1587     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1588"><font size=-1>1588     </font></a><span class="default">            Token *</span><span class="keyword">const </span><span class="default">startToken = cond.first-&gt;findExpressionStartEndTokens().second-&gt;next();</span>
<a name="1589"><font size=-1>1589     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(Token* tok = startToken; tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="1590"><font size=-1>1590     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%comp%&quot;</span><span class="default">))</span>
<a name="1591"><font size=-1>1591     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1592"><font size=-1>1592     </font></a><span class="default">                </span><span class="comment">// Skip known values</span>
<a name="1593"><font size=-1>1593     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="1594"><font size=-1>1594     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1595"><font size=-1>1595     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(cond.second) {</span>
<a name="1596"><font size=-1>1596     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">bail = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1597"><font size=-1>1597     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * parent = tok-&gt;scope()-&gt;nestedIn; parent; parent = parent-&gt;nestedIn) {</span>
<a name="1598"><font size=-1>1598     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(parent == cond.second) {</span>
<a name="1599"><font size=-1>1599     </font></a><span class="default">                            bail = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1600"><font size=-1>1600     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1601"><font size=-1>1601     </font></a><span class="default">                        }</span>
<a name="1602"><font size=-1>1602     </font></a><span class="default">                    }</span>
<a name="1603"><font size=-1>1603     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(bail)</span>
<a name="1604"><font size=-1>1604     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1605"><font size=-1>1605     </font></a><span class="default">                }</span>
<a name="1606"><font size=-1>1606     </font></a><span class="default">                ErrorPath errorPath;</span>
<a name="1607"><font size=-1>1607     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isOppositeCond(</span><span class="keyword">true</span><span class="default">, cpp, tok, cond.first, settings-&gt;library, </span><span class="keyword">true</span><span class="default">, </span><span class="keyword">true</span><span class="default">, &amp;errorPath)) {</span>
<a name="1608"><font size=-1>1608     </font></a><span class="default">                    ValueFlow::Value val(</span><span class="number">1</span><span class="default">);</span>
<a name="1609"><font size=-1>1609     </font></a><span class="default">                    val.setKnown();</span>
<a name="1610"><font size=-1>1610     </font></a><span class="default">                    val.condition = cond.first;</span>
<a name="1611"><font size=-1>1611     </font></a><span class="default">                    val.errorPath = errorPath;</span>
<a name="1612"><font size=-1>1612     </font></a><span class="default">                    val.errorPath.emplace_back(cond.first, </span><span class="string">&quot;Assuming condition '&quot; </span><span class="default">+ cond.first-&gt;expressionString() + </span><span class="string">&quot;' is false&quot;</span><span class="default">);</span>
<a name="1613"><font size=-1>1613     </font></a><span class="default">                    setTokenValue(tok, val, tokenlist-&gt;getSettings());</span>
<a name="1614"><font size=-1>1614     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(isSameExpression(cpp, </span><span class="keyword">true</span><span class="default">, tok, cond.first, settings-&gt;library, </span><span class="keyword">true</span><span class="default">, </span><span class="keyword">true</span><span class="default">, &amp;errorPath)) {</span>
<a name="1615"><font size=-1>1615     </font></a><span class="default">                    ValueFlow::Value val(</span><span class="number">0</span><span class="default">);</span>
<a name="1616"><font size=-1>1616     </font></a><span class="default">                    val.setKnown();</span>
<a name="1617"><font size=-1>1617     </font></a><span class="default">                    val.condition = cond.first;</span>
<a name="1618"><font size=-1>1618     </font></a><span class="default">                    val.errorPath = errorPath;</span>
<a name="1619"><font size=-1>1619     </font></a><span class="default">                    val.errorPath.emplace_back(cond.first, </span><span class="string">&quot;Assuming condition '&quot; </span><span class="default">+ cond.first-&gt;expressionString() + </span><span class="string">&quot;' is false&quot;</span><span class="default">);</span>
<a name="1620"><font size=-1>1620     </font></a><span class="default">                    setTokenValue(tok, val, tokenlist-&gt;getSettings());</span>
<a name="1621"><font size=-1>1621     </font></a><span class="default">                }</span>
<a name="1622"><font size=-1>1622     </font></a><span class="default">            }</span>
<a name="1623"><font size=-1>1623     </font></a><span class="default">        }</span>
<a name="1624"><font size=-1>1624     </font></a><span class="default">    }</span>
<a name="1625"><font size=-1>1625     </font></a><span class="default">}</span>
<a name="1626"><font size=-1>1626     </font></a><span class="default"></span>
<a name="1627"><font size=-1>1627     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">getExpressionRange(</span><span class="keyword">const </span><span class="default">Token *expr, MathLib::bigint *minvalue, MathLib::bigint *maxvalue)</span>
<a name="1628"><font size=-1>1628     </font></a><span class="default">{</span>
<a name="1629"><font size=-1>1629     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;hasKnownIntValue()) {</span>
<a name="1630"><font size=-1>1630     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(minvalue)</span>
<a name="1631"><font size=-1>1631     </font></a><span class="default">            *minvalue = expr-&gt;values().front().intvalue;</span>
<a name="1632"><font size=-1>1632     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(maxvalue)</span>
<a name="1633"><font size=-1>1633     </font></a><span class="default">            *maxvalue = expr-&gt;values().front().intvalue;</span>
<a name="1634"><font size=-1>1634     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1635"><font size=-1>1635     </font></a><span class="default">    }</span>
<a name="1636"><font size=-1>1636     </font></a><span class="default"></span>
<a name="1637"><font size=-1>1637     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&amp;&quot; </span><span class="default">&amp;&amp; expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="1638"><font size=-1>1638     </font></a><span class="default">        MathLib::bigint vals[</span><span class="number">4</span><span class="default">];</span>
<a name="1639"><font size=-1>1639     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">lhsHasKnownRange = getExpressionRange(expr-&gt;astOperand1(), &amp;vals[</span><span class="number">0</span><span class="default">], &amp;vals[</span><span class="number">1</span><span class="default">]);</span>
<a name="1640"><font size=-1>1640     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">rhsHasKnownRange = getExpressionRange(expr-&gt;astOperand2(), &amp;vals[</span><span class="number">2</span><span class="default">], &amp;vals[</span><span class="number">3</span><span class="default">]);</span>
<a name="1641"><font size=-1>1641     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!lhsHasKnownRange &amp;&amp; !rhsHasKnownRange)</span>
<a name="1642"><font size=-1>1642     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1643"><font size=-1>1643     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!lhsHasKnownRange || !rhsHasKnownRange) {</span>
<a name="1644"><font size=-1>1644     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(minvalue)</span>
<a name="1645"><font size=-1>1645     </font></a><span class="default">                *minvalue = lhsHasKnownRange ? vals[</span><span class="number">0</span><span class="default">] : vals[</span><span class="number">2</span><span class="default">];</span>
<a name="1646"><font size=-1>1646     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(maxvalue)</span>
<a name="1647"><font size=-1>1647     </font></a><span class="default">                *maxvalue = lhsHasKnownRange ? vals[</span><span class="number">1</span><span class="default">] : vals[</span><span class="number">3</span><span class="default">];</span>
<a name="1648"><font size=-1>1648     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1649"><font size=-1>1649     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(minvalue)</span>
<a name="1650"><font size=-1>1650     </font></a><span class="default">                *minvalue = vals[</span><span class="number">0</span><span class="default">] &amp; vals[</span><span class="number">2</span><span class="default">];</span>
<a name="1651"><font size=-1>1651     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(maxvalue)</span>
<a name="1652"><font size=-1>1652     </font></a><span class="default">                *maxvalue = vals[</span><span class="number">1</span><span class="default">] &amp; vals[</span><span class="number">3</span><span class="default">];</span>
<a name="1653"><font size=-1>1653     </font></a><span class="default">        }</span>
<a name="1654"><font size=-1>1654     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1655"><font size=-1>1655     </font></a><span class="default">    }</span>
<a name="1656"><font size=-1>1656     </font></a><span class="default"></span>
<a name="1657"><font size=-1>1657     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;%&quot; </span><span class="default">&amp;&amp; expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="1658"><font size=-1>1658     </font></a><span class="default">        MathLib::bigint vals[</span><span class="number">4</span><span class="default">];</span>
<a name="1659"><font size=-1>1659     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!getExpressionRange(expr-&gt;astOperand2(), &amp;vals[</span><span class="number">2</span><span class="default">], &amp;vals[</span><span class="number">3</span><span class="default">]))</span>
<a name="1660"><font size=-1>1660     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1661"><font size=-1>1661     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vals[</span><span class="number">2</span><span class="default">] &lt;= </span><span class="number">0</span><span class="default">)</span>
<a name="1662"><font size=-1>1662     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1663"><font size=-1>1663     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">lhsHasKnownRange = getExpressionRange(expr-&gt;astOperand1(), &amp;vals[</span><span class="number">0</span><span class="default">], &amp;vals[</span><span class="number">1</span><span class="default">]);</span>
<a name="1664"><font size=-1>1664     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(lhsHasKnownRange &amp;&amp; vals[</span><span class="number">0</span><span class="default">] &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="1665"><font size=-1>1665     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1666"><font size=-1>1666     </font></a><span class="default">        </span><span class="comment">// If lhs has unknown value, it must be unsigned</span>
<a name="1667"><font size=-1>1667     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!lhsHasKnownRange &amp;&amp; (!expr-&gt;astOperand1()-&gt;valueType() || expr-&gt;astOperand1()-&gt;valueType()-&gt;sign != ValueType::Sign::UNSIGNED))</span>
<a name="1668"><font size=-1>1668     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1669"><font size=-1>1669     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(minvalue)</span>
<a name="1670"><font size=-1>1670     </font></a><span class="default">            *minvalue = </span><span class="number">0</span><span class="default">;</span>
<a name="1671"><font size=-1>1671     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(maxvalue)</span>
<a name="1672"><font size=-1>1672     </font></a><span class="default">            *maxvalue = vals[</span><span class="number">3</span><span class="default">] - </span><span class="number">1</span><span class="default">;</span>
<a name="1673"><font size=-1>1673     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1674"><font size=-1>1674     </font></a><span class="default">    }</span>
<a name="1675"><font size=-1>1675     </font></a><span class="default"></span>
<a name="1676"><font size=-1>1676     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1677"><font size=-1>1677     </font></a><span class="default">}</span>
<a name="1678"><font size=-1>1678     </font></a><span class="default"></span>
<a name="1679"><font size=-1>1679     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowRightShift(TokenList *tokenList, </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="1680"><font size=-1>1680     </font></a><span class="default">{</span>
<a name="1681"><font size=-1>1681     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenList-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1682"><font size=-1>1682     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;&gt;&gt;&quot;</span><span class="default">)</span>
<a name="1683"><font size=-1>1683     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1684"><font size=-1>1684     </font></a><span class="default"></span>
<a name="1685"><font size=-1>1685     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="1686"><font size=-1>1686     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1687"><font size=-1>1687     </font></a><span class="default"></span>
<a name="1688"><font size=-1>1688     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1() || !tok-&gt;astOperand2())</span>
<a name="1689"><font size=-1>1689     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1690"><font size=-1>1690     </font></a><span class="default"></span>
<a name="1691"><font size=-1>1691     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand2()-&gt;hasKnownValue())</span>
<a name="1692"><font size=-1>1692     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1693"><font size=-1>1693     </font></a><span class="default"></span>
<a name="1694"><font size=-1>1694     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">MathLib::bigint rhsvalue = tok-&gt;astOperand2()-&gt;values().front().intvalue;</span>
<a name="1695"><font size=-1>1695     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(rhsvalue &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="1696"><font size=-1>1696     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1697"><font size=-1>1697     </font></a><span class="default"></span>
<a name="1698"><font size=-1>1698     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1()-&gt;valueType() || !tok-&gt;astOperand1()-&gt;valueType()-&gt;isIntegral())</span>
<a name="1699"><font size=-1>1699     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1700"><font size=-1>1700     </font></a><span class="default"></span>
<a name="1701"><font size=-1>1701     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand2()-&gt;valueType() || !tok-&gt;astOperand2()-&gt;valueType()-&gt;isIntegral())</span>
<a name="1702"><font size=-1>1702     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1703"><font size=-1>1703     </font></a><span class="default"></span>
<a name="1704"><font size=-1>1704     </font></a><span class="default">        MathLib::bigint lhsmax=</span><span class="number">0</span><span class="default">;</span>
<a name="1705"><font size=-1>1705     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!getExpressionRange(tok-&gt;astOperand1(), nullptr, &amp;lhsmax))</span>
<a name="1706"><font size=-1>1706     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1707"><font size=-1>1707     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(lhsmax &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="1708"><font size=-1>1708     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1709"><font size=-1>1709     </font></a><span class="default">        </span><span class="keyword">int </span><span class="default">lhsbits;</span>
<a name="1710"><font size=-1>1710     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">((tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::CHAR) ||</span>
<a name="1711"><font size=-1>1711     </font></a><span class="default">            (tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::SHORT) ||</span>
<a name="1712"><font size=-1>1712     </font></a><span class="default">            (tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::WCHAR_T) ||</span>
<a name="1713"><font size=-1>1713     </font></a><span class="default">            (tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::BOOL) ||</span>
<a name="1714"><font size=-1>1714     </font></a><span class="default">            (tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::INT))</span>
<a name="1715"><font size=-1>1715     </font></a><span class="default">            lhsbits = settings-&gt;int_bit;</span>
<a name="1716"><font size=-1>1716     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::LONG)</span>
<a name="1717"><font size=-1>1717     </font></a><span class="default">            lhsbits = settings-&gt;long_bit;</span>
<a name="1718"><font size=-1>1718     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(tok-&gt;astOperand1()-&gt;valueType()-&gt;type == ValueType::Type::LONGLONG)</span>
<a name="1719"><font size=-1>1719     </font></a><span class="default">            lhsbits = settings-&gt;long_long_bit;</span>
<a name="1720"><font size=-1>1720     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="1721"><font size=-1>1721     </font></a><span class="keyword">            continue</span><span class="default">;</span>
<a name="1722"><font size=-1>1722     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(rhsvalue &gt;= lhsbits || rhsvalue &gt;= MathLib::bigint_bits || (</span><span class="number">1ULL </span><span class="default">&lt;&lt; rhsvalue) &lt;= lhsmax)</span>
<a name="1723"><font size=-1>1723     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1724"><font size=-1>1724     </font></a><span class="default"></span>
<a name="1725"><font size=-1>1725     </font></a><span class="default">        ValueFlow::Value val(</span><span class="number">0</span><span class="default">);</span>
<a name="1726"><font size=-1>1726     </font></a><span class="default">        val.setKnown();</span>
<a name="1727"><font size=-1>1727     </font></a><span class="default">        setTokenValue(tok, val, tokenList-&gt;getSettings());</span>
<a name="1728"><font size=-1>1728     </font></a><span class="default">    }</span>
<a name="1729"><font size=-1>1729     </font></a><span class="default">}</span>
<a name="1730"><font size=-1>1730     </font></a><span class="default"></span>
<a name="1731"><font size=-1>1731     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowOppositeCondition(SymbolDatabase *symboldatabase, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1732"><font size=-1>1732     </font></a><span class="default">{</span>
<a name="1733"><font size=-1>1733     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope &amp;scope : symboldatabase-&gt;scopeList) {</span>
<a name="1734"><font size=-1>1734     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope.type != Scope::eIf)</span>
<a name="1735"><font size=-1>1735     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1736"><font size=-1>1736     </font></a><span class="default">        Token *tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(scope.classDef);</span>
<a name="1737"><font size=-1>1737     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;if (&quot;</span><span class="default">))</span>
<a name="1738"><font size=-1>1738     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1739"><font size=-1>1739     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *cond1 = tok-&gt;next()-&gt;astOperand2();</span>
<a name="1740"><font size=-1>1740     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!cond1 || !cond1-&gt;isComparisonOp())</span>
<a name="1741"><font size=-1>1741     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1742"><font size=-1>1742     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">cpp = symboldatabase-&gt;isCPP();</span>
<a name="1743"><font size=-1>1743     </font></a><span class="default">        Token *tok2 = tok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="1744"><font size=-1>1744     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="1745"><font size=-1>1745     </font></a><span class="default">            tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="1746"><font size=-1>1746     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok2, </span><span class="string">&quot;} else { if (&quot;</span><span class="default">))</span>
<a name="1747"><font size=-1>1747     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1748"><font size=-1>1748     </font></a><span class="default">            Token *ifOpenBraceTok = tok2-&gt;tokAt(</span><span class="number">4</span><span class="default">);</span>
<a name="1749"><font size=-1>1749     </font></a><span class="default">            Token *cond2 = ifOpenBraceTok-&gt;astOperand2();</span>
<a name="1750"><font size=-1>1750     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!cond2 || !cond2-&gt;isComparisonOp())</span>
<a name="1751"><font size=-1>1751     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1752"><font size=-1>1752     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isOppositeCond(</span><span class="keyword">true</span><span class="default">, cpp, cond1, cond2, settings-&gt;library, </span><span class="keyword">true</span><span class="default">, </span><span class="keyword">true</span><span class="default">)) {</span>
<a name="1753"><font size=-1>1753     </font></a><span class="default">                ValueFlow::Value value(</span><span class="number">1</span><span class="default">);</span>
<a name="1754"><font size=-1>1754     </font></a><span class="default">                value.setKnown();</span>
<a name="1755"><font size=-1>1755     </font></a><span class="default">                setTokenValue(cond2, value, settings);</span>
<a name="1756"><font size=-1>1756     </font></a><span class="default">            }</span>
<a name="1757"><font size=-1>1757     </font></a><span class="default">            tok2 = ifOpenBraceTok-&gt;link();</span>
<a name="1758"><font size=-1>1758     </font></a><span class="default">        }</span>
<a name="1759"><font size=-1>1759     </font></a><span class="default">    }</span>
<a name="1760"><font size=-1>1760     </font></a><span class="default">}</span>
<a name="1761"><font size=-1>1761     </font></a><span class="default"></span>
<a name="1762"><font size=-1>1762     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowGlobalConstVar(TokenList* tokenList, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1763"><font size=-1>1763     </font></a><span class="default">{</span>
<a name="1764"><font size=-1>1764     </font></a><span class="default">    </span><span class="comment">// Get variable values...</span>
<a name="1765"><font size=-1>1765     </font></a><span class="comment">    </span><span class="default">std::map&lt;</span><span class="keyword">const </span><span class="default">Variable*, ValueFlow::Value&gt; vars;</span>
<a name="1766"><font size=-1>1766     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* tok = tokenList-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1767"><font size=-1>1767     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;variable())</span>
<a name="1768"><font size=-1>1768     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1769"><font size=-1>1769     </font></a><span class="default">        </span><span class="comment">// Initialization...</span>
<a name="1770"><font size=-1>1770     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok == tok-&gt;variable()-&gt;nameToken() &amp;&amp;</span>
<a name="1771"><font size=-1>1771     </font></a><span class="default">            !tok-&gt;variable()-&gt;isVolatile() &amp;&amp;</span>
<a name="1772"><font size=-1>1772     </font></a><span class="default">            !tok-&gt;variable()-&gt;isArgument() &amp;&amp;</span>
<a name="1773"><font size=-1>1773     </font></a><span class="default">            tok-&gt;variable()-&gt;isConst() &amp;&amp;</span>
<a name="1774"><font size=-1>1774     </font></a><span class="default">            tok-&gt;valueType() &amp;&amp;</span>
<a name="1775"><font size=-1>1775     </font></a><span class="default">            tok-&gt;valueType()-&gt;isIntegral() &amp;&amp;</span>
<a name="1776"><font size=-1>1776     </font></a><span class="default">            tok-&gt;valueType()-&gt;pointer == </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="1777"><font size=-1>1777     </font></a><span class="default">            tok-&gt;valueType()-&gt;constness == </span><span class="number">1 </span><span class="default">&amp;&amp;</span>
<a name="1778"><font size=-1>1778     </font></a><span class="default">            Token::Match(tok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1779"><font size=-1>1779     </font></a><span class="default">            tok-&gt;next()-&gt;astOperand2() &amp;&amp;</span>
<a name="1780"><font size=-1>1780     </font></a><span class="default">            tok-&gt;next()-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="1781"><font size=-1>1781     </font></a><span class="default">            vars[tok-&gt;variable()] = tok-&gt;next()-&gt;astOperand2()-&gt;values().front();</span>
<a name="1782"><font size=-1>1782     </font></a><span class="default">        }</span>
<a name="1783"><font size=-1>1783     </font></a><span class="default">    }</span>
<a name="1784"><font size=-1>1784     </font></a><span class="default"></span>
<a name="1785"><font size=-1>1785     </font></a><span class="default">    </span><span class="comment">// Set values..</span>
<a name="1786"><font size=-1>1786     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(Token* tok = tokenList-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1787"><font size=-1>1787     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;variable())</span>
<a name="1788"><font size=-1>1788     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1789"><font size=-1>1789     </font></a><span class="default">        std::map&lt;</span><span class="keyword">const </span><span class="default">Variable*, ValueFlow::Value&gt;::const_iterator var = vars.find(tok-&gt;variable());</span>
<a name="1790"><font size=-1>1790     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var == vars.end())</span>
<a name="1791"><font size=-1>1791     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1792"><font size=-1>1792     </font></a><span class="default">        setTokenValue(tok, var-&gt;second, settings);</span>
<a name="1793"><font size=-1>1793     </font></a><span class="default">    }</span>
<a name="1794"><font size=-1>1794     </font></a><span class="default">}</span>
<a name="1795"><font size=-1>1795     </font></a><span class="default"></span>
<a name="1796"><font size=-1>1796     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowGlobalStaticVar(TokenList *tokenList, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1797"><font size=-1>1797     </font></a><span class="default">{</span>
<a name="1798"><font size=-1>1798     </font></a><span class="default">    </span><span class="comment">// Get variable values...</span>
<a name="1799"><font size=-1>1799     </font></a><span class="comment">    </span><span class="default">std::map&lt;</span><span class="keyword">const </span><span class="default">Variable *, ValueFlow::Value&gt; vars;</span>
<a name="1800"><font size=-1>1800     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = tokenList-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1801"><font size=-1>1801     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;variable())</span>
<a name="1802"><font size=-1>1802     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1803"><font size=-1>1803     </font></a><span class="default">        </span><span class="comment">// Initialization...</span>
<a name="1804"><font size=-1>1804     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok == tok-&gt;variable()-&gt;nameToken() &amp;&amp;</span>
<a name="1805"><font size=-1>1805     </font></a><span class="default">            tok-&gt;variable()-&gt;isStatic() &amp;&amp;</span>
<a name="1806"><font size=-1>1806     </font></a><span class="default">            !tok-&gt;variable()-&gt;isConst() &amp;&amp;</span>
<a name="1807"><font size=-1>1807     </font></a><span class="default">            tok-&gt;valueType() &amp;&amp;</span>
<a name="1808"><font size=-1>1808     </font></a><span class="default">            tok-&gt;valueType()-&gt;isIntegral() &amp;&amp;</span>
<a name="1809"><font size=-1>1809     </font></a><span class="default">            tok-&gt;valueType()-&gt;pointer == </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="1810"><font size=-1>1810     </font></a><span class="default">            tok-&gt;valueType()-&gt;constness == </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="1811"><font size=-1>1811     </font></a><span class="default">            Token::Match(tok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1812"><font size=-1>1812     </font></a><span class="default">            tok-&gt;next()-&gt;astOperand2() &amp;&amp;</span>
<a name="1813"><font size=-1>1813     </font></a><span class="default">            tok-&gt;next()-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="1814"><font size=-1>1814     </font></a><span class="default">            vars[tok-&gt;variable()] = tok-&gt;next()-&gt;astOperand2()-&gt;values().front();</span>
<a name="1815"><font size=-1>1815     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1816"><font size=-1>1816     </font></a><span class="default">            </span><span class="comment">// If variable is written anywhere in TU then remove it from vars</span>
<a name="1817"><font size=-1>1817     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;astParent())</span>
<a name="1818"><font size=-1>1818     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1819"><font size=-1>1819     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;++|--|&amp;&quot;</span><span class="default">) &amp;&amp; !tok-&gt;astParent()-&gt;astOperand2())</span>
<a name="1820"><font size=-1>1820     </font></a><span class="default">                vars.erase(tok-&gt;variable());</span>
<a name="1821"><font size=-1>1821     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(tok-&gt;astParent()-&gt;isAssignmentOp()) {</span>
<a name="1822"><font size=-1>1822     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok == tok-&gt;astParent()-&gt;astOperand1())</span>
<a name="1823"><font size=-1>1823     </font></a><span class="default">                    vars.erase(tok-&gt;variable());</span>
<a name="1824"><font size=-1>1824     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(tokenList-&gt;isCPP() &amp;&amp; Token::Match(tok-&gt;astParent()-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;&amp; %name% =&quot;</span><span class="default">))</span>
<a name="1825"><font size=-1>1825     </font></a><span class="default">                    vars.erase(tok-&gt;variable());</span>
<a name="1826"><font size=-1>1826     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(isLikelyStreamRead(tokenList-&gt;isCPP(), tok-&gt;astParent())) {</span>
<a name="1827"><font size=-1>1827     </font></a><span class="default">                vars.erase(tok-&gt;variable());</span>
<a name="1828"><font size=-1>1828     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;[(,]&quot;</span><span class="default">))</span>
<a name="1829"><font size=-1>1829     </font></a><span class="default">                vars.erase(tok-&gt;variable());</span>
<a name="1830"><font size=-1>1830     </font></a><span class="default">        }</span>
<a name="1831"><font size=-1>1831     </font></a><span class="default">    }</span>
<a name="1832"><font size=-1>1832     </font></a><span class="default"></span>
<a name="1833"><font size=-1>1833     </font></a><span class="default">    </span><span class="comment">// Set values..</span>
<a name="1834"><font size=-1>1834     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenList-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="1835"><font size=-1>1835     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;variable())</span>
<a name="1836"><font size=-1>1836     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1837"><font size=-1>1837     </font></a><span class="default">        std::map&lt;</span><span class="keyword">const </span><span class="default">Variable *, ValueFlow::Value&gt;::const_iterator var = vars.find(tok-&gt;variable());</span>
<a name="1838"><font size=-1>1838     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var == vars.end())</span>
<a name="1839"><font size=-1>1839     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1840"><font size=-1>1840     </font></a><span class="default">        setTokenValue(tok, var-&gt;second, settings);</span>
<a name="1841"><font size=-1>1841     </font></a><span class="default">    }</span>
<a name="1842"><font size=-1>1842     </font></a><span class="default">}</span>
<a name="1843"><font size=-1>1843     </font></a><span class="default"></span>
<a name="1844"><font size=-1>1844     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowReverse(TokenList *tokenlist,</span>
<a name="1845"><font size=-1>1845     </font></a><span class="default">                             Token *tok,</span>
<a name="1846"><font size=-1>1846     </font></a><span class="default">                             </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">varToken,</span>
<a name="1847"><font size=-1>1847     </font></a><span class="default">                             ValueFlow::Value val,</span>
<a name="1848"><font size=-1>1848     </font></a><span class="default">                             ValueFlow::Value val2,</span>
<a name="1849"><font size=-1>1849     </font></a><span class="default">                             ErrorLogger *errorLogger,</span>
<a name="1850"><font size=-1>1850     </font></a><span class="default">                             </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="1851"><font size=-1>1851     </font></a><span class="default">{</span>
<a name="1852"><font size=-1>1852     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">MathLib::bigint    num        = val.intvalue;</span>
<a name="1853"><font size=-1>1853     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const   </span><span class="default">var        = varToken-&gt;variable();</span>
<a name="1854"><font size=-1>1854     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="1855"><font size=-1>1855     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1856"><font size=-1>1856     </font></a><span class="default"></span>
<a name="1857"><font size=-1>1857     </font></a><span class="default">    </span><span class="keyword">const int                </span><span class="default">varid      = varToken-&gt;varId();</span>
<a name="1858"><font size=-1>1858     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const      </span><span class="default">startToken = var-&gt;nameToken();</span>
<a name="1859"><font size=-1>1859     </font></a><span class="default"></span>
<a name="1860"><font size=-1>1860     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok2 = tok-&gt;previous(); ; tok2 = tok2-&gt;previous()) {</span>
<a name="1861"><font size=-1>1861     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok2 ||</span>
<a name="1862"><font size=-1>1862     </font></a><span class="default">            tok2 == startToken ||</span>
<a name="1863"><font size=-1>1863     </font></a><span class="default">            (tok2-&gt;str() == </span><span class="string">&quot;{&quot; </span><span class="default">&amp;&amp; tok2-&gt;scope()-&gt;type == Scope::ScopeType::eFunction)) {</span>
<a name="1864"><font size=-1>1864     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1865"><font size=-1>1865     </font></a><span class="default">        }</span>
<a name="1866"><font size=-1>1866     </font></a><span class="default"></span>
<a name="1867"><font size=-1>1867     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;varId() == varid) {</span>
<a name="1868"><font size=-1>1868     </font></a><span class="default">            </span><span class="comment">// bailout: assignment</span>
<a name="1869"><font size=-1>1869     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;!!* %name% =&quot;</span><span class="default">)) {</span>
<a name="1870"><font size=-1>1870     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1871"><font size=-1>1871     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;assignment of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="1872"><font size=-1>1872     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1873"><font size=-1>1873     </font></a><span class="default">            }</span>
<a name="1874"><font size=-1>1874     </font></a><span class="default"></span>
<a name="1875"><font size=-1>1875     </font></a><span class="default">            </span><span class="comment">// increment/decrement</span>
<a name="1876"><font size=-1>1876     </font></a><span class="comment">            </span><span class="keyword">int </span><span class="default">inc = </span><span class="number">0</span><span class="default">;</span>
<a name="1877"><font size=-1>1877     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;[;{}] %name% ++|-- ;&quot;</span><span class="default">))</span>
<a name="1878"><font size=-1>1878     </font></a><span class="default">                inc = (tok2-&gt;strAt(</span><span class="number">1</span><span class="default">)==</span><span class="string">&quot;++&quot;</span><span class="default">) ? -</span><span class="number">1 </span><span class="default">: </span><span class="number">1</span><span class="default">;</span>
<a name="1879"><font size=-1>1879     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;[;{}] ++|-- %name% ;&quot;</span><span class="default">))</span>
<a name="1880"><font size=-1>1880     </font></a><span class="default">                inc = (tok2-&gt;strAt(-</span><span class="number">1</span><span class="default">)==</span><span class="string">&quot;++&quot;</span><span class="default">) ? -</span><span class="number">1 </span><span class="default">: </span><span class="number">1</span><span class="default">;</span>
<a name="1881"><font size=-1>1881     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;++|-- %name%&quot;</span><span class="default">) || Token::Match(tok2, </span><span class="string">&quot;%name% ++|--&quot;</span><span class="default">)) {</span>
<a name="1882"><font size=-1>1882     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1883"><font size=-1>1883     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;increment/decrement of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="1884"><font size=-1>1884     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1885"><font size=-1>1885     </font></a><span class="default">            }</span>
<a name="1886"><font size=-1>1886     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(inc != </span><span class="number">0</span><span class="default">) {</span>
<a name="1887"><font size=-1>1887     </font></a><span class="default">                val.intvalue += inc;</span>
<a name="1888"><font size=-1>1888     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::string info(tok2-&gt;str() + </span><span class="string">&quot; is &quot; </span><span class="default">+ std::string(inc==</span><span class="number">1 </span><span class="default">? </span><span class="string">&quot;decremented&quot; </span><span class="default">: </span><span class="string">&quot;incremented&quot;</span><span class="default">) + </span><span class="string">&quot;, before this &quot; </span><span class="default">+ (inc==</span><span class="number">1</span><span class="default">?</span><span class="string">&quot;decrement&quot;</span><span class="default">:</span><span class="string">&quot;increment&quot;</span><span class="default">) + </span><span class="string">&quot; the value is &quot; </span><span class="default">+ val.infoString());</span>
<a name="1889"><font size=-1>1889     </font></a><span class="default">                val.errorPath.emplace_back(tok2, info);</span>
<a name="1890"><font size=-1>1890     </font></a><span class="default">            }</span>
<a name="1891"><font size=-1>1891     </font></a><span class="default"></span>
<a name="1892"><font size=-1>1892     </font></a><span class="default">            </span><span class="comment">// compound assignment</span>
<a name="1893"><font size=-1>1893     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;[;{}] %var% %assign%&quot;</span><span class="default">) &amp;&amp; tok2-&gt;next()-&gt;str() != </span><span class="string">&quot;=&quot;</span><span class="default">) {</span>
<a name="1894"><font size=-1>1894     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">assignToken = tok2-&gt;next();</span>
<a name="1895"><font size=-1>1895     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">rhsToken = assignToken-&gt;astOperand2();</span>
<a name="1896"><font size=-1>1896     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!rhsToken || !rhsToken-&gt;hasKnownIntValue()) {</span>
<a name="1897"><font size=-1>1897     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1898"><font size=-1>1898     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;compound assignment, rhs value is not known&quot;</span><span class="default">);</span>
<a name="1899"><font size=-1>1899     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1900"><font size=-1>1900     </font></a><span class="default">                }</span>
<a name="1901"><font size=-1>1901     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">MathLib::bigint rhsValue =  rhsToken-&gt;values().front().intvalue;</span>
<a name="1902"><font size=-1>1902     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(assignToken-&gt;str() == </span><span class="string">&quot;+=&quot;</span><span class="default">)</span>
<a name="1903"><font size=-1>1903     </font></a><span class="default">                    val.intvalue -= rhsValue;</span>
<a name="1904"><font size=-1>1904     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(assignToken-&gt;str() == </span><span class="string">&quot;-=&quot;</span><span class="default">)</span>
<a name="1905"><font size=-1>1905     </font></a><span class="default">                    val.intvalue += rhsValue;</span>
<a name="1906"><font size=-1>1906     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(assignToken-&gt;str() == </span><span class="string">&quot;*=&quot; </span><span class="default">&amp;&amp; rhsValue != </span><span class="number">0</span><span class="default">)</span>
<a name="1907"><font size=-1>1907     </font></a><span class="default">                    val.intvalue /= rhsValue;</span>
<a name="1908"><font size=-1>1908     </font></a><span class="default">                </span><span class="keyword">else </span><span class="default">{</span>
<a name="1909"><font size=-1>1909     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1910"><font size=-1>1910     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;compound assignment &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="1911"><font size=-1>1911     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="1912"><font size=-1>1912     </font></a><span class="default">                }</span>
<a name="1913"><font size=-1>1913     </font></a><span class="default"></span>
<a name="1914"><font size=-1>1914     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::string info(</span><span class="string">&quot;Compound assignment '&quot; </span><span class="default">+ assignToken-&gt;str() + </span><span class="string">&quot;', before assignment value is &quot; </span><span class="default">+ val.infoString());</span>
<a name="1915"><font size=-1>1915     </font></a><span class="default">                val.errorPath.emplace_back(tok2, info);</span>
<a name="1916"><font size=-1>1916     </font></a><span class="default">            }</span>
<a name="1917"><font size=-1>1917     </font></a><span class="default"></span>
<a name="1918"><font size=-1>1918     </font></a><span class="default">            </span><span class="comment">// bailout: variable is used in rhs in assignment to itself</span>
<a name="1919"><font size=-1>1919     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(bailoutSelfAssignment(tok2)) {</span>
<a name="1920"><font size=-1>1920     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1921"><font size=-1>1921     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; is used in rhs in assignment to itself&quot;</span><span class="default">);</span>
<a name="1922"><font size=-1>1922     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1923"><font size=-1>1923     </font></a><span class="default">            }</span>
<a name="1924"><font size=-1>1924     </font></a><span class="default"></span>
<a name="1925"><font size=-1>1925     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;sizeof|.&quot;</span><span class="default">)) {</span>
<a name="1926"><font size=-1>1926     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *prev = tok2-&gt;previous();</span>
<a name="1927"><font size=-1>1927     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(Token::Match(prev,</span><span class="string">&quot;%name%|.&quot;</span><span class="default">) &amp;&amp; prev-&gt;str() != </span><span class="string">&quot;sizeof&quot;</span><span class="default">)</span>
<a name="1928"><font size=-1>1928     </font></a><span class="default">                    prev = prev-&gt;previous();</span>
<a name="1929"><font size=-1>1929     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(prev &amp;&amp; prev-&gt;str() == </span><span class="string">&quot;sizeof&quot;</span><span class="default">)</span>
<a name="1930"><font size=-1>1930     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1931"><font size=-1>1931     </font></a><span class="default">            }</span>
<a name="1932"><font size=-1>1932     </font></a><span class="default"></span>
<a name="1933"><font size=-1>1933     </font></a><span class="default">            </span><span class="comment">// assigned by subfunction?</span>
<a name="1934"><font size=-1>1934     </font></a><span class="comment">            </span><span class="keyword">bool </span><span class="default">inconclusive = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1935"><font size=-1>1935     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChangedByFunctionCall(tok2, std::max(val.indirect, val2.indirect), settings, &amp;inconclusive)) {</span>
<a name="1936"><font size=-1>1936     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1937"><font size=-1>1937     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;possible assignment of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; by subfunction&quot;</span><span class="default">);</span>
<a name="1938"><font size=-1>1938     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1939"><font size=-1>1939     </font></a><span class="default">            }</span>
<a name="1940"><font size=-1>1940     </font></a><span class="default">            </span><span class="comment">// Impossible values can't be inconclusive</span>
<a name="1941"><font size=-1>1941     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(val.isImpossible() || val2.isImpossible())</span>
<a name="1942"><font size=-1>1942     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1943"><font size=-1>1943     </font></a><span class="default">            val.setInconclusive(inconclusive);</span>
<a name="1944"><font size=-1>1944     </font></a><span class="default">            val2.setInconclusive(inconclusive);</span>
<a name="1945"><font size=-1>1945     </font></a><span class="default"></span>
<a name="1946"><font size=-1>1946     </font></a><span class="default">            </span><span class="comment">// skip if variable is conditionally used in ?: expression</span>
<a name="1947"><font size=-1>1947     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *parent = skipValueInConditionalExpression(tok2)) {</span>
<a name="1948"><font size=-1>1948     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1949"><font size=-1>1949     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="1950"><font size=-1>1950     </font></a><span class="default">                            errorLogger,</span>
<a name="1951"><font size=-1>1951     </font></a><span class="default">                            tok2,</span>
<a name="1952"><font size=-1>1952     </font></a><span class="default">                            </span><span class="string">&quot;no simplification of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; within &quot; </span><span class="default">+ (Token::Match(parent,</span><span class="string">&quot;[?:]&quot;</span><span class="default">) ? </span><span class="string">&quot;?:&quot; </span><span class="default">: parent-&gt;str()) + </span><span class="string">&quot; expression&quot;</span><span class="default">);</span>
<a name="1953"><font size=-1>1953     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1954"><font size=-1>1954     </font></a><span class="default">            }</span>
<a name="1955"><font size=-1>1955     </font></a><span class="default"></span>
<a name="1956"><font size=-1>1956     </font></a><span class="default">            </span><span class="comment">// do-while condition, break in the loop body</span>
<a name="1957"><font size=-1>1957     </font></a><span class="comment">            </span><span class="default">{</span>
<a name="1958"><font size=-1>1958     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *parent = tok2-&gt;astParent();</span>
<a name="1959"><font size=-1>1959     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; !Token::simpleMatch(parent-&gt;previous(), </span><span class="string">&quot;while (&quot;</span><span class="default">))</span>
<a name="1960"><font size=-1>1960     </font></a><span class="default">                    parent = parent-&gt;astParent();</span>
<a name="1961"><font size=-1>1961     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(parent &amp;&amp; Token::simpleMatch(parent-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;} while (&quot;</span><span class="default">) &amp;&amp; Token::simpleMatch(parent-&gt;linkAt(-</span><span class="number">2</span><span class="default">)-&gt;previous(), </span><span class="string">&quot;do {&quot;</span><span class="default">)) {</span>
<a name="1962"><font size=-1>1962     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">breakBailout = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1963"><font size=-1>1963     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *iftok = parent-&gt;linkAt(-</span><span class="number">2</span><span class="default">); iftok != parent; iftok = iftok-&gt;next()) {</span>
<a name="1964"><font size=-1>1964     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(iftok, </span><span class="string">&quot;if (&quot;</span><span class="default">))</span>
<a name="1965"><font size=-1>1965     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1966"><font size=-1>1966     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(iftok-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) { break&quot;</span><span class="default">))</span>
<a name="1967"><font size=-1>1967     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1968"><font size=-1>1968     </font></a><span class="default">                        ProgramMemory programMemory;</span>
<a name="1969"><font size=-1>1969     </font></a><span class="default">                        programMemory.setIntValue(varid, num);</span>
<a name="1970"><font size=-1>1970     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(conditionIsTrue(iftok-&gt;next()-&gt;astOperand2(), programMemory)) {</span>
<a name="1971"><font size=-1>1971     </font></a><span class="default">                            breakBailout = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1972"><font size=-1>1972     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1973"><font size=-1>1973     </font></a><span class="default">                        }</span>
<a name="1974"><font size=-1>1974     </font></a><span class="default">                    }</span>
<a name="1975"><font size=-1>1975     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(breakBailout) {</span>
<a name="1976"><font size=-1>1976     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="1977"><font size=-1>1977     </font></a><span class="default">                            bailout(tokenlist,</span>
<a name="1978"><font size=-1>1978     </font></a><span class="default">                                    errorLogger,</span>
<a name="1979"><font size=-1>1979     </font></a><span class="default">                                    tok2,</span>
<a name="1980"><font size=-1>1980     </font></a><span class="default">                                    </span><span class="string">&quot;no simplification of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; in do-while condition since there is a break in the loop body&quot;</span><span class="default">);</span>
<a name="1981"><font size=-1>1981     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="1982"><font size=-1>1982     </font></a><span class="default">                    }</span>
<a name="1983"><font size=-1>1983     </font></a><span class="default">                }</span>
<a name="1984"><font size=-1>1984     </font></a><span class="default">            }</span>
<a name="1985"><font size=-1>1985     </font></a><span class="default"></span>
<a name="1986"><font size=-1>1986     </font></a><span class="default">            setTokenValue(tok2, val, settings);</span>
<a name="1987"><font size=-1>1987     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(val2.condition)</span>
<a name="1988"><font size=-1>1988     </font></a><span class="default">                setTokenValue(tok2,val2, settings);</span>
<a name="1989"><font size=-1>1989     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2 == var-&gt;nameToken())</span>
<a name="1990"><font size=-1>1990     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="1991"><font size=-1>1991     </font></a><span class="default">        }</span>
<a name="1992"><font size=-1>1992     </font></a><span class="default"></span>
<a name="1993"><font size=-1>1993     </font></a><span class="default">        </span><span class="comment">// skip sizeof etc..</span>
<a name="1994"><font size=-1>1994     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;)&quot; </span><span class="default">&amp;&amp; Token::Match(tok2-&gt;link()-&gt;previous(), </span><span class="string">&quot;sizeof|typeof|typeid (&quot;</span><span class="default">))</span>
<a name="1995"><font size=-1>1995     </font></a><span class="default">            tok2 = tok2-&gt;link();</span>
<a name="1996"><font size=-1>1996     </font></a><span class="default"></span>
<a name="1997"><font size=-1>1997     </font></a><span class="default">        </span><span class="comment">// goto label</span>
<a name="1998"><font size=-1>1998     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[;{}] %name% :&quot;</span><span class="default">)) {</span>
<a name="1999"><font size=-1>1999     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2000"><font size=-1>2000     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok2-&gt;next(), </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; stopping on goto label&quot;</span><span class="default">);</span>
<a name="2001"><font size=-1>2001     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="2002"><font size=-1>2002     </font></a><span class="default">        }</span>
<a name="2003"><font size=-1>2003     </font></a><span class="default"></span>
<a name="2004"><font size=-1>2004     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;}&quot;</span><span class="default">) {</span>
<a name="2005"><font size=-1>2005     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *vartok = Token::findmatch(tok2-&gt;link(), </span><span class="string">&quot;%varid%&quot;</span><span class="default">, tok2, varid);</span>
<a name="2006"><font size=-1>2006     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(Token::Match(vartok, </span><span class="string">&quot;%name% = %num% ;&quot;</span><span class="default">) &amp;&amp; !vartok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;getValue(num))</span>
<a name="2007"><font size=-1>2007     </font></a><span class="default">                vartok = Token::findmatch(vartok-&gt;next(), </span><span class="string">&quot;%varid%&quot;</span><span class="default">, tok2, varid);</span>
<a name="2008"><font size=-1>2008     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vartok) {</span>
<a name="2009"><font size=-1>2009     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings) {</span>
<a name="2010"><font size=-1>2010     </font></a><span class="default">                    std::string errmsg = </span><span class="string">&quot;variable &quot;</span><span class="default">;</span>
<a name="2011"><font size=-1>2011     </font></a><span class="default">                    errmsg += var-&gt;name() + </span><span class="string">&quot; &quot;</span><span class="default">;</span>
<a name="2012"><font size=-1>2012     </font></a><span class="default">                    errmsg += </span><span class="string">&quot;stopping on }&quot;</span><span class="default">;</span>
<a name="2013"><font size=-1>2013     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, errmsg);</span>
<a name="2014"><font size=-1>2014     </font></a><span class="default">                }</span>
<a name="2015"><font size=-1>2015     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2016"><font size=-1>2016     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2017"><font size=-1>2017     </font></a><span class="default">                tok2 = tok2-&gt;link();</span>
<a name="2018"><font size=-1>2018     </font></a><span class="default">            }</span>
<a name="2019"><font size=-1>2019     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">) {</span>
<a name="2020"><font size=-1>2020     </font></a><span class="default">            </span><span class="comment">// if variable is assigned in loop don't look before the loop</span>
<a name="2021"><font size=-1>2021     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;previous() &amp;&amp;</span>
<a name="2022"><font size=-1>2022     </font></a><span class="default">                (Token::simpleMatch(tok2-&gt;previous(), </span><span class="string">&quot;do&quot;</span><span class="default">) ||</span>
<a name="2023"><font size=-1>2023     </font></a><span class="default">                 (tok2-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;)&quot; </span><span class="default">&amp;&amp; Token::Match(tok2-&gt;linkAt(-</span><span class="number">1</span><span class="default">)-&gt;previous(), </span><span class="string">&quot;for|while (&quot;</span><span class="default">)))) {</span>
<a name="2024"><font size=-1>2024     </font></a><span class="default"></span>
<a name="2025"><font size=-1>2025     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *start = tok2;</span>
<a name="2026"><font size=-1>2026     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *end   = start-&gt;link();</span>
<a name="2027"><font size=-1>2027     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isVariableChanged(start,end,varid,var-&gt;isGlobal(),settings, tokenlist-&gt;isCPP())) {</span>
<a name="2028"><font size=-1>2028     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2029"><font size=-1>2029     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; is assigned in loop. so valueflow analysis bailout when start of loop is reached.&quot;</span><span class="default">);</span>
<a name="2030"><font size=-1>2030     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="2031"><font size=-1>2031     </font></a><span class="default">                }</span>
<a name="2032"><font size=-1>2032     </font></a><span class="default">            }</span>
<a name="2033"><font size=-1>2033     </font></a><span class="default"></span>
<a name="2034"><font size=-1>2034     </font></a><span class="default">            </span><span class="comment">// Global variable : stop when leaving the function scope</span>
<a name="2035"><font size=-1>2035     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!var-&gt;isLocal()) {</span>
<a name="2036"><font size=-1>2036     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;)|else|do {&quot;</span><span class="default">))</span>
<a name="2037"><font size=-1>2037     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="2038"><font size=-1>2038     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">((tok2-&gt;previous()-&gt;str() == </span><span class="string">&quot;)&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2039"><font size=-1>2039     </font></a><span class="default">                    !Token::Match(tok2-&gt;linkAt(-</span><span class="number">1</span><span class="default">)-&gt;previous(), </span><span class="string">&quot;if|for|while (&quot;</span><span class="default">))</span>
<a name="2040"><font size=-1>2040     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="2041"><font size=-1>2041     </font></a><span class="default">            }</span>
<a name="2042"><font size=-1>2042     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;;&quot;</span><span class="default">) {</span>
<a name="2043"><font size=-1>2043     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *parent = tok2-&gt;previous();</span>
<a name="2044"><font size=-1>2044     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; !Token::Match(parent, </span><span class="string">&quot;return|break|continue|goto&quot;</span><span class="default">))</span>
<a name="2045"><font size=-1>2045     </font></a><span class="default">                parent = parent-&gt;astParent();</span>
<a name="2046"><font size=-1>2046     </font></a><span class="default">            </span><span class="comment">// reaching a break/continue/return</span>
<a name="2047"><font size=-1>2047     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(parent) {</span>
<a name="2048"><font size=-1>2048     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2049"><font size=-1>2049     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; stopping on &quot; </span><span class="default">+ parent-&gt;str());</span>
<a name="2050"><font size=-1>2050     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2051"><font size=-1>2051     </font></a><span class="default">            }</span>
<a name="2052"><font size=-1>2052     </font></a><span class="default">        }</span>
<a name="2053"><font size=-1>2053     </font></a><span class="default"></span>
<a name="2054"><font size=-1>2054     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; !Token::simpleMatch(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="2055"><font size=-1>2055     </font></a><span class="default">            </span><span class="comment">// bailout: global non-const variables</span>
<a name="2056"><font size=-1>2056     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!(var-&gt;isLocal() || var-&gt;isArgument()) &amp;&amp; !var-&gt;isConst()) {</span>
<a name="2057"><font size=-1>2057     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2058"><font size=-1>2058     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;global variable &quot; </span><span class="default">+ var-&gt;name());</span>
<a name="2059"><font size=-1>2059     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="2060"><font size=-1>2060     </font></a><span class="default">            }</span>
<a name="2061"><font size=-1>2061     </font></a><span class="default">        }</span>
<a name="2062"><font size=-1>2062     </font></a><span class="default">    }</span>
<a name="2063"><font size=-1>2063     </font></a><span class="default">}</span>
<a name="2064"><font size=-1>2064     </font></a><span class="default"></span>
<a name="2065"><font size=-1>2065     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowBeforeCondition(TokenList *tokenlist, SymbolDatabase *symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="2066"><font size=-1>2066     </font></a><span class="default">{</span>
<a name="2067"><font size=-1>2067     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : symboldatabase-&gt;functionScopes) {</span>
<a name="2068"><font size=-1>2068     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Token* tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(scope-&gt;bodyStart); tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="2069"><font size=-1>2069     </font></a><span class="default">            MathLib::bigint num = </span><span class="number">0</span><span class="default">;</span>
<a name="2070"><font size=-1>2070     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *vartok = nullptr;</span>
<a name="2071"><font size=-1>2071     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;isComparisonOp() &amp;&amp; tok-&gt;astOperand1() &amp;&amp; tok-&gt;astOperand2()) {</span>
<a name="2072"><font size=-1>2072     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;astOperand1()-&gt;isName() &amp;&amp; tok-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="2073"><font size=-1>2073     </font></a><span class="default">                    vartok = tok-&gt;astOperand1();</span>
<a name="2074"><font size=-1>2074     </font></a><span class="default">                    num = tok-&gt;astOperand2()-&gt;values().front().intvalue;</span>
<a name="2075"><font size=-1>2075     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(tok-&gt;astOperand1()-&gt;hasKnownIntValue() &amp;&amp; tok-&gt;astOperand2()-&gt;isName()) {</span>
<a name="2076"><font size=-1>2076     </font></a><span class="default">                    vartok = tok-&gt;astOperand2();</span>
<a name="2077"><font size=-1>2077     </font></a><span class="default">                    num = tok-&gt;astOperand1()-&gt;values().front().intvalue;</span>
<a name="2078"><font size=-1>2078     </font></a><span class="default">                } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2079"><font size=-1>2079     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2080"><font size=-1>2080     </font></a><span class="default">                }</span>
<a name="2081"><font size=-1>2081     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;previous(), </span><span class="string">&quot;if|while ( %name% %oror%|&amp;&amp;|)&quot;</span><span class="default">) ||</span>
<a name="2082"><font size=-1>2082     </font></a><span class="default">                       Token::Match(tok, </span><span class="string">&quot;%oror%|&amp;&amp; %name% %oror%|&amp;&amp;|)&quot;</span><span class="default">)) {</span>
<a name="2083"><font size=-1>2083     </font></a><span class="default">                vartok = tok-&gt;next();</span>
<a name="2084"><font size=-1>2084     </font></a><span class="default">                num = </span><span class="number">0</span><span class="default">;</span>
<a name="2085"><font size=-1>2085     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[!?]&quot;</span><span class="default">) &amp;&amp; Token::Match(tok-&gt;astOperand1(), </span><span class="string">&quot;%name%&quot;</span><span class="default">)) {</span>
<a name="2086"><font size=-1>2086     </font></a><span class="default">                vartok = tok-&gt;astOperand1();</span>
<a name="2087"><font size=-1>2087     </font></a><span class="default">                num = </span><span class="number">0</span><span class="default">;</span>
<a name="2088"><font size=-1>2088     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2089"><font size=-1>2089     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2090"><font size=-1>2090     </font></a><span class="default">            }</span>
<a name="2091"><font size=-1>2091     </font></a><span class="default"></span>
<a name="2092"><font size=-1>2092     </font></a><span class="default">            </span><span class="keyword">int </span><span class="default">varid = vartok-&gt;varId();</span>
<a name="2093"><font size=-1>2093     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">var = vartok-&gt;variable();</span>
<a name="2094"><font size=-1>2094     </font></a><span class="default"></span>
<a name="2095"><font size=-1>2095     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varid == </span><span class="number">0U </span><span class="default">|| !var)</span>
<a name="2096"><font size=-1>2096     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2097"><font size=-1>2097     </font></a><span class="default"></span>
<a name="2098"><font size=-1>2098     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;?&quot; </span><span class="default">&amp;&amp; tok-&gt;isExpandedMacro()) {</span>
<a name="2099"><font size=-1>2099     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2100"><font size=-1>2100     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot;, condition is defined in macro&quot;</span><span class="default">);</span>
<a name="2101"><font size=-1>2101     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2102"><font size=-1>2102     </font></a><span class="default">            }</span>
<a name="2103"><font size=-1>2103     </font></a><span class="default"></span>
<a name="2104"><font size=-1>2104     </font></a><span class="default">            </span><span class="comment">// bailout: for/while-condition, variable is changed in while loop</span>
<a name="2105"><font size=-1>2105     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok2 = tok; tok2; tok2 = tok2-&gt;astParent()) {</span>
<a name="2106"><font size=-1>2106     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;astParent() || tok2-&gt;str() != </span><span class="string">&quot;(&quot; </span><span class="default">|| !Token::simpleMatch(tok2-&gt;link(), </span><span class="string">&quot;) {&quot;</span><span class="default">))</span>
<a name="2107"><font size=-1>2107     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2108"><font size=-1>2108     </font></a><span class="default"></span>
<a name="2109"><font size=-1>2109     </font></a><span class="default">                </span><span class="comment">// Variable changed in 3rd for-expression</span>
<a name="2110"><font size=-1>2110     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2-&gt;previous(), </span><span class="string">&quot;for (&quot;</span><span class="default">)) {</span>
<a name="2111"><font size=-1>2111     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(tok2-&gt;astOperand2() &amp;&amp; tok2-&gt;astOperand2()-&gt;astOperand2() &amp;&amp; isVariableChanged(tok2-&gt;astOperand2()-&gt;astOperand2(), tok2-&gt;link(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2112"><font size=-1>2112     </font></a><span class="default">                        varid = </span><span class="number">0U</span><span class="default">;</span>
<a name="2113"><font size=-1>2113     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2114"><font size=-1>2114     </font></a><span class="default">                            bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; used in loop&quot;</span><span class="default">);</span>
<a name="2115"><font size=-1>2115     </font></a><span class="default">                    }</span>
<a name="2116"><font size=-1>2116     </font></a><span class="default">                }</span>
<a name="2117"><font size=-1>2117     </font></a><span class="default"></span>
<a name="2118"><font size=-1>2118     </font></a><span class="default">                </span><span class="comment">// Variable changed in loop code</span>
<a name="2119"><font size=-1>2119     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;for|while (&quot;</span><span class="default">)) {</span>
<a name="2120"><font size=-1>2120     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">start = tok2-&gt;link()-&gt;next();</span>
<a name="2121"><font size=-1>2121     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">end   = start-&gt;link();</span>
<a name="2122"><font size=-1>2122     </font></a><span class="default"></span>
<a name="2123"><font size=-1>2123     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(isVariableChanged(start,end,varid,var-&gt;isGlobal(),settings, tokenlist-&gt;isCPP())) {</span>
<a name="2124"><font size=-1>2124     </font></a><span class="default">                        varid = </span><span class="number">0U</span><span class="default">;</span>
<a name="2125"><font size=-1>2125     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2126"><font size=-1>2126     </font></a><span class="default">                            bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; used in loop&quot;</span><span class="default">);</span>
<a name="2127"><font size=-1>2127     </font></a><span class="default">                    }</span>
<a name="2128"><font size=-1>2128     </font></a><span class="default">                }</span>
<a name="2129"><font size=-1>2129     </font></a><span class="default"></span>
<a name="2130"><font size=-1>2130     </font></a><span class="default">                </span><span class="comment">// if,macro =&gt; bailout</span>
<a name="2131"><font size=-1>2131     </font></a><span class="comment">                </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2-&gt;previous(), </span><span class="string">&quot;if (&quot;</span><span class="default">) &amp;&amp; tok2-&gt;previous()-&gt;isExpandedMacro()) {</span>
<a name="2132"><font size=-1>2132     </font></a><span class="default">                    varid = </span><span class="number">0U</span><span class="default">;</span>
<a name="2133"><font size=-1>2133     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2134"><font size=-1>2134     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot;, condition is defined in macro&quot;</span><span class="default">);</span>
<a name="2135"><font size=-1>2135     </font></a><span class="default">                }</span>
<a name="2136"><font size=-1>2136     </font></a><span class="default">            }</span>
<a name="2137"><font size=-1>2137     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varid == </span><span class="number">0U</span><span class="default">)</span>
<a name="2138"><font size=-1>2138     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2139"><font size=-1>2139     </font></a><span class="default"></span>
<a name="2140"><font size=-1>2140     </font></a><span class="default">            </span><span class="comment">// extra logic for unsigned variables 'i&gt;=1' =&gt; possible value can also be 0</span>
<a name="2141"><font size=-1>2141     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;&lt;|&gt;&quot;</span><span class="default">)) {</span>
<a name="2142"><font size=-1>2142     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(num != </span><span class="number">0</span><span class="default">)</span>
<a name="2143"><font size=-1>2143     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2144"><font size=-1>2144     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var-&gt;typeStartToken()-&gt;isUnsigned())</span>
<a name="2145"><font size=-1>2145     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2146"><font size=-1>2146     </font></a><span class="default">            }</span>
<a name="2147"><font size=-1>2147     </font></a><span class="default">            ValueFlow::Value val(tok, num);</span>
<a name="2148"><font size=-1>2148     </font></a><span class="default">            val.varId = varid;</span>
<a name="2149"><font size=-1>2149     </font></a><span class="default">            ValueFlow::Value val2;</span>
<a name="2150"><font size=-1>2150     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(num==</span><span class="number">1U </span><span class="default">&amp;&amp; Token::Match(tok,</span><span class="string">&quot;&lt;=|&gt;=&quot;</span><span class="default">)) {</span>
<a name="2151"><font size=-1>2151     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;typeStartToken()-&gt;isUnsigned()) {</span>
<a name="2152"><font size=-1>2152     </font></a><span class="default">                    val2 = ValueFlow::Value(tok,</span><span class="number">0</span><span class="default">);</span>
<a name="2153"><font size=-1>2153     </font></a><span class="default">                    val2.varId = varid;</span>
<a name="2154"><font size=-1>2154     </font></a><span class="default">                }</span>
<a name="2155"><font size=-1>2155     </font></a><span class="default">            }</span>
<a name="2156"><font size=-1>2156     </font></a><span class="default">            Token* startTok = tok-&gt;astParent() ? tok-&gt;astParent() : tok-&gt;previous();</span>
<a name="2157"><font size=-1>2157     </font></a><span class="default">            valueFlowReverse(tokenlist, startTok, vartok, val, val2, errorLogger, settings);</span>
<a name="2158"><font size=-1>2158     </font></a><span class="default">        }</span>
<a name="2159"><font size=-1>2159     </font></a><span class="default">    }</span>
<a name="2160"><font size=-1>2160     </font></a><span class="default">}</span>
<a name="2161"><font size=-1>2161     </font></a><span class="default"></span>
<a name="2162"><font size=-1>2162     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">removeValues(std::list&lt;ValueFlow::Value&gt; &amp;values, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; &amp;valuesToRemove)</span>
<a name="2163"><font size=-1>2163     </font></a><span class="default">{</span>
<a name="2164"><font size=-1>2164     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(std::list&lt;ValueFlow::Value&gt;::iterator it = values.begin(); it != values.end();) {</span>
<a name="2165"><font size=-1>2165     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">found = std::any_of(valuesToRemove.cbegin(), valuesToRemove.cend(),</span>
<a name="2166"><font size=-1>2166     </font></a><span class="default">        [=](</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v2) {</span>
<a name="2167"><font size=-1>2167     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">it-&gt;intvalue == v2.intvalue;</span>
<a name="2168"><font size=-1>2168     </font></a><span class="default">        });</span>
<a name="2169"><font size=-1>2169     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(found)</span>
<a name="2170"><font size=-1>2170     </font></a><span class="default">            values.erase(it++);</span>
<a name="2171"><font size=-1>2171     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="2172"><font size=-1>2172     </font></a><span class="keyword">            </span><span class="default">++it;</span>
<a name="2173"><font size=-1>2173     </font></a><span class="default">    }</span>
<a name="2174"><font size=-1>2174     </font></a><span class="default">}</span>
<a name="2175"><font size=-1>2175     </font></a><span class="default"></span>
<a name="2176"><font size=-1>2176     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowAST(Token *tok, nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="2177"><font size=-1>2177     </font></a><span class="default">{</span>
<a name="2178"><font size=-1>2178     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="2179"><font size=-1>2179     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2180"><font size=-1>2180     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == varid)</span>
<a name="2181"><font size=-1>2181     </font></a><span class="default">        setTokenValue(tok, value, settings);</span>
<a name="2182"><font size=-1>2182     </font></a><span class="default">    valueFlowAST(tok-&gt;astOperand1(), varid, value, settings);</span>
<a name="2183"><font size=-1>2183     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot; </span><span class="default">&amp;&amp; tok-&gt;astOperand1() &amp;&amp; tok-&gt;astOperand1()-&gt;getValue(</span><span class="number">0</span><span class="default">)) {</span>
<a name="2184"><font size=-1>2184     </font></a><span class="default">        ProgramMemory pm;</span>
<a name="2185"><font size=-1>2185     </font></a><span class="default">        pm.setValue(varid,value);</span>
<a name="2186"><font size=-1>2186     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(conditionIsFalse(tok-&gt;astOperand1(), pm))</span>
<a name="2187"><font size=-1>2187     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="2188"><font size=-1>2188     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;||&quot; </span><span class="default">&amp;&amp; tok-&gt;astOperand1()) {</span>
<a name="2189"><font size=-1>2189     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; &amp;values = tok-&gt;astOperand1()-&gt;values();</span>
<a name="2190"><font size=-1>2190     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">nonzero = std::any_of(values.cbegin(), values.cend(),</span>
<a name="2191"><font size=-1>2191     </font></a><span class="default">        [=](</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v) {</span>
<a name="2192"><font size=-1>2192     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">v.intvalue != </span><span class="number">0</span><span class="default">;</span>
<a name="2193"><font size=-1>2193     </font></a><span class="default">        });</span>
<a name="2194"><font size=-1>2194     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!nonzero)</span>
<a name="2195"><font size=-1>2195     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="2196"><font size=-1>2196     </font></a><span class="default">        ProgramMemory pm;</span>
<a name="2197"><font size=-1>2197     </font></a><span class="default">        pm.setValue(varid,value);</span>
<a name="2198"><font size=-1>2198     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(conditionIsTrue(tok-&gt;astOperand1(), pm))</span>
<a name="2199"><font size=-1>2199     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="2200"><font size=-1>2200     </font></a><span class="default">    }</span>
<a name="2201"><font size=-1>2201     </font></a><span class="default">    valueFlowAST(tok-&gt;astOperand2(), varid, value, settings);</span>
<a name="2202"><font size=-1>2202     </font></a><span class="default">}</span>
<a name="2203"><font size=-1>2203     </font></a><span class="default"></span>
<a name="2204"><font size=-1>2204     </font></a><span class="default"></span><span class="comment">/** if known variable is changed in loop body, change it to a possible value */</span>
<a name="2205"><font size=-1>2205     </font></a><span class="comment"></span><span class="keyword">static bool </span><span class="default">handleKnownValuesInLoop(</span><span class="keyword">const </span><span class="default">Token                 *startToken,</span>
<a name="2206"><font size=-1>2206     </font></a><span class="default">                                    </span><span class="keyword">const </span><span class="default">Token                 *endToken,</span>
<a name="2207"><font size=-1>2207     </font></a><span class="default">                                    std::list&lt;ValueFlow::Value&gt; *values,</span>
<a name="2208"><font size=-1>2208     </font></a><span class="default">                                    nonneg </span><span class="keyword">int                  </span><span class="default">varid,</span>
<a name="2209"><font size=-1>2209     </font></a><span class="default">                                    </span><span class="keyword">bool                        </span><span class="default">globalvar,</span>
<a name="2210"><font size=-1>2210     </font></a><span class="default">                                    </span><span class="keyword">const </span><span class="default">Settings              *settings)</span>
<a name="2211"><font size=-1>2211     </font></a><span class="default">{</span>
<a name="2212"><font size=-1>2212     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">isChanged = isVariableChanged(startToken, endToken, varid, globalvar, settings, </span><span class="keyword">true</span><span class="default">);</span>
<a name="2213"><font size=-1>2213     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!isChanged)</span>
<a name="2214"><font size=-1>2214     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2215"><font size=-1>2215     </font></a><span class="default">    lowerToPossible(*values);</span>
<a name="2216"><font size=-1>2216     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">isChanged;</span>
<a name="2217"><font size=-1>2217     </font></a><span class="default">}</span>
<a name="2218"><font size=-1>2218     </font></a><span class="default"></span>
<a name="2219"><font size=-1>2219     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">evalAssignment(ValueFlow::Value &amp;lhsValue, </span><span class="keyword">const </span><span class="default">std::string &amp;assign, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;rhsValue)</span>
<a name="2220"><font size=-1>2220     </font></a><span class="default">{</span>
<a name="2221"><font size=-1>2221     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(lhsValue.isIntValue()) {</span>
<a name="2222"><font size=-1>2222     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(assign == </span><span class="string">&quot;+=&quot;</span><span class="default">)</span>
<a name="2223"><font size=-1>2223     </font></a><span class="default">            lhsValue.intvalue += rhsValue.intvalue;</span>
<a name="2224"><font size=-1>2224     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;-=&quot;</span><span class="default">)</span>
<a name="2225"><font size=-1>2225     </font></a><span class="default">            lhsValue.intvalue -= rhsValue.intvalue;</span>
<a name="2226"><font size=-1>2226     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;*=&quot;</span><span class="default">)</span>
<a name="2227"><font size=-1>2227     </font></a><span class="default">            lhsValue.intvalue *= rhsValue.intvalue;</span>
<a name="2228"><font size=-1>2228     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;/=&quot;</span><span class="default">) {</span>
<a name="2229"><font size=-1>2229     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(rhsValue.intvalue == </span><span class="number">0</span><span class="default">)</span>
<a name="2230"><font size=-1>2230     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2231"><font size=-1>2231     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="2232"><font size=-1>2232     </font></a><span class="keyword">                </span><span class="default">lhsValue.intvalue /= rhsValue.intvalue;</span>
<a name="2233"><font size=-1>2233     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;%=&quot;</span><span class="default">) {</span>
<a name="2234"><font size=-1>2234     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(rhsValue.intvalue == </span><span class="number">0</span><span class="default">)</span>
<a name="2235"><font size=-1>2235     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2236"><font size=-1>2236     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="2237"><font size=-1>2237     </font></a><span class="keyword">                </span><span class="default">lhsValue.intvalue %= rhsValue.intvalue;</span>
<a name="2238"><font size=-1>2238     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;&amp;=&quot;</span><span class="default">)</span>
<a name="2239"><font size=-1>2239     </font></a><span class="default">            lhsValue.intvalue &amp;= rhsValue.intvalue;</span>
<a name="2240"><font size=-1>2240     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;|=&quot;</span><span class="default">)</span>
<a name="2241"><font size=-1>2241     </font></a><span class="default">            lhsValue.intvalue |= rhsValue.intvalue;</span>
<a name="2242"><font size=-1>2242     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;^=&quot;</span><span class="default">)</span>
<a name="2243"><font size=-1>2243     </font></a><span class="default">            lhsValue.intvalue ^= rhsValue.intvalue;</span>
<a name="2244"><font size=-1>2244     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="2245"><font size=-1>2245     </font></a><span class="keyword">            return false</span><span class="default">;</span>
<a name="2246"><font size=-1>2246     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(lhsValue.isFloatValue()) {</span>
<a name="2247"><font size=-1>2247     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(assign == </span><span class="string">&quot;+=&quot;</span><span class="default">)</span>
<a name="2248"><font size=-1>2248     </font></a><span class="default">            lhsValue.floatValue += rhsValue.intvalue;</span>
<a name="2249"><font size=-1>2249     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;-=&quot;</span><span class="default">)</span>
<a name="2250"><font size=-1>2250     </font></a><span class="default">            lhsValue.floatValue -= rhsValue.intvalue;</span>
<a name="2251"><font size=-1>2251     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;*=&quot;</span><span class="default">)</span>
<a name="2252"><font size=-1>2252     </font></a><span class="default">            lhsValue.floatValue *= rhsValue.intvalue;</span>
<a name="2253"><font size=-1>2253     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(assign == </span><span class="string">&quot;/=&quot;</span><span class="default">)</span>
<a name="2254"><font size=-1>2254     </font></a><span class="default">            lhsValue.floatValue /= rhsValue.intvalue;</span>
<a name="2255"><font size=-1>2255     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="2256"><font size=-1>2256     </font></a><span class="keyword">            return false</span><span class="default">;</span>
<a name="2257"><font size=-1>2257     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2258"><font size=-1>2258     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2259"><font size=-1>2259     </font></a><span class="default">    }</span>
<a name="2260"><font size=-1>2260     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2261"><font size=-1>2261     </font></a><span class="default">}</span>
<a name="2262"><font size=-1>2262     </font></a><span class="default"></span>
<a name="2263"><font size=-1>2263     </font></a><span class="default"></span><span class="comment">// Check if its an alias of the variable or is being aliased to this variable</span>
<a name="2264"><font size=-1>2264     </font></a><span class="comment"></span><span class="keyword">static bool </span><span class="default">isAliasOf(</span><span class="keyword">const </span><span class="default">Variable * var, </span><span class="keyword">const </span><span class="default">Token *tok, nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values)</span>
<a name="2265"><font size=-1>2265     </font></a><span class="default">{</span>
<a name="2266"><font size=-1>2266     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == varid)</span>
<a name="2267"><font size=-1>2267     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2268"><font size=-1>2268     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == </span><span class="number">0</span><span class="default">)</span>
<a name="2269"><font size=-1>2269     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2270"><font size=-1>2270     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(isAliasOf(tok, varid))</span>
<a name="2271"><font size=-1>2271     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2272"><font size=-1>2272     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!var-&gt;isPointer())</span>
<a name="2273"><font size=-1>2273     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2274"><font size=-1>2274     </font></a><span class="default">    </span><span class="comment">// Search through non value aliases</span>
<a name="2275"><font size=-1>2275     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val : values) {</span>
<a name="2276"><font size=-1>2276     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!val.isNonValue())</span>
<a name="2277"><font size=-1>2277     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2278"><font size=-1>2278     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(val.isInconclusive())</span>
<a name="2279"><font size=-1>2279     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2280"><font size=-1>2280     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(val.isLifetimeValue() &amp;&amp; !val.isLocalLifetimeValue())</span>
<a name="2281"><font size=-1>2281     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2282"><font size=-1>2282     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(val.isLifetimeValue() &amp;&amp; val.lifetimeKind != ValueFlow::Value::LifetimeKind::Address)</span>
<a name="2283"><font size=-1>2283     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2284"><font size=-1>2284     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(val.tokvalue, </span><span class="string">&quot;.|&amp;|*|%var%&quot;</span><span class="default">))</span>
<a name="2285"><font size=-1>2285     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2286"><font size=-1>2286     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(astHasVar(val.tokvalue, tok-&gt;varId()))</span>
<a name="2287"><font size=-1>2287     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2288"><font size=-1>2288     </font></a><span class="default">    }</span>
<a name="2289"><font size=-1>2289     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2290"><font size=-1>2290     </font></a><span class="default">}</span>
<a name="2291"><font size=-1>2291     </font></a><span class="default"></span>
<a name="2292"><font size=-1>2292     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; getIndirections(</span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values)</span>
<a name="2293"><font size=-1>2293     </font></a><span class="default">{</span>
<a name="2294"><font size=-1>2294     </font></a><span class="default">    std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; result;</span>
<a name="2295"><font size=-1>2295     </font></a><span class="default">    std::transform(values.begin(), values.end(), std::inserter(result, result.end()), [](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="2296"><font size=-1>2296     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">std::max(</span><span class="number">0</span><span class="default">, v.indirect);</span>
<a name="2297"><font size=-1>2297     </font></a><span class="default">    });</span>
<a name="2298"><font size=-1>2298     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="2299"><font size=-1>2299     </font></a><span class="default">}</span>
<a name="2300"><font size=-1>2300     </font></a><span class="default"></span>
<a name="2301"><font size=-1>2301     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForwardExpression(Token* startToken,</span>
<a name="2302"><font size=-1>2302     </font></a><span class="default">                                       </span><span class="keyword">const </span><span class="default">Token* endToken,</span>
<a name="2303"><font size=-1>2303     </font></a><span class="default">                                       </span><span class="keyword">const </span><span class="default">Token* exprTok,</span>
<a name="2304"><font size=-1>2304     </font></a><span class="default">                                       </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values,</span>
<a name="2305"><font size=-1>2305     </font></a><span class="default">                                       </span><span class="keyword">const </span><span class="default">TokenList* </span><span class="keyword">const </span><span class="default">tokenlist,</span>
<a name="2306"><font size=-1>2306     </font></a><span class="default">                                       </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="2307"><font size=-1>2307     </font></a><span class="default">{</span>
<a name="2308"><font size=-1>2308     </font></a><span class="default">    FwdAnalysis fwdAnalysis(tokenlist-&gt;isCPP(), settings-&gt;library);</span>
<a name="2309"><font size=-1>2309     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">FwdAnalysis::KnownAndToken read : fwdAnalysis.valueFlow(exprTok, startToken, endToken)) {</span>
<a name="2310"><font size=-1>2310     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; value : values) {</span>
<a name="2311"><font size=-1>2311     </font></a><span class="default">            </span><span class="comment">// Don't set inconclusive values</span>
<a name="2312"><font size=-1>2312     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(value.isInconclusive())</span>
<a name="2313"><font size=-1>2313     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2314"><font size=-1>2314     </font></a><span class="default">            ValueFlow::Value v = value;</span>
<a name="2315"><font size=-1>2315     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(v.isImpossible()) {</span>
<a name="2316"><font size=-1>2316     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(read.known)</span>
<a name="2317"><font size=-1>2317     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2318"><font size=-1>2318     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(!read.known) {</span>
<a name="2319"><font size=-1>2319     </font></a><span class="default">                v.valueKind = ValueFlow::Value::ValueKind::Possible;</span>
<a name="2320"><font size=-1>2320     </font></a><span class="default">            }</span>
<a name="2321"><font size=-1>2321     </font></a><span class="default">            setTokenValue(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(read.token), v, settings);</span>
<a name="2322"><font size=-1>2322     </font></a><span class="default">        }</span>
<a name="2323"><font size=-1>2323     </font></a><span class="default">    }</span>
<a name="2324"><font size=-1>2324     </font></a><span class="default">}</span>
<a name="2325"><font size=-1>2325     </font></a><span class="default"></span>
<a name="2326"><font size=-1>2326     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">valueFlowForwardVariable(Token* </span><span class="keyword">const </span><span class="default">startToken,</span>
<a name="2327"><font size=-1>2327     </font></a><span class="default">                                     </span><span class="keyword">const </span><span class="default">Token* </span><span class="keyword">const </span><span class="default">endToken,</span>
<a name="2328"><font size=-1>2328     </font></a><span class="default">                                     </span><span class="keyword">const </span><span class="default">Variable* </span><span class="keyword">const </span><span class="default">var,</span>
<a name="2329"><font size=-1>2329     </font></a><span class="default">                                     </span><span class="keyword">const </span><span class="default">nonneg </span><span class="keyword">int </span><span class="default">varid,</span>
<a name="2330"><font size=-1>2330     </font></a><span class="default">                                     std::list&lt;ValueFlow::Value&gt; values,</span>
<a name="2331"><font size=-1>2331     </font></a><span class="default">                                     </span><span class="keyword">const bool </span><span class="default">constValue,</span>
<a name="2332"><font size=-1>2332     </font></a><span class="default">                                     </span><span class="keyword">const bool </span><span class="default">subFunction,</span>
<a name="2333"><font size=-1>2333     </font></a><span class="default">                                     TokenList* </span><span class="keyword">const </span><span class="default">tokenlist,</span>
<a name="2334"><font size=-1>2334     </font></a><span class="default">                                     ErrorLogger* </span><span class="keyword">const </span><span class="default">errorLogger,</span>
<a name="2335"><font size=-1>2335     </font></a><span class="default">                                     </span><span class="keyword">const </span><span class="default">Settings* </span><span class="keyword">const </span><span class="default">settings)</span>
<a name="2336"><font size=-1>2336     </font></a><span class="default">{</span>
<a name="2337"><font size=-1>2337     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">indentlevel = </span><span class="number">0</span><span class="default">;</span>
<a name="2338"><font size=-1>2338     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">number_of_if = </span><span class="number">0</span><span class="default">;</span>
<a name="2339"><font size=-1>2339     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">varusagelevel = -</span><span class="number">1</span><span class="default">;</span>
<a name="2340"><font size=-1>2340     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">returnStatement = </span><span class="keyword">false</span><span class="default">;  </span><span class="comment">// current statement is a return, stop analysis at the &quot;;&quot;</span>
<a name="2341"><font size=-1>2341     </font></a><span class="comment">    </span><span class="keyword">bool </span><span class="default">read = </span><span class="keyword">false</span><span class="default">;  </span><span class="comment">// is variable value read?</span>
<a name="2342"><font size=-1>2342     </font></a><span class="comment"></span>
<a name="2343"><font size=-1>2343     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="2344"><font size=-1>2344     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2345"><font size=-1>2345     </font></a><span class="default"></span>
<a name="2346"><font size=-1>2346     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok2 = startToken; tok2 &amp;&amp; tok2 != endToken; tok2 = tok2-&gt;next()) {</span>
<a name="2347"><font size=-1>2347     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="2348"><font size=-1>2348     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2349"><font size=-1>2349     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(indentlevel &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; tok2-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">)</span>
<a name="2350"><font size=-1>2350     </font></a><span class="default">            ++indentlevel;</span>
<a name="2351"><font size=-1>2351     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(indentlevel &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; tok2-&gt;str() == </span><span class="string">&quot;}&quot;</span><span class="default">) {</span>
<a name="2352"><font size=-1>2352     </font></a><span class="default">            --indentlevel;</span>
<a name="2353"><font size=-1>2353     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(indentlevel &lt;= </span><span class="number">0 </span><span class="default">&amp;&amp; isReturnScope(tok2, settings) &amp;&amp; Token::Match(tok2-&gt;link()-&gt;previous(), </span><span class="string">&quot;else|) {&quot;</span><span class="default">)) {</span>
<a name="2354"><font size=-1>2354     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *condition = tok2-&gt;link();</span>
<a name="2355"><font size=-1>2355     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">iselse = Token::simpleMatch(condition-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;} else {&quot;</span><span class="default">);</span>
<a name="2356"><font size=-1>2356     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(iselse)</span>
<a name="2357"><font size=-1>2357     </font></a><span class="default">                    condition = condition-&gt;linkAt(-</span><span class="number">2</span><span class="default">);</span>
<a name="2358"><font size=-1>2358     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(condition &amp;&amp; Token::simpleMatch(condition-&gt;previous(), </span><span class="string">&quot;) {&quot;</span><span class="default">))</span>
<a name="2359"><font size=-1>2359     </font></a><span class="default">                    condition = condition-&gt;linkAt(-</span><span class="number">1</span><span class="default">)-&gt;astOperand2();</span>
<a name="2360"><font size=-1>2360     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="2361"><font size=-1>2361     </font></a><span class="keyword">                    </span><span class="default">condition = nullptr;</span>
<a name="2362"><font size=-1>2362     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!condition) {</span>
<a name="2363"><font size=-1>2363     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2364"><font size=-1>2364     </font></a><span class="default">                        bailout(</span>
<a name="2365"><font size=-1>2365     </font></a><span class="default">                            tokenlist,</span>
<a name="2366"><font size=-1>2366     </font></a><span class="default">                            errorLogger,</span>
<a name="2367"><font size=-1>2367     </font></a><span class="default">                            tok2,</span>
<a name="2368"><font size=-1>2368     </font></a><span class="default">                            </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() +</span>
<a name="2369"><font size=-1>2369     </font></a><span class="default">                            </span><span class="string">&quot; valueFlowForwardVariable, bailing out since it's unknown if conditional return is executed&quot;</span><span class="default">);</span>
<a name="2370"><font size=-1>2370     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2371"><font size=-1>2371     </font></a><span class="default">                }</span>
<a name="2372"><font size=-1>2372     </font></a><span class="default"></span>
<a name="2373"><font size=-1>2373     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">bailoutflag = </span><span class="keyword">false</span><span class="default">;</span>
<a name="2374"><font size=-1>2374     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">start1 = iselse ? tok2-&gt;link()-&gt;linkAt(-</span><span class="number">2</span><span class="default">) : nullptr;</span>
<a name="2375"><font size=-1>2375     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(std::list&lt;ValueFlow::Value&gt;::iterator it = values.begin(); it != values.end();) {</span>
<a name="2376"><font size=-1>2376     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!iselse &amp;&amp; conditionIsTrue(condition, getProgramMemory(condition-&gt;astParent(), varid, *it))) {</span>
<a name="2377"><font size=-1>2377     </font></a><span class="default">                        bailoutflag = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2378"><font size=-1>2378     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="2379"><font size=-1>2379     </font></a><span class="default">                    }</span>
<a name="2380"><font size=-1>2380     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(iselse &amp;&amp; conditionIsFalse(condition, getProgramMemory(condition-&gt;astParent(), varid, *it))) {</span>
<a name="2381"><font size=-1>2381     </font></a><span class="default">                        bailoutflag = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2382"><font size=-1>2382     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="2383"><font size=-1>2383     </font></a><span class="default">                    }</span>
<a name="2384"><font size=-1>2384     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(iselse &amp;&amp; it-&gt;isPossible() &amp;&amp; isVariableChanged(start1, start1-&gt;link(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP()))</span>
<a name="2385"><font size=-1>2385     </font></a><span class="default">                        values.erase(it++);</span>
<a name="2386"><font size=-1>2386     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="2387"><font size=-1>2387     </font></a><span class="keyword">                        </span><span class="default">++it;</span>
<a name="2388"><font size=-1>2388     </font></a><span class="default">                }</span>
<a name="2389"><font size=-1>2389     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(bailoutflag) {</span>
<a name="2390"><font size=-1>2390     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2391"><font size=-1>2391     </font></a><span class="default">                        bailout(tokenlist,</span>
<a name="2392"><font size=-1>2392     </font></a><span class="default">                                errorLogger,</span>
<a name="2393"><font size=-1>2393     </font></a><span class="default">                                tok2,</span>
<a name="2394"><font size=-1>2394     </font></a><span class="default">                                </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() +</span>
<a name="2395"><font size=-1>2395     </font></a><span class="default">                                </span><span class="string">&quot; valueFlowForwardVariable, conditional return is assumed to be executed&quot;</span><span class="default">);</span>
<a name="2396"><font size=-1>2396     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2397"><font size=-1>2397     </font></a><span class="default">                }</span>
<a name="2398"><font size=-1>2398     </font></a><span class="default"></span>
<a name="2399"><font size=-1>2399     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="2400"><font size=-1>2400     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2401"><font size=-1>2401     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(indentlevel &lt;= </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="2402"><font size=-1>2402     </font></a><span class="default">                       Token::simpleMatch(tok2-&gt;link()-&gt;previous(), </span><span class="string">&quot;else {&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2403"><font size=-1>2403     </font></a><span class="default">                       !isReturnScope(tok2-&gt;link()-&gt;tokAt(-</span><span class="number">2</span><span class="default">), settings) &amp;&amp;</span>
<a name="2404"><font size=-1>2404     </font></a><span class="default">                       isVariableChanged(tok2-&gt;link(), tok2, varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2405"><font size=-1>2405     </font></a><span class="default">                lowerToPossible(values);</span>
<a name="2406"><font size=-1>2406     </font></a><span class="default">            }</span>
<a name="2407"><font size=-1>2407     </font></a><span class="default">        }</span>
<a name="2408"><font size=-1>2408     </font></a><span class="default"></span>
<a name="2409"><font size=-1>2409     </font></a><span class="default">        </span><span class="comment">// skip lambda functions</span>
<a name="2410"><font size=-1>2410     </font></a><span class="comment">        // TODO: handle lambda functions</span>
<a name="2411"><font size=-1>2411     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;[&quot; </span><span class="default">&amp;&amp; findLambdaEndToken(tok2)) {</span>
<a name="2412"><font size=-1>2412     </font></a><span class="default">            Token *lambdaEndToken = </span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(findLambdaEndToken(tok2));</span>
<a name="2413"><font size=-1>2413     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChanged(lambdaEndToken-&gt;link(), lambdaEndToken, varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP()))</span>
<a name="2414"><font size=-1>2414     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2415"><font size=-1>2415     </font></a><span class="default">            </span><span class="comment">// Don't skip lambdas for lifetime values</span>
<a name="2416"><font size=-1>2416     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!std::all_of(values.begin(), values.end(), std::mem_fn(&amp;ValueFlow::Value::isLifetimeValue))) {</span>
<a name="2417"><font size=-1>2417     </font></a><span class="default">                tok2 = lambdaEndToken;</span>
<a name="2418"><font size=-1>2418     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2419"><font size=-1>2419     </font></a><span class="default">            }</span>
<a name="2420"><font size=-1>2420     </font></a><span class="default">        }</span>
<a name="2421"><font size=-1>2421     </font></a><span class="default"></span>
<a name="2422"><font size=-1>2422     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[;{}] %name% :&quot;</span><span class="default">) || tok2-&gt;str() == </span><span class="string">&quot;case&quot;</span><span class="default">) {</span>
<a name="2423"><font size=-1>2423     </font></a><span class="default">            lowerToPossible(values);</span>
<a name="2424"><font size=-1>2424     </font></a><span class="default">            tok2 = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2425"><font size=-1>2425     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2426"><font size=-1>2426     </font></a><span class="default">        }</span>
<a name="2427"><font size=-1>2427     </font></a><span class="default"></span>
<a name="2428"><font size=-1>2428     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">((var-&gt;isGlobal() || tok2-&gt;str() == </span><span class="string">&quot;asm&quot;</span><span class="default">) &amp;&amp; Token::Match(tok2, </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; Token::Match(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) !!{&quot;</span><span class="default">)) {</span>
<a name="2429"><font size=-1>2429     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2430"><font size=-1>2430     </font></a><span class="default">        }</span>
<a name="2431"><font size=-1>2431     </font></a><span class="default"></span>
<a name="2432"><font size=-1>2432     </font></a><span class="default">        </span><span class="comment">// Skip sizeof etc</span>
<a name="2433"><font size=-1>2433     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;sizeof|typeof|typeid (&quot;</span><span class="default">))</span>
<a name="2434"><font size=-1>2434     </font></a><span class="default">            tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="2435"><font size=-1>2435     </font></a><span class="default"></span>
<a name="2436"><font size=-1>2436     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;else {&quot;</span><span class="default">)) {</span>
<a name="2437"><font size=-1>2437     </font></a><span class="default">            </span><span class="comment">// Should scope be skipped because variable value is checked?</span>
<a name="2438"><font size=-1>2438     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token *condition = tok2-&gt;linkAt(-</span><span class="number">1</span><span class="default">);</span>
<a name="2439"><font size=-1>2439     </font></a><span class="default">            condition = condition ? condition-&gt;linkAt(-</span><span class="number">1</span><span class="default">) : nullptr;</span>
<a name="2440"><font size=-1>2440     </font></a><span class="default">            condition = condition ? condition-&gt;astOperand2() : nullptr;</span>
<a name="2441"><font size=-1>2441     </font></a><span class="default"></span>
<a name="2442"><font size=-1>2442     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">skipelse = std::any_of(values.cbegin(), values.cend(),</span>
<a name="2443"><font size=-1>2443     </font></a><span class="default">            [=](</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v) {</span>
<a name="2444"><font size=-1>2444     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">conditionIsTrue(condition, getProgramMemory(tok2, varid, v));</span>
<a name="2445"><font size=-1>2445     </font></a><span class="default">            });</span>
<a name="2446"><font size=-1>2446     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(skipelse) {</span>
<a name="2447"><font size=-1>2447     </font></a><span class="default">                tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="2448"><font size=-1>2448     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2449"><font size=-1>2449     </font></a><span class="default">            }</span>
<a name="2450"><font size=-1>2450     </font></a><span class="default">        }</span>
<a name="2451"><font size=-1>2451     </font></a><span class="default"></span>
<a name="2452"><font size=-1>2452     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;do {&quot;</span><span class="default">)) {</span>
<a name="2453"><font size=-1>2453     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *start = tok2-&gt;next();</span>
<a name="2454"><font size=-1>2454     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *end   = start-&gt;link();</span>
<a name="2455"><font size=-1>2455     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(end, </span><span class="string">&quot;} while (&quot;</span><span class="default">))</span>
<a name="2456"><font size=-1>2456     </font></a><span class="default">                end = end-&gt;linkAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2457"><font size=-1>2457     </font></a><span class="default"></span>
<a name="2458"><font size=-1>2458     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChanged(start, end, varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2459"><font size=-1>2459     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2460"><font size=-1>2460     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="2461"><font size=-1>2461     </font></a><span class="default">                            errorLogger,</span>
<a name="2462"><font size=-1>2462     </font></a><span class="default">                            tok2,</span>
<a name="2463"><font size=-1>2463     </font></a><span class="default">                            </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; valueFlowForwardVariable, assignment in do-while&quot;</span><span class="default">);</span>
<a name="2464"><font size=-1>2464     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2465"><font size=-1>2465     </font></a><span class="default">            }</span>
<a name="2466"><font size=-1>2466     </font></a><span class="default"></span>
<a name="2467"><font size=-1>2467     </font></a><span class="default">            handleKnownValuesInLoop(start, end, &amp;values, varid, var-&gt;isGlobal(), settings);</span>
<a name="2468"><font size=-1>2468     </font></a><span class="default">        }</span>
<a name="2469"><font size=-1>2469     </font></a><span class="default"></span>
<a name="2470"><font size=-1>2470     </font></a><span class="default">        </span><span class="comment">// conditional block of code that assigns variable..</span>
<a name="2471"><font size=-1>2471     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(!tok2-&gt;varId() &amp;&amp; Token::Match(tok2, </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; Token::simpleMatch(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="2472"><font size=-1>2472     </font></a><span class="default">            </span><span class="comment">// is variable changed in condition?</span>
<a name="2473"><font size=-1>2473     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">i:getIndirections(values)) {</span>
<a name="2474"><font size=-1>2474     </font></a><span class="default">                Token* tokChanged = findVariableChanged(tok2-&gt;next(), tok2-&gt;next()-&gt;link(), i, varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP());</span>
<a name="2475"><font size=-1>2475     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tokChanged != nullptr) {</span>
<a name="2476"><font size=-1>2476     </font></a><span class="default">                    </span><span class="comment">// Set the value before bailing</span>
<a name="2477"><font size=-1>2477     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(tokChanged-&gt;varId() == varid) {</span>
<a name="2478"><font size=-1>2478     </font></a><span class="default">                        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values) {</span>
<a name="2479"><font size=-1>2479     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(!v.isNonValue())</span>
<a name="2480"><font size=-1>2480     </font></a><span class="default">                                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2481"><font size=-1>2481     </font></a><span class="default">                            setTokenValue(tokChanged, v, settings);</span>
<a name="2482"><font size=-1>2482     </font></a><span class="default">                        }</span>
<a name="2483"><font size=-1>2483     </font></a><span class="default">                    }</span>
<a name="2484"><font size=-1>2484     </font></a><span class="default">                    values.remove_if([&amp;](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="2485"><font size=-1>2485     </font></a><span class="default">                        </span><span class="keyword">return </span><span class="default">v.indirect == i;</span>
<a name="2486"><font size=-1>2486     </font></a><span class="default">                    });</span>
<a name="2487"><font size=-1>2487     </font></a><span class="default">                }</span>
<a name="2488"><font size=-1>2488     </font></a><span class="default">            }</span>
<a name="2489"><font size=-1>2489     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(values.empty()) {</span>
<a name="2490"><font size=-1>2490     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2491"><font size=-1>2491     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="2492"><font size=-1>2492     </font></a><span class="default">                            errorLogger,</span>
<a name="2493"><font size=-1>2493     </font></a><span class="default">                            tok2,</span>
<a name="2494"><font size=-1>2494     </font></a><span class="default">                            </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; valueFlowForwardVariable, assignment in condition&quot;</span><span class="default">);</span>
<a name="2495"><font size=-1>2495     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2496"><font size=-1>2496     </font></a><span class="default">            }</span>
<a name="2497"><font size=-1>2497     </font></a><span class="default"></span>
<a name="2498"><font size=-1>2498     </font></a><span class="default">            </span><span class="comment">// if known variable is changed in loop body, change it to a possible value..</span>
<a name="2499"><font size=-1>2499     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;for|while&quot;</span><span class="default">)) {</span>
<a name="2500"><font size=-1>2500     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(handleKnownValuesInLoop(tok2, tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;linkAt(</span><span class="number">1</span><span class="default">), &amp;values, varid, var-&gt;isGlobal(), settings))</span>
<a name="2501"><font size=-1>2501     </font></a><span class="default">                    number_of_if++;</span>
<a name="2502"><font size=-1>2502     </font></a><span class="default">            }</span>
<a name="2503"><font size=-1>2503     </font></a><span class="default"></span>
<a name="2504"><font size=-1>2504     </font></a><span class="default">            </span><span class="comment">// Set values in condition</span>
<a name="2505"><font size=-1>2505     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(Token* tok3 = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">); tok3 != tok2-&gt;next()-&gt;link(); tok3 = tok3-&gt;next()) {</span>
<a name="2506"><font size=-1>2506     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok3-&gt;varId() == varid) {</span>
<a name="2507"><font size=-1>2507     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values)</span>
<a name="2508"><font size=-1>2508     </font></a><span class="default">                        setTokenValue(tok3, v, settings);</span>
<a name="2509"><font size=-1>2509     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok3, </span><span class="string">&quot;%oror%|&amp;&amp;|?|;&quot;</span><span class="default">)) {</span>
<a name="2510"><font size=-1>2510     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="2511"><font size=-1>2511     </font></a><span class="default">                }</span>
<a name="2512"><font size=-1>2512     </font></a><span class="default">            }</span>
<a name="2513"><font size=-1>2513     </font></a><span class="default"></span>
<a name="2514"><font size=-1>2514     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">condTok = tok2-&gt;next()-&gt;astOperand2();</span>
<a name="2515"><font size=-1>2515     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">condAlwaysTrue = (condTok &amp;&amp; condTok-&gt;hasKnownIntValue() &amp;&amp; condTok-&gt;values().front().intvalue != </span><span class="number">0</span><span class="default">);</span>
<a name="2516"><font size=-1>2516     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">condAlwaysFalse = (condTok &amp;&amp; condTok-&gt;hasKnownIntValue() &amp;&amp; condTok-&gt;values().front().intvalue == </span><span class="number">0</span><span class="default">);</span>
<a name="2517"><font size=-1>2517     </font></a><span class="default"></span>
<a name="2518"><font size=-1>2518     </font></a><span class="default">            </span><span class="comment">// Should scope be skipped because variable value is checked?</span>
<a name="2519"><font size=-1>2519     </font></a><span class="comment">            </span><span class="default">std::list&lt;ValueFlow::Value&gt; truevalues;</span>
<a name="2520"><font size=-1>2520     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt; falsevalues;</span>
<a name="2521"><font size=-1>2521     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values) {</span>
<a name="2522"><font size=-1>2522     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(condAlwaysTrue) {</span>
<a name="2523"><font size=-1>2523     </font></a><span class="default">                    truevalues.push_back(v);</span>
<a name="2524"><font size=-1>2524     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2525"><font size=-1>2525     </font></a><span class="default">                }</span>
<a name="2526"><font size=-1>2526     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(condAlwaysFalse) {</span>
<a name="2527"><font size=-1>2527     </font></a><span class="default">                    falsevalues.push_back(v);</span>
<a name="2528"><font size=-1>2528     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2529"><font size=-1>2529     </font></a><span class="default">                }</span>
<a name="2530"><font size=-1>2530     </font></a><span class="default">                </span><span class="comment">// TODO: Compute program from tokvalue first</span>
<a name="2531"><font size=-1>2531     </font></a><span class="comment">                </span><span class="default">ProgramMemory programMemory = getProgramMemory(tok2, varid, v);</span>
<a name="2532"><font size=-1>2532     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">isTrue = conditionIsTrue(condTok, programMemory);</span>
<a name="2533"><font size=-1>2533     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">isFalse = conditionIsFalse(condTok, programMemory);</span>
<a name="2534"><font size=-1>2534     </font></a><span class="default"></span>
<a name="2535"><font size=-1>2535     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isTrue)</span>
<a name="2536"><font size=-1>2536     </font></a><span class="default">                    truevalues.push_back(v);</span>
<a name="2537"><font size=-1>2537     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isFalse)</span>
<a name="2538"><font size=-1>2538     </font></a><span class="default">                    falsevalues.push_back(v);</span>
<a name="2539"><font size=-1>2539     </font></a><span class="default"></span>
<a name="2540"><font size=-1>2540     </font></a><span class="default">            }</span>
<a name="2541"><font size=-1>2541     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!truevalues.empty() || !falsevalues.empty()) {</span>
<a name="2542"><font size=-1>2542     </font></a><span class="default">                </span><span class="comment">// '{'</span>
<a name="2543"><font size=-1>2543     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">startToken1 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="2544"><font size=-1>2544     </font></a><span class="default"></span>
<a name="2545"><font size=-1>2545     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">vfresult = valueFlowForwardVariable(startToken1-&gt;next(),</span>
<a name="2546"><font size=-1>2546     </font></a><span class="default">                                startToken1-&gt;link(),</span>
<a name="2547"><font size=-1>2547     </font></a><span class="default">                                var,</span>
<a name="2548"><font size=-1>2548     </font></a><span class="default">                                varid,</span>
<a name="2549"><font size=-1>2549     </font></a><span class="default">                                truevalues,</span>
<a name="2550"><font size=-1>2550     </font></a><span class="default">                                constValue,</span>
<a name="2551"><font size=-1>2551     </font></a><span class="default">                                subFunction,</span>
<a name="2552"><font size=-1>2552     </font></a><span class="default">                                tokenlist,</span>
<a name="2553"><font size=-1>2553     </font></a><span class="default">                                errorLogger,</span>
<a name="2554"><font size=-1>2554     </font></a><span class="default">                                settings);</span>
<a name="2555"><font size=-1>2555     </font></a><span class="default"></span>
<a name="2556"><font size=-1>2556     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!condAlwaysFalse &amp;&amp; isVariableChanged(startToken1, startToken1-&gt;link(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2557"><font size=-1>2557     </font></a><span class="default">                    removeValues(values, truevalues);</span>
<a name="2558"><font size=-1>2558     </font></a><span class="default">                    lowerToPossible(values);</span>
<a name="2559"><font size=-1>2559     </font></a><span class="default">                }</span>
<a name="2560"><font size=-1>2560     </font></a><span class="default"></span>
<a name="2561"><font size=-1>2561     </font></a><span class="default">                </span><span class="comment">// goto '}'</span>
<a name="2562"><font size=-1>2562     </font></a><span class="comment">                </span><span class="default">tok2 = startToken1-&gt;link();</span>
<a name="2563"><font size=-1>2563     </font></a><span class="default"></span>
<a name="2564"><font size=-1>2564     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isReturnScope(tok2, settings) || !vfresult) {</span>
<a name="2565"><font size=-1>2565     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(condAlwaysTrue)</span>
<a name="2566"><font size=-1>2566     </font></a><span class="default">                        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2567"><font size=-1>2567     </font></a><span class="default">                    removeValues(values, truevalues);</span>
<a name="2568"><font size=-1>2568     </font></a><span class="default">                }</span>
<a name="2569"><font size=-1>2569     </font></a><span class="default"></span>
<a name="2570"><font size=-1>2570     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;} else {&quot;</span><span class="default">)) {</span>
<a name="2571"><font size=-1>2571     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">startTokenElse = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2572"><font size=-1>2572     </font></a><span class="default"></span>
<a name="2573"><font size=-1>2573     </font></a><span class="default">                    vfresult = valueFlowForwardVariable(startTokenElse-&gt;next(),</span>
<a name="2574"><font size=-1>2574     </font></a><span class="default">                                                        startTokenElse-&gt;link(),</span>
<a name="2575"><font size=-1>2575     </font></a><span class="default">                                                        var,</span>
<a name="2576"><font size=-1>2576     </font></a><span class="default">                                                        varid,</span>
<a name="2577"><font size=-1>2577     </font></a><span class="default">                                                        falsevalues,</span>
<a name="2578"><font size=-1>2578     </font></a><span class="default">                                                        constValue,</span>
<a name="2579"><font size=-1>2579     </font></a><span class="default">                                                        subFunction,</span>
<a name="2580"><font size=-1>2580     </font></a><span class="default">                                                        tokenlist,</span>
<a name="2581"><font size=-1>2581     </font></a><span class="default">                                                        errorLogger,</span>
<a name="2582"><font size=-1>2582     </font></a><span class="default">                                                        settings);</span>
<a name="2583"><font size=-1>2583     </font></a><span class="default"></span>
<a name="2584"><font size=-1>2584     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!condAlwaysTrue &amp;&amp; isVariableChanged(startTokenElse, startTokenElse-&gt;link(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2585"><font size=-1>2585     </font></a><span class="default">                        removeValues(values, falsevalues);</span>
<a name="2586"><font size=-1>2586     </font></a><span class="default">                        lowerToPossible(values);</span>
<a name="2587"><font size=-1>2587     </font></a><span class="default">                    }</span>
<a name="2588"><font size=-1>2588     </font></a><span class="default"></span>
<a name="2589"><font size=-1>2589     </font></a><span class="default">                    </span><span class="comment">// goto '}'</span>
<a name="2590"><font size=-1>2590     </font></a><span class="comment">                    </span><span class="default">tok2 = startTokenElse-&gt;link();</span>
<a name="2591"><font size=-1>2591     </font></a><span class="default"></span>
<a name="2592"><font size=-1>2592     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(isReturnScope(tok2, settings) || !vfresult) {</span>
<a name="2593"><font size=-1>2593     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(condAlwaysFalse)</span>
<a name="2594"><font size=-1>2594     </font></a><span class="default">                            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2595"><font size=-1>2595     </font></a><span class="default">                        removeValues(values, falsevalues);</span>
<a name="2596"><font size=-1>2596     </font></a><span class="default">                    }</span>
<a name="2597"><font size=-1>2597     </font></a><span class="default">                }</span>
<a name="2598"><font size=-1>2598     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="2599"><font size=-1>2599     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2600"><font size=-1>2600     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2601"><font size=-1>2601     </font></a><span class="default">            }</span>
<a name="2602"><font size=-1>2602     </font></a><span class="default"></span>
<a name="2603"><font size=-1>2603     </font></a><span class="default">            Token * </span><span class="keyword">const </span><span class="default">start = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="2604"><font size=-1>2604     </font></a><span class="default">            Token * </span><span class="keyword">const </span><span class="default">end   = start-&gt;link();</span>
<a name="2605"><font size=-1>2605     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">varusage = (indentlevel &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; constValue &amp;&amp; number_of_if == </span><span class="number">0U</span><span class="default">) ?</span>
<a name="2606"><font size=-1>2606     </font></a><span class="default">                                  isVariableChanged(start,end,varid,var-&gt;isGlobal(),settings, tokenlist-&gt;isCPP()) :</span>
<a name="2607"><font size=-1>2607     </font></a><span class="default">                                  (nullptr != Token::findmatch(start, </span><span class="string">&quot;%varid%&quot;</span><span class="default">, end, varid));</span>
<a name="2608"><font size=-1>2608     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!read) {</span>
<a name="2609"><font size=-1>2609     </font></a><span class="default">                read = </span><span class="keyword">bool</span><span class="default">(nullptr != Token::findmatch(tok2, </span><span class="string">&quot;%varid% !!=&quot;</span><span class="default">, end, varid));</span>
<a name="2610"><font size=-1>2610     </font></a><span class="default">            }</span>
<a name="2611"><font size=-1>2611     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varusage) {</span>
<a name="2612"><font size=-1>2612     </font></a><span class="default">                varusagelevel = indentlevel;</span>
<a name="2613"><font size=-1>2613     </font></a><span class="default"></span>
<a name="2614"><font size=-1>2614     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(indentlevel &lt; </span><span class="number">0 </span><span class="default">&amp;&amp; tok2-&gt;str() == </span><span class="string">&quot;switch&quot;</span><span class="default">)</span>
<a name="2615"><font size=-1>2615     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2616"><font size=-1>2616     </font></a><span class="default"></span>
<a name="2617"><font size=-1>2617     </font></a><span class="default">                </span><span class="comment">// TODO: don't check noreturn scopes</span>
<a name="2618"><font size=-1>2618     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(read &amp;&amp; (number_of_if &gt; </span><span class="number">0U </span><span class="default">|| Token::findmatch(tok2, </span><span class="string">&quot;%varid%&quot;</span><span class="default">, start, varid))) {</span>
<a name="2619"><font size=-1>2619     </font></a><span class="default">                    </span><span class="comment">// Set values in condition</span>
<a name="2620"><font size=-1>2620     </font></a><span class="comment">                    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">condend = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="2621"><font size=-1>2621     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(Token *condtok = tok2; condtok != condend; condtok = condtok-&gt;next()) {</span>
<a name="2622"><font size=-1>2622     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(condtok-&gt;varId() == varid) {</span>
<a name="2623"><font size=-1>2623     </font></a><span class="default">                            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values)</span>
<a name="2624"><font size=-1>2624     </font></a><span class="default">                                setTokenValue(condtok, v, settings);</span>
<a name="2625"><font size=-1>2625     </font></a><span class="default">                        }</span>
<a name="2626"><font size=-1>2626     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(condtok, </span><span class="string">&quot;%oror%|&amp;&amp;|?|;&quot;</span><span class="default">))</span>
<a name="2627"><font size=-1>2627     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="2628"><font size=-1>2628     </font></a><span class="default">                    }</span>
<a name="2629"><font size=-1>2629     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2630"><font size=-1>2630     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; is assigned in conditional code&quot;</span><span class="default">);</span>
<a name="2631"><font size=-1>2631     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2632"><font size=-1>2632     </font></a><span class="default">                }</span>
<a name="2633"><font size=-1>2633     </font></a><span class="default"></span>
<a name="2634"><font size=-1>2634     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;isStatic()) {</span>
<a name="2635"><font size=-1>2635     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2636"><font size=-1>2636     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; bailout when conditional code that contains var is seen&quot;</span><span class="default">);</span>
<a name="2637"><font size=-1>2637     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2638"><font size=-1>2638     </font></a><span class="default">                }</span>
<a name="2639"><font size=-1>2639     </font></a><span class="default"></span>
<a name="2640"><font size=-1>2640     </font></a><span class="default">                </span><span class="comment">// Forward known values in the else branch</span>
<a name="2641"><font size=-1>2641     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(end, </span><span class="string">&quot;} else {&quot;</span><span class="default">)) {</span>
<a name="2642"><font size=-1>2642     </font></a><span class="default">                    std::list&lt;ValueFlow::Value&gt; knownValues;</span>
<a name="2643"><font size=-1>2643     </font></a><span class="default">                    std::copy_if(values.begin(), values.end(), std::back_inserter(knownValues), std::mem_fn(&amp;ValueFlow::Value::isKnown));</span>
<a name="2644"><font size=-1>2644     </font></a><span class="default">                    valueFlowForwardVariable(end-&gt;tokAt(</span><span class="number">2</span><span class="default">),</span>
<a name="2645"><font size=-1>2645     </font></a><span class="default">                                             end-&gt;linkAt(</span><span class="number">2</span><span class="default">),</span>
<a name="2646"><font size=-1>2646     </font></a><span class="default">                                             var,</span>
<a name="2647"><font size=-1>2647     </font></a><span class="default">                                             varid,</span>
<a name="2648"><font size=-1>2648     </font></a><span class="default">                                             knownValues,</span>
<a name="2649"><font size=-1>2649     </font></a><span class="default">                                             constValue,</span>
<a name="2650"><font size=-1>2650     </font></a><span class="default">                                             subFunction,</span>
<a name="2651"><font size=-1>2651     </font></a><span class="default">                                             tokenlist,</span>
<a name="2652"><font size=-1>2652     </font></a><span class="default">                                             errorLogger,</span>
<a name="2653"><font size=-1>2653     </font></a><span class="default">                                             settings);</span>
<a name="2654"><font size=-1>2654     </font></a><span class="default">                }</span>
<a name="2655"><font size=-1>2655     </font></a><span class="default"></span>
<a name="2656"><font size=-1>2656     </font></a><span class="default">                </span><span class="comment">// Remove conditional values</span>
<a name="2657"><font size=-1>2657     </font></a><span class="comment">                </span><span class="default">std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="2658"><font size=-1>2658     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end();) {</span>
<a name="2659"><font size=-1>2659     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(it-&gt;condition || it-&gt;conditional || it-&gt;isImpossible())</span>
<a name="2660"><font size=-1>2660     </font></a><span class="default">                        values.erase(it++);</span>
<a name="2661"><font size=-1>2661     </font></a><span class="default">                    </span><span class="keyword">else </span><span class="default">{</span>
<a name="2662"><font size=-1>2662     </font></a><span class="default">                        it-&gt;changeKnownToPossible();</span>
<a name="2663"><font size=-1>2663     </font></a><span class="default">                        ++it;</span>
<a name="2664"><font size=-1>2664     </font></a><span class="default">                    }</span>
<a name="2665"><font size=-1>2665     </font></a><span class="default">                }</span>
<a name="2666"><font size=-1>2666     </font></a><span class="default">            }</span>
<a name="2667"><font size=-1>2667     </font></a><span class="default"></span>
<a name="2668"><font size=-1>2668     </font></a><span class="default">            </span><span class="comment">// stop after conditional return scopes that are executed</span>
<a name="2669"><font size=-1>2669     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(isReturnScope(end, settings)) {</span>
<a name="2670"><font size=-1>2670     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="2671"><font size=-1>2671     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end();) {</span>
<a name="2672"><font size=-1>2672     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(conditionIsTrue(tok2-&gt;next()-&gt;astOperand2(), getProgramMemory(tok2, varid, *it)))</span>
<a name="2673"><font size=-1>2673     </font></a><span class="default">                        values.erase(it++);</span>
<a name="2674"><font size=-1>2674     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="2675"><font size=-1>2675     </font></a><span class="keyword">                        </span><span class="default">++it;</span>
<a name="2676"><font size=-1>2676     </font></a><span class="default">                }</span>
<a name="2677"><font size=-1>2677     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="2678"><font size=-1>2678     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2679"><font size=-1>2679     </font></a><span class="default">            }</span>
<a name="2680"><font size=-1>2680     </font></a><span class="default"></span>
<a name="2681"><font size=-1>2681     </font></a><span class="default">            </span><span class="comment">// noreturn scopes..</span>
<a name="2682"><font size=-1>2682     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">((number_of_if &gt; </span><span class="number">0 </span><span class="default">|| Token::findmatch(tok2, </span><span class="string">&quot;%varid%&quot;</span><span class="default">, start, varid)) &amp;&amp;</span>
<a name="2683"><font size=-1>2683     </font></a><span class="default">                (isEscapeScope(start, tokenlist) ||</span>
<a name="2684"><font size=-1>2684     </font></a><span class="default">                 (Token::simpleMatch(end,</span><span class="string">&quot;} else {&quot;</span><span class="default">) &amp;&amp; isEscapeScope(end-&gt;tokAt(</span><span class="number">2</span><span class="default">), tokenlist)))) {</span>
<a name="2685"><font size=-1>2685     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2686"><font size=-1>2686     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot;. noreturn conditional scope.&quot;</span><span class="default">);</span>
<a name="2687"><font size=-1>2687     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2688"><font size=-1>2688     </font></a><span class="default">            }</span>
<a name="2689"><font size=-1>2689     </font></a><span class="default"></span>
<a name="2690"><font size=-1>2690     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChanged(start, end, varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="2691"><font size=-1>2691     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">((!read || number_of_if == </span><span class="number">0</span><span class="default">) &amp;&amp;</span>
<a name="2692"><font size=-1>2692     </font></a><span class="default">                    Token::simpleMatch(tok2, </span><span class="string">&quot;if (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2693"><font size=-1>2693     </font></a><span class="default">                    !(Token::simpleMatch(end, </span><span class="string">&quot;} else {&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2694"><font size=-1>2694     </font></a><span class="default">                      isEscapeScope(end-&gt;tokAt(</span><span class="number">2</span><span class="default">), tokenlist))) {</span>
<a name="2695"><font size=-1>2695     </font></a><span class="default">                    ++number_of_if;</span>
<a name="2696"><font size=-1>2696     </font></a><span class="default">                    tok2 = end;</span>
<a name="2697"><font size=-1>2697     </font></a><span class="default">                } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2698"><font size=-1>2698     </font></a><span class="default">                    </span><span class="comment">// loop that conditionally set variable and then break =&gt; either loop condition is</span>
<a name="2699"><font size=-1>2699     </font></a><span class="comment">                    // redundant or the variable can be unchanged after the loop.</span>
<a name="2700"><font size=-1>2700     </font></a><span class="comment">                    </span><span class="keyword">bool </span><span class="default">loopCondition = </span><span class="keyword">false</span><span class="default">;</span>
<a name="2701"><font size=-1>2701     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;while (&quot;</span><span class="default">) &amp;&amp; Token::Match(tok2-&gt;next()-&gt;astOperand2(), </span><span class="string">&quot;%op%&quot;</span><span class="default">))</span>
<a name="2702"><font size=-1>2702     </font></a><span class="default">                        loopCondition = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2703"><font size=-1>2703     </font></a><span class="default">                    </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;for (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2704"><font size=-1>2704     </font></a><span class="default">                             Token::simpleMatch(tok2-&gt;next()-&gt;astOperand2(), </span><span class="string">&quot;;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2705"><font size=-1>2705     </font></a><span class="default">                             Token::simpleMatch(tok2-&gt;next()-&gt;astOperand2()-&gt;astOperand2(), </span><span class="string">&quot;;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2706"><font size=-1>2706     </font></a><span class="default">                             Token::Match(tok2-&gt;next()-&gt;astOperand2()-&gt;astOperand2()-&gt;astOperand1(), </span><span class="string">&quot;%op%&quot;</span><span class="default">))</span>
<a name="2707"><font size=-1>2707     </font></a><span class="default">                        loopCondition = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2708"><font size=-1>2708     </font></a><span class="default"></span>
<a name="2709"><font size=-1>2709     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">bail = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2710"><font size=-1>2710     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(loopCondition) {</span>
<a name="2711"><font size=-1>2711     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Token *tok3 = Token::findmatch(start, </span><span class="string">&quot;%varid%&quot;</span><span class="default">, end, varid);</span>
<a name="2712"><font size=-1>2712     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(tok3, </span><span class="string">&quot;%varid% =&quot;</span><span class="default">, varid) &amp;&amp;</span>
<a name="2713"><font size=-1>2713     </font></a><span class="default">                            tok3-&gt;scope()-&gt;bodyEnd                &amp;&amp;</span>
<a name="2714"><font size=-1>2714     </font></a><span class="default">                            Token::Match(tok3-&gt;scope()-&gt;bodyEnd-&gt;tokAt(-</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;[;}] break ;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2715"><font size=-1>2715     </font></a><span class="default">                            !Token::findmatch(tok3-&gt;next(), </span><span class="string">&quot;%varid%&quot;</span><span class="default">, end, varid)) {</span>
<a name="2716"><font size=-1>2716     </font></a><span class="default">                            bail = </span><span class="keyword">false</span><span class="default">;</span>
<a name="2717"><font size=-1>2717     </font></a><span class="default">                            tok2 = end;</span>
<a name="2718"><font size=-1>2718     </font></a><span class="default">                        }</span>
<a name="2719"><font size=-1>2719     </font></a><span class="default">                    }</span>
<a name="2720"><font size=-1>2720     </font></a><span class="default"></span>
<a name="2721"><font size=-1>2721     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(bail) {</span>
<a name="2722"><font size=-1>2722     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2723"><font size=-1>2723     </font></a><span class="default">                            bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; is assigned in conditional code&quot;</span><span class="default">);</span>
<a name="2724"><font size=-1>2724     </font></a><span class="default">                        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2725"><font size=-1>2725     </font></a><span class="default">                    }</span>
<a name="2726"><font size=-1>2726     </font></a><span class="default">                }</span>
<a name="2727"><font size=-1>2727     </font></a><span class="default">            }</span>
<a name="2728"><font size=-1>2728     </font></a><span class="default">        }</span>
<a name="2729"><font size=-1>2729     </font></a><span class="default"></span>
<a name="2730"><font size=-1>2730     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;assert|ASSERT (&quot;</span><span class="default">) &amp;&amp; Token::simpleMatch(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) ;&quot;</span><span class="default">)) {</span>
<a name="2731"><font size=-1>2731     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">arg = tok2-&gt;next()-&gt;astOperand2();</span>
<a name="2732"><font size=-1>2732     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(arg != nullptr &amp;&amp; arg-&gt;str() != </span><span class="string">&quot;,&quot;</span><span class="default">) {</span>
<a name="2733"><font size=-1>2733     </font></a><span class="default">                </span><span class="comment">// Should scope be skipped because variable value is checked?</span>
<a name="2734"><font size=-1>2734     </font></a><span class="comment">                </span><span class="keyword">for </span><span class="default">(std::list&lt;ValueFlow::Value&gt;::iterator it = values.begin(); it != values.end();) {</span>
<a name="2735"><font size=-1>2735     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(conditionIsFalse(arg, getProgramMemory(tok2, varid, *it)))</span>
<a name="2736"><font size=-1>2736     </font></a><span class="default">                        values.erase(it++);</span>
<a name="2737"><font size=-1>2737     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="2738"><font size=-1>2738     </font></a><span class="keyword">                        </span><span class="default">++it;</span>
<a name="2739"><font size=-1>2739     </font></a><span class="default">                }</span>
<a name="2740"><font size=-1>2740     </font></a><span class="default">            }</span>
<a name="2741"><font size=-1>2741     </font></a><span class="default">        }</span>
<a name="2742"><font size=-1>2742     </font></a><span class="default"></span>
<a name="2743"><font size=-1>2743     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;}&quot; </span><span class="default">&amp;&amp; indentlevel == varusagelevel) {</span>
<a name="2744"><font size=-1>2744     </font></a><span class="default">            ++number_of_if;</span>
<a name="2745"><font size=-1>2745     </font></a><span class="default"></span>
<a name="2746"><font size=-1>2746     </font></a><span class="default">            </span><span class="comment">// Set &quot;conditional&quot; flag for all values</span>
<a name="2747"><font size=-1>2747     </font></a><span class="comment">            </span><span class="default">removeImpossible(values);</span>
<a name="2748"><font size=-1>2748     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="2749"><font size=-1>2749     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end(); ++it) {</span>
<a name="2750"><font size=-1>2750     </font></a><span class="default">                it-&gt;conditional = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2751"><font size=-1>2751     </font></a><span class="default">                it-&gt;changeKnownToPossible();</span>
<a name="2752"><font size=-1>2752     </font></a><span class="default">            }</span>
<a name="2753"><font size=-1>2753     </font></a><span class="default"></span>
<a name="2754"><font size=-1>2754     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2,</span><span class="string">&quot;} else {&quot;</span><span class="default">))</span>
<a name="2755"><font size=-1>2755     </font></a><span class="default">                tok2 = tok2-&gt;linkAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2756"><font size=-1>2756     </font></a><span class="default">        }</span>
<a name="2757"><font size=-1>2757     </font></a><span class="default"></span>
<a name="2758"><font size=-1>2758     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;break|continue|goto&quot;</span><span class="default">)) {</span>
<a name="2759"><font size=-1>2759     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope *scope = tok2-&gt;scope();</span>
<a name="2760"><font size=-1>2760     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(indentlevel &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="2761"><font size=-1>2761     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *tok3 = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2762"><font size=-1>2762     </font></a><span class="default">                </span><span class="keyword">int </span><span class="default">indentlevel2 = indentlevel;</span>
<a name="2763"><font size=-1>2763     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(indentlevel2 &gt; </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="2764"><font size=-1>2764     </font></a><span class="default">                       tok3-&gt;str() == </span><span class="string">&quot;}&quot; </span><span class="default">&amp;&amp;</span>
<a name="2765"><font size=-1>2765     </font></a><span class="default">                       Token::Match(tok3-&gt;link()-&gt;previous(), </span><span class="string">&quot;!!)&quot;</span><span class="default">)) {</span>
<a name="2766"><font size=-1>2766     </font></a><span class="default">                    indentlevel2--;</span>
<a name="2767"><font size=-1>2767     </font></a><span class="default">                    tok3 = tok3-&gt;next();</span>
<a name="2768"><font size=-1>2768     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(tok3 &amp;&amp; tok3-&gt;str() == </span><span class="string">&quot;;&quot;</span><span class="default">)</span>
<a name="2769"><font size=-1>2769     </font></a><span class="default">                        tok3 = tok3-&gt;next();</span>
<a name="2770"><font size=-1>2770     </font></a><span class="default">                }</span>
<a name="2771"><font size=-1>2771     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(indentlevel2 &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="2772"><font size=-1>2772     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2773"><font size=-1>2773     </font></a><span class="default">                scope = tok3-&gt;scope();</span>
<a name="2774"><font size=-1>2774     </font></a><span class="default">                indentlevel = </span><span class="number">0</span><span class="default">;</span>
<a name="2775"><font size=-1>2775     </font></a><span class="default">            }</span>
<a name="2776"><font size=-1>2776     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;break&quot;</span><span class="default">) {</span>
<a name="2777"><font size=-1>2777     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(scope &amp;&amp; scope-&gt;type == Scope::eSwitch) {</span>
<a name="2778"><font size=-1>2778     </font></a><span class="default">                    tok2 = </span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(scope-&gt;bodyEnd);</span>
<a name="2779"><font size=-1>2779     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(tok2 == endToken)</span>
<a name="2780"><font size=-1>2780     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="2781"><font size=-1>2781     </font></a><span class="default">                    --indentlevel;</span>
<a name="2782"><font size=-1>2782     </font></a><span class="default">                    lowerToPossible(values);</span>
<a name="2783"><font size=-1>2783     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2784"><font size=-1>2784     </font></a><span class="default">                }</span>
<a name="2785"><font size=-1>2785     </font></a><span class="default">            }</span>
<a name="2786"><font size=-1>2786     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2787"><font size=-1>2787     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot;. noreturn conditional scope.&quot;</span><span class="default">);</span>
<a name="2788"><font size=-1>2788     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2789"><font size=-1>2789     </font></a><span class="default">        }</span>
<a name="2790"><font size=-1>2790     </font></a><span class="default"></span>
<a name="2791"><font size=-1>2791     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(indentlevel &lt;= </span><span class="number">0 </span><span class="default">&amp;&amp; Token::Match(tok2, </span><span class="string">&quot;return|throw|setjmp|longjmp&quot;</span><span class="default">))</span>
<a name="2792"><font size=-1>2792     </font></a><span class="default">            returnStatement = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2793"><font size=-1>2793     </font></a><span class="default"></span>
<a name="2794"><font size=-1>2794     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(returnStatement &amp;&amp; tok2-&gt;str() == </span><span class="string">&quot;;&quot;</span><span class="default">)</span>
<a name="2795"><font size=-1>2795     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2796"><font size=-1>2796     </font></a><span class="default"></span>
<a name="2797"><font size=-1>2797     </font></a><span class="default">        </span><span class="comment">// If a ? is seen and it's known that the condition is true/false..</span>
<a name="2798"><font size=-1>2798     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;?&quot;</span><span class="default">) {</span>
<a name="2799"><font size=-1>2799     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(subFunction &amp;&amp; (astIsPointer(tok2-&gt;astOperand1()) || astIsIntegral(tok2-&gt;astOperand1(), </span><span class="keyword">false</span><span class="default">))) {</span>
<a name="2800"><font size=-1>2800     </font></a><span class="default">                tok2 = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(nextAfterAstRightmostLeaf(tok2));</span>
<a name="2801"><font size=-1>2801     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2802"><font size=-1>2802     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="2803"><font size=-1>2803     </font></a><span class="default">                            errorLogger,</span>
<a name="2804"><font size=-1>2804     </font></a><span class="default">                            tok2,</span>
<a name="2805"><font size=-1>2805     </font></a><span class="default">                            </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; valueFlowForwardVariable, skip ternary in subfunctions&quot;</span><span class="default">);</span>
<a name="2806"><font size=-1>2806     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2807"><font size=-1>2807     </font></a><span class="default">            }</span>
<a name="2808"><font size=-1>2808     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *condition = tok2-&gt;astOperand1();</span>
<a name="2809"><font size=-1>2809     </font></a><span class="default">            Token *op2 = tok2-&gt;astOperand2();</span>
<a name="2810"><font size=-1>2810     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!condition || !op2) </span><span class="comment">// Ticket #6713</span>
<a name="2811"><font size=-1>2811     </font></a><span class="comment">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2812"><font size=-1>2812     </font></a><span class="default"></span>
<a name="2813"><font size=-1>2813     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(condition-&gt;hasKnownIntValue()) {</span>
<a name="2814"><font size=-1>2814     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;condValue = condition-&gt;values().front();</span>
<a name="2815"><font size=-1>2815     </font></a><span class="default">                Token *expr = (condValue.intvalue != </span><span class="number">0</span><span class="default">) ? op2-&gt;astOperand1() : op2-&gt;astOperand2();</span>
<a name="2816"><font size=-1>2816     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values)</span>
<a name="2817"><font size=-1>2817     </font></a><span class="default">                    valueFlowAST(expr, varid, v, settings);</span>
<a name="2818"><font size=-1>2818     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isVariableChangedByFunctionCall(expr, </span><span class="number">0</span><span class="default">, varid, settings, nullptr))</span>
<a name="2819"><font size=-1>2819     </font></a><span class="default">                    lowerToPossible(values, </span><span class="number">0</span><span class="default">);</span>
<a name="2820"><font size=-1>2820     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isVariableChangedByFunctionCall(expr, </span><span class="number">1</span><span class="default">, varid, settings, nullptr))</span>
<a name="2821"><font size=-1>2821     </font></a><span class="default">                    lowerToPossible(values, </span><span class="number">1</span><span class="default">);</span>
<a name="2822"><font size=-1>2822     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2823"><font size=-1>2823     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values) {</span>
<a name="2824"><font size=-1>2824     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">ProgramMemory programMemory(getProgramMemory(tok2, varid, v));</span>
<a name="2825"><font size=-1>2825     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(conditionIsTrue(condition, programMemory))</span>
<a name="2826"><font size=-1>2826     </font></a><span class="default">                        valueFlowAST(op2-&gt;astOperand1(), varid, v, settings);</span>
<a name="2827"><font size=-1>2827     </font></a><span class="default">                    </span><span class="keyword">else if </span><span class="default">(conditionIsFalse(condition, programMemory))</span>
<a name="2828"><font size=-1>2828     </font></a><span class="default">                        valueFlowAST(op2-&gt;astOperand2(), varid, v, settings);</span>
<a name="2829"><font size=-1>2829     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="2830"><font size=-1>2830     </font></a><span class="keyword">                        </span><span class="default">valueFlowAST(op2, varid, v, settings);</span>
<a name="2831"><font size=-1>2831     </font></a><span class="default">                }</span>
<a name="2832"><font size=-1>2832     </font></a><span class="default"></span>
<a name="2833"><font size=-1>2833     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">expr0 = op2-&gt;astOperand1() ? op2-&gt;astOperand1() : tok2-&gt;astOperand1();</span>
<a name="2834"><font size=-1>2834     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">expr1 = op2-&gt;astOperand2();</span>
<a name="2835"><font size=-1>2835     </font></a><span class="default"></span>
<a name="2836"><font size=-1>2836     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::pair&lt;</span><span class="keyword">const </span><span class="default">Token *, </span><span class="keyword">const </span><span class="default">Token *&gt; startEnd0 = expr0-&gt;findExpressionStartEndTokens();</span>
<a name="2837"><font size=-1>2837     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::pair&lt;</span><span class="keyword">const </span><span class="default">Token *, </span><span class="keyword">const </span><span class="default">Token *&gt; startEnd1 = expr1-&gt;findExpressionStartEndTokens();</span>
<a name="2838"><font size=-1>2838     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">changed0 = isVariableChanged(startEnd0.first, startEnd0.second-&gt;next(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP());</span>
<a name="2839"><font size=-1>2839     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">changed1 = isVariableChanged(startEnd1.first, startEnd1.second-&gt;next(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP());</span>
<a name="2840"><font size=-1>2840     </font></a><span class="default"></span>
<a name="2841"><font size=-1>2841     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(changed0 &amp;&amp; changed1) {</span>
<a name="2842"><font size=-1>2842     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2843"><font size=-1>2843     </font></a><span class="default">                        bailout(tokenlist,</span>
<a name="2844"><font size=-1>2844     </font></a><span class="default">                                errorLogger,</span>
<a name="2845"><font size=-1>2845     </font></a><span class="default">                                tok2,</span>
<a name="2846"><font size=-1>2846     </font></a><span class="default">                                </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; valueFlowForwardVariable, changed in both : expressions&quot;</span><span class="default">);</span>
<a name="2847"><font size=-1>2847     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2848"><font size=-1>2848     </font></a><span class="default">                }</span>
<a name="2849"><font size=-1>2849     </font></a><span class="default"></span>
<a name="2850"><font size=-1>2850     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(changed0 || changed1)</span>
<a name="2851"><font size=-1>2851     </font></a><span class="default">                    lowerToPossible(values);</span>
<a name="2852"><font size=-1>2852     </font></a><span class="default">            }</span>
<a name="2853"><font size=-1>2853     </font></a><span class="default"></span>
<a name="2854"><font size=-1>2854     </font></a><span class="default">            </span><span class="comment">// Skip conditional expressions..</span>
<a name="2855"><font size=-1>2855     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">questionToken = tok2;</span>
<a name="2856"><font size=-1>2856     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(tok2-&gt;astOperand1() || tok2-&gt;astOperand2()) {</span>
<a name="2857"><font size=-1>2857     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;astOperand2())</span>
<a name="2858"><font size=-1>2858     </font></a><span class="default">                    tok2 = tok2-&gt;astOperand2();</span>
<a name="2859"><font size=-1>2859     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(tok2-&gt;isUnaryPreOp())</span>
<a name="2860"><font size=-1>2860     </font></a><span class="default">                    tok2 = tok2-&gt;astOperand1();</span>
<a name="2861"><font size=-1>2861     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="2862"><font size=-1>2862     </font></a><span class="keyword">                    break</span><span class="default">;</span>
<a name="2863"><font size=-1>2863     </font></a><span class="default">            }</span>
<a name="2864"><font size=-1>2864     </font></a><span class="default">            tok2 = tok2-&gt;next();</span>
<a name="2865"><font size=-1>2865     </font></a><span class="default"></span>
<a name="2866"><font size=-1>2866     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChanged(questionToken, questionToken-&gt;astOperand2(), varid, </span><span class="keyword">false</span><span class="default">, settings, tokenlist-&gt;isCPP()) &amp;&amp;</span>
<a name="2867"><font size=-1>2867     </font></a><span class="default">                isVariableChanged(questionToken-&gt;astOperand2(), tok2, varid, </span><span class="keyword">false</span><span class="default">, settings, tokenlist-&gt;isCPP())) {</span>
<a name="2868"><font size=-1>2868     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2869"><font size=-1>2869     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="2870"><font size=-1>2870     </font></a><span class="default">                            errorLogger,</span>
<a name="2871"><font size=-1>2871     </font></a><span class="default">                            tok2,</span>
<a name="2872"><font size=-1>2872     </font></a><span class="default">                            </span><span class="string">&quot;variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; valueFlowForwardVariable, assignment in condition&quot;</span><span class="default">);</span>
<a name="2873"><font size=-1>2873     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2874"><font size=-1>2874     </font></a><span class="default"></span>
<a name="2875"><font size=-1>2875     </font></a><span class="default">            }</span>
<a name="2876"><font size=-1>2876     </font></a><span class="default">        }</span>
<a name="2877"><font size=-1>2877     </font></a><span class="default"></span>
<a name="2878"><font size=-1>2878     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(tok2-&gt;varId() == varid) {</span>
<a name="2879"><font size=-1>2879     </font></a><span class="default">            </span><span class="comment">// compound assignment, known value in rhs</span>
<a name="2880"><font size=-1>2880     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;!!* %name% %assign%&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2881"><font size=-1>2881     </font></a><span class="default">                tok2-&gt;next()-&gt;str() != </span><span class="string">&quot;=&quot; </span><span class="default">&amp;&amp;</span>
<a name="2882"><font size=-1>2882     </font></a><span class="default">                tok2-&gt;next()-&gt;astOperand2() &amp;&amp;</span>
<a name="2883"><font size=-1>2883     </font></a><span class="default">                tok2-&gt;next()-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="2884"><font size=-1>2884     </font></a><span class="default"></span>
<a name="2885"><font size=-1>2885     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;rhsValue = tok2-&gt;next()-&gt;astOperand2()-&gt;values().front();</span>
<a name="2886"><font size=-1>2886     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::string &amp;assign = tok2-&gt;next()-&gt;str();</span>
<a name="2887"><font size=-1>2887     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="2888"><font size=-1>2888     </font></a><span class="default">                </span><span class="comment">// Erase values that are not int values..</span>
<a name="2889"><font size=-1>2889     </font></a><span class="comment">                </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end();) {</span>
<a name="2890"><font size=-1>2890     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!evalAssignment(*it, assign, rhsValue)) {</span>
<a name="2891"><font size=-1>2891     </font></a><span class="default">                        it = values.erase(it);</span>
<a name="2892"><font size=-1>2892     </font></a><span class="default">                    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2893"><font size=-1>2893     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">std::string info(</span><span class="string">&quot;Compound assignment '&quot; </span><span class="default">+ assign + </span><span class="string">&quot;', assigned value is &quot; </span><span class="default">+ it-&gt;infoString());</span>
<a name="2894"><font size=-1>2894     </font></a><span class="default">                        it-&gt;errorPath.emplace_back(tok2, info);</span>
<a name="2895"><font size=-1>2895     </font></a><span class="default"></span>
<a name="2896"><font size=-1>2896     </font></a><span class="default">                        ++it;</span>
<a name="2897"><font size=-1>2897     </font></a><span class="default">                    }</span>
<a name="2898"><font size=-1>2898     </font></a><span class="default"></span>
<a name="2899"><font size=-1>2899     </font></a><span class="default">                }</span>
<a name="2900"><font size=-1>2900     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(values.empty()) {</span>
<a name="2901"><font size=-1>2901     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2902"><font size=-1>2902     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;compound assignment of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="2903"><font size=-1>2903     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2904"><font size=-1>2904     </font></a><span class="default">                }</span>
<a name="2905"><font size=-1>2905     </font></a><span class="default">            }</span>
<a name="2906"><font size=-1>2906     </font></a><span class="default"></span>
<a name="2907"><font size=-1>2907     </font></a><span class="default">            </span><span class="comment">// bailout: assignment</span>
<a name="2908"><font size=-1>2908     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;!!* %name% %assign%&quot;</span><span class="default">)) {</span>
<a name="2909"><font size=-1>2909     </font></a><span class="default">                </span><span class="comment">// simplify rhs</span>
<a name="2910"><font size=-1>2910     </font></a><span class="comment">                </span><span class="default">std::stack&lt;Token *&gt; rhs;</span>
<a name="2911"><font size=-1>2911     </font></a><span class="default">                rhs.push(tok2-&gt;next()-&gt;astOperand2());</span>
<a name="2912"><font size=-1>2912     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(!rhs.empty()) {</span>
<a name="2913"><font size=-1>2913     </font></a><span class="default">                    Token *rtok = rhs.top();</span>
<a name="2914"><font size=-1>2914     </font></a><span class="default">                    rhs.pop();</span>
<a name="2915"><font size=-1>2915     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!rtok)</span>
<a name="2916"><font size=-1>2916     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2917"><font size=-1>2917     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(rtok-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; Token::Match(rtok-&gt;astOperand1(), </span><span class="string">&quot;sizeof|typeof|typeid&quot;</span><span class="default">))</span>
<a name="2918"><font size=-1>2918     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2919"><font size=-1>2919     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::Match(rtok, </span><span class="string">&quot;++|--|?|:|;|,&quot;</span><span class="default">))</span>
<a name="2920"><font size=-1>2920     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2921"><font size=-1>2921     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(rtok-&gt;varId() == varid) {</span>
<a name="2922"><font size=-1>2922     </font></a><span class="default">                        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values)</span>
<a name="2923"><font size=-1>2923     </font></a><span class="default">                            setTokenValue(rtok, v, settings);</span>
<a name="2924"><font size=-1>2924     </font></a><span class="default">                    }</span>
<a name="2925"><font size=-1>2925     </font></a><span class="default">                    rhs.push(rtok-&gt;astOperand1());</span>
<a name="2926"><font size=-1>2926     </font></a><span class="default">                    rhs.push(rtok-&gt;astOperand2());</span>
<a name="2927"><font size=-1>2927     </font></a><span class="default">                }</span>
<a name="2928"><font size=-1>2928     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2929"><font size=-1>2929     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;assignment of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="2930"><font size=-1>2930     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2931"><font size=-1>2931     </font></a><span class="default">            }</span>
<a name="2932"><font size=-1>2932     </font></a><span class="default"></span>
<a name="2933"><font size=-1>2933     </font></a><span class="default">            </span><span class="comment">// bailout: possible assignment using &gt;&gt;</span>
<a name="2934"><font size=-1>2934     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(isLikelyStreamRead(tokenlist-&gt;isCPP(), tok2-&gt;previous())) {</span>
<a name="2935"><font size=-1>2935     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2936"><font size=-1>2936     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Possible assignment of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; using &quot; </span><span class="default">+ tok2-&gt;strAt(-</span><span class="number">1</span><span class="default">));</span>
<a name="2937"><font size=-1>2937     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2938"><font size=-1>2938     </font></a><span class="default">            }</span>
<a name="2939"><font size=-1>2939     </font></a><span class="default"></span>
<a name="2940"><font size=-1>2940     </font></a><span class="default">            </span><span class="comment">// skip if variable is conditionally used in ?: expression</span>
<a name="2941"><font size=-1>2941     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *parent = skipValueInConditionalExpression(tok2)) {</span>
<a name="2942"><font size=-1>2942     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2943"><font size=-1>2943     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="2944"><font size=-1>2944     </font></a><span class="default">                            errorLogger,</span>
<a name="2945"><font size=-1>2945     </font></a><span class="default">                            tok2,</span>
<a name="2946"><font size=-1>2946     </font></a><span class="default">                            </span><span class="string">&quot;no simplification of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; within &quot; </span><span class="default">+ (Token::Match(parent,</span><span class="string">&quot;[?:]&quot;</span><span class="default">) ? </span><span class="string">&quot;?:&quot; </span><span class="default">: parent-&gt;str()) + </span><span class="string">&quot; expression&quot;</span><span class="default">);</span>
<a name="2947"><font size=-1>2947     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *astTop = parent-&gt;astTop();</span>
<a name="2948"><font size=-1>2948     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(astTop-&gt;astOperand1(), </span><span class="string">&quot;for (&quot;</span><span class="default">))</span>
<a name="2949"><font size=-1>2949     </font></a><span class="default">                    tok2 = astTop-&gt;link();</span>
<a name="2950"><font size=-1>2950     </font></a><span class="default"></span>
<a name="2951"><font size=-1>2951     </font></a><span class="default">                </span><span class="comment">// bailout if address of var is taken..</span>
<a name="2952"><font size=-1>2952     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;astParent() &amp;&amp; tok2-&gt;astParent()-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">)) {</span>
<a name="2953"><font size=-1>2953     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2954"><font size=-1>2954     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Taking address of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="2955"><font size=-1>2955     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2956"><font size=-1>2956     </font></a><span class="default">                }</span>
<a name="2957"><font size=-1>2957     </font></a><span class="default"></span>
<a name="2958"><font size=-1>2958     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2959"><font size=-1>2959     </font></a><span class="default">            }</span>
<a name="2960"><font size=-1>2960     </font></a><span class="default"></span>
<a name="2961"><font size=-1>2961     </font></a><span class="default">            {</span>
<a name="2962"><font size=-1>2962     </font></a><span class="default">                </span><span class="comment">// Is variable usage protected by &amp;&amp; || ?:</span>
<a name="2963"><font size=-1>2963     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">Token *tok3 = tok2;</span>
<a name="2964"><font size=-1>2964     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *parent = tok3-&gt;astParent();</span>
<a name="2965"><font size=-1>2965     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; !Token::Match(parent, </span><span class="string">&quot;%oror%|&amp;&amp;|:&quot;</span><span class="default">)) {</span>
<a name="2966"><font size=-1>2966     </font></a><span class="default">                    tok3 = parent;</span>
<a name="2967"><font size=-1>2967     </font></a><span class="default">                    parent = parent-&gt;astParent();</span>
<a name="2968"><font size=-1>2968     </font></a><span class="default">                }</span>
<a name="2969"><font size=-1>2969     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">conditional = parent &amp;&amp; (parent-&gt;str() == </span><span class="string">&quot;:&quot; </span><span class="default">|| parent-&gt;astOperand2() == tok3);</span>
<a name="2970"><font size=-1>2970     </font></a><span class="default"></span>
<a name="2971"><font size=-1>2971     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : values) {</span>
<a name="2972"><font size=-1>2972     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!conditional || !v.conditional)</span>
<a name="2973"><font size=-1>2973     </font></a><span class="default">                        setTokenValue(tok2, v, settings);</span>
<a name="2974"><font size=-1>2974     </font></a><span class="default">                }</span>
<a name="2975"><font size=-1>2975     </font></a><span class="default">            }</span>
<a name="2976"><font size=-1>2976     </font></a><span class="default"></span>
<a name="2977"><font size=-1>2977     </font></a><span class="default">            </span><span class="comment">// increment/decrement</span>
<a name="2978"><font size=-1>2978     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;++|-- %name%&quot;</span><span class="default">) || Token::Match(tok2, </span><span class="string">&quot;%name% ++|--&quot;</span><span class="default">)) {</span>
<a name="2979"><font size=-1>2979     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="2980"><font size=-1>2980     </font></a><span class="default">                </span><span class="comment">// Erase values that are not int values..</span>
<a name="2981"><font size=-1>2981     </font></a><span class="comment">                </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end();) {</span>
<a name="2982"><font size=-1>2982     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!it-&gt;isIntValue())</span>
<a name="2983"><font size=-1>2983     </font></a><span class="default">                        it = values.erase(it);</span>
<a name="2984"><font size=-1>2984     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="2985"><font size=-1>2985     </font></a><span class="keyword">                        </span><span class="default">++it;</span>
<a name="2986"><font size=-1>2986     </font></a><span class="default">                }</span>
<a name="2987"><font size=-1>2987     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(values.empty()) {</span>
<a name="2988"><font size=-1>2988     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="2989"><font size=-1>2989     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;increment/decrement of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="2990"><font size=-1>2990     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2991"><font size=-1>2991     </font></a><span class="default">                }</span>
<a name="2992"><font size=-1>2992     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">pre   = Token::Match(tok2-&gt;previous(), </span><span class="string">&quot;++|--&quot;</span><span class="default">);</span>
<a name="2993"><font size=-1>2993     </font></a><span class="default">                Token * </span><span class="keyword">const </span><span class="default">op = pre ? tok2-&gt;previous() : tok2-&gt;next();</span>
<a name="2994"><font size=-1>2994     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">inc   = (op-&gt;str() == </span><span class="string">&quot;++&quot;</span><span class="default">);</span>
<a name="2995"><font size=-1>2995     </font></a><span class="default">                </span><span class="comment">// Perform increment/decrement..</span>
<a name="2996"><font size=-1>2996     </font></a><span class="comment">                </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end(); ++it) {</span>
<a name="2997"><font size=-1>2997     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!pre)</span>
<a name="2998"><font size=-1>2998     </font></a><span class="default">                        setTokenValue(op, *it, settings);</span>
<a name="2999"><font size=-1>2999     </font></a><span class="default">                    it-&gt;intvalue += (inc ? </span><span class="number">1 </span><span class="default">: -</span><span class="number">1</span><span class="default">);</span>
<a name="3000"><font size=-1>3000     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(pre)</span>
<a name="3001"><font size=-1>3001     </font></a><span class="default">                        setTokenValue(op, *it, settings);</span>
<a name="3002"><font size=-1>3002     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">std::string info(tok2-&gt;str() + </span><span class="string">&quot; is &quot; </span><span class="default">+ std::string(inc ? </span><span class="string">&quot;incremented&quot; </span><span class="default">: </span><span class="string">&quot;decremented&quot;</span><span class="default">) + </span><span class="string">&quot;', new value is &quot; </span><span class="default">+ it-&gt;infoString());</span>
<a name="3003"><font size=-1>3003     </font></a><span class="default">                    it-&gt;errorPath.emplace_back(tok2, info);</span>
<a name="3004"><font size=-1>3004     </font></a><span class="default">                }</span>
<a name="3005"><font size=-1>3005     </font></a><span class="default">            }</span>
<a name="3006"><font size=-1>3006     </font></a><span class="default"></span>
<a name="3007"><font size=-1>3007     </font></a><span class="default">            </span><span class="comment">// bailout if address of var is taken..</span>
<a name="3008"><font size=-1>3008     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;astParent() &amp;&amp; tok2-&gt;astParent()-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">)) {</span>
<a name="3009"><font size=-1>3009     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3010"><font size=-1>3010     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Taking address of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="3011"><font size=-1>3011     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3012"><font size=-1>3012     </font></a><span class="default">            }</span>
<a name="3013"><font size=-1>3013     </font></a><span class="default"></span>
<a name="3014"><font size=-1>3014     </font></a><span class="default">            </span><span class="comment">// bailout if reference is created..</span>
<a name="3015"><font size=-1>3015     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;astParent() &amp;&amp; Token::Match(tok2-&gt;astParent()-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;&amp; %name% =&quot;</span><span class="default">)) {</span>
<a name="3016"><font size=-1>3016     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3017"><font size=-1>3017     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Reference of &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="3018"><font size=-1>3018     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3019"><font size=-1>3019     </font></a><span class="default">            }</span>
<a name="3020"><font size=-1>3020     </font></a><span class="default"></span>
<a name="3021"><font size=-1>3021     </font></a><span class="default">            </span><span class="comment">// bailout if its stream..</span>
<a name="3022"><font size=-1>3022     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(isLikelyStream(tokenlist-&gt;isCPP(), tok2)) {</span>
<a name="3023"><font size=-1>3023     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3024"><font size=-1>3024     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Stream used: &quot; </span><span class="default">+ tok2-&gt;str());</span>
<a name="3025"><font size=-1>3025     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3026"><font size=-1>3026     </font></a><span class="default">            }</span>
<a name="3027"><font size=-1>3027     </font></a><span class="default"></span>
<a name="3028"><font size=-1>3028     </font></a><span class="default">            </span><span class="comment">// assigned by subfunction?</span>
<a name="3029"><font size=-1>3029     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">i:getIndirections(values)) {</span>
<a name="3030"><font size=-1>3030     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">inconclusive = </span><span class="keyword">false</span><span class="default">;</span>
<a name="3031"><font size=-1>3031     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isVariableChangedByFunctionCall(tok2, i, settings, &amp;inconclusive)) {</span>
<a name="3032"><font size=-1>3032     </font></a><span class="default">                    values.remove_if([&amp;](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="3033"><font size=-1>3033     </font></a><span class="default">                        </span><span class="keyword">return </span><span class="default">v.indirect &lt;= i;</span>
<a name="3034"><font size=-1>3034     </font></a><span class="default">                    });</span>
<a name="3035"><font size=-1>3035     </font></a><span class="default">                }</span>
<a name="3036"><font size=-1>3036     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(inconclusive)</span>
<a name="3037"><font size=-1>3037     </font></a><span class="default">                    lowerToInconclusive(values, settings, i);</span>
<a name="3038"><font size=-1>3038     </font></a><span class="default">            }</span>
<a name="3039"><font size=-1>3039     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(values.empty()) {</span>
<a name="3040"><font size=-1>3040     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3041"><font size=-1>3041     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;possible assignment of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; by subfunction&quot;</span><span class="default">);</span>
<a name="3042"><font size=-1>3042     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3043"><font size=-1>3043     </font></a><span class="default">            }</span>
<a name="3044"><font size=-1>3044     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;.&quot; </span><span class="default">&amp;&amp; tok2-&gt;next()-&gt;originalName() != </span><span class="string">&quot;-&gt;&quot;</span><span class="default">) {</span>
<a name="3045"><font size=-1>3045     </font></a><span class="default">                lowerToInconclusive(values, settings);</span>
<a name="3046"><font size=-1>3046     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive) {</span>
<a name="3047"><font size=-1>3047     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3048"><font size=-1>3048     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;possible assignment of &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; by member function&quot;</span><span class="default">);</span>
<a name="3049"><font size=-1>3049     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3050"><font size=-1>3050     </font></a><span class="default">                }</span>
<a name="3051"><font size=-1>3051     </font></a><span class="default">            }</span>
<a name="3052"><font size=-1>3052     </font></a><span class="default">            </span><span class="comment">// Variable changed</span>
<a name="3053"><font size=-1>3053     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">i:getIndirections(values)) {</span>
<a name="3054"><font size=-1>3054     </font></a><span class="default">                </span><span class="comment">// Remove uninitialized values if modified</span>
<a name="3055"><font size=-1>3055     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(isVariableChanged(tok2, i, settings, tokenlist-&gt;isCPP()))</span>
<a name="3056"><font size=-1>3056     </font></a><span class="default">                    values.remove_if([&amp;](</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; v) {</span>
<a name="3057"><font size=-1>3057     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">v.isUninitValue() &amp;&amp; v.indirect &lt;= i;</span>
<a name="3058"><font size=-1>3058     </font></a><span class="default">                });</span>
<a name="3059"><font size=-1>3059     </font></a><span class="default">            }</span>
<a name="3060"><font size=-1>3060     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(isAliasOf(var, tok2, varid, values) &amp;&amp; isVariableChanged(tok2, </span><span class="number">0</span><span class="default">, settings, tokenlist-&gt;isCPP())) {</span>
<a name="3061"><font size=-1>3061     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3062"><font size=-1>3062     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;Alias variable was modified.&quot;</span><span class="default">);</span>
<a name="3063"><font size=-1>3063     </font></a><span class="default">            </span><span class="comment">// Bail at the end of the statement if its in an assignment</span>
<a name="3064"><font size=-1>3064     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token * top = tok2-&gt;astTop();</span>
<a name="3065"><font size=-1>3065     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(top, </span><span class="string">&quot;%assign%&quot;</span><span class="default">) &amp;&amp; astHasToken(top-&gt;astOperand1(), tok2))</span>
<a name="3066"><font size=-1>3066     </font></a><span class="default">                returnStatement = </span><span class="keyword">true</span><span class="default">;</span>
<a name="3067"><font size=-1>3067     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="3068"><font size=-1>3068     </font></a><span class="keyword">                return false</span><span class="default">;</span>
<a name="3069"><font size=-1>3069     </font></a><span class="default">        }</span>
<a name="3070"><font size=-1>3070     </font></a><span class="default"></span>
<a name="3071"><font size=-1>3071     </font></a><span class="default">        </span><span class="comment">// Lambda function</span>
<a name="3072"><font size=-1>3072     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;= [&quot;</span><span class="default">) &amp;&amp;</span>
<a name="3073"><font size=-1>3073     </font></a><span class="default">            Token::simpleMatch(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;] (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="3074"><font size=-1>3074     </font></a><span class="default">            Token::simpleMatch(tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="3075"><font size=-1>3075     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *bodyStart = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="3076"><font size=-1>3076     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isVariableChanged(bodyStart, bodyStart-&gt;link(), varid, var-&gt;isGlobal(), settings, tokenlist-&gt;isCPP())) {</span>
<a name="3077"><font size=-1>3077     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="3078"><font size=-1>3078     </font></a><span class="default">                    bailout(tokenlist,</span>
<a name="3079"><font size=-1>3079     </font></a><span class="default">                            errorLogger,</span>
<a name="3080"><font size=-1>3080     </font></a><span class="default">                            tok2,</span>
<a name="3081"><font size=-1>3081     </font></a><span class="default">                            </span><span class="string">&quot;valueFlowForwardVariable, &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; is changed in lambda function&quot;</span><span class="default">);</span>
<a name="3082"><font size=-1>3082     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3083"><font size=-1>3083     </font></a><span class="default">            }</span>
<a name="3084"><font size=-1>3084     </font></a><span class="default">        }</span>
<a name="3085"><font size=-1>3085     </font></a><span class="default"></span>
<a name="3086"><font size=-1>3086     </font></a><span class="default">    }</span>
<a name="3087"><font size=-1>3087     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3088"><font size=-1>3088     </font></a><span class="default">}</span>
<a name="3089"><font size=-1>3089     </font></a><span class="default"></span>
<a name="3090"><font size=-1>3090     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token* parseBinaryIntOp(</span><span class="keyword">const </span><span class="default">Token* expr, MathLib::bigint&amp; known)</span>
<a name="3091"><font size=-1>3091     </font></a><span class="default">{</span>
<a name="3092"><font size=-1>3092     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!expr)</span>
<a name="3093"><font size=-1>3093     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="3094"><font size=-1>3094     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!expr-&gt;astOperand1() || !expr-&gt;astOperand2())</span>
<a name="3095"><font size=-1>3095     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="3096"><font size=-1>3096     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* knownTok = nullptr;</span>
<a name="3097"><font size=-1>3097     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* varTok = nullptr;</span>
<a name="3098"><font size=-1>3098     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;astOperand1()-&gt;hasKnownIntValue() &amp;&amp; !expr-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="3099"><font size=-1>3099     </font></a><span class="default">        varTok = expr-&gt;astOperand2();</span>
<a name="3100"><font size=-1>3100     </font></a><span class="default">        knownTok = expr-&gt;astOperand1();</span>
<a name="3101"><font size=-1>3101     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(expr-&gt;astOperand2()-&gt;hasKnownIntValue() &amp;&amp; !expr-&gt;astOperand1()-&gt;hasKnownIntValue()) {</span>
<a name="3102"><font size=-1>3102     </font></a><span class="default">        varTok = expr-&gt;astOperand1();</span>
<a name="3103"><font size=-1>3103     </font></a><span class="default">        knownTok = expr-&gt;astOperand2();</span>
<a name="3104"><font size=-1>3104     </font></a><span class="default">    }</span>
<a name="3105"><font size=-1>3105     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(knownTok)</span>
<a name="3106"><font size=-1>3106     </font></a><span class="default">        known = knownTok-&gt;values().front().intvalue;</span>
<a name="3107"><font size=-1>3107     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">varTok;</span>
<a name="3108"><font size=-1>3108     </font></a><span class="default">}</span>
<a name="3109"><font size=-1>3109     </font></a><span class="default"></span>
<a name="3110"><font size=-1>3110     </font></a><span class="default"></span><span class="keyword">template </span><span class="default">&lt;</span><span class="keyword">class </span><span class="default">F&gt;</span>
<a name="3111"><font size=-1>3111     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">transformIntValues(std::list&lt;ValueFlow::Value&gt;&amp; values, F f)</span>
<a name="3112"><font size=-1>3112     </font></a><span class="default">{</span>
<a name="3113"><font size=-1>3113     </font></a><span class="default">    std::transform(values.begin(), values.end(), values.begin(), [&amp;](ValueFlow::Value x) {</span>
<a name="3114"><font size=-1>3114     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(x.isIntValue())</span>
<a name="3115"><font size=-1>3115     </font></a><span class="default">            x.intvalue = f(x.intvalue);</span>
<a name="3116"><font size=-1>3116     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">x;</span>
<a name="3117"><font size=-1>3117     </font></a><span class="default">    });</span>
<a name="3118"><font size=-1>3118     </font></a><span class="default">}</span>
<a name="3119"><font size=-1>3119     </font></a><span class="default"></span>
<a name="3120"><font size=-1>3120     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token* solveExprValues(</span><span class="keyword">const </span><span class="default">Token* expr, std::list&lt;ValueFlow::Value&gt;&amp; values)</span>
<a name="3121"><font size=-1>3121     </font></a><span class="default">{</span>
<a name="3122"><font size=-1>3122     </font></a><span class="default">    MathLib::bigint intval;</span>
<a name="3123"><font size=-1>3123     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* binaryTok = parseBinaryIntOp(expr, intval);</span>
<a name="3124"><font size=-1>3124     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(binaryTok &amp;&amp; expr-&gt;str().size() == </span><span class="number">1</span><span class="default">) {</span>
<a name="3125"><font size=-1>3125     </font></a><span class="default">        </span><span class="keyword">switch </span><span class="default">(expr-&gt;str()[</span><span class="number">0</span><span class="default">]) {</span>
<a name="3126"><font size=-1>3126     </font></a><span class="default">        </span><span class="keyword">case </span><span class="string">'+'</span><span class="default">: {</span>
<a name="3127"><font size=-1>3127     </font></a><span class="default">            transformIntValues(values, [&amp;](MathLib::bigint x) {</span>
<a name="3128"><font size=-1>3128     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">x - intval;</span>
<a name="3129"><font size=-1>3129     </font></a><span class="default">            });</span>
<a name="3130"><font size=-1>3130     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">solveExprValues(binaryTok, values);</span>
<a name="3131"><font size=-1>3131     </font></a><span class="default">        }</span>
<a name="3132"><font size=-1>3132     </font></a><span class="default">        </span><span class="keyword">case </span><span class="string">'*'</span><span class="default">: {</span>
<a name="3133"><font size=-1>3133     </font></a><span class="default">            transformIntValues(values, [&amp;](MathLib::bigint x) {</span>
<a name="3134"><font size=-1>3134     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">x / intval;</span>
<a name="3135"><font size=-1>3135     </font></a><span class="default">            });</span>
<a name="3136"><font size=-1>3136     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">solveExprValues(binaryTok, values);</span>
<a name="3137"><font size=-1>3137     </font></a><span class="default">        }</span>
<a name="3138"><font size=-1>3138     </font></a><span class="default">        </span><span class="keyword">case </span><span class="string">'^'</span><span class="default">: {</span>
<a name="3139"><font size=-1>3139     </font></a><span class="default">            transformIntValues(values, [&amp;](MathLib::bigint x) {</span>
<a name="3140"><font size=-1>3140     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">x ^ intval;</span>
<a name="3141"><font size=-1>3141     </font></a><span class="default">            });</span>
<a name="3142"><font size=-1>3142     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">solveExprValues(binaryTok, values);</span>
<a name="3143"><font size=-1>3143     </font></a><span class="default">        }</span>
<a name="3144"><font size=-1>3144     </font></a><span class="default">        }</span>
<a name="3145"><font size=-1>3145     </font></a><span class="default">    }</span>
<a name="3146"><font size=-1>3146     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">expr;</span>
<a name="3147"><font size=-1>3147     </font></a><span class="default">}</span>
<a name="3148"><font size=-1>3148     </font></a><span class="default"></span>
<a name="3149"><font size=-1>3149     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForward(Token* startToken,</span>
<a name="3150"><font size=-1>3150     </font></a><span class="default">                             </span><span class="keyword">const </span><span class="default">Token* endToken,</span>
<a name="3151"><font size=-1>3151     </font></a><span class="default">                             </span><span class="keyword">const </span><span class="default">Token* exprTok,</span>
<a name="3152"><font size=-1>3152     </font></a><span class="default">                             std::list&lt;ValueFlow::Value&gt; values,</span>
<a name="3153"><font size=-1>3153     </font></a><span class="default">                             </span><span class="keyword">const bool </span><span class="default">constValue,</span>
<a name="3154"><font size=-1>3154     </font></a><span class="default">                             </span><span class="keyword">const bool </span><span class="default">subFunction,</span>
<a name="3155"><font size=-1>3155     </font></a><span class="default">                             TokenList* </span><span class="keyword">const </span><span class="default">tokenlist,</span>
<a name="3156"><font size=-1>3156     </font></a><span class="default">                             ErrorLogger* </span><span class="keyword">const </span><span class="default">errorLogger,</span>
<a name="3157"><font size=-1>3157     </font></a><span class="default">                             </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="3158"><font size=-1>3158     </font></a><span class="default">{</span>
<a name="3159"><font size=-1>3159     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* expr = solveExprValues(exprTok, values);</span>
<a name="3160"><font size=-1>3160     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(expr, </span><span class="string">&quot;%var%&quot;</span><span class="default">)) {</span>
<a name="3161"><font size=-1>3161     </font></a><span class="default">        valueFlowForwardVariable(startToken,</span>
<a name="3162"><font size=-1>3162     </font></a><span class="default">                                 endToken,</span>
<a name="3163"><font size=-1>3163     </font></a><span class="default">                                 expr-&gt;variable(),</span>
<a name="3164"><font size=-1>3164     </font></a><span class="default">                                 expr-&gt;varId(),</span>
<a name="3165"><font size=-1>3165     </font></a><span class="default">                                 values,</span>
<a name="3166"><font size=-1>3166     </font></a><span class="default">                                 constValue,</span>
<a name="3167"><font size=-1>3167     </font></a><span class="default">                                 subFunction,</span>
<a name="3168"><font size=-1>3168     </font></a><span class="default">                                 tokenlist,</span>
<a name="3169"><font size=-1>3169     </font></a><span class="default">                                 errorLogger,</span>
<a name="3170"><font size=-1>3170     </font></a><span class="default">                                 settings);</span>
<a name="3171"><font size=-1>3171     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="3172"><font size=-1>3172     </font></a><span class="default">        valueFlowForwardExpression(startToken, endToken, expr, values, tokenlist, settings);</span>
<a name="3173"><font size=-1>3173     </font></a><span class="default">    }</span>
<a name="3174"><font size=-1>3174     </font></a><span class="default">}</span>
<a name="3175"><font size=-1>3175     </font></a><span class="default"></span>
<a name="3176"><font size=-1>3176     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::vector&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; findReturns(</span><span class="keyword">const </span><span class="default">Function* f)</span>
<a name="3177"><font size=-1>3177     </font></a><span class="default">{</span>
<a name="3178"><font size=-1>3178     </font></a><span class="default">    std::vector&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; result;</span>
<a name="3179"><font size=-1>3179     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Scope* scope = f-&gt;functionScope;</span>
<a name="3180"><font size=-1>3180     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="3181"><font size=-1>3181     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3182"><font size=-1>3182     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* tok = scope-&gt;bodyStart-&gt;next(); tok &amp;&amp; tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="3183"><font size=-1>3183     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;{&quot; </span><span class="default">&amp;&amp; tok-&gt;scope() &amp;&amp;</span>
<a name="3184"><font size=-1>3184     </font></a><span class="default">            (tok-&gt;scope()-&gt;type == Scope::eLambda || tok-&gt;scope()-&gt;type == Scope::eClass)) {</span>
<a name="3185"><font size=-1>3185     </font></a><span class="default">            tok = tok-&gt;link();</span>
<a name="3186"><font size=-1>3186     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3187"><font size=-1>3187     </font></a><span class="default">        }</span>
<a name="3188"><font size=-1>3188     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;return&quot;</span><span class="default">)) {</span>
<a name="3189"><font size=-1>3189     </font></a><span class="default">            result.push_back(tok);</span>
<a name="3190"><font size=-1>3190     </font></a><span class="default">        }</span>
<a name="3191"><font size=-1>3191     </font></a><span class="default">        </span><span class="comment">// Skip lambda functions since the scope may not be set correctly</span>
<a name="3192"><font size=-1>3192     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">Token* lambdaEndToken = findLambdaEndToken(tok);</span>
<a name="3193"><font size=-1>3193     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(lambdaEndToken) {</span>
<a name="3194"><font size=-1>3194     </font></a><span class="default">            tok = lambdaEndToken;</span>
<a name="3195"><font size=-1>3195     </font></a><span class="default">        }</span>
<a name="3196"><font size=-1>3196     </font></a><span class="default">    }</span>
<a name="3197"><font size=-1>3197     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3198"><font size=-1>3198     </font></a><span class="default">}</span>
<a name="3199"><font size=-1>3199     </font></a><span class="default"></span>
<a name="3200"><font size=-1>3200     </font></a><span class="default"></span><span class="keyword">static int </span><span class="default">getArgumentPos(</span><span class="keyword">const </span><span class="default">Variable *var, </span><span class="keyword">const </span><span class="default">Function *f)</span>
<a name="3201"><font size=-1>3201     </font></a><span class="default">{</span>
<a name="3202"><font size=-1>3202     </font></a><span class="default">    </span><span class="keyword">auto </span><span class="default">arg_it = std::find_if(f-&gt;argumentList.begin(), f-&gt;argumentList.end(), [&amp;](</span><span class="keyword">const </span><span class="default">Variable &amp;v) {</span>
<a name="3203"><font size=-1>3203     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">v.nameToken() == var-&gt;nameToken();</span>
<a name="3204"><font size=-1>3204     </font></a><span class="default">    });</span>
<a name="3205"><font size=-1>3205     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(arg_it == f-&gt;argumentList.end())</span>
<a name="3206"><font size=-1>3206     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">-</span><span class="number">1</span><span class="default">;</span>
<a name="3207"><font size=-1>3207     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">std::distance(f-&gt;argumentList.begin(), arg_it);</span>
<a name="3208"><font size=-1>3208     </font></a><span class="default">}</span>
<a name="3209"><font size=-1>3209     </font></a><span class="default"></span>
<a name="3210"><font size=-1>3210     </font></a><span class="default">std::string lifetimeType(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">ValueFlow::Value *val)</span>
<a name="3211"><font size=-1>3211     </font></a><span class="default">{</span>
<a name="3212"><font size=-1>3212     </font></a><span class="default">    std::string result;</span>
<a name="3213"><font size=-1>3213     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!val)</span>
<a name="3214"><font size=-1>3214     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;object&quot;</span><span class="default">;</span>
<a name="3215"><font size=-1>3215     </font></a><span class="default">    </span><span class="keyword">switch </span><span class="default">(val-&gt;lifetimeKind) {</span>
<a name="3216"><font size=-1>3216     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Lambda:</span>
<a name="3217"><font size=-1>3217     </font></a><span class="default">        result = </span><span class="string">&quot;lambda&quot;</span><span class="default">;</span>
<a name="3218"><font size=-1>3218     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="3219"><font size=-1>3219     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Iterator:</span>
<a name="3220"><font size=-1>3220     </font></a><span class="default">        result = </span><span class="string">&quot;iterator&quot;</span><span class="default">;</span>
<a name="3221"><font size=-1>3221     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="3222"><font size=-1>3222     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Object:</span>
<a name="3223"><font size=-1>3223     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Address:</span>
<a name="3224"><font size=-1>3224     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(astIsPointer(tok))</span>
<a name="3225"><font size=-1>3225     </font></a><span class="default">            result = </span><span class="string">&quot;pointer&quot;</span><span class="default">;</span>
<a name="3226"><font size=-1>3226     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="3227"><font size=-1>3227     </font></a><span class="keyword">            </span><span class="default">result = </span><span class="string">&quot;object&quot;</span><span class="default">;</span>
<a name="3228"><font size=-1>3228     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="3229"><font size=-1>3229     </font></a><span class="default">    }</span>
<a name="3230"><font size=-1>3230     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3231"><font size=-1>3231     </font></a><span class="default">}</span>
<a name="3232"><font size=-1>3232     </font></a><span class="default"></span>
<a name="3233"><font size=-1>3233     </font></a><span class="default">std::string lifetimeMessage(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">ValueFlow::Value *val, ErrorPath &amp;errorPath)</span>
<a name="3234"><font size=-1>3234     </font></a><span class="default">{</span>
<a name="3235"><font size=-1>3235     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *tokvalue = val ? val-&gt;tokvalue : nullptr;</span>
<a name="3236"><font size=-1>3236     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Variable *tokvar = tokvalue ? tokvalue-&gt;variable() : nullptr;</span>
<a name="3237"><font size=-1>3237     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *vartok = tokvar ? tokvar-&gt;nameToken() : nullptr;</span>
<a name="3238"><font size=-1>3238     </font></a><span class="default">    std::string type = lifetimeType(tok, val);</span>
<a name="3239"><font size=-1>3239     </font></a><span class="default">    std::string msg = type;</span>
<a name="3240"><font size=-1>3240     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(vartok) {</span>
<a name="3241"><font size=-1>3241     </font></a><span class="default">        errorPath.emplace_back(vartok, </span><span class="string">&quot;Variable created here.&quot;</span><span class="default">);</span>
<a name="3242"><font size=-1>3242     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable * var = vartok-&gt;variable();</span>
<a name="3243"><font size=-1>3243     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var) {</span>
<a name="3244"><font size=-1>3244     </font></a><span class="default">            </span><span class="keyword">switch </span><span class="default">(val-&gt;lifetimeKind) {</span>
<a name="3245"><font size=-1>3245     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Object:</span>
<a name="3246"><font size=-1>3246     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Address:</span>
<a name="3247"><font size=-1>3247     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(type == </span><span class="string">&quot;pointer&quot;</span><span class="default">)</span>
<a name="3248"><font size=-1>3248     </font></a><span class="default">                    msg += </span><span class="string">&quot; to local variable&quot;</span><span class="default">;</span>
<a name="3249"><font size=-1>3249     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="3250"><font size=-1>3250     </font></a><span class="keyword">                    </span><span class="default">msg += </span><span class="string">&quot; that points to local variable&quot;</span><span class="default">;</span>
<a name="3251"><font size=-1>3251     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="3252"><font size=-1>3252     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Lambda:</span>
<a name="3253"><font size=-1>3253     </font></a><span class="default">                msg += </span><span class="string">&quot; that captures local variable&quot;</span><span class="default">;</span>
<a name="3254"><font size=-1>3254     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="3255"><font size=-1>3255     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">ValueFlow::Value::LifetimeKind::Iterator:</span>
<a name="3256"><font size=-1>3256     </font></a><span class="default">                msg += </span><span class="string">&quot; to local container&quot;</span><span class="default">;</span>
<a name="3257"><font size=-1>3257     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="3258"><font size=-1>3258     </font></a><span class="default">            }</span>
<a name="3259"><font size=-1>3259     </font></a><span class="default">            msg += </span><span class="string">&quot; '&quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot;'&quot;</span><span class="default">;</span>
<a name="3260"><font size=-1>3260     </font></a><span class="default">        }</span>
<a name="3261"><font size=-1>3261     </font></a><span class="default">    }</span>
<a name="3262"><font size=-1>3262     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">msg;</span>
<a name="3263"><font size=-1>3263     </font></a><span class="default">}</span>
<a name="3264"><font size=-1>3264     </font></a><span class="default"></span>
<a name="3265"><font size=-1>3265     </font></a><span class="default">ValueFlow::Value getLifetimeObjValue(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="3266"><font size=-1>3266     </font></a><span class="default">{</span>
<a name="3267"><font size=-1>3267     </font></a><span class="default">    ValueFlow::Value result;</span>
<a name="3268"><font size=-1>3268     </font></a><span class="default">    </span><span class="keyword">auto </span><span class="default">pred = [](</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v) {</span>
<a name="3269"><font size=-1>3269     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!v.isLocalLifetimeValue())</span>
<a name="3270"><font size=-1>3270     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3271"><font size=-1>3271     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(v.isInconclusive())</span>
<a name="3272"><font size=-1>3272     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3273"><font size=-1>3273     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!v.tokvalue-&gt;variable())</span>
<a name="3274"><font size=-1>3274     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3275"><font size=-1>3275     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3276"><font size=-1>3276     </font></a><span class="default">    };</span>
<a name="3277"><font size=-1>3277     </font></a><span class="default">    </span><span class="keyword">auto </span><span class="default">it = std::find_if(tok-&gt;values().begin(), tok-&gt;values().end(), pred);</span>
<a name="3278"><font size=-1>3278     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(it == tok-&gt;values().end())</span>
<a name="3279"><font size=-1>3279     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3280"><font size=-1>3280     </font></a><span class="default">    result = *it;</span>
<a name="3281"><font size=-1>3281     </font></a><span class="default">    </span><span class="comment">// There should only be one lifetime</span>
<a name="3282"><font size=-1>3282     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(std::find_if(std::next(it), tok-&gt;values().end(), pred) != tok-&gt;values().end())</span>
<a name="3283"><font size=-1>3283     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3284"><font size=-1>3284     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3285"><font size=-1>3285     </font></a><span class="default">}</span>
<a name="3286"><font size=-1>3286     </font></a><span class="default"></span>
<a name="3287"><font size=-1>3287     </font></a><span class="default">std::vector&lt;LifetimeToken&gt; getLifetimeTokens(</span><span class="keyword">const </span><span class="default">Token* tok, ValueFlow::Value::ErrorPath errorPath, </span><span class="keyword">int </span><span class="default">depth)</span>
<a name="3288"><font size=-1>3288     </font></a><span class="default">{</span>
<a name="3289"><font size=-1>3289     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="3290"><font size=-1>3290     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">std::vector&lt;LifetimeToken&gt; {};</span>
<a name="3291"><font size=-1>3291     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Variable *var = tok-&gt;variable();</span>
<a name="3292"><font size=-1>3292     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(depth &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="3293"><font size=-1>3293     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">{{tok, std::move(errorPath)}};</span>
<a name="3294"><font size=-1>3294     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;declarationId() == tok-&gt;varId()) {</span>
<a name="3295"><font size=-1>3295     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;isReference() || var-&gt;isRValueReference()) {</span>
<a name="3296"><font size=-1>3296     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var-&gt;declEndToken())</span>
<a name="3297"><font size=-1>3297     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">{{tok, </span><span class="keyword">true</span><span class="default">, std::move(errorPath)}};</span>
<a name="3298"><font size=-1>3298     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var-&gt;isArgument()) {</span>
<a name="3299"><font size=-1>3299     </font></a><span class="default">                errorPath.emplace_back(var-&gt;declEndToken(), </span><span class="string">&quot;Passed to reference.&quot;</span><span class="default">);</span>
<a name="3300"><font size=-1>3300     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">{{tok, </span><span class="keyword">true</span><span class="default">, std::move(errorPath)}};</span>
<a name="3301"><font size=-1>3301     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(var-&gt;declEndToken(), </span><span class="string">&quot;=&quot;</span><span class="default">)) {</span>
<a name="3302"><font size=-1>3302     </font></a><span class="default">                errorPath.emplace_back(var-&gt;declEndToken(), </span><span class="string">&quot;Assigned to reference.&quot;</span><span class="default">);</span>
<a name="3303"><font size=-1>3303     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *vartok = var-&gt;declEndToken()-&gt;astOperand2();</span>
<a name="3304"><font size=-1>3304     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(vartok == tok)</span>
<a name="3305"><font size=-1>3305     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">{{tok, </span><span class="keyword">true</span><span class="default">, std::move(errorPath)}};</span>
<a name="3306"><font size=-1>3306     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(vartok)</span>
<a name="3307"><font size=-1>3307     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">getLifetimeTokens(vartok, std::move(errorPath), depth - </span><span class="number">1</span><span class="default">);</span>
<a name="3308"><font size=-1>3308     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="3309"><font size=-1>3309     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">std::vector&lt;LifetimeToken&gt; {};</span>
<a name="3310"><font size=-1>3310     </font></a><span class="default">            }</span>
<a name="3311"><font size=-1>3311     </font></a><span class="default">        }</span>
<a name="3312"><font size=-1>3312     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;previous(), </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) {</span>
<a name="3313"><font size=-1>3313     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function *f = tok-&gt;previous()-&gt;function();</span>
<a name="3314"><font size=-1>3314     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(f) {</span>
<a name="3315"><font size=-1>3315     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Function::returnsReference(f))</span>
<a name="3316"><font size=-1>3316     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">{{tok, std::move(errorPath)}};</span>
<a name="3317"><font size=-1>3317     </font></a><span class="default">            std::vector&lt;LifetimeToken&gt; result;</span>
<a name="3318"><font size=-1>3318     </font></a><span class="default">            std::vector&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; returns = findReturns(f);</span>
<a name="3319"><font size=-1>3319     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* returnTok : returns) {</span>
<a name="3320"><font size=-1>3320     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(returnTok == tok)</span>
<a name="3321"><font size=-1>3321     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3322"><font size=-1>3322     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(LifetimeToken&amp; lt : getLifetimeTokens(returnTok, std::move(errorPath), depth - </span><span class="number">1</span><span class="default">)) {</span>
<a name="3323"><font size=-1>3323     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token* argvarTok = lt.token;</span>
<a name="3324"><font size=-1>3324     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable* argvar = argvarTok-&gt;variable();</span>
<a name="3325"><font size=-1>3325     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!argvar)</span>
<a name="3326"><font size=-1>3326     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3327"><font size=-1>3327     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(argvar-&gt;isArgument() &amp;&amp; (argvar-&gt;isReference() || argvar-&gt;isRValueReference())) {</span>
<a name="3328"><font size=-1>3328     </font></a><span class="default">                        </span><span class="keyword">int </span><span class="default">n = getArgumentPos(argvar, f);</span>
<a name="3329"><font size=-1>3329     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(n &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="3330"><font size=-1>3330     </font></a><span class="default">                            </span><span class="keyword">return </span><span class="default">std::vector&lt;LifetimeToken&gt; {};</span>
<a name="3331"><font size=-1>3331     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Token* argTok = getArguments(tok-&gt;previous()).at(n);</span>
<a name="3332"><font size=-1>3332     </font></a><span class="default">                        lt.errorPath.emplace_back(returnTok, </span><span class="string">&quot;Return reference.&quot;</span><span class="default">);</span>
<a name="3333"><font size=-1>3333     </font></a><span class="default">                        lt.errorPath.emplace_back(tok-&gt;previous(), </span><span class="string">&quot;Called function passing '&quot; </span><span class="default">+ argTok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">);</span>
<a name="3334"><font size=-1>3334     </font></a><span class="default">                        std::vector&lt;LifetimeToken&gt; arglts = LifetimeToken::setInconclusive(</span>
<a name="3335"><font size=-1>3335     </font></a><span class="default">                                                                getLifetimeTokens(argTok, std::move(lt.errorPath), depth - </span><span class="number">1</span><span class="default">), returns.size() &gt; </span><span class="number">1</span><span class="default">);</span>
<a name="3336"><font size=-1>3336     </font></a><span class="default">                        result.insert(result.end(), arglts.begin(), arglts.end());</span>
<a name="3337"><font size=-1>3337     </font></a><span class="default">                    }</span>
<a name="3338"><font size=-1>3338     </font></a><span class="default">                }</span>
<a name="3339"><font size=-1>3339     </font></a><span class="default">            }</span>
<a name="3340"><font size=-1>3340     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">result;</span>
<a name="3341"><font size=-1>3341     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;. %name% (&quot;</span><span class="default">) &amp;&amp; astIsContainer(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">)-&gt;astOperand1())) {</span>
<a name="3342"><font size=-1>3342     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Library::Container* library = getLibraryContainer(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">)-&gt;astOperand1());</span>
<a name="3343"><font size=-1>3343     </font></a><span class="default">            Library::Container::Yield y = library-&gt;getYield(tok-&gt;previous()-&gt;str());</span>
<a name="3344"><font size=-1>3344     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(y == Library::Container::Yield::AT_INDEX || y == Library::Container::Yield::ITEM) {</span>
<a name="3345"><font size=-1>3345     </font></a><span class="default">                errorPath.emplace_back(tok-&gt;previous(), </span><span class="string">&quot;Accessing container.&quot;</span><span class="default">);</span>
<a name="3346"><font size=-1>3346     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">LifetimeToken::setAddressOf(</span>
<a name="3347"><font size=-1>3347     </font></a><span class="default">                           getLifetimeTokens(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">)-&gt;astOperand1(), std::move(errorPath), depth - </span><span class="number">1</span><span class="default">), </span><span class="keyword">false</span><span class="default">);</span>
<a name="3348"><font size=-1>3348     </font></a><span class="default">            }</span>
<a name="3349"><font size=-1>3349     </font></a><span class="default">        }</span>
<a name="3350"><font size=-1>3350     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;.|::|[&quot;</span><span class="default">)) {</span>
<a name="3351"><font size=-1>3351     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vartok = tok;</span>
<a name="3352"><font size=-1>3352     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(vartok) {</span>
<a name="3353"><font size=-1>3353     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vartok-&gt;str() == </span><span class="string">&quot;[&quot; </span><span class="default">|| vartok-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot;</span><span class="default">)</span>
<a name="3354"><font size=-1>3354     </font></a><span class="default">                vartok = vartok-&gt;astOperand1();</span>
<a name="3355"><font size=-1>3355     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(vartok-&gt;str() == </span><span class="string">&quot;.&quot; </span><span class="default">|| vartok-&gt;str() == </span><span class="string">&quot;::&quot;</span><span class="default">)</span>
<a name="3356"><font size=-1>3356     </font></a><span class="default">                vartok = vartok-&gt;astOperand2();</span>
<a name="3357"><font size=-1>3357     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="3358"><font size=-1>3358     </font></a><span class="keyword">                break</span><span class="default">;</span>
<a name="3359"><font size=-1>3359     </font></a><span class="default">        }</span>
<a name="3360"><font size=-1>3360     </font></a><span class="default"></span>
<a name="3361"><font size=-1>3361     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!vartok)</span>
<a name="3362"><font size=-1>3362     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">{{tok, std::move(errorPath)}};</span>
<a name="3363"><font size=-1>3363     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *tokvar = vartok-&gt;variable();</span>
<a name="3364"><font size=-1>3364     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!astIsContainer(vartok) &amp;&amp; !(tokvar &amp;&amp; tokvar-&gt;isArray()) &amp;&amp;</span>
<a name="3365"><font size=-1>3365     </font></a><span class="default">            (Token::Match(vartok-&gt;astParent(), </span><span class="string">&quot;[|*&quot;</span><span class="default">) || vartok-&gt;astParent()-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot;</span><span class="default">)) {</span>
<a name="3366"><font size=-1>3366     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : vartok-&gt;values()) {</span>
<a name="3367"><font size=-1>3367     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!v.isLocalLifetimeValue())</span>
<a name="3368"><font size=-1>3368     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3369"><font size=-1>3369     </font></a><span class="default">                errorPath.insert(errorPath.end(), v.errorPath.begin(), v.errorPath.end());</span>
<a name="3370"><font size=-1>3370     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">getLifetimeTokens(v.tokvalue, std::move(errorPath));</span>
<a name="3371"><font size=-1>3371     </font></a><span class="default">            }</span>
<a name="3372"><font size=-1>3372     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="3373"><font size=-1>3373     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">LifetimeToken::setAddressOf(getLifetimeTokens(vartok, std::move(errorPath)),</span>
<a name="3374"><font size=-1>3374     </font></a><span class="default">                                               !(astIsContainer(vartok) &amp;&amp; Token::simpleMatch(vartok-&gt;astParent(), </span><span class="string">&quot;[&quot;</span><span class="default">)));</span>
<a name="3375"><font size=-1>3375     </font></a><span class="default">        }</span>
<a name="3376"><font size=-1>3376     </font></a><span class="default">    }</span>
<a name="3377"><font size=-1>3377     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">{{tok, std::move(errorPath)}};</span>
<a name="3378"><font size=-1>3378     </font></a><span class="default">}</span>
<a name="3379"><font size=-1>3379     </font></a><span class="default"></span>
<a name="3380"><font size=-1>3380     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token* getLifetimeToken(</span><span class="keyword">const </span><span class="default">Token* tok, ValueFlow::Value::ErrorPath&amp; errorPath, </span><span class="keyword">bool</span><span class="default">* addressOf = nullptr)</span>
<a name="3381"><font size=-1>3381     </font></a><span class="default">{</span>
<a name="3382"><font size=-1>3382     </font></a><span class="default">    std::vector&lt;LifetimeToken&gt; lts = getLifetimeTokens(tok);</span>
<a name="3383"><font size=-1>3383     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(lts.size() != </span><span class="number">1</span><span class="default">)</span>
<a name="3384"><font size=-1>3384     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="3385"><font size=-1>3385     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(lts.front().inconclusive)</span>
<a name="3386"><font size=-1>3386     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="3387"><font size=-1>3387     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(addressOf)</span>
<a name="3388"><font size=-1>3388     </font></a><span class="default">        *addressOf = lts.front().addressOf;</span>
<a name="3389"><font size=-1>3389     </font></a><span class="default">    errorPath.insert(errorPath.end(), lts.front().errorPath.begin(), lts.front().errorPath.end());</span>
<a name="3390"><font size=-1>3390     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">lts.front().token;</span>
<a name="3391"><font size=-1>3391     </font></a><span class="default">}</span>
<a name="3392"><font size=-1>3392     </font></a><span class="default"></span>
<a name="3393"><font size=-1>3393     </font></a><span class="default"></span><span class="keyword">const </span><span class="default">Variable* getLifetimeVariable(</span><span class="keyword">const </span><span class="default">Token* tok, ValueFlow::Value::ErrorPath&amp; errorPath, </span><span class="keyword">bool</span><span class="default">* addressOf)</span>
<a name="3394"><font size=-1>3394     </font></a><span class="default">{</span>
<a name="3395"><font size=-1>3395     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* tok2 = getLifetimeToken(tok, errorPath, addressOf);</span>
<a name="3396"><font size=-1>3396     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok2 &amp;&amp; tok2-&gt;variable())</span>
<a name="3397"><font size=-1>3397     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">tok2-&gt;variable();</span>
<a name="3398"><font size=-1>3398     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="3399"><font size=-1>3399     </font></a><span class="default">}</span>
<a name="3400"><font size=-1>3400     </font></a><span class="default"></span>
<a name="3401"><font size=-1>3401     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isNotLifetimeValue(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; val)</span>
<a name="3402"><font size=-1>3402     </font></a><span class="default">{</span>
<a name="3403"><font size=-1>3403     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">!val.isLifetimeValue();</span>
<a name="3404"><font size=-1>3404     </font></a><span class="default">}</span>
<a name="3405"><font size=-1>3405     </font></a><span class="default"></span>
<a name="3406"><font size=-1>3406     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isLifetimeOwned(</span><span class="keyword">const </span><span class="default">ValueType *vt, </span><span class="keyword">const </span><span class="default">ValueType *vtParent)</span>
<a name="3407"><font size=-1>3407     </font></a><span class="default">{</span>
<a name="3408"><font size=-1>3408     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vtParent)</span>
<a name="3409"><font size=-1>3409     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3410"><font size=-1>3410     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vt) {</span>
<a name="3411"><font size=-1>3411     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vtParent-&gt;type == ValueType::CONTAINER)</span>
<a name="3412"><font size=-1>3412     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3413"><font size=-1>3413     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3414"><font size=-1>3414     </font></a><span class="default">    }</span>
<a name="3415"><font size=-1>3415     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(vt-&gt;type != ValueType::UNKNOWN_TYPE &amp;&amp; vtParent-&gt;type != ValueType::UNKNOWN_TYPE) {</span>
<a name="3416"><font size=-1>3416     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vt-&gt;pointer != vtParent-&gt;pointer)</span>
<a name="3417"><font size=-1>3417     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3418"><font size=-1>3418     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vt-&gt;type != vtParent-&gt;type) {</span>
<a name="3419"><font size=-1>3419     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vtParent-&gt;type == ValueType::RECORD)</span>
<a name="3420"><font size=-1>3420     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3421"><font size=-1>3421     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vtParent-&gt;type == ValueType::CONTAINER)</span>
<a name="3422"><font size=-1>3422     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3423"><font size=-1>3423     </font></a><span class="default">        }</span>
<a name="3424"><font size=-1>3424     </font></a><span class="default">    }</span>
<a name="3425"><font size=-1>3425     </font></a><span class="default"></span>
<a name="3426"><font size=-1>3426     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3427"><font size=-1>3427     </font></a><span class="default">}</span>
<a name="3428"><font size=-1>3428     </font></a><span class="default"></span>
<a name="3429"><font size=-1>3429     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isLifetimeBorrowed(</span><span class="keyword">const </span><span class="default">ValueType *vt, </span><span class="keyword">const </span><span class="default">ValueType *vtParent)</span>
<a name="3430"><font size=-1>3430     </font></a><span class="default">{</span>
<a name="3431"><font size=-1>3431     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vtParent)</span>
<a name="3432"><font size=-1>3432     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3433"><font size=-1>3433     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vt)</span>
<a name="3434"><font size=-1>3434     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3435"><font size=-1>3435     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(vt-&gt;type != ValueType::UNKNOWN_TYPE &amp;&amp; vtParent-&gt;type != ValueType::UNKNOWN_TYPE) {</span>
<a name="3436"><font size=-1>3436     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vtParent-&gt;pointer &gt; vt-&gt;pointer)</span>
<a name="3437"><font size=-1>3437     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3438"><font size=-1>3438     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vtParent-&gt;pointer &lt; vt-&gt;pointer &amp;&amp; vtParent-&gt;isIntegral())</span>
<a name="3439"><font size=-1>3439     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3440"><font size=-1>3440     </font></a><span class="default">    }</span>
<a name="3441"><font size=-1>3441     </font></a><span class="default"></span>
<a name="3442"><font size=-1>3442     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3443"><font size=-1>3443     </font></a><span class="default">}</span>
<a name="3444"><font size=-1>3444     </font></a><span class="default"></span>
<a name="3445"><font size=-1>3445     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">isLifetimeBorrowed(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="3446"><font size=-1>3446     </font></a><span class="default">{</span>
<a name="3447"><font size=-1>3447     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="3448"><font size=-1>3448     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3449"><font size=-1>3449     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;,&quot;</span><span class="default">))</span>
<a name="3450"><font size=-1>3450     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3451"><font size=-1>3451     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;astParent())</span>
<a name="3452"><font size=-1>3452     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3453"><font size=-1>3453     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok-&gt;astParent()-&gt;previous(), </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; !Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;,&quot;</span><span class="default">)) {</span>
<a name="3454"><font size=-1>3454     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;{&quot;</span><span class="default">)) {</span>
<a name="3455"><font size=-1>3455     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueType *vt = tok-&gt;valueType();</span>
<a name="3456"><font size=-1>3456     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueType *vtParent = tok-&gt;astParent()-&gt;valueType();</span>
<a name="3457"><font size=-1>3457     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isLifetimeBorrowed(vt, vtParent))</span>
<a name="3458"><font size=-1>3458     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3459"><font size=-1>3459     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isLifetimeOwned(vt, vtParent))</span>
<a name="3460"><font size=-1>3460     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3461"><font size=-1>3461     </font></a><span class="default">        }</span>
<a name="3462"><font size=-1>3462     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type *t = Token::typeOf(tok);</span>
<a name="3463"><font size=-1>3463     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type *parentT = Token::typeOf(tok-&gt;astParent());</span>
<a name="3464"><font size=-1>3464     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(t &amp;&amp; parentT &amp;&amp; t-&gt;classDef &amp;&amp; parentT-&gt;classDef &amp;&amp; t-&gt;classDef != parentT-&gt;classDef) {</span>
<a name="3465"><font size=-1>3465     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3466"><font size=-1>3466     </font></a><span class="default">        }</span>
<a name="3467"><font size=-1>3467     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;astParent()-&gt;tokAt(-</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;%var% . push_back|push_front|insert|push (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="3468"><font size=-1>3468     </font></a><span class="default">               astIsContainer(tok-&gt;astParent()-&gt;tokAt(-</span><span class="number">3</span><span class="default">))) {</span>
<a name="3469"><font size=-1>3469     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">ValueType *vt = tok-&gt;valueType();</span>
<a name="3470"><font size=-1>3470     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">ValueType *vtCont = tok-&gt;astParent()-&gt;tokAt(-</span><span class="number">3</span><span class="default">)-&gt;valueType();</span>
<a name="3471"><font size=-1>3471     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!vtCont-&gt;containerTypeToken)</span>
<a name="3472"><font size=-1>3472     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3473"><font size=-1>3473     </font></a><span class="default">        ValueType vtParent = ValueType::parseDecl(vtCont-&gt;containerTypeToken, settings);</span>
<a name="3474"><font size=-1>3474     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isLifetimeBorrowed(vt, &amp;vtParent))</span>
<a name="3475"><font size=-1>3475     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3476"><font size=-1>3476     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isLifetimeOwned(vt, &amp;vtParent))</span>
<a name="3477"><font size=-1>3477     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3478"><font size=-1>3478     </font></a><span class="default">    }</span>
<a name="3479"><font size=-1>3479     </font></a><span class="default"></span>
<a name="3480"><font size=-1>3480     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3481"><font size=-1>3481     </font></a><span class="default">}</span>
<a name="3482"><font size=-1>3482     </font></a><span class="default"></span>
<a name="3483"><font size=-1>3483     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetimeFunction(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings);</span>
<a name="3484"><font size=-1>3484     </font></a><span class="default"></span>
<a name="3485"><font size=-1>3485     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetimeConstructor(Token *tok,</span>
<a name="3486"><font size=-1>3486     </font></a><span class="default">        TokenList *tokenlist,</span>
<a name="3487"><font size=-1>3487     </font></a><span class="default">        ErrorLogger *errorLogger,</span>
<a name="3488"><font size=-1>3488     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Settings *settings);</span>
<a name="3489"><font size=-1>3489     </font></a><span class="default"></span>
<a name="3490"><font size=-1>3490     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForwardLifetime(Token * tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="3491"><font size=-1>3491     </font></a><span class="default">{</span>
<a name="3492"><font size=-1>3492     </font></a><span class="default">    Token *parent = tok-&gt;astParent();</span>
<a name="3493"><font size=-1>3493     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; (parent-&gt;isArithmeticalOp() || parent-&gt;str() == </span><span class="string">&quot;,&quot;</span><span class="default">))</span>
<a name="3494"><font size=-1>3494     </font></a><span class="default">        parent = parent-&gt;astParent();</span>
<a name="3495"><font size=-1>3495     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!parent)</span>
<a name="3496"><font size=-1>3496     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3497"><font size=-1>3497     </font></a><span class="default">    </span><span class="comment">// Assignment</span>
<a name="3498"><font size=-1>3498     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;=&quot; </span><span class="default">&amp;&amp; (!parent-&gt;astParent() || Token::simpleMatch(parent-&gt;astParent(), </span><span class="string">&quot;;&quot;</span><span class="default">))) {</span>
<a name="3499"><font size=-1>3499     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var = getLHSVariable(parent);</span>
<a name="3500"><font size=-1>3500     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="3501"><font size=-1>3501     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3502"><font size=-1>3502     </font></a><span class="default"></span>
<a name="3503"><font size=-1>3503     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * endOfVarScope = nullptr;</span>
<a name="3504"><font size=-1>3504     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;isLocal())</span>
<a name="3505"><font size=-1>3505     </font></a><span class="default">            endOfVarScope = tok-&gt;scope()-&gt;bodyEnd;</span>
<a name="3506"><font size=-1>3506     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="3507"><font size=-1>3507     </font></a><span class="keyword">            </span><span class="default">endOfVarScope = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="3508"><font size=-1>3508     </font></a><span class="default"></span>
<a name="3509"><font size=-1>3509     </font></a><span class="default">        </span><span class="comment">// Rhs values..</span>
<a name="3510"><font size=-1>3510     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!parent-&gt;astOperand2() || parent-&gt;astOperand2()-&gt;values().empty())</span>
<a name="3511"><font size=-1>3511     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3512"><font size=-1>3512     </font></a><span class="default"></span>
<a name="3513"><font size=-1>3513     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!isLifetimeBorrowed(parent-&gt;astOperand2(), settings))</span>
<a name="3514"><font size=-1>3514     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3515"><font size=-1>3515     </font></a><span class="default"></span>
<a name="3516"><font size=-1>3516     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; values = parent-&gt;astOperand2()-&gt;values();</span>
<a name="3517"><font size=-1>3517     </font></a><span class="default"></span>
<a name="3518"><font size=-1>3518     </font></a><span class="default">        </span><span class="comment">// Static variable initialisation?</span>
<a name="3519"><font size=-1>3519     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(var-&gt;isStatic() &amp;&amp; var-&gt;nameToken() == parent-&gt;astOperand1())</span>
<a name="3520"><font size=-1>3520     </font></a><span class="default">            lowerToPossible(values);</span>
<a name="3521"><font size=-1>3521     </font></a><span class="default"></span>
<a name="3522"><font size=-1>3522     </font></a><span class="default">        </span><span class="comment">// Skip RHS</span>
<a name="3523"><font size=-1>3523     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">Token *nextExpression = nextAfterAstRightmostLeaf(parent);</span>
<a name="3524"><font size=-1>3524     </font></a><span class="default"></span>
<a name="3525"><font size=-1>3525     </font></a><span class="default">        </span><span class="comment">// Only forward lifetime values</span>
<a name="3526"><font size=-1>3526     </font></a><span class="comment">        </span><span class="default">values.remove_if(&amp;isNotLifetimeValue);</span>
<a name="3527"><font size=-1>3527     </font></a><span class="default">        valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(nextExpression),</span>
<a name="3528"><font size=-1>3528     </font></a><span class="default">                                 endOfVarScope,</span>
<a name="3529"><font size=-1>3529     </font></a><span class="default">                                 var,</span>
<a name="3530"><font size=-1>3530     </font></a><span class="default">                                 var-&gt;declarationId(),</span>
<a name="3531"><font size=-1>3531     </font></a><span class="default">                                 values,</span>
<a name="3532"><font size=-1>3532     </font></a><span class="default">                                 </span><span class="keyword">false</span><span class="default">,</span>
<a name="3533"><font size=-1>3533     </font></a><span class="default">                                 </span><span class="keyword">false</span><span class="default">,</span>
<a name="3534"><font size=-1>3534     </font></a><span class="default">                                 tokenlist,</span>
<a name="3535"><font size=-1>3535     </font></a><span class="default">                                 errorLogger,</span>
<a name="3536"><font size=-1>3536     </font></a><span class="default">                                 settings);</span>
<a name="3537"><font size=-1>3537     </font></a><span class="default"></span>
<a name="3538"><font size=-1>3538     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;astTop() &amp;&amp; Token::simpleMatch(tok-&gt;astTop()-&gt;previous(), </span><span class="string">&quot;for (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="3539"><font size=-1>3539     </font></a><span class="default">            Token::simpleMatch(tok-&gt;astTop()-&gt;link(), </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="3540"><font size=-1>3540     </font></a><span class="default">            Token *start = tok-&gt;astTop()-&gt;link()-&gt;next();</span>
<a name="3541"><font size=-1>3541     </font></a><span class="default">            valueFlowForwardVariable(</span>
<a name="3542"><font size=-1>3542     </font></a><span class="default">                start, start-&gt;link(), var, var-&gt;declarationId(), values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="3543"><font size=-1>3543     </font></a><span class="default">        }</span>
<a name="3544"><font size=-1>3544     </font></a><span class="default">        </span><span class="comment">// Constructor</span>
<a name="3545"><font size=-1>3545     </font></a><span class="comment">    </span><span class="default">} </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(parent, </span><span class="string">&quot;{&quot;</span><span class="default">) &amp;&amp; !isScopeBracket(parent)) {</span>
<a name="3546"><font size=-1>3546     </font></a><span class="default">        valueFlowLifetimeConstructor(parent, tokenlist, errorLogger, settings);</span>
<a name="3547"><font size=-1>3547     </font></a><span class="default">        valueFlowForwardLifetime(parent, tokenlist, errorLogger, settings);</span>
<a name="3548"><font size=-1>3548     </font></a><span class="default">        </span><span class="comment">// Function call</span>
<a name="3549"><font size=-1>3549     </font></a><span class="comment">    </span><span class="default">} </span><span class="keyword">else if </span><span class="default">(Token::Match(parent-&gt;previous(), </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) {</span>
<a name="3550"><font size=-1>3550     </font></a><span class="default">        valueFlowLifetimeFunction(parent-&gt;previous(), tokenlist, errorLogger, settings);</span>
<a name="3551"><font size=-1>3551     </font></a><span class="default">        valueFlowForwardLifetime(parent, tokenlist, errorLogger, settings);</span>
<a name="3552"><font size=-1>3552     </font></a><span class="default">        </span><span class="comment">// Variable</span>
<a name="3553"><font size=-1>3553     </font></a><span class="comment">    </span><span class="default">} </span><span class="keyword">else if </span><span class="default">(tok-&gt;variable()) {</span>
<a name="3554"><font size=-1>3554     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var = tok-&gt;variable();</span>
<a name="3555"><font size=-1>3555     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;typeStartToken() || !var-&gt;typeStartToken()-&gt;scope())</span>
<a name="3556"><font size=-1>3556     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3557"><font size=-1>3557     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *endOfVarScope = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="3558"><font size=-1>3558     </font></a><span class="default"></span>
<a name="3559"><font size=-1>3559     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; values = tok-&gt;values();</span>
<a name="3560"><font size=-1>3560     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *nextExpression = nextAfterAstRightmostLeaf(parent);</span>
<a name="3561"><font size=-1>3561     </font></a><span class="default">        </span><span class="comment">// Only forward lifetime values</span>
<a name="3562"><font size=-1>3562     </font></a><span class="comment">        </span><span class="default">values.remove_if(&amp;isNotLifetimeValue);</span>
<a name="3563"><font size=-1>3563     </font></a><span class="default">        valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(nextExpression),</span>
<a name="3564"><font size=-1>3564     </font></a><span class="default">                                 endOfVarScope,</span>
<a name="3565"><font size=-1>3565     </font></a><span class="default">                                 var,</span>
<a name="3566"><font size=-1>3566     </font></a><span class="default">                                 var-&gt;declarationId(),</span>
<a name="3567"><font size=-1>3567     </font></a><span class="default">                                 values,</span>
<a name="3568"><font size=-1>3568     </font></a><span class="default">                                 </span><span class="keyword">false</span><span class="default">,</span>
<a name="3569"><font size=-1>3569     </font></a><span class="default">                                 </span><span class="keyword">false</span><span class="default">,</span>
<a name="3570"><font size=-1>3570     </font></a><span class="default">                                 tokenlist,</span>
<a name="3571"><font size=-1>3571     </font></a><span class="default">                                 errorLogger,</span>
<a name="3572"><font size=-1>3572     </font></a><span class="default">                                 settings);</span>
<a name="3573"><font size=-1>3573     </font></a><span class="default">    }</span>
<a name="3574"><font size=-1>3574     </font></a><span class="default">}</span>
<a name="3575"><font size=-1>3575     </font></a><span class="default"></span>
<a name="3576"><font size=-1>3576     </font></a><span class="default"></span><span class="keyword">struct </span><span class="default">LifetimeStore {</span>
<a name="3577"><font size=-1>3577     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *argtok;</span>
<a name="3578"><font size=-1>3578     </font></a><span class="default">    std::string message;</span>
<a name="3579"><font size=-1>3579     </font></a><span class="default">    ValueFlow::Value::LifetimeKind type;</span>
<a name="3580"><font size=-1>3580     </font></a><span class="default">    ErrorPath errorPath;</span>
<a name="3581"><font size=-1>3581     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">inconclusive;</span>
<a name="3582"><font size=-1>3582     </font></a><span class="default"></span>
<a name="3583"><font size=-1>3583     </font></a><span class="default">    LifetimeStore()</span>
<a name="3584"><font size=-1>3584     </font></a><span class="default">        : argtok(nullptr), message(), type(), errorPath(), inconclusive(</span><span class="keyword">false</span><span class="default">)</span>
<a name="3585"><font size=-1>3585     </font></a><span class="default">    {}</span>
<a name="3586"><font size=-1>3586     </font></a><span class="default"></span>
<a name="3587"><font size=-1>3587     </font></a><span class="default">    LifetimeStore(</span><span class="keyword">const </span><span class="default">Token *argtok,</span>
<a name="3588"><font size=-1>3588     </font></a><span class="default">                  </span><span class="keyword">const </span><span class="default">std::string &amp;message,</span>
<a name="3589"><font size=-1>3589     </font></a><span class="default">                  ValueFlow::Value::LifetimeKind type = ValueFlow::Value::LifetimeKind::Object,</span>
<a name="3590"><font size=-1>3590     </font></a><span class="default">                  </span><span class="keyword">bool </span><span class="default">inconclusive = </span><span class="keyword">false</span><span class="default">)</span>
<a name="3591"><font size=-1>3591     </font></a><span class="default">        : argtok(argtok), message(message), type(type), errorPath(), inconclusive(inconclusive)</span>
<a name="3592"><font size=-1>3592     </font></a><span class="default">    {}</span>
<a name="3593"><font size=-1>3593     </font></a><span class="default"></span>
<a name="3594"><font size=-1>3594     </font></a><span class="default">    </span><span class="keyword">static </span><span class="default">LifetimeStore fromFunctionArg(</span><span class="keyword">const </span><span class="default">Function * f, Token *tok, </span><span class="keyword">const </span><span class="default">Variable *var, TokenList *tokenlist, ErrorLogger *errorLogger) {</span>
<a name="3595"><font size=-1>3595     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="3596"><font size=-1>3596     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">LifetimeStore{};</span>
<a name="3597"><font size=-1>3597     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;isArgument())</span>
<a name="3598"><font size=-1>3598     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">LifetimeStore{};</span>
<a name="3599"><font size=-1>3599     </font></a><span class="default">        </span><span class="keyword">int </span><span class="default">n = getArgumentPos(var, f);</span>
<a name="3600"><font size=-1>3600     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(n &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="3601"><font size=-1>3601     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">LifetimeStore{};</span>
<a name="3602"><font size=-1>3602     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; args = getArguments(tok);</span>
<a name="3603"><font size=-1>3603     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(n &gt;= args.size()) {</span>
<a name="3604"><font size=-1>3604     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tokenlist-&gt;getSettings()-&gt;debugwarnings)</span>
<a name="3605"><font size=-1>3605     </font></a><span class="default">                bailout(tokenlist,</span>
<a name="3606"><font size=-1>3606     </font></a><span class="default">                        errorLogger,</span>
<a name="3607"><font size=-1>3607     </font></a><span class="default">                        tok,</span>
<a name="3608"><font size=-1>3608     </font></a><span class="default">                        </span><span class="string">&quot;Argument mismatch: Function '&quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot;' returning lifetime from argument index &quot; </span><span class="default">+</span>
<a name="3609"><font size=-1>3609     </font></a><span class="default">                        std::to_string(n) + </span><span class="string">&quot; but only &quot; </span><span class="default">+ std::to_string(args.size()) +</span>
<a name="3610"><font size=-1>3610     </font></a><span class="default">                        </span><span class="string">&quot; arguments are available.&quot;</span><span class="default">);</span>
<a name="3611"><font size=-1>3611     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">LifetimeStore{};</span>
<a name="3612"><font size=-1>3612     </font></a><span class="default">        }</span>
<a name="3613"><font size=-1>3613     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *argtok2 = args[n];</span>
<a name="3614"><font size=-1>3614     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">LifetimeStore{argtok2, </span><span class="string">&quot;Passed to '&quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object};</span>
<a name="3615"><font size=-1>3615     </font></a><span class="default">    }</span>
<a name="3616"><font size=-1>3616     </font></a><span class="default"></span>
<a name="3617"><font size=-1>3617     </font></a><span class="default">    </span><span class="keyword">template </span><span class="default">&lt;</span><span class="keyword">class </span><span class="default">Predicate&gt;</span>
<a name="3618"><font size=-1>3618     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byRef(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings, Predicate pred) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3619"><font size=-1>3619     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; inconclusive)</span>
<a name="3620"><font size=-1>3620     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3621"><font size=-1>3621     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!argtok)</span>
<a name="3622"><font size=-1>3622     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3623"><font size=-1>3623     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">LifetimeToken&amp; lt : getLifetimeTokens(argtok)) {</span>
<a name="3624"><font size=-1>3624     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; lt.inconclusive)</span>
<a name="3625"><font size=-1>3625     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3626"><font size=-1>3626     </font></a><span class="default">            ErrorPath er = errorPath;</span>
<a name="3627"><font size=-1>3627     </font></a><span class="default">            er.insert(er.end(), lt.errorPath.begin(), lt.errorPath.end());</span>
<a name="3628"><font size=-1>3628     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!lt.token)</span>
<a name="3629"><font size=-1>3629     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="3630"><font size=-1>3630     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!pred(lt.token))</span>
<a name="3631"><font size=-1>3631     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="3632"><font size=-1>3632     </font></a><span class="default">            er.emplace_back(argtok, message);</span>
<a name="3633"><font size=-1>3633     </font></a><span class="default"></span>
<a name="3634"><font size=-1>3634     </font></a><span class="default">            ValueFlow::Value value;</span>
<a name="3635"><font size=-1>3635     </font></a><span class="default">            value.valueType = ValueFlow::Value::LIFETIME;</span>
<a name="3636"><font size=-1>3636     </font></a><span class="default">            value.lifetimeScope = ValueFlow::Value::LifetimeScope::Local;</span>
<a name="3637"><font size=-1>3637     </font></a><span class="default">            value.tokvalue = lt.token;</span>
<a name="3638"><font size=-1>3638     </font></a><span class="default">            value.errorPath = std::move(er);</span>
<a name="3639"><font size=-1>3639     </font></a><span class="default">            value.lifetimeKind = type;</span>
<a name="3640"><font size=-1>3640     </font></a><span class="default">            value.setInconclusive(lt.inconclusive || inconclusive);</span>
<a name="3641"><font size=-1>3641     </font></a><span class="default">            </span><span class="comment">// Don't add the value a second time</span>
<a name="3642"><font size=-1>3642     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(std::find(tok-&gt;values().begin(), tok-&gt;values().end(), value) != tok-&gt;values().end())</span>
<a name="3643"><font size=-1>3643     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="3644"><font size=-1>3644     </font></a><span class="default">            setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="3645"><font size=-1>3645     </font></a><span class="default">            valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="3646"><font size=-1>3646     </font></a><span class="default">        }</span>
<a name="3647"><font size=-1>3647     </font></a><span class="default">    }</span>
<a name="3648"><font size=-1>3648     </font></a><span class="default"></span>
<a name="3649"><font size=-1>3649     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byRef(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3650"><font size=-1>3650     </font></a><span class="default">        byRef(tok, tokenlist, errorLogger, settings, [](</span><span class="keyword">const </span><span class="default">Token *) {</span>
<a name="3651"><font size=-1>3651     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3652"><font size=-1>3652     </font></a><span class="default">        });</span>
<a name="3653"><font size=-1>3653     </font></a><span class="default">    }</span>
<a name="3654"><font size=-1>3654     </font></a><span class="default"></span>
<a name="3655"><font size=-1>3655     </font></a><span class="default">    </span><span class="keyword">template </span><span class="default">&lt;</span><span class="keyword">class </span><span class="default">Predicate&gt;</span>
<a name="3656"><font size=-1>3656     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byVal(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings, Predicate pred) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3657"><font size=-1>3657     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; inconclusive)</span>
<a name="3658"><font size=-1>3658     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3659"><font size=-1>3659     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!argtok)</span>
<a name="3660"><font size=-1>3660     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3661"><font size=-1>3661     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(argtok-&gt;values().empty()) {</span>
<a name="3662"><font size=-1>3662     </font></a><span class="default">            ErrorPath er;</span>
<a name="3663"><font size=-1>3663     </font></a><span class="default">            er.emplace_back(argtok, message);</span>
<a name="3664"><font size=-1>3664     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *var = getLifetimeVariable(argtok, er);</span>
<a name="3665"><font size=-1>3665     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;isArgument()) {</span>
<a name="3666"><font size=-1>3666     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="3667"><font size=-1>3667     </font></a><span class="default">                value.valueType = ValueFlow::Value::LIFETIME;</span>
<a name="3668"><font size=-1>3668     </font></a><span class="default">                value.lifetimeScope = ValueFlow::Value::LifetimeScope::Argument;</span>
<a name="3669"><font size=-1>3669     </font></a><span class="default">                value.tokvalue = var-&gt;nameToken();</span>
<a name="3670"><font size=-1>3670     </font></a><span class="default">                value.errorPath = er;</span>
<a name="3671"><font size=-1>3671     </font></a><span class="default">                value.lifetimeKind = type;</span>
<a name="3672"><font size=-1>3672     </font></a><span class="default">                value.setInconclusive(inconclusive);</span>
<a name="3673"><font size=-1>3673     </font></a><span class="default">                </span><span class="comment">// Don't add the value a second time</span>
<a name="3674"><font size=-1>3674     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(std::find(tok-&gt;values().begin(), tok-&gt;values().end(), value) != tok-&gt;values().end())</span>
<a name="3675"><font size=-1>3675     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="3676"><font size=-1>3676     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="3677"><font size=-1>3677     </font></a><span class="default">                valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="3678"><font size=-1>3678     </font></a><span class="default">            }</span>
<a name="3679"><font size=-1>3679     </font></a><span class="default">        }</span>
<a name="3680"><font size=-1>3680     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : argtok-&gt;values()) {</span>
<a name="3681"><font size=-1>3681     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!v.isLifetimeValue())</span>
<a name="3682"><font size=-1>3682     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3683"><font size=-1>3683     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *tok3 = v.tokvalue;</span>
<a name="3684"><font size=-1>3684     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">LifetimeToken&amp; lt : getLifetimeTokens(tok3)) {</span>
<a name="3685"><font size=-1>3685     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; lt.inconclusive)</span>
<a name="3686"><font size=-1>3686     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3687"><font size=-1>3687     </font></a><span class="default">                ErrorPath er = v.errorPath;</span>
<a name="3688"><font size=-1>3688     </font></a><span class="default">                er.insert(er.end(), lt.errorPath.begin(), lt.errorPath.end());</span>
<a name="3689"><font size=-1>3689     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!lt.token)</span>
<a name="3690"><font size=-1>3690     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="3691"><font size=-1>3691     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!pred(lt.token))</span>
<a name="3692"><font size=-1>3692     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="3693"><font size=-1>3693     </font></a><span class="default">                er.emplace_back(argtok, message);</span>
<a name="3694"><font size=-1>3694     </font></a><span class="default">                er.insert(er.end(), errorPath.begin(), errorPath.end());</span>
<a name="3695"><font size=-1>3695     </font></a><span class="default"></span>
<a name="3696"><font size=-1>3696     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="3697"><font size=-1>3697     </font></a><span class="default">                value.valueType = ValueFlow::Value::LIFETIME;</span>
<a name="3698"><font size=-1>3698     </font></a><span class="default">                value.lifetimeScope = v.lifetimeScope;</span>
<a name="3699"><font size=-1>3699     </font></a><span class="default">                value.tokvalue = lt.token;</span>
<a name="3700"><font size=-1>3700     </font></a><span class="default">                value.errorPath = std::move(er);</span>
<a name="3701"><font size=-1>3701     </font></a><span class="default">                value.lifetimeKind = type;</span>
<a name="3702"><font size=-1>3702     </font></a><span class="default">                value.setInconclusive(lt.inconclusive || v.isInconclusive() || inconclusive);</span>
<a name="3703"><font size=-1>3703     </font></a><span class="default">                </span><span class="comment">// Don't add the value a second time</span>
<a name="3704"><font size=-1>3704     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(std::find(tok-&gt;values().begin(), tok-&gt;values().end(), value) != tok-&gt;values().end())</span>
<a name="3705"><font size=-1>3705     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3706"><font size=-1>3706     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="3707"><font size=-1>3707     </font></a><span class="default">                valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="3708"><font size=-1>3708     </font></a><span class="default">            }</span>
<a name="3709"><font size=-1>3709     </font></a><span class="default">        }</span>
<a name="3710"><font size=-1>3710     </font></a><span class="default">    }</span>
<a name="3711"><font size=-1>3711     </font></a><span class="default"></span>
<a name="3712"><font size=-1>3712     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byVal(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3713"><font size=-1>3713     </font></a><span class="default">        byVal(tok, tokenlist, errorLogger, settings, [](</span><span class="keyword">const </span><span class="default">Token *) {</span>
<a name="3714"><font size=-1>3714     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3715"><font size=-1>3715     </font></a><span class="default">        });</span>
<a name="3716"><font size=-1>3716     </font></a><span class="default">    }</span>
<a name="3717"><font size=-1>3717     </font></a><span class="default"></span>
<a name="3718"><font size=-1>3718     </font></a><span class="default">    </span><span class="keyword">template </span><span class="default">&lt;</span><span class="keyword">class </span><span class="default">Predicate&gt;</span>
<a name="3719"><font size=-1>3719     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byDerefCopy(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings, Predicate pred) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3720"><font size=-1>3720     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; inconclusive)</span>
<a name="3721"><font size=-1>3721     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3722"><font size=-1>3722     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!argtok)</span>
<a name="3723"><font size=-1>3723     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3724"><font size=-1>3724     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : argtok-&gt;values()) {</span>
<a name="3725"><font size=-1>3725     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!v.isLifetimeValue())</span>
<a name="3726"><font size=-1>3726     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3727"><font size=-1>3727     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *tok2 = v.tokvalue;</span>
<a name="3728"><font size=-1>3728     </font></a><span class="default">            ErrorPath er = v.errorPath;</span>
<a name="3729"><font size=-1>3729     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *var = getLifetimeVariable(tok2, er);</span>
<a name="3730"><font size=-1>3730     </font></a><span class="default">            er.insert(er.end(), errorPath.begin(), errorPath.end());</span>
<a name="3731"><font size=-1>3731     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="3732"><font size=-1>3732     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3733"><font size=-1>3733     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok3 = tok; tok3 &amp;&amp; tok3 != var-&gt;declEndToken(); tok3 = tok3-&gt;previous()) {</span>
<a name="3734"><font size=-1>3734     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok3-&gt;varId() == var-&gt;declarationId()) {</span>
<a name="3735"><font size=-1>3735     </font></a><span class="default">                    LifetimeStore{tok3, message, type, inconclusive} .byVal(tok, tokenlist, errorLogger, settings, pred);</span>
<a name="3736"><font size=-1>3736     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="3737"><font size=-1>3737     </font></a><span class="default">                }</span>
<a name="3738"><font size=-1>3738     </font></a><span class="default">            }</span>
<a name="3739"><font size=-1>3739     </font></a><span class="default">        }</span>
<a name="3740"><font size=-1>3740     </font></a><span class="default">    }</span>
<a name="3741"><font size=-1>3741     </font></a><span class="default"></span>
<a name="3742"><font size=-1>3742     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">byDerefCopy(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings) </span><span class="keyword">const </span><span class="default">{</span>
<a name="3743"><font size=-1>3743     </font></a><span class="default">        byDerefCopy(tok, tokenlist, errorLogger, settings, [](</span><span class="keyword">const </span><span class="default">Token *) {</span>
<a name="3744"><font size=-1>3744     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3745"><font size=-1>3745     </font></a><span class="default">        });</span>
<a name="3746"><font size=-1>3746     </font></a><span class="default">    }</span>
<a name="3747"><font size=-1>3747     </font></a><span class="default">};</span>
<a name="3748"><font size=-1>3748     </font></a><span class="default"></span>
<a name="3749"><font size=-1>3749     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetimeFunction(Token *tok, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="3750"><font size=-1>3750     </font></a><span class="default">{</span>
<a name="3751"><font size=-1>3751     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%name% (&quot;</span><span class="default">))</span>
<a name="3752"><font size=-1>3752     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3753"><font size=-1>3753     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;std :: ref|cref|tie|front_inserter|back_inserter&quot;</span><span class="default">)) {</span>
<a name="3754"><font size=-1>3754     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *argtok : getArguments(tok)) {</span>
<a name="3755"><font size=-1>3755     </font></a><span class="default">            LifetimeStore{argtok, </span><span class="string">&quot;Passed to '&quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object} .byRef(</span>
<a name="3756"><font size=-1>3756     </font></a><span class="default">                tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="3757"><font size=-1>3757     </font></a><span class="default">        }</span>
<a name="3758"><font size=-1>3758     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;std :: make_tuple|tuple_cat|make_pair|make_reverse_iterator|next|prev|move&quot;</span><span class="default">)) {</span>
<a name="3759"><font size=-1>3759     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *argtok : getArguments(tok)) {</span>
<a name="3760"><font size=-1>3760     </font></a><span class="default">            LifetimeStore{argtok, </span><span class="string">&quot;Passed to '&quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object} .byVal(</span>
<a name="3761"><font size=-1>3761     </font></a><span class="default">                tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="3762"><font size=-1>3762     </font></a><span class="default">        }</span>
<a name="3763"><font size=-1>3763     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;%var% . push_back|push_front|insert|push|assign&quot;</span><span class="default">) &amp;&amp;</span>
<a name="3764"><font size=-1>3764     </font></a><span class="default">               astIsContainer(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">))) {</span>
<a name="3765"><font size=-1>3765     </font></a><span class="default">        Token *vartok = tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">);</span>
<a name="3766"><font size=-1>3766     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; args = getArguments(tok);</span>
<a name="3767"><font size=-1>3767     </font></a><span class="default">        std::size_t n = args.size();</span>
<a name="3768"><font size=-1>3768     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(n &gt; </span><span class="number">1 </span><span class="default">&amp;&amp; Token::typeStr(args[n - </span><span class="number">2</span><span class="default">]) == Token::typeStr(args[n - </span><span class="number">1</span><span class="default">]) &amp;&amp;</span>
<a name="3769"><font size=-1>3769     </font></a><span class="default">            (((astIsIterator(args[n - </span><span class="number">2</span><span class="default">]) &amp;&amp; astIsIterator(args[n - </span><span class="number">1</span><span class="default">])) ||</span>
<a name="3770"><font size=-1>3770     </font></a><span class="default">              (astIsPointer(args[n - </span><span class="number">2</span><span class="default">]) &amp;&amp; astIsPointer(args[n - </span><span class="number">1</span><span class="default">]))))) {</span>
<a name="3771"><font size=-1>3771     </font></a><span class="default">            LifetimeStore{args.back(), </span><span class="string">&quot;Added to container '&quot; </span><span class="default">+ vartok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object} .byDerefCopy(</span>
<a name="3772"><font size=-1>3772     </font></a><span class="default">                vartok, tokenlist, errorLogger, settings);</span>
<a name="3773"><font size=-1>3773     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(!args.empty() &amp;&amp; isLifetimeBorrowed(args.back(), settings)) {</span>
<a name="3774"><font size=-1>3774     </font></a><span class="default">            LifetimeStore{args.back(), </span><span class="string">&quot;Added to container '&quot; </span><span class="default">+ vartok-&gt;str() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object} .byVal(</span>
<a name="3775"><font size=-1>3775     </font></a><span class="default">                vartok, tokenlist, errorLogger, settings);</span>
<a name="3776"><font size=-1>3776     </font></a><span class="default">        }</span>
<a name="3777"><font size=-1>3777     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;function()) {</span>
<a name="3778"><font size=-1>3778     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function *f = tok-&gt;function();</span>
<a name="3779"><font size=-1>3779     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Function::returnsReference(f))</span>
<a name="3780"><font size=-1>3780     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3781"><font size=-1>3781     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; returns = findReturns(f);</span>
<a name="3782"><font size=-1>3782     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">inconclusive = returns.size() &gt; </span><span class="number">1</span><span class="default">;</span>
<a name="3783"><font size=-1>3783     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* returnTok : returns) {</span>
<a name="3784"><font size=-1>3784     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(returnTok == tok)</span>
<a name="3785"><font size=-1>3785     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3786"><font size=-1>3786     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *returnVar = returnTok-&gt;variable();</span>
<a name="3787"><font size=-1>3787     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(returnVar &amp;&amp; returnVar-&gt;isArgument() &amp;&amp; (returnVar-&gt;isConst() || !isVariableChanged(returnVar, settings, tokenlist-&gt;isCPP()))) {</span>
<a name="3788"><font size=-1>3788     </font></a><span class="default">                LifetimeStore ls = LifetimeStore::fromFunctionArg(f, tok, returnVar, tokenlist, errorLogger);</span>
<a name="3789"><font size=-1>3789     </font></a><span class="default">                ls.inconclusive = inconclusive;</span>
<a name="3790"><font size=-1>3790     </font></a><span class="default">                ls.byVal(tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="3791"><font size=-1>3791     </font></a><span class="default">            }</span>
<a name="3792"><font size=-1>3792     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;v : returnTok-&gt;values()) {</span>
<a name="3793"><font size=-1>3793     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!v.isLifetimeValue())</span>
<a name="3794"><font size=-1>3794     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3795"><font size=-1>3795     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!v.tokvalue)</span>
<a name="3796"><font size=-1>3796     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3797"><font size=-1>3797     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable *var = v.tokvalue-&gt;variable();</span>
<a name="3798"><font size=-1>3798     </font></a><span class="default">                LifetimeStore ls = LifetimeStore::fromFunctionArg(f, tok, var, tokenlist, errorLogger);</span>
<a name="3799"><font size=-1>3799     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!ls.argtok)</span>
<a name="3800"><font size=-1>3800     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3801"><font size=-1>3801     </font></a><span class="default">                ls.inconclusive = inconclusive;</span>
<a name="3802"><font size=-1>3802     </font></a><span class="default">                ls.errorPath = v.errorPath;</span>
<a name="3803"><font size=-1>3803     </font></a><span class="default">                ls.errorPath.emplace_front(returnTok, </span><span class="string">&quot;Return &quot; </span><span class="default">+ lifetimeType(returnTok, &amp;v) + </span><span class="string">&quot;.&quot;</span><span class="default">);</span>
<a name="3804"><font size=-1>3804     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;isReference() || var-&gt;isRValueReference()) {</span>
<a name="3805"><font size=-1>3805     </font></a><span class="default">                    ls.byRef(tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="3806"><font size=-1>3806     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(v.isArgumentLifetimeValue()) {</span>
<a name="3807"><font size=-1>3807     </font></a><span class="default">                    ls.byVal(tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="3808"><font size=-1>3808     </font></a><span class="default">                }</span>
<a name="3809"><font size=-1>3809     </font></a><span class="default">            }</span>
<a name="3810"><font size=-1>3810     </font></a><span class="default">        }</span>
<a name="3811"><font size=-1>3811     </font></a><span class="default">    }</span>
<a name="3812"><font size=-1>3812     </font></a><span class="default">}</span>
<a name="3813"><font size=-1>3813     </font></a><span class="default"></span>
<a name="3814"><font size=-1>3814     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetimeConstructor(Token* tok,</span>
<a name="3815"><font size=-1>3815     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type* t,</span>
<a name="3816"><font size=-1>3816     </font></a><span class="default">        TokenList* tokenlist,</span>
<a name="3817"><font size=-1>3817     </font></a><span class="default">        ErrorLogger* errorLogger,</span>
<a name="3818"><font size=-1>3818     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="3819"><font size=-1>3819     </font></a><span class="default">{</span>
<a name="3820"><font size=-1>3820     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!t)</span>
<a name="3821"><font size=-1>3821     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3822"><font size=-1>3822     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;(|{&quot;</span><span class="default">))</span>
<a name="3823"><font size=-1>3823     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3824"><font size=-1>3824     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Scope* scope = t-&gt;classScope;</span>
<a name="3825"><font size=-1>3825     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="3826"><font size=-1>3826     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3827"><font size=-1>3827     </font></a><span class="default">    </span><span class="comment">// Only support aggregate constructors for now</span>
<a name="3828"><font size=-1>3828     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(scope-&gt;numConstructors == </span><span class="number">0 </span><span class="default">&amp;&amp; t-&gt;derivedFrom.empty() &amp;&amp; (t-&gt;isClassType() || t-&gt;isStructType())) {</span>
<a name="3829"><font size=-1>3829     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; args = getArguments(tok);</span>
<a name="3830"><font size=-1>3830     </font></a><span class="default">        std::size_t i = </span><span class="number">0</span><span class="default">;</span>
<a name="3831"><font size=-1>3831     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable&amp; var : scope-&gt;varlist) {</span>
<a name="3832"><font size=-1>3832     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(i &gt;= args.size())</span>
<a name="3833"><font size=-1>3833     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="3834"><font size=-1>3834     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* argtok = args[i];</span>
<a name="3835"><font size=-1>3835     </font></a><span class="default">            LifetimeStore ls{</span>
<a name="3836"><font size=-1>3836     </font></a><span class="default">                argtok, </span><span class="string">&quot;Passed to constructor of '&quot; </span><span class="default">+ t-&gt;name() + </span><span class="string">&quot;'.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object};</span>
<a name="3837"><font size=-1>3837     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var.isReference() || var.isRValueReference()) {</span>
<a name="3838"><font size=-1>3838     </font></a><span class="default">                ls.byRef(tok, tokenlist, errorLogger, settings);</span>
<a name="3839"><font size=-1>3839     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="3840"><font size=-1>3840     </font></a><span class="default">                ls.byVal(tok, tokenlist, errorLogger, settings);</span>
<a name="3841"><font size=-1>3841     </font></a><span class="default">            }</span>
<a name="3842"><font size=-1>3842     </font></a><span class="default">            i++;</span>
<a name="3843"><font size=-1>3843     </font></a><span class="default">        }</span>
<a name="3844"><font size=-1>3844     </font></a><span class="default">    }</span>
<a name="3845"><font size=-1>3845     </font></a><span class="default">}</span>
<a name="3846"><font size=-1>3846     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetimeConstructor(Token* tok, TokenList* tokenlist, ErrorLogger* errorLogger, </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="3847"><font size=-1>3847     </font></a><span class="default">{</span>
<a name="3848"><font size=-1>3848     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;(|{&quot;</span><span class="default">))</span>
<a name="3849"><font size=-1>3849     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="3850"><font size=-1>3850     </font></a><span class="default">    Token* parent = tok-&gt;astParent();</span>
<a name="3851"><font size=-1>3851     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(Token::simpleMatch(parent, </span><span class="string">&quot;,&quot;</span><span class="default">))</span>
<a name="3852"><font size=-1>3852     </font></a><span class="default">        parent = parent-&gt;astParent();</span>
<a name="3853"><font size=-1>3853     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(parent, </span><span class="string">&quot;{&quot;</span><span class="default">) &amp;&amp; (astIsContainer(parent-&gt;astParent()) || astIsPointer(parent-&gt;astParent()))) {</span>
<a name="3854"><font size=-1>3854     </font></a><span class="default">        valueFlowLifetimeConstructor(tok, Token::typeOf(parent-&gt;previous()), tokenlist, errorLogger, settings);</span>
<a name="3855"><font size=-1>3855     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;{&quot;</span><span class="default">) &amp;&amp; (astIsContainer(parent) || astIsPointer(parent))) {</span>
<a name="3856"><font size=-1>3856     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; args = getArguments(tok);</span>
<a name="3857"><font size=-1>3857     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *argtok : args) {</span>
<a name="3858"><font size=-1>3858     </font></a><span class="default">            LifetimeStore ls{argtok, </span><span class="string">&quot;Passed to initializer list.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object};</span>
<a name="3859"><font size=-1>3859     </font></a><span class="default">            ls.byVal(tok, tokenlist, errorLogger, settings);</span>
<a name="3860"><font size=-1>3860     </font></a><span class="default">        }</span>
<a name="3861"><font size=-1>3861     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type* t = Token::typeOf(tok-&gt;previous())) {</span>
<a name="3862"><font size=-1>3862     </font></a><span class="default">        valueFlowLifetimeConstructor(tok, t, tokenlist, errorLogger, settings);</span>
<a name="3863"><font size=-1>3863     </font></a><span class="default">    }</span>
<a name="3864"><font size=-1>3864     </font></a><span class="default">}</span>
<a name="3865"><font size=-1>3865     </font></a><span class="default"></span>
<a name="3866"><font size=-1>3866     </font></a><span class="default"></span><span class="keyword">struct </span><span class="default">Lambda {</span>
<a name="3867"><font size=-1>3867     </font></a><span class="default">    </span><span class="keyword">explicit </span><span class="default">Lambda(</span><span class="keyword">const </span><span class="default">Token * tok)</span>
<a name="3868"><font size=-1>3868     </font></a><span class="default">        : capture(nullptr), arguments(nullptr), returnTok(nullptr), bodyTok(nullptr) {</span>
<a name="3869"><font size=-1>3869     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;[&quot;</span><span class="default">) || !tok-&gt;link())</span>
<a name="3870"><font size=-1>3870     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="3871"><font size=-1>3871     </font></a><span class="default">        capture = tok;</span>
<a name="3872"><font size=-1>3872     </font></a><span class="default"></span>
<a name="3873"><font size=-1>3873     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(capture-&gt;link(), </span><span class="string">&quot;] (&quot;</span><span class="default">)) {</span>
<a name="3874"><font size=-1>3874     </font></a><span class="default">            arguments = capture-&gt;link()-&gt;next();</span>
<a name="3875"><font size=-1>3875     </font></a><span class="default">        }</span>
<a name="3876"><font size=-1>3876     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * afterArguments = arguments ? arguments-&gt;link()-&gt;next() : capture-&gt;link()-&gt;next();</span>
<a name="3877"><font size=-1>3877     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(afterArguments &amp;&amp; afterArguments-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot;</span><span class="default">) {</span>
<a name="3878"><font size=-1>3878     </font></a><span class="default">            returnTok = afterArguments-&gt;next();</span>
<a name="3879"><font size=-1>3879     </font></a><span class="default">            bodyTok = Token::findsimplematch(returnTok, </span><span class="string">&quot;{&quot;</span><span class="default">);</span>
<a name="3880"><font size=-1>3880     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(afterArguments, </span><span class="string">&quot;{&quot;</span><span class="default">)) {</span>
<a name="3881"><font size=-1>3881     </font></a><span class="default">            bodyTok = afterArguments;</span>
<a name="3882"><font size=-1>3882     </font></a><span class="default">        }</span>
<a name="3883"><font size=-1>3883     </font></a><span class="default">    }</span>
<a name="3884"><font size=-1>3884     </font></a><span class="default"></span>
<a name="3885"><font size=-1>3885     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * capture;</span>
<a name="3886"><font size=-1>3886     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * arguments;</span>
<a name="3887"><font size=-1>3887     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * returnTok;</span>
<a name="3888"><font size=-1>3888     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * bodyTok;</span>
<a name="3889"><font size=-1>3889     </font></a><span class="default"></span>
<a name="3890"><font size=-1>3890     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">isLambda() </span><span class="keyword">const </span><span class="default">{</span>
<a name="3891"><font size=-1>3891     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">capture &amp;&amp; bodyTok;</span>
<a name="3892"><font size=-1>3892     </font></a><span class="default">    }</span>
<a name="3893"><font size=-1>3893     </font></a><span class="default">};</span>
<a name="3894"><font size=-1>3894     </font></a><span class="default"></span>
<a name="3895"><font size=-1>3895     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isDecayedPointer(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="3896"><font size=-1>3896     </font></a><span class="default">{</span>
<a name="3897"><font size=-1>3897     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="3898"><font size=-1>3898     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3899"><font size=-1>3899     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(astIsPointer(tok-&gt;astParent()) &amp;&amp; !Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;return&quot;</span><span class="default">))</span>
<a name="3900"><font size=-1>3900     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3901"><font size=-1>3901     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;%cop%&quot;</span><span class="default">))</span>
<a name="3902"><font size=-1>3902     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3903"><font size=-1>3903     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;return&quot;</span><span class="default">))</span>
<a name="3904"><font size=-1>3904     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3905"><font size=-1>3905     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope())</span>
<a name="3906"><font size=-1>3906     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3907"><font size=-1>3907     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope()-&gt;function)</span>
<a name="3908"><font size=-1>3908     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3909"><font size=-1>3909     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope()-&gt;function-&gt;retDef)</span>
<a name="3910"><font size=-1>3910     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3911"><font size=-1>3911     </font></a><span class="default">    </span><span class="comment">// TODO: Add valuetypes to return types of functions</span>
<a name="3912"><font size=-1>3912     </font></a><span class="comment">    </span><span class="default">ValueType vt = ValueType::parseDecl(tok-&gt;scope()-&gt;function-&gt;retDef, settings);</span>
<a name="3913"><font size=-1>3913     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(vt.pointer &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="3914"><font size=-1>3914     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3915"><font size=-1>3915     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3916"><font size=-1>3916     </font></a><span class="default">}</span>
<a name="3917"><font size=-1>3917     </font></a><span class="default"></span>
<a name="3918"><font size=-1>3918     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLifetime(TokenList *tokenlist, SymbolDatabase*, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="3919"><font size=-1>3919     </font></a><span class="default">{</span>
<a name="3920"><font size=-1>3920     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="3921"><font size=-1>3921     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope())</span>
<a name="3922"><font size=-1>3922     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3923"><font size=-1>3923     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;scope()-&gt;type == Scope::eGlobal)</span>
<a name="3924"><font size=-1>3924     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3925"><font size=-1>3925     </font></a><span class="default">        Lambda lam(tok);</span>
<a name="3926"><font size=-1>3926     </font></a><span class="default">        </span><span class="comment">// Lamdas</span>
<a name="3927"><font size=-1>3927     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(lam.isLambda()) {</span>
<a name="3928"><font size=-1>3928     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope * bodyScope = lam.bodyTok-&gt;scope();</span>
<a name="3929"><font size=-1>3929     </font></a><span class="default"></span>
<a name="3930"><font size=-1>3930     </font></a><span class="default">            std::set&lt;</span><span class="keyword">const </span><span class="default">Scope *&gt; scopes;</span>
<a name="3931"><font size=-1>3931     </font></a><span class="default"></span>
<a name="3932"><font size=-1>3932     </font></a><span class="default">            </span><span class="keyword">auto </span><span class="default">isCapturingVariable = [&amp;](</span><span class="keyword">const </span><span class="default">Token *varTok) {</span>
<a name="3933"><font size=-1>3933     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable *var = varTok-&gt;variable();</span>
<a name="3934"><font size=-1>3934     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="3935"><font size=-1>3935     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3936"><font size=-1>3936     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Scope *scope = var-&gt;scope();</span>
<a name="3937"><font size=-1>3937     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="3938"><font size=-1>3938     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3939"><font size=-1>3939     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(scopes.count(scope) &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="3940"><font size=-1>3940     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3941"><font size=-1>3941     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(scope-&gt;isNestedIn(bodyScope))</span>
<a name="3942"><font size=-1>3942     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="3943"><font size=-1>3943     </font></a><span class="default">                scopes.insert(scope);</span>
<a name="3944"><font size=-1>3944     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="3945"><font size=-1>3945     </font></a><span class="default">            };</span>
<a name="3946"><font size=-1>3946     </font></a><span class="default"></span>
<a name="3947"><font size=-1>3947     </font></a><span class="default">            </span><span class="comment">// TODO: Handle explicit capture</span>
<a name="3948"><font size=-1>3948     </font></a><span class="comment">            </span><span class="keyword">bool </span><span class="default">captureByRef = Token::Match(lam.capture, </span><span class="string">&quot;[ &amp; ]&quot;</span><span class="default">);</span>
<a name="3949"><font size=-1>3949     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">captureByValue = Token::Match(lam.capture, </span><span class="string">&quot;[ = ]&quot;</span><span class="default">);</span>
<a name="3950"><font size=-1>3950     </font></a><span class="default"></span>
<a name="3951"><font size=-1>3951     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token * tok2 = lam.bodyTok; tok2 != lam.bodyTok-&gt;link(); tok2 = tok2-&gt;next()) {</span>
<a name="3952"><font size=-1>3952     </font></a><span class="default">                ErrorPath errorPath;</span>
<a name="3953"><font size=-1>3953     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(captureByRef) {</span>
<a name="3954"><font size=-1>3954     </font></a><span class="default">                    LifetimeStore{tok2, </span><span class="string">&quot;Lambda captures variable by reference here.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Lambda} .byRef(</span>
<a name="3955"><font size=-1>3955     </font></a><span class="default">                        tok, tokenlist, errorLogger, settings, isCapturingVariable);</span>
<a name="3956"><font size=-1>3956     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(captureByValue) {</span>
<a name="3957"><font size=-1>3957     </font></a><span class="default">                    LifetimeStore{tok2, </span><span class="string">&quot;Lambda captures variable by value here.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Lambda} .byVal(</span>
<a name="3958"><font size=-1>3958     </font></a><span class="default">                        tok, tokenlist, errorLogger, settings, isCapturingVariable);</span>
<a name="3959"><font size=-1>3959     </font></a><span class="default">                }</span>
<a name="3960"><font size=-1>3960     </font></a><span class="default">            }</span>
<a name="3961"><font size=-1>3961     </font></a><span class="default">        }</span>
<a name="3962"><font size=-1>3962     </font></a><span class="default">        </span><span class="comment">// address of</span>
<a name="3963"><font size=-1>3963     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(tok-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">)) {</span>
<a name="3964"><font size=-1>3964     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">LifetimeToken&amp; lt : getLifetimeTokens(tok-&gt;astOperand1())) {</span>
<a name="3965"><font size=-1>3965     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!settings-&gt;inconclusive &amp;&amp; lt.inconclusive)</span>
<a name="3966"><font size=-1>3966     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3967"><font size=-1>3967     </font></a><span class="default">                ErrorPath errorPath = lt.errorPath;</span>
<a name="3968"><font size=-1>3968     </font></a><span class="default">                errorPath.emplace_back(tok, </span><span class="string">&quot;Address of variable taken here.&quot;</span><span class="default">);</span>
<a name="3969"><font size=-1>3969     </font></a><span class="default"></span>
<a name="3970"><font size=-1>3970     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="3971"><font size=-1>3971     </font></a><span class="default">                value.valueType = ValueFlow::Value::ValueType::LIFETIME;</span>
<a name="3972"><font size=-1>3972     </font></a><span class="default">                value.lifetimeScope = ValueFlow::Value::LifetimeScope::Local;</span>
<a name="3973"><font size=-1>3973     </font></a><span class="default">                value.tokvalue = lt.token;</span>
<a name="3974"><font size=-1>3974     </font></a><span class="default">                value.errorPath = std::move(errorPath);</span>
<a name="3975"><font size=-1>3975     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(astIsPointer(lt.token) || !Token::Match(lt.token-&gt;astParent(), </span><span class="string">&quot;.|[&quot;</span><span class="default">))</span>
<a name="3976"><font size=-1>3976     </font></a><span class="default">                    value.lifetimeKind = ValueFlow::Value::LifetimeKind::Address;</span>
<a name="3977"><font size=-1>3977     </font></a><span class="default">                value.setInconclusive(lt.inconclusive);</span>
<a name="3978"><font size=-1>3978     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="3979"><font size=-1>3979     </font></a><span class="default"></span>
<a name="3980"><font size=-1>3980     </font></a><span class="default">                valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="3981"><font size=-1>3981     </font></a><span class="default">            }</span>
<a name="3982"><font size=-1>3982     </font></a><span class="default">        }</span>
<a name="3983"><font size=-1>3983     </font></a><span class="default">        </span><span class="comment">// container lifetimes</span>
<a name="3984"><font size=-1>3984     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(astIsContainer(tok)) {</span>
<a name="3985"><font size=-1>3985     </font></a><span class="default">            Token * parent = astParentSkipParens(tok);</span>
<a name="3986"><font size=-1>3986     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::Match(parent, </span><span class="string">&quot;. %name% (&quot;</span><span class="default">))</span>
<a name="3987"><font size=-1>3987     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="3988"><font size=-1>3988     </font></a><span class="default"></span>
<a name="3989"><font size=-1>3989     </font></a><span class="default">            LifetimeStore ls;</span>
<a name="3990"><font size=-1>3990     </font></a><span class="default"></span>
<a name="3991"><font size=-1>3991     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(astIsIterator(parent-&gt;tokAt(</span><span class="number">2</span><span class="default">)))</span>
<a name="3992"><font size=-1>3992     </font></a><span class="default">                ls = LifetimeStore{tok, </span><span class="string">&quot;Iterator to container is created here.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Iterator};</span>
<a name="3993"><font size=-1>3993     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(astIsPointer(parent-&gt;tokAt(</span><span class="number">2</span><span class="default">)) || Token::Match(parent-&gt;next(), </span><span class="string">&quot;data|c_str&quot;</span><span class="default">))</span>
<a name="3994"><font size=-1>3994     </font></a><span class="default">                ls = LifetimeStore{tok, </span><span class="string">&quot;Pointer to container is created here.&quot;</span><span class="default">, ValueFlow::Value::LifetimeKind::Object};</span>
<a name="3995"><font size=-1>3995     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="3996"><font size=-1>3996     </font></a><span class="keyword">                continue</span><span class="default">;</span>
<a name="3997"><font size=-1>3997     </font></a><span class="default"></span>
<a name="3998"><font size=-1>3998     </font></a><span class="default">            </span><span class="comment">// Dereferencing</span>
<a name="3999"><font size=-1>3999     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok-&gt;isUnaryOp(</span><span class="string">&quot;*&quot;</span><span class="default">) || parent-&gt;originalName() == </span><span class="string">&quot;-&gt;&quot;</span><span class="default">)</span>
<a name="4000"><font size=-1>4000     </font></a><span class="default">                ls.byDerefCopy(parent-&gt;tokAt(</span><span class="number">2</span><span class="default">), tokenlist, errorLogger, settings);</span>
<a name="4001"><font size=-1>4001     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="4002"><font size=-1>4002     </font></a><span class="keyword">                </span><span class="default">ls.byRef(parent-&gt;tokAt(</span><span class="number">2</span><span class="default">), tokenlist, errorLogger, settings);</span>
<a name="4003"><font size=-1>4003     </font></a><span class="default"></span>
<a name="4004"><font size=-1>4004     </font></a><span class="default">        }</span>
<a name="4005"><font size=-1>4005     </font></a><span class="default">        </span><span class="comment">// Check constructors</span>
<a name="4006"><font size=-1>4006     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;=|return|%type%|%var% {&quot;</span><span class="default">)) {</span>
<a name="4007"><font size=-1>4007     </font></a><span class="default">            valueFlowLifetimeConstructor(tok-&gt;next(), tokenlist, errorLogger, settings);</span>
<a name="4008"><font size=-1>4008     </font></a><span class="default">        }</span>
<a name="4009"><font size=-1>4009     </font></a><span class="default">        </span><span class="comment">// Check function calls</span>
<a name="4010"><font size=-1>4010     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) {</span>
<a name="4011"><font size=-1>4011     </font></a><span class="default">            valueFlowLifetimeFunction(tok, tokenlist, errorLogger, settings);</span>
<a name="4012"><font size=-1>4012     </font></a><span class="default">        }</span>
<a name="4013"><font size=-1>4013     </font></a><span class="default">        </span><span class="comment">// Check variables</span>
<a name="4014"><font size=-1>4014     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(tok-&gt;variable()) {</span>
<a name="4015"><font size=-1>4015     </font></a><span class="default">            ErrorPath errorPath;</span>
<a name="4016"><font size=-1>4016     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable * var = getLifetimeVariable(tok, errorPath);</span>
<a name="4017"><font size=-1>4017     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="4018"><font size=-1>4018     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4019"><font size=-1>4019     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var-&gt;nameToken() == tok)</span>
<a name="4020"><font size=-1>4020     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4021"><font size=-1>4021     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var-&gt;isArray() &amp;&amp; !var-&gt;isStlType() &amp;&amp; !var-&gt;isArgument() &amp;&amp; isDecayedPointer(tok, settings)) {</span>
<a name="4022"><font size=-1>4022     </font></a><span class="default">                errorPath.emplace_back(tok, </span><span class="string">&quot;Array decayed to pointer here.&quot;</span><span class="default">);</span>
<a name="4023"><font size=-1>4023     </font></a><span class="default"></span>
<a name="4024"><font size=-1>4024     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="4025"><font size=-1>4025     </font></a><span class="default">                value.valueType = ValueFlow::Value::ValueType::LIFETIME;</span>
<a name="4026"><font size=-1>4026     </font></a><span class="default">                value.lifetimeScope = ValueFlow::Value::LifetimeScope::Local;</span>
<a name="4027"><font size=-1>4027     </font></a><span class="default">                value.tokvalue = var-&gt;nameToken();</span>
<a name="4028"><font size=-1>4028     </font></a><span class="default">                value.errorPath = errorPath;</span>
<a name="4029"><font size=-1>4029     </font></a><span class="default">                setTokenValue(tok, value, tokenlist-&gt;getSettings());</span>
<a name="4030"><font size=-1>4030     </font></a><span class="default"></span>
<a name="4031"><font size=-1>4031     </font></a><span class="default">                valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="4032"><font size=-1>4032     </font></a><span class="default">            }</span>
<a name="4033"><font size=-1>4033     </font></a><span class="default">        }</span>
<a name="4034"><font size=-1>4034     </font></a><span class="default">    }</span>
<a name="4035"><font size=-1>4035     </font></a><span class="default">}</span>
<a name="4036"><font size=-1>4036     </font></a><span class="default"></span>
<a name="4037"><font size=-1>4037     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isStdMoveOrStdForwarded(Token * tok, ValueFlow::Value::MoveKind * moveKind, Token ** varTok = nullptr)</span>
<a name="4038"><font size=-1>4038     </font></a><span class="default">{</span>
<a name="4039"><font size=-1>4039     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;std&quot;</span><span class="default">)</span>
<a name="4040"><font size=-1>4040     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4041"><font size=-1>4041     </font></a><span class="default">    ValueFlow::Value::MoveKind kind = ValueFlow::Value::MoveKind::NonMovedVariable;</span>
<a name="4042"><font size=-1>4042     </font></a><span class="default">    Token * variableToken = nullptr;</span>
<a name="4043"><font size=-1>4043     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;std :: move ( %var% )&quot;</span><span class="default">)) {</span>
<a name="4044"><font size=-1>4044     </font></a><span class="default">        variableToken = tok-&gt;tokAt(</span><span class="number">4</span><span class="default">);</span>
<a name="4045"><font size=-1>4045     </font></a><span class="default">        kind = ValueFlow::Value::MoveKind::MovedVariable;</span>
<a name="4046"><font size=-1>4046     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;std :: forward &lt;&quot;</span><span class="default">)) {</span>
<a name="4047"><font size=-1>4047     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">leftAngle = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="4048"><font size=-1>4048     </font></a><span class="default">        Token * rightAngle = leftAngle-&gt;link();</span>
<a name="4049"><font size=-1>4049     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(rightAngle, </span><span class="string">&quot;&gt; ( %var% )&quot;</span><span class="default">)) {</span>
<a name="4050"><font size=-1>4050     </font></a><span class="default">            variableToken = rightAngle-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="4051"><font size=-1>4051     </font></a><span class="default">            kind = ValueFlow::Value::MoveKind::ForwardedVariable;</span>
<a name="4052"><font size=-1>4052     </font></a><span class="default">        }</span>
<a name="4053"><font size=-1>4053     </font></a><span class="default">    }</span>
<a name="4054"><font size=-1>4054     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!variableToken)</span>
<a name="4055"><font size=-1>4055     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4056"><font size=-1>4056     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(variableToken-&gt;strAt(</span><span class="number">2</span><span class="default">) == </span><span class="string">&quot;.&quot;</span><span class="default">) </span><span class="comment">// Only partially moved</span>
<a name="4057"><font size=-1>4057     </font></a><span class="comment">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4058"><font size=-1>4058     </font></a><span class="default"></span>
<a name="4059"><font size=-1>4059     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(moveKind != nullptr)</span>
<a name="4060"><font size=-1>4060     </font></a><span class="default">        *moveKind = kind;</span>
<a name="4061"><font size=-1>4061     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(varTok != nullptr)</span>
<a name="4062"><font size=-1>4062     </font></a><span class="default">        *varTok = variableToken;</span>
<a name="4063"><font size=-1>4063     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="4064"><font size=-1>4064     </font></a><span class="default">}</span>
<a name="4065"><font size=-1>4065     </font></a><span class="default"></span>
<a name="4066"><font size=-1>4066     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isOpenParenthesisMemberFunctionCallOfVarId(</span><span class="keyword">const </span><span class="default">Token * openParenthesisToken, nonneg </span><span class="keyword">int </span><span class="default">varId)</span>
<a name="4067"><font size=-1>4067     </font></a><span class="default">{</span>
<a name="4068"><font size=-1>4068     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * varTok = openParenthesisToken-&gt;tokAt(-</span><span class="number">3</span><span class="default">);</span>
<a name="4069"><font size=-1>4069     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">Token::Match(varTok, </span><span class="string">&quot;%varid% . %name% (&quot;</span><span class="default">, varId) &amp;&amp;</span>
<a name="4070"><font size=-1>4070     </font></a><span class="default">           varTok-&gt;next()-&gt;originalName() == emptyString;</span>
<a name="4071"><font size=-1>4071     </font></a><span class="default">}</span>
<a name="4072"><font size=-1>4072     </font></a><span class="default"></span>
<a name="4073"><font size=-1>4073     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token * findOpenParentesisOfMove(</span><span class="keyword">const </span><span class="default">Token * moveVarTok)</span>
<a name="4074"><font size=-1>4074     </font></a><span class="default">{</span>
<a name="4075"><font size=-1>4075     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * tok = moveVarTok;</span>
<a name="4076"><font size=-1>4076     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(tok &amp;&amp; tok-&gt;str() != </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="4077"><font size=-1>4077     </font></a><span class="default">        tok = tok-&gt;previous();</span>
<a name="4078"><font size=-1>4078     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">tok;</span>
<a name="4079"><font size=-1>4079     </font></a><span class="default">}</span>
<a name="4080"><font size=-1>4080     </font></a><span class="default"></span>
<a name="4081"><font size=-1>4081     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">Token * findEndOfFunctionCallForParameter(</span><span class="keyword">const </span><span class="default">Token * parameterToken)</span>
<a name="4082"><font size=-1>4082     </font></a><span class="default">{</span>
<a name="4083"><font size=-1>4083     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!parameterToken)</span>
<a name="4084"><font size=-1>4084     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="4085"><font size=-1>4085     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * parent = parameterToken-&gt;astParent();</span>
<a name="4086"><font size=-1>4086     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; !parent-&gt;isOp() &amp;&amp; parent-&gt;str() != </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="4087"><font size=-1>4087     </font></a><span class="default">        parent = parent-&gt;astParent();</span>
<a name="4088"><font size=-1>4088     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!parent)</span>
<a name="4089"><font size=-1>4089     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="4090"><font size=-1>4090     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nextAfterAstRightmostLeaf(parent);</span>
<a name="4091"><font size=-1>4091     </font></a><span class="default">}</span>
<a name="4092"><font size=-1>4092     </font></a><span class="default"></span>
<a name="4093"><font size=-1>4093     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowAfterMove(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="4094"><font size=-1>4094     </font></a><span class="default">{</span>
<a name="4095"><font size=-1>4095     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tokenlist-&gt;isCPP() || settings-&gt;standards.cpp &lt; Standards::CPP11)</span>
<a name="4096"><font size=-1>4096     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="4097"><font size=-1>4097     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : symboldatabase-&gt;functionScopes) {</span>
<a name="4098"><font size=-1>4098     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="4099"><font size=-1>4099     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4100"><font size=-1>4100     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token * start = scope-&gt;bodyStart;</span>
<a name="4101"><font size=-1>4101     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope-&gt;function) {</span>
<a name="4102"><font size=-1>4102     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * memberInitializationTok = scope-&gt;function-&gt;constructorMemberInitialization();</span>
<a name="4103"><font size=-1>4103     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(memberInitializationTok)</span>
<a name="4104"><font size=-1>4104     </font></a><span class="default">                start = memberInitializationTok;</span>
<a name="4105"><font size=-1>4105     </font></a><span class="default">        }</span>
<a name="4106"><font size=-1>4106     </font></a><span class="default"></span>
<a name="4107"><font size=-1>4107     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Token* tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(start); tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="4108"><font size=-1>4108     </font></a><span class="default">            Token * varTok;</span>
<a name="4109"><font size=-1>4109     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% . reset|clear (&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;originalName() == emptyString) {</span>
<a name="4110"><font size=-1>4110     </font></a><span class="default">                varTok = tok;</span>
<a name="4111"><font size=-1>4111     </font></a><span class="default">                ValueFlow::Value value;</span>
<a name="4112"><font size=-1>4112     </font></a><span class="default">                value.valueType = ValueFlow::Value::ValueType::MOVED;</span>
<a name="4113"><font size=-1>4113     </font></a><span class="default">                value.moveKind = ValueFlow::Value::MoveKind::NonMovedVariable;</span>
<a name="4114"><font size=-1>4114     </font></a><span class="default">                value.errorPath.emplace_back(tok, </span><span class="string">&quot;Calling &quot; </span><span class="default">+ tok-&gt;next()-&gt;expressionString() + </span><span class="string">&quot; makes &quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot; 'non-moved'&quot;</span><span class="default">);</span>
<a name="4115"><font size=-1>4115     </font></a><span class="default">                value.setKnown();</span>
<a name="4116"><font size=-1>4116     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="4117"><font size=-1>4117     </font></a><span class="default">                values.push_back(value);</span>
<a name="4118"><font size=-1>4118     </font></a><span class="default"></span>
<a name="4119"><font size=-1>4119     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable *var = varTok-&gt;variable();</span>
<a name="4120"><font size=-1>4120     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var || (!var-&gt;isLocal() &amp;&amp; !var-&gt;isArgument()))</span>
<a name="4121"><font size=-1>4121     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4122"><font size=-1>4122     </font></a><span class="default">                </span><span class="keyword">const int </span><span class="default">varId = varTok-&gt;varId();</span>
<a name="4123"><font size=-1>4123     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">endOfVarScope = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="4124"><font size=-1>4124     </font></a><span class="default">                setTokenValue(varTok, value, settings);</span>
<a name="4125"><font size=-1>4125     </font></a><span class="default">                valueFlowForwardVariable(</span>
<a name="4126"><font size=-1>4126     </font></a><span class="default">                    varTok-&gt;next(), endOfVarScope, var, varId, values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="4127"><font size=-1>4127     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4128"><font size=-1>4128     </font></a><span class="default">            }</span>
<a name="4129"><font size=-1>4129     </font></a><span class="default">            ValueFlow::Value::MoveKind moveKind;</span>
<a name="4130"><font size=-1>4130     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isStdMoveOrStdForwarded(tok, &amp;moveKind, &amp;varTok))</span>
<a name="4131"><font size=-1>4131     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4132"><font size=-1>4132     </font></a><span class="default">            </span><span class="keyword">const int </span><span class="default">varId = varTok-&gt;varId();</span>
<a name="4133"><font size=-1>4133     </font></a><span class="default">            </span><span class="comment">// x is not MOVED after assignment if code is:  x = ... std::move(x) .. ;</span>
<a name="4134"><font size=-1>4134     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token *parent = tok-&gt;astParent();</span>
<a name="4135"><font size=-1>4135     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; parent-&gt;str() != </span><span class="string">&quot;=&quot; </span><span class="default">&amp;&amp; parent-&gt;str() != </span><span class="string">&quot;return&quot; </span><span class="default">&amp;&amp;</span>
<a name="4136"><font size=-1>4136     </font></a><span class="default">                   !(parent-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; isOpenParenthesisMemberFunctionCallOfVarId(parent, varId)))</span>
<a name="4137"><font size=-1>4137     </font></a><span class="default">                parent = parent-&gt;astParent();</span>
<a name="4138"><font size=-1>4138     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(parent &amp;&amp;</span>
<a name="4139"><font size=-1>4139     </font></a><span class="default">                (parent-&gt;str() == </span><span class="string">&quot;return&quot; </span><span class="default">|| </span><span class="comment">// MOVED in return statement</span>
<a name="4140"><font size=-1>4140     </font></a><span class="comment">                 </span><span class="default">parent-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)) </span><span class="comment">// MOVED in self assignment, isOpenParenthesisMemberFunctionCallOfVarId == true</span>
<a name="4141"><font size=-1>4141     </font></a><span class="comment">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4142"><font size=-1>4142     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(parent &amp;&amp; parent-&gt;astOperand1() &amp;&amp; parent-&gt;astOperand1()-&gt;varId() == varId)</span>
<a name="4143"><font size=-1>4143     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4144"><font size=-1>4144     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *var = varTok-&gt;variable();</span>
<a name="4145"><font size=-1>4145     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="4146"><font size=-1>4146     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4147"><font size=-1>4147     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">endOfVarScope = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="4148"><font size=-1>4148     </font></a><span class="default"></span>
<a name="4149"><font size=-1>4149     </font></a><span class="default">            ValueFlow::Value value;</span>
<a name="4150"><font size=-1>4150     </font></a><span class="default">            value.valueType = ValueFlow::Value::ValueType::MOVED;</span>
<a name="4151"><font size=-1>4151     </font></a><span class="default">            value.moveKind = moveKind;</span>
<a name="4152"><font size=-1>4152     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(moveKind == ValueFlow::Value::MoveKind::MovedVariable)</span>
<a name="4153"><font size=-1>4153     </font></a><span class="default">                value.errorPath.emplace_back(tok, </span><span class="string">&quot;Calling std::move(&quot; </span><span class="default">+ varTok-&gt;str() + </span><span class="string">&quot;)&quot;</span><span class="default">);</span>
<a name="4154"><font size=-1>4154     </font></a><span class="default">            </span><span class="keyword">else </span><span class="comment">// if (moveKind == ValueFlow::Value::ForwardedVariable)</span>
<a name="4155"><font size=-1>4155     </font></a><span class="comment">                </span><span class="default">value.errorPath.emplace_back(tok, </span><span class="string">&quot;Calling std::forward(&quot; </span><span class="default">+ varTok-&gt;str() + </span><span class="string">&quot;)&quot;</span><span class="default">);</span>
<a name="4156"><font size=-1>4156     </font></a><span class="default">            value.setKnown();</span>
<a name="4157"><font size=-1>4157     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="4158"><font size=-1>4158     </font></a><span class="default">            values.push_back(value);</span>
<a name="4159"><font size=-1>4159     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * openParentesisOfMove = findOpenParentesisOfMove(varTok);</span>
<a name="4160"><font size=-1>4160     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * endOfFunctionCall = findEndOfFunctionCallForParameter(openParentesisOfMove);</span>
<a name="4161"><font size=-1>4161     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(endOfFunctionCall)</span>
<a name="4162"><font size=-1>4162     </font></a><span class="default">                valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(endOfFunctionCall),</span>
<a name="4163"><font size=-1>4163     </font></a><span class="default">                                         endOfVarScope,</span>
<a name="4164"><font size=-1>4164     </font></a><span class="default">                                         var,</span>
<a name="4165"><font size=-1>4165     </font></a><span class="default">                                         varId,</span>
<a name="4166"><font size=-1>4166     </font></a><span class="default">                                         values,</span>
<a name="4167"><font size=-1>4167     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">,</span>
<a name="4168"><font size=-1>4168     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">,</span>
<a name="4169"><font size=-1>4169     </font></a><span class="default">                                         tokenlist,</span>
<a name="4170"><font size=-1>4170     </font></a><span class="default">                                         errorLogger,</span>
<a name="4171"><font size=-1>4171     </font></a><span class="default">                                         settings);</span>
<a name="4172"><font size=-1>4172     </font></a><span class="default">        }</span>
<a name="4173"><font size=-1>4173     </font></a><span class="default">    }</span>
<a name="4174"><font size=-1>4174     </font></a><span class="default">}</span>
<a name="4175"><font size=-1>4175     </font></a><span class="default"></span>
<a name="4176"><font size=-1>4176     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForwardAssign(Token * </span><span class="keyword">const               </span><span class="default">tok,</span>
<a name="4177"><font size=-1>4177     </font></a><span class="default">                                   </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const      </span><span class="default">var,</span>
<a name="4178"><font size=-1>4178     </font></a><span class="default">                                   std::list&lt;ValueFlow::Value&gt; values,</span>
<a name="4179"><font size=-1>4179     </font></a><span class="default">                                   </span><span class="keyword">const bool                  </span><span class="default">constValue,</span>
<a name="4180"><font size=-1>4180     </font></a><span class="default">                                   </span><span class="keyword">const bool                  </span><span class="default">init,</span>
<a name="4181"><font size=-1>4181     </font></a><span class="default">                                   TokenList * </span><span class="keyword">const           </span><span class="default">tokenlist,</span>
<a name="4182"><font size=-1>4182     </font></a><span class="default">                                   ErrorLogger * </span><span class="keyword">const         </span><span class="default">errorLogger,</span>
<a name="4183"><font size=-1>4183     </font></a><span class="default">                                   </span><span class="keyword">const </span><span class="default">Settings * </span><span class="keyword">const      </span><span class="default">settings)</span>
<a name="4184"><font size=-1>4184     </font></a><span class="default">{</span>
<a name="4185"><font size=-1>4185     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">endOfVarScope = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="4186"><font size=-1>4186     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(std::any_of(values.begin(), values.end(), std::mem_fn(&amp;ValueFlow::Value::isLifetimeValue))) {</span>
<a name="4187"><font size=-1>4187     </font></a><span class="default">        valueFlowForwardLifetime(tok, tokenlist, errorLogger, settings);</span>
<a name="4188"><font size=-1>4188     </font></a><span class="default">        values.remove_if(std::mem_fn(&amp;ValueFlow::Value::isLifetimeValue));</span>
<a name="4189"><font size=-1>4189     </font></a><span class="default">    }</span>
<a name="4190"><font size=-1>4190     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!var-&gt;isPointer() &amp;&amp; !var-&gt;isSmartPointer())</span>
<a name="4191"><font size=-1>4191     </font></a><span class="default">        values.remove_if(std::mem_fn(&amp;ValueFlow::Value::isTokValue));</span>
<a name="4192"><font size=-1>4192     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;astParent()) {</span>
<a name="4193"><font size=-1>4193     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::list&lt;ValueFlow::Value&gt;::iterator it = values.begin(); it != values.end(); ++it) {</span>
<a name="4194"><font size=-1>4194     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::string info = </span><span class="string">&quot;Assignment '&quot; </span><span class="default">+ tok-&gt;astParent()-&gt;expressionString() + </span><span class="string">&quot;', assigned value is &quot; </span><span class="default">+ it-&gt;infoString();</span>
<a name="4195"><font size=-1>4195     </font></a><span class="default">            it-&gt;errorPath.emplace_back(tok, info);</span>
<a name="4196"><font size=-1>4196     </font></a><span class="default">        }</span>
<a name="4197"><font size=-1>4197     </font></a><span class="default">    }</span>
<a name="4198"><font size=-1>4198     </font></a><span class="default"></span>
<a name="4199"><font size=-1>4199     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tokenlist-&gt;isCPP() &amp;&amp; Token::Match(var-&gt;typeStartToken(), </span><span class="string">&quot;bool|_Bool&quot;</span><span class="default">)) {</span>
<a name="4200"><font size=-1>4200     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt;::iterator it;</span>
<a name="4201"><font size=-1>4201     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(it = values.begin(); it != values.end(); ++it) {</span>
<a name="4202"><font size=-1>4202     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(it-&gt;isIntValue())</span>
<a name="4203"><font size=-1>4203     </font></a><span class="default">                it-&gt;intvalue = (it-&gt;intvalue != </span><span class="number">0</span><span class="default">);</span>
<a name="4204"><font size=-1>4204     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(it-&gt;isTokValue())</span>
<a name="4205"><font size=-1>4205     </font></a><span class="default">                it -&gt;intvalue = (it-&gt;tokvalue != nullptr);</span>
<a name="4206"><font size=-1>4206     </font></a><span class="default">        }</span>
<a name="4207"><font size=-1>4207     </font></a><span class="default">    }</span>
<a name="4208"><font size=-1>4208     </font></a><span class="default"></span>
<a name="4209"><font size=-1>4209     </font></a><span class="default">    </span><span class="comment">// Static variable initialisation?</span>
<a name="4210"><font size=-1>4210     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(var-&gt;isStatic() &amp;&amp; init)</span>
<a name="4211"><font size=-1>4211     </font></a><span class="default">        lowerToPossible(values);</span>
<a name="4212"><font size=-1>4212     </font></a><span class="default"></span>
<a name="4213"><font size=-1>4213     </font></a><span class="default">    </span><span class="comment">// Skip RHS</span>
<a name="4214"><font size=-1>4214     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Token * nextExpression = tok-&gt;astParent() ? nextAfterAstRightmostLeaf(tok-&gt;astParent()) : tok-&gt;next();</span>
<a name="4215"><font size=-1>4215     </font></a><span class="default"></span>
<a name="4216"><font size=-1>4216     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(std::any_of(values.begin(), values.end(), std::mem_fn(&amp;ValueFlow::Value::isTokValue))) {</span>
<a name="4217"><font size=-1>4217     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; tokvalues;</span>
<a name="4218"><font size=-1>4218     </font></a><span class="default">        std::copy_if(values.begin(),</span>
<a name="4219"><font size=-1>4219     </font></a><span class="default">                     values.end(),</span>
<a name="4220"><font size=-1>4220     </font></a><span class="default">                     std::back_inserter(tokvalues),</span>
<a name="4221"><font size=-1>4221     </font></a><span class="default">                     std::mem_fn(&amp;ValueFlow::Value::isTokValue));</span>
<a name="4222"><font size=-1>4222     </font></a><span class="default">        valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(nextExpression),</span>
<a name="4223"><font size=-1>4223     </font></a><span class="default">                                 endOfVarScope,</span>
<a name="4224"><font size=-1>4224     </font></a><span class="default">                                 var,</span>
<a name="4225"><font size=-1>4225     </font></a><span class="default">                                 var-&gt;declarationId(),</span>
<a name="4226"><font size=-1>4226     </font></a><span class="default">                                 tokvalues,</span>
<a name="4227"><font size=-1>4227     </font></a><span class="default">                                 constValue,</span>
<a name="4228"><font size=-1>4228     </font></a><span class="default">                                 </span><span class="keyword">false</span><span class="default">,</span>
<a name="4229"><font size=-1>4229     </font></a><span class="default">                                 tokenlist,</span>
<a name="4230"><font size=-1>4230     </font></a><span class="default">                                 errorLogger,</span>
<a name="4231"><font size=-1>4231     </font></a><span class="default">                                 settings);</span>
<a name="4232"><font size=-1>4232     </font></a><span class="default">        values.remove_if(std::mem_fn(&amp;ValueFlow::Value::isTokValue));</span>
<a name="4233"><font size=-1>4233     </font></a><span class="default">    }</span>
<a name="4234"><font size=-1>4234     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(ValueFlow::Value&amp; value:values)</span>
<a name="4235"><font size=-1>4235     </font></a><span class="default">        value.tokvalue = tok;</span>
<a name="4236"><font size=-1>4236     </font></a><span class="default">    valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(nextExpression),</span>
<a name="4237"><font size=-1>4237     </font></a><span class="default">                             endOfVarScope,</span>
<a name="4238"><font size=-1>4238     </font></a><span class="default">                             var,</span>
<a name="4239"><font size=-1>4239     </font></a><span class="default">                             var-&gt;declarationId(),</span>
<a name="4240"><font size=-1>4240     </font></a><span class="default">                             values,</span>
<a name="4241"><font size=-1>4241     </font></a><span class="default">                             constValue,</span>
<a name="4242"><font size=-1>4242     </font></a><span class="default">                             </span><span class="keyword">false</span><span class="default">,</span>
<a name="4243"><font size=-1>4243     </font></a><span class="default">                             tokenlist,</span>
<a name="4244"><font size=-1>4244     </font></a><span class="default">                             errorLogger,</span>
<a name="4245"><font size=-1>4245     </font></a><span class="default">                             settings);</span>
<a name="4246"><font size=-1>4246     </font></a><span class="default">}</span>
<a name="4247"><font size=-1>4247     </font></a><span class="default"></span>
<a name="4248"><font size=-1>4248     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::list&lt;ValueFlow::Value&gt; truncateValues(std::list&lt;ValueFlow::Value&gt; values, </span><span class="keyword">const </span><span class="default">ValueType *valueType, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="4249"><font size=-1>4249     </font></a><span class="default">{</span>
<a name="4250"><font size=-1>4250     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!valueType || !valueType-&gt;isIntegral())</span>
<a name="4251"><font size=-1>4251     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">values;</span>
<a name="4252"><font size=-1>4252     </font></a><span class="default"></span>
<a name="4253"><font size=-1>4253     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">size_t sz = getSizeOf(*valueType, settings);</span>
<a name="4254"><font size=-1>4254     </font></a><span class="default"></span>
<a name="4255"><font size=-1>4255     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(ValueFlow::Value &amp;value : values) {</span>
<a name="4256"><font size=-1>4256     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.isFloatValue()) {</span>
<a name="4257"><font size=-1>4257     </font></a><span class="default">            value.intvalue = value.floatValue;</span>
<a name="4258"><font size=-1>4258     </font></a><span class="default">            value.valueType = ValueFlow::Value::INT;</span>
<a name="4259"><font size=-1>4259     </font></a><span class="default">        }</span>
<a name="4260"><font size=-1>4260     </font></a><span class="default"></span>
<a name="4261"><font size=-1>4261     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.isIntValue() &amp;&amp; sz &gt; </span><span class="number">0 </span><span class="default">&amp;&amp; sz &lt; </span><span class="number">8</span><span class="default">) {</span>
<a name="4262"><font size=-1>4262     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">MathLib::biguint unsignedMaxValue = (</span><span class="number">1ULL </span><span class="default">&lt;&lt; (sz * </span><span class="number">8</span><span class="default">)) - </span><span class="number">1ULL</span><span class="default">;</span>
<a name="4263"><font size=-1>4263     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">MathLib::biguint signBit = </span><span class="number">1ULL </span><span class="default">&lt;&lt; (sz * </span><span class="number">8 </span><span class="default">- </span><span class="number">1</span><span class="default">);</span>
<a name="4264"><font size=-1>4264     </font></a><span class="default">            value.intvalue &amp;= unsignedMaxValue;</span>
<a name="4265"><font size=-1>4265     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(valueType-&gt;sign == ValueType::Sign::SIGNED &amp;&amp; (value.intvalue &amp; signBit))</span>
<a name="4266"><font size=-1>4266     </font></a><span class="default">                value.intvalue |= ~unsignedMaxValue;</span>
<a name="4267"><font size=-1>4267     </font></a><span class="default">        }</span>
<a name="4268"><font size=-1>4268     </font></a><span class="default">    }</span>
<a name="4269"><font size=-1>4269     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">values;</span>
<a name="4270"><font size=-1>4270     </font></a><span class="default">}</span>
<a name="4271"><font size=-1>4271     </font></a><span class="default"></span>
<a name="4272"><font size=-1>4272     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isLiteralNumber(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">bool </span><span class="default">cpp)</span>
<a name="4273"><font size=-1>4273     </font></a><span class="default">{</span>
<a name="4274"><font size=-1>4274     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">tok-&gt;isNumber() || tok-&gt;str() == </span><span class="string">&quot;NULL&quot; </span><span class="default">|| (cpp &amp;&amp; Token::Match(tok, </span><span class="string">&quot;false|true|nullptr&quot;</span><span class="default">));</span>
<a name="4275"><font size=-1>4275     </font></a><span class="default">}</span>
<a name="4276"><font size=-1>4276     </font></a><span class="default"></span>
<a name="4277"><font size=-1>4277     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowAfterAssign(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="4278"><font size=-1>4278     </font></a><span class="default">{</span>
<a name="4279"><font size=-1>4279     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : symboldatabase-&gt;functionScopes) {</span>
<a name="4280"><font size=-1>4280     </font></a><span class="default">        std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; aliased;</span>
<a name="4281"><font size=-1>4281     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Token* tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(scope-&gt;bodyStart); tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="4282"><font size=-1>4282     </font></a><span class="default">            </span><span class="comment">// Alias</span>
<a name="4283"><font size=-1>4283     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(tok-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">)) {</span>
<a name="4284"><font size=-1>4284     </font></a><span class="default">                aliased.insert(tok-&gt;astOperand1()-&gt;varId());</span>
<a name="4285"><font size=-1>4285     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4286"><font size=-1>4286     </font></a><span class="default">            }</span>
<a name="4287"><font size=-1>4287     </font></a><span class="default"></span>
<a name="4288"><font size=-1>4288     </font></a><span class="default">            </span><span class="comment">// Assignment</span>
<a name="4289"><font size=-1>4289     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">((tok-&gt;str() != </span><span class="string">&quot;=&quot;</span><span class="default">) || (tok-&gt;astParent()))</span>
<a name="4290"><font size=-1>4290     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4291"><font size=-1>4291     </font></a><span class="default"></span>
<a name="4292"><font size=-1>4292     </font></a><span class="default">            </span><span class="comment">// Lhs should be a variable</span>
<a name="4293"><font size=-1>4293     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand1() || !tok-&gt;astOperand1()-&gt;varId() || tok-&gt;astOperand1()-&gt;hasKnownValue())</span>
<a name="4294"><font size=-1>4294     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4295"><font size=-1>4295     </font></a><span class="default">            </span><span class="keyword">const int </span><span class="default">varid = tok-&gt;astOperand1()-&gt;varId();</span>
<a name="4296"><font size=-1>4296     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(aliased.find(varid) != aliased.end())</span>
<a name="4297"><font size=-1>4297     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4298"><font size=-1>4298     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable *var = tok-&gt;astOperand1()-&gt;variable();</span>
<a name="4299"><font size=-1>4299     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var || (!var-&gt;isLocal() &amp;&amp; !var-&gt;isGlobal() &amp;&amp; !var-&gt;isArgument()))</span>
<a name="4300"><font size=-1>4300     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4301"><font size=-1>4301     </font></a><span class="default"></span>
<a name="4302"><font size=-1>4302     </font></a><span class="default">            </span><span class="comment">// Rhs values..</span>
<a name="4303"><font size=-1>4303     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand2() || tok-&gt;astOperand2()-&gt;values().empty())</span>
<a name="4304"><font size=-1>4304     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4305"><font size=-1>4305     </font></a><span class="default"></span>
<a name="4306"><font size=-1>4306     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt; values = truncateValues(tok-&gt;astOperand2()-&gt;values(), tok-&gt;astOperand1()-&gt;valueType(), settings);</span>
<a name="4307"><font size=-1>4307     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">constValue = isLiteralNumber(tok-&gt;astOperand2(), tokenlist-&gt;isCPP());</span>
<a name="4308"><font size=-1>4308     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">init = var-&gt;nameToken() == tok-&gt;astOperand1();</span>
<a name="4309"><font size=-1>4309     </font></a><span class="default">            valueFlowForwardAssign(tok-&gt;astOperand2(), var, values, constValue, init, tokenlist, errorLogger, settings);</span>
<a name="4310"><font size=-1>4310     </font></a><span class="default">        }</span>
<a name="4311"><font size=-1>4311     </font></a><span class="default">    }</span>
<a name="4312"><font size=-1>4312     </font></a><span class="default">}</span>
<a name="4313"><font size=-1>4313     </font></a><span class="default"></span>
<a name="4314"><font size=-1>4314     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isConditionKnown(</span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">bool </span><span class="default">then)</span>
<a name="4315"><font size=-1>4315     </font></a><span class="default">{</span>
<a name="4316"><font size=-1>4316     </font></a><span class="default">    </span><span class="keyword">const char </span><span class="default">* op = </span><span class="string">&quot;||&quot;</span><span class="default">;</span>
<a name="4317"><font size=-1>4317     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(then)</span>
<a name="4318"><font size=-1>4318     </font></a><span class="default">        op = </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">;</span>
<a name="4319"><font size=-1>4319     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* parent = tok-&gt;astParent();</span>
<a name="4320"><font size=-1>4320     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; parent-&gt;str() == op)</span>
<a name="4321"><font size=-1>4321     </font></a><span class="default">        parent = parent-&gt;astParent();</span>
<a name="4322"><font size=-1>4322     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">(parent &amp;&amp; parent-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">);</span>
<a name="4323"><font size=-1>4323     </font></a><span class="default">}</span>
<a name="4324"><font size=-1>4324     </font></a><span class="default"></span>
<a name="4325"><font size=-1>4325     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSetConditionToKnown(</span><span class="keyword">const </span><span class="default">Token* tok, std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">bool </span><span class="default">then)</span>
<a name="4326"><font size=-1>4326     </font></a><span class="default">{</span>
<a name="4327"><font size=-1>4327     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="4328"><font size=-1>4328     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="4329"><font size=-1>4329     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(then &amp;&amp; !Token::Match(tok, </span><span class="string">&quot;==|!|(&quot;</span><span class="default">))</span>
<a name="4330"><font size=-1>4330     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="4331"><font size=-1>4331     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!then &amp;&amp; !Token::Match(tok, </span><span class="string">&quot;!=|%var%|(&quot;</span><span class="default">))</span>
<a name="4332"><font size=-1>4332     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="4333"><font size=-1>4333     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(isConditionKnown(tok, then))</span>
<a name="4334"><font size=-1>4334     </font></a><span class="default">        changePossibleToKnown(values);</span>
<a name="4335"><font size=-1>4335     </font></a><span class="default">}</span>
<a name="4336"><font size=-1>4336     </font></a><span class="default"></span>
<a name="4337"><font size=-1>4337     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isBreakScope(</span><span class="keyword">const </span><span class="default">Token* </span><span class="keyword">const </span><span class="default">endToken)</span>
<a name="4338"><font size=-1>4338     </font></a><span class="default">{</span>
<a name="4339"><font size=-1>4339     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(endToken, </span><span class="string">&quot;}&quot;</span><span class="default">))</span>
<a name="4340"><font size=-1>4340     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4341"><font size=-1>4341     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(endToken-&gt;link(), </span><span class="string">&quot;{&quot;</span><span class="default">))</span>
<a name="4342"><font size=-1>4342     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4343"><font size=-1>4343     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">Token::findmatch(endToken-&gt;link(), </span><span class="string">&quot;break|goto&quot;</span><span class="default">, endToken);</span>
<a name="4344"><font size=-1>4344     </font></a><span class="default">}</span>
<a name="4345"><font size=-1>4345     </font></a><span class="default"></span>
<a name="4346"><font size=-1>4346     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">ValueFlow::Value asImpossible(ValueFlow::Value v)</span>
<a name="4347"><font size=-1>4347     </font></a><span class="default">{</span>
<a name="4348"><font size=-1>4348     </font></a><span class="default">    v.invertRange();</span>
<a name="4349"><font size=-1>4349     </font></a><span class="default">    v.setImpossible();</span>
<a name="4350"><font size=-1>4350     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">v;</span>
<a name="4351"><font size=-1>4351     </font></a><span class="default">}</span>
<a name="4352"><font size=-1>4352     </font></a><span class="default"></span>
<a name="4353"><font size=-1>4353     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">insertImpossible(std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; input)</span>
<a name="4354"><font size=-1>4354     </font></a><span class="default">{</span>
<a name="4355"><font size=-1>4355     </font></a><span class="default">    std::transform(input.begin(), input.end(), std::back_inserter(values), &amp;asImpossible);</span>
<a name="4356"><font size=-1>4356     </font></a><span class="default">}</span>
<a name="4357"><font size=-1>4357     </font></a><span class="default"></span>
<a name="4358"><font size=-1>4358     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::vector&lt;</span><span class="keyword">const </span><span class="default">Variable*&gt; getExprVariables(</span><span class="keyword">const </span><span class="default">Token* expr,</span>
<a name="4359"><font size=-1>4359     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">TokenList* tokenlist,</span>
<a name="4360"><font size=-1>4360     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">SymbolDatabase* symboldatabase,</span>
<a name="4361"><font size=-1>4361     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="4362"><font size=-1>4362     </font></a><span class="default">{</span>
<a name="4363"><font size=-1>4363     </font></a><span class="default">    std::vector&lt;</span><span class="keyword">const </span><span class="default">Variable*&gt; result;</span>
<a name="4364"><font size=-1>4364     </font></a><span class="default">    FwdAnalysis fwdAnalysis(tokenlist-&gt;isCPP(), settings-&gt;library);</span>
<a name="4365"><font size=-1>4365     </font></a><span class="default">    std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; varids = fwdAnalysis.getExprVarIds(expr);</span>
<a name="4366"><font size=-1>4366     </font></a><span class="default">    std::transform(varids.begin(), varids.end(), std::back_inserter(result), [&amp;](</span><span class="keyword">int </span><span class="default">id) {</span>
<a name="4367"><font size=-1>4367     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">symboldatabase-&gt;getVariableFromVarId(id);</span>
<a name="4368"><font size=-1>4368     </font></a><span class="default">    });</span>
<a name="4369"><font size=-1>4369     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="4370"><font size=-1>4370     </font></a><span class="default">}</span>
<a name="4371"><font size=-1>4371     </font></a><span class="default"></span>
<a name="4372"><font size=-1>4372     </font></a><span class="default"></span><span class="keyword">struct </span><span class="default">ValueFlowConditionHandler {</span>
<a name="4373"><font size=-1>4373     </font></a><span class="default">    </span><span class="keyword">struct </span><span class="default">Condition {</span>
<a name="4374"><font size=-1>4374     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vartok;</span>
<a name="4375"><font size=-1>4375     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; true_values;</span>
<a name="4376"><font size=-1>4376     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; false_values;</span>
<a name="4377"><font size=-1>4377     </font></a><span class="default"></span>
<a name="4378"><font size=-1>4378     </font></a><span class="default">        Condition() : vartok(nullptr), true_values(), false_values() {}</span>
<a name="4379"><font size=-1>4379     </font></a><span class="default">    };</span>
<a name="4380"><font size=-1>4380     </font></a><span class="default">    std::function&lt;</span><span class="keyword">bool</span><span class="default">(Token* start, </span><span class="keyword">const </span><span class="default">Token* stop, </span><span class="keyword">const </span><span class="default">Token* exprTok, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">bool </span><span class="default">constValue)&gt;</span>
<a name="4381"><font size=-1>4381     </font></a><span class="default">    forward;</span>
<a name="4382"><font size=-1>4382     </font></a><span class="default">    std::function&lt;Condition(Token *tok)&gt; parse;</span>
<a name="4383"><font size=-1>4383     </font></a><span class="default"></span>
<a name="4384"><font size=-1>4384     </font></a><span class="default">    </span><span class="keyword">void </span><span class="default">afterCondition(TokenList *tokenlist,</span>
<a name="4385"><font size=-1>4385     </font></a><span class="default">                        SymbolDatabase *symboldatabase,</span>
<a name="4386"><font size=-1>4386     </font></a><span class="default">                        ErrorLogger *errorLogger,</span>
<a name="4387"><font size=-1>4387     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Settings *settings) </span><span class="keyword">const </span><span class="default">{</span>
<a name="4388"><font size=-1>4388     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *scope : symboldatabase-&gt;functionScopes) {</span>
<a name="4389"><font size=-1>4389     </font></a><span class="default">            std::set&lt;</span><span class="keyword">unsigned</span><span class="default">&gt; aliased;</span>
<a name="4390"><font size=-1>4390     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(Token *tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(scope-&gt;bodyStart); tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="4391"><font size=-1>4391     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;if|while|for (&quot;</span><span class="default">))</span>
<a name="4392"><font size=-1>4392     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4393"><font size=-1>4393     </font></a><span class="default"></span>
<a name="4394"><font size=-1>4394     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;= &amp; %var% ;&quot;</span><span class="default">))</span>
<a name="4395"><font size=-1>4395     </font></a><span class="default">                    aliased.insert(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;varId());</span>
<a name="4396"><font size=-1>4396     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token* top = tok-&gt;astTop();</span>
<a name="4397"><font size=-1>4397     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!top)</span>
<a name="4398"><font size=-1>4398     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4399"><font size=-1>4399     </font></a><span class="default"></span>
<a name="4400"><font size=-1>4400     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!Token::Match(top-&gt;previous(), </span><span class="string">&quot;if|while|for (&quot;</span><span class="default">) &amp;&amp; !Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;&amp;&amp;|%oror%&quot;</span><span class="default">))</span>
<a name="4401"><font size=-1>4401     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4402"><font size=-1>4402     </font></a><span class="default"></span>
<a name="4403"><font size=-1>4403     </font></a><span class="default">                Condition cond = parse(tok);</span>
<a name="4404"><font size=-1>4404     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!cond.vartok)</span>
<a name="4405"><font size=-1>4405     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4406"><font size=-1>4406     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(cond.true_values.empty() || cond.false_values.empty())</span>
<a name="4407"><font size=-1>4407     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4408"><font size=-1>4408     </font></a><span class="default"></span>
<a name="4409"><font size=-1>4409     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(exprDependsOnThis(cond.vartok))</span>
<a name="4410"><font size=-1>4410     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4411"><font size=-1>4411     </font></a><span class="default">                std::vector&lt;</span><span class="keyword">const </span><span class="default">Variable*&gt; vars = getExprVariables(cond.vartok, tokenlist, symboldatabase, settings);</span>
<a name="4412"><font size=-1>4412     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(std::any_of(vars.begin(), vars.end(), [](</span><span class="keyword">const </span><span class="default">Variable* var) {</span>
<a name="4413"><font size=-1>4413     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">!var;</span>
<a name="4414"><font size=-1>4414     </font></a><span class="default">            }))</span>
<a name="4415"><font size=-1>4415     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4416"><font size=-1>4416     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!vars.empty() &amp;&amp; (vars.front()))</span>
<a name="4417"><font size=-1>4417     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(std::any_of(vars.begin(), vars.end(), [&amp;](</span><span class="keyword">const </span><span class="default">Variable* var) {</span>
<a name="4418"><font size=-1>4418     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">var &amp;&amp; aliased.find(var-&gt;declarationId()) != aliased.end();</span>
<a name="4419"><font size=-1>4419     </font></a><span class="default">                    })) {</span>
<a name="4420"><font size=-1>4420     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="4421"><font size=-1>4421     </font></a><span class="default">                        bailout(tokenlist,</span>
<a name="4422"><font size=-1>4422     </font></a><span class="default">                                errorLogger,</span>
<a name="4423"><font size=-1>4423     </font></a><span class="default">                                cond.vartok,</span>
<a name="4424"><font size=-1>4424     </font></a><span class="default">                                </span><span class="string">&quot;variable is aliased so we just skip all valueflow after condition&quot;</span><span class="default">);</span>
<a name="4425"><font size=-1>4425     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4426"><font size=-1>4426     </font></a><span class="default">                }</span>
<a name="4427"><font size=-1>4427     </font></a><span class="default"></span>
<a name="4428"><font size=-1>4428     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;%oror%|&amp;&amp;&quot;</span><span class="default">)) {</span>
<a name="4429"><font size=-1>4429     </font></a><span class="default">                    Token *parent = tok-&gt;astParent();</span>
<a name="4430"><font size=-1>4430     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">std::string &amp;op(parent-&gt;str());</span>
<a name="4431"><font size=-1>4431     </font></a><span class="default"></span>
<a name="4432"><font size=-1>4432     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(parent-&gt;astOperand1() == tok &amp;&amp; ((op == </span><span class="string">&quot;&amp;&amp;&quot; </span><span class="default">&amp;&amp; Token::Match(tok, </span><span class="string">&quot;==|&gt;=|&lt;=|!&quot;</span><span class="default">)) ||</span>
<a name="4433"><font size=-1>4433     </font></a><span class="default">                                                         (op == </span><span class="string">&quot;||&quot; </span><span class="default">&amp;&amp; Token::Match(tok, </span><span class="string">&quot;%name%|!=&quot;</span><span class="default">)))) {</span>
<a name="4434"><font size=-1>4434     </font></a><span class="default">                        </span><span class="keyword">for </span><span class="default">(; parent &amp;&amp; parent-&gt;str() == op; parent = parent-&gt;astParent()) {</span>
<a name="4435"><font size=-1>4435     </font></a><span class="default">                            std::stack&lt;Token *&gt; tokens;</span>
<a name="4436"><font size=-1>4436     </font></a><span class="default">                            tokens.push(parent-&gt;astOperand2());</span>
<a name="4437"><font size=-1>4437     </font></a><span class="default">                            </span><span class="keyword">bool </span><span class="default">assign = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4438"><font size=-1>4438     </font></a><span class="default">                            </span><span class="keyword">while </span><span class="default">(!tokens.empty()) {</span>
<a name="4439"><font size=-1>4439     </font></a><span class="default">                                Token *rhstok = tokens.top();</span>
<a name="4440"><font size=-1>4440     </font></a><span class="default">                                tokens.pop();</span>
<a name="4441"><font size=-1>4441     </font></a><span class="default">                                </span><span class="keyword">if </span><span class="default">(!rhstok)</span>
<a name="4442"><font size=-1>4442     </font></a><span class="default">                                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4443"><font size=-1>4443     </font></a><span class="default">                                tokens.push(rhstok-&gt;astOperand1());</span>
<a name="4444"><font size=-1>4444     </font></a><span class="default">                                tokens.push(rhstok-&gt;astOperand2());</span>
<a name="4445"><font size=-1>4445     </font></a><span class="default">                                </span><span class="keyword">if </span><span class="default">(isSameExpression(</span>
<a name="4446"><font size=-1>4446     </font></a><span class="default">                                        tokenlist-&gt;isCPP(), </span><span class="keyword">false</span><span class="default">, cond.vartok, rhstok, settings-&gt;library, </span><span class="keyword">true</span><span class="default">, </span><span class="keyword">false</span><span class="default">))</span>
<a name="4447"><font size=-1>4447     </font></a><span class="default">                                    setTokenValue(rhstok, cond.true_values.front(), settings);</span>
<a name="4448"><font size=-1>4448     </font></a><span class="default">                                </span><span class="keyword">else if </span><span class="default">(Token::Match(rhstok, </span><span class="string">&quot;++|--|=&quot;</span><span class="default">) &amp;&amp; isSameExpression(tokenlist-&gt;isCPP(),</span>
<a name="4449"><font size=-1>4449     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">,</span>
<a name="4450"><font size=-1>4450     </font></a><span class="default">                                         cond.vartok,</span>
<a name="4451"><font size=-1>4451     </font></a><span class="default">                                         rhstok-&gt;astOperand1(),</span>
<a name="4452"><font size=-1>4452     </font></a><span class="default">                                         settings-&gt;library,</span>
<a name="4453"><font size=-1>4453     </font></a><span class="default">                                         </span><span class="keyword">true</span><span class="default">,</span>
<a name="4454"><font size=-1>4454     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">)) {</span>
<a name="4455"><font size=-1>4455     </font></a><span class="default">                                    assign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4456"><font size=-1>4456     </font></a><span class="default">                                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="4457"><font size=-1>4457     </font></a><span class="default">                                }</span>
<a name="4458"><font size=-1>4458     </font></a><span class="default">                            }</span>
<a name="4459"><font size=-1>4459     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(assign)</span>
<a name="4460"><font size=-1>4460     </font></a><span class="default">                                </span><span class="keyword">break</span><span class="default">;</span>
<a name="4461"><font size=-1>4461     </font></a><span class="default">                            </span><span class="keyword">while </span><span class="default">(parent-&gt;astParent() &amp;&amp; parent == parent-&gt;astParent()-&gt;astOperand2())</span>
<a name="4462"><font size=-1>4462     </font></a><span class="default">                                parent = parent-&gt;astParent();</span>
<a name="4463"><font size=-1>4463     </font></a><span class="default">                        }</span>
<a name="4464"><font size=-1>4464     </font></a><span class="default">                    }</span>
<a name="4465"><font size=-1>4465     </font></a><span class="default">                }</span>
<a name="4466"><font size=-1>4466     </font></a><span class="default"></span>
<a name="4467"><font size=-1>4467     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(top &amp;&amp; Token::Match(top-&gt;previous(), </span><span class="string">&quot;if|while (&quot;</span><span class="default">) &amp;&amp; !top-&gt;previous()-&gt;isExpandedMacro()) {</span>
<a name="4468"><font size=-1>4468     </font></a><span class="default">                    </span><span class="comment">// does condition reassign variable?</span>
<a name="4469"><font size=-1>4469     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(tok != top-&gt;astOperand2() &amp;&amp; Token::Match(top-&gt;astOperand2(), </span><span class="string">&quot;%oror%|&amp;&amp;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="4470"><font size=-1>4470     </font></a><span class="default">                        isVariablesChanged(top, top-&gt;link(), </span><span class="number">0</span><span class="default">, vars, settings, tokenlist-&gt;isCPP())) {</span>
<a name="4471"><font size=-1>4471     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="4472"><font size=-1>4472     </font></a><span class="default">                            bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;assignment in condition&quot;</span><span class="default">);</span>
<a name="4473"><font size=-1>4473     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4474"><font size=-1>4474     </font></a><span class="default">                    }</span>
<a name="4475"><font size=-1>4475     </font></a><span class="default"></span>
<a name="4476"><font size=-1>4476     </font></a><span class="default">                    std::list&lt;ValueFlow::Value&gt; thenValues;</span>
<a name="4477"><font size=-1>4477     </font></a><span class="default">                    std::list&lt;ValueFlow::Value&gt; elseValues;</span>
<a name="4478"><font size=-1>4478     </font></a><span class="default"></span>
<a name="4479"><font size=-1>4479     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;!=|=&quot;</span><span class="default">) &amp;&amp; tok != cond.vartok) {</span>
<a name="4480"><font size=-1>4480     </font></a><span class="default">                        thenValues.insert(thenValues.end(), cond.true_values.begin(), cond.true_values.end());</span>
<a name="4481"><font size=-1>4481     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(isConditionKnown(tok, </span><span class="keyword">false</span><span class="default">))</span>
<a name="4482"><font size=-1>4482     </font></a><span class="default">                            insertImpossible(elseValues, cond.false_values);</span>
<a name="4483"><font size=-1>4483     </font></a><span class="default">                    }</span>
<a name="4484"><font size=-1>4484     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;==|!&quot;</span><span class="default">)) {</span>
<a name="4485"><font size=-1>4485     </font></a><span class="default">                        elseValues.insert(elseValues.end(), cond.false_values.begin(), cond.false_values.end());</span>
<a name="4486"><font size=-1>4486     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(isConditionKnown(tok, </span><span class="keyword">true</span><span class="default">))</span>
<a name="4487"><font size=-1>4487     </font></a><span class="default">                            insertImpossible(thenValues, cond.true_values);</span>
<a name="4488"><font size=-1>4488     </font></a><span class="default">                    }</span>
<a name="4489"><font size=-1>4489     </font></a><span class="default"></span>
<a name="4490"><font size=-1>4490     </font></a><span class="default">                    </span><span class="comment">// start token of conditional code</span>
<a name="4491"><font size=-1>4491     </font></a><span class="comment">                    </span><span class="default">Token* startTokens[] = {nullptr, nullptr};</span>
<a name="4492"><font size=-1>4492     </font></a><span class="default"></span>
<a name="4493"><font size=-1>4493     </font></a><span class="default">                    </span><span class="comment">// if astParent is &quot;!&quot; we need to invert codeblock</span>
<a name="4494"><font size=-1>4494     </font></a><span class="comment">                    </span><span class="default">{</span>
<a name="4495"><font size=-1>4495     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Token *tok2 = tok;</span>
<a name="4496"><font size=-1>4496     </font></a><span class="default">                        </span><span class="keyword">while </span><span class="default">(tok2-&gt;astParent()) {</span>
<a name="4497"><font size=-1>4497     </font></a><span class="default">                            </span><span class="keyword">const </span><span class="default">Token *parent = tok2-&gt;astParent();</span>
<a name="4498"><font size=-1>4498     </font></a><span class="default">                            </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; parent-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">)</span>
<a name="4499"><font size=-1>4499     </font></a><span class="default">                                parent = parent-&gt;astParent();</span>
<a name="4500"><font size=-1>4500     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(parent &amp;&amp; (parent-&gt;str() == </span><span class="string">&quot;!&quot; </span><span class="default">|| Token::simpleMatch(parent, </span><span class="string">&quot;== false&quot;</span><span class="default">))) {</span>
<a name="4501"><font size=-1>4501     </font></a><span class="default">                                std::swap(thenValues, elseValues);</span>
<a name="4502"><font size=-1>4502     </font></a><span class="default">                            }</span>
<a name="4503"><font size=-1>4503     </font></a><span class="default">                            tok2 = parent;</span>
<a name="4504"><font size=-1>4504     </font></a><span class="default">                        }</span>
<a name="4505"><font size=-1>4505     </font></a><span class="default">                    }</span>
<a name="4506"><font size=-1>4506     </font></a><span class="default"></span>
<a name="4507"><font size=-1>4507     </font></a><span class="default">                    </span><span class="comment">// determine startToken(s)</span>
<a name="4508"><font size=-1>4508     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(top-&gt;link(), </span><span class="string">&quot;) {&quot;</span><span class="default">))</span>
<a name="4509"><font size=-1>4509     </font></a><span class="default">                        startTokens[</span><span class="number">0</span><span class="default">] = top-&gt;link()-&gt;next();</span>
<a name="4510"><font size=-1>4510     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(top-&gt;link()-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;} else {&quot;</span><span class="default">))</span>
<a name="4511"><font size=-1>4511     </font></a><span class="default">                        startTokens[</span><span class="number">1</span><span class="default">] = top-&gt;link()-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="4512"><font size=-1>4512     </font></a><span class="default"></span>
<a name="4513"><font size=-1>4513     </font></a><span class="default">                    </span><span class="keyword">int </span><span class="default">changeBlock = -</span><span class="number">1</span><span class="default">;</span>
<a name="4514"><font size=-1>4514     </font></a><span class="default"></span>
<a name="4515"><font size=-1>4515     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">i = </span><span class="number">0</span><span class="default">; i &lt; </span><span class="number">2</span><span class="default">; i++) {</span>
<a name="4516"><font size=-1>4516     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Token *</span><span class="keyword">const </span><span class="default">startToken = startTokens[i];</span>
<a name="4517"><font size=-1>4517     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!startToken)</span>
<a name="4518"><font size=-1>4518     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4519"><font size=-1>4519     </font></a><span class="default">                        std::list&lt;ValueFlow::Value&gt;&amp; values = (i == </span><span class="number">0 </span><span class="default">? thenValues : elseValues);</span>
<a name="4520"><font size=-1>4520     </font></a><span class="default">                        valueFlowSetConditionToKnown(tok, values, i == </span><span class="number">0</span><span class="default">);</span>
<a name="4521"><font size=-1>4521     </font></a><span class="default"></span>
<a name="4522"><font size=-1>4522     </font></a><span class="default">                        </span><span class="comment">// TODO: The endToken should not be startTokens[i]-&gt;link() in the valueFlowForwardVariable call</span>
<a name="4523"><font size=-1>4523     </font></a><span class="comment">                        </span><span class="keyword">if </span><span class="default">(forward(startTokens[i], startTokens[i]-&gt;link(), cond.vartok, values, </span><span class="keyword">true</span><span class="default">))</span>
<a name="4524"><font size=-1>4524     </font></a><span class="default">                            changeBlock = i;</span>
<a name="4525"><font size=-1>4525     </font></a><span class="default">                        changeKnownToPossible(values);</span>
<a name="4526"><font size=-1>4526     </font></a><span class="default">                    }</span>
<a name="4527"><font size=-1>4527     </font></a><span class="default">                    </span><span class="comment">// TODO: Values changed in noreturn blocks should not bail</span>
<a name="4528"><font size=-1>4528     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(changeBlock &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; !Token::simpleMatch(top-&gt;previous(), </span><span class="string">&quot;while (&quot;</span><span class="default">)) {</span>
<a name="4529"><font size=-1>4529     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="4530"><font size=-1>4530     </font></a><span class="default">                            bailout(tokenlist,</span>
<a name="4531"><font size=-1>4531     </font></a><span class="default">                                    errorLogger,</span>
<a name="4532"><font size=-1>4532     </font></a><span class="default">                                    startTokens[changeBlock]-&gt;link(),</span>
<a name="4533"><font size=-1>4533     </font></a><span class="default">                                    </span><span class="string">&quot;valueFlowAfterCondition: &quot; </span><span class="default">+ cond.vartok-&gt;expressionString() +</span>
<a name="4534"><font size=-1>4534     </font></a><span class="default">                                    </span><span class="string">&quot; is changed in conditional block&quot;</span><span class="default">);</span>
<a name="4535"><font size=-1>4535     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4536"><font size=-1>4536     </font></a><span class="default">                    }</span>
<a name="4537"><font size=-1>4537     </font></a><span class="default"></span>
<a name="4538"><font size=-1>4538     </font></a><span class="default">                    </span><span class="comment">// After conditional code..</span>
<a name="4539"><font size=-1>4539     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(top-&gt;link(), </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="4540"><font size=-1>4540     </font></a><span class="default">                        Token *after = top-&gt;link()-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="4541"><font size=-1>4541     </font></a><span class="default">                        std::string unknownFunction;</span>
<a name="4542"><font size=-1>4542     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(settings-&gt;library.isScopeNoReturn(after, &amp;unknownFunction)) {</span>
<a name="4543"><font size=-1>4543     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings &amp;&amp; !unknownFunction.empty())</span>
<a name="4544"><font size=-1>4544     </font></a><span class="default">                                bailout(tokenlist, errorLogger, after, </span><span class="string">&quot;possible noreturn scope&quot;</span><span class="default">);</span>
<a name="4545"><font size=-1>4545     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4546"><font size=-1>4546     </font></a><span class="default">                        }</span>
<a name="4547"><font size=-1>4547     </font></a><span class="default"></span>
<a name="4548"><font size=-1>4548     </font></a><span class="default">                        </span><span class="keyword">bool </span><span class="default">dead_if = isReturnScope(after, settings) ||</span>
<a name="4549"><font size=-1>4549     </font></a><span class="default">                                       (tok-&gt;astParent() &amp;&amp; Token::simpleMatch(tok-&gt;astParent()-&gt;previous(), </span><span class="string">&quot;while (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="4550"><font size=-1>4550     </font></a><span class="default">                                        !isBreakScope(after));</span>
<a name="4551"><font size=-1>4551     </font></a><span class="default">                        </span><span class="keyword">bool </span><span class="default">dead_else = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4552"><font size=-1>4552     </font></a><span class="default"></span>
<a name="4553"><font size=-1>4553     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(after, </span><span class="string">&quot;} else {&quot;</span><span class="default">)) {</span>
<a name="4554"><font size=-1>4554     </font></a><span class="default">                            after = after-&gt;linkAt(</span><span class="number">2</span><span class="default">);</span>
<a name="4555"><font size=-1>4555     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(after-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;) ; }&quot;</span><span class="default">)) {</span>
<a name="4556"><font size=-1>4556     </font></a><span class="default">                                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="4557"><font size=-1>4557     </font></a><span class="default">                                    bailout(tokenlist, errorLogger, after, </span><span class="string">&quot;possible noreturn scope&quot;</span><span class="default">);</span>
<a name="4558"><font size=-1>4558     </font></a><span class="default">                                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4559"><font size=-1>4559     </font></a><span class="default">                            }</span>
<a name="4560"><font size=-1>4560     </font></a><span class="default">                            dead_else = isReturnScope(after, settings);</span>
<a name="4561"><font size=-1>4561     </font></a><span class="default">                        }</span>
<a name="4562"><font size=-1>4562     </font></a><span class="default"></span>
<a name="4563"><font size=-1>4563     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(dead_if &amp;&amp; dead_else)</span>
<a name="4564"><font size=-1>4564     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4565"><font size=-1>4565     </font></a><span class="default"></span>
<a name="4566"><font size=-1>4566     </font></a><span class="default">                        std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="4567"><font size=-1>4567     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(dead_if) {</span>
<a name="4568"><font size=-1>4568     </font></a><span class="default">                            values = elseValues;</span>
<a name="4569"><font size=-1>4569     </font></a><span class="default">                        } </span><span class="keyword">else if </span><span class="default">(dead_else) {</span>
<a name="4570"><font size=-1>4570     </font></a><span class="default">                            values = thenValues;</span>
<a name="4571"><font size=-1>4571     </font></a><span class="default">                        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="4572"><font size=-1>4572     </font></a><span class="default">                            std::copy_if(thenValues.begin(),</span>
<a name="4573"><font size=-1>4573     </font></a><span class="default">                                         thenValues.end(),</span>
<a name="4574"><font size=-1>4574     </font></a><span class="default">                                         std::back_inserter(values),</span>
<a name="4575"><font size=-1>4575     </font></a><span class="default">                                         std::mem_fn(&amp;ValueFlow::Value::isPossible));</span>
<a name="4576"><font size=-1>4576     </font></a><span class="default">                            std::copy_if(elseValues.begin(),</span>
<a name="4577"><font size=-1>4577     </font></a><span class="default">                                         elseValues.end(),</span>
<a name="4578"><font size=-1>4578     </font></a><span class="default">                                         std::back_inserter(values),</span>
<a name="4579"><font size=-1>4579     </font></a><span class="default">                                         std::mem_fn(&amp;ValueFlow::Value::isPossible));</span>
<a name="4580"><font size=-1>4580     </font></a><span class="default">                        }</span>
<a name="4581"><font size=-1>4581     </font></a><span class="default"></span>
<a name="4582"><font size=-1>4582     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(!values.empty()) {</span>
<a name="4583"><font size=-1>4583     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">((dead_if || dead_else) &amp;&amp; !Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;&amp;&amp;|&amp;&quot;</span><span class="default">)) {</span>
<a name="4584"><font size=-1>4584     </font></a><span class="default">                                valueFlowSetConditionToKnown(tok, values, </span><span class="keyword">true</span><span class="default">);</span>
<a name="4585"><font size=-1>4585     </font></a><span class="default">                                valueFlowSetConditionToKnown(tok, values, </span><span class="keyword">false</span><span class="default">);</span>
<a name="4586"><font size=-1>4586     </font></a><span class="default">                            }</span>
<a name="4587"><font size=-1>4587     </font></a><span class="default">                            </span><span class="comment">// TODO: constValue could be true if there are no assignments in the conditional blocks and</span>
<a name="4588"><font size=-1>4588     </font></a><span class="comment">                            //       perhaps if there are no &amp;&amp; and no || in the condition</span>
<a name="4589"><font size=-1>4589     </font></a><span class="comment">                            </span><span class="keyword">bool </span><span class="default">constValue = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4590"><font size=-1>4590     </font></a><span class="default">                            forward(after, top-&gt;scope()-&gt;bodyEnd, cond.vartok, values, constValue);</span>
<a name="4591"><font size=-1>4591     </font></a><span class="default">                        }</span>
<a name="4592"><font size=-1>4592     </font></a><span class="default">                    }</span>
<a name="4593"><font size=-1>4593     </font></a><span class="default">                }</span>
<a name="4594"><font size=-1>4594     </font></a><span class="default">            }</span>
<a name="4595"><font size=-1>4595     </font></a><span class="default">        }</span>
<a name="4596"><font size=-1>4596     </font></a><span class="default">    }</span>
<a name="4597"><font size=-1>4597     </font></a><span class="default">};</span>
<a name="4598"><font size=-1>4598     </font></a><span class="default"></span>
<a name="4599"><font size=-1>4599     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowAfterCondition(TokenList *tokenlist,</span>
<a name="4600"><font size=-1>4600     </font></a><span class="default">                                    SymbolDatabase *symboldatabase,</span>
<a name="4601"><font size=-1>4601     </font></a><span class="default">                                    ErrorLogger *errorLogger,</span>
<a name="4602"><font size=-1>4602     </font></a><span class="default">                                    </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="4603"><font size=-1>4603     </font></a><span class="default">{</span>
<a name="4604"><font size=-1>4604     </font></a><span class="default">    ValueFlowConditionHandler handler;</span>
<a name="4605"><font size=-1>4605     </font></a><span class="default">    handler.forward = [&amp;](Token* start,</span>
<a name="4606"><font size=-1>4606     </font></a><span class="default">                          </span><span class="keyword">const </span><span class="default">Token* stop,</span>
<a name="4607"><font size=-1>4607     </font></a><span class="default">                          </span><span class="keyword">const </span><span class="default">Token* vartok,</span>
<a name="4608"><font size=-1>4608     </font></a><span class="default">                          </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values,</span>
<a name="4609"><font size=-1>4609     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">constValue) {</span>
<a name="4610"><font size=-1>4610     </font></a><span class="default">        valueFlowForward(start-&gt;next(), stop, vartok, values, constValue, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="4611"><font size=-1>4611     </font></a><span class="default">        std::vector&lt;</span><span class="keyword">const </span><span class="default">Variable*&gt; vars = getExprVariables(vartok, tokenlist, symboldatabase, settings);</span>
<a name="4612"><font size=-1>4612     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">isVariablesChanged(start, stop, </span><span class="number">0</span><span class="default">, vars, settings, tokenlist-&gt;isCPP());</span>
<a name="4613"><font size=-1>4613     </font></a><span class="default">    };</span>
<a name="4614"><font size=-1>4614     </font></a><span class="default">    handler.parse = [&amp;](</span><span class="keyword">const </span><span class="default">Token *tok) {</span>
<a name="4615"><font size=-1>4615     </font></a><span class="default">        ValueFlowConditionHandler::Condition cond;</span>
<a name="4616"><font size=-1>4616     </font></a><span class="default">        ValueFlow::Value true_value;</span>
<a name="4617"><font size=-1>4617     </font></a><span class="default">        ValueFlow::Value false_value;</span>
<a name="4618"><font size=-1>4618     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vartok = parseCompareInt(tok, true_value, false_value);</span>
<a name="4619"><font size=-1>4619     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vartok) {</span>
<a name="4620"><font size=-1>4620     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(vartok-&gt;str() == </span><span class="string">&quot;=&quot; </span><span class="default">&amp;&amp; vartok-&gt;astOperand1() &amp;&amp; vartok-&gt;astOperand2())</span>
<a name="4621"><font size=-1>4621     </font></a><span class="default">                vartok = vartok-&gt;astOperand1();</span>
<a name="4622"><font size=-1>4622     </font></a><span class="default">            cond.true_values.push_back(true_value);</span>
<a name="4623"><font size=-1>4623     </font></a><span class="default">            cond.false_values.push_back(false_value);</span>
<a name="4624"><font size=-1>4624     </font></a><span class="default">            cond.vartok = vartok;</span>
<a name="4625"><font size=-1>4625     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="4626"><font size=-1>4626     </font></a><span class="default">        }</span>
<a name="4627"><font size=-1>4627     </font></a><span class="default"></span>
<a name="4628"><font size=-1>4628     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;!&quot;</span><span class="default">) {</span>
<a name="4629"><font size=-1>4629     </font></a><span class="default">            vartok = tok-&gt;astOperand1();</span>
<a name="4630"><font size=-1>4630     </font></a><span class="default"></span>
<a name="4631"><font size=-1>4631     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok-&gt;astParent() &amp;&amp; (Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;%oror%|&amp;&amp;&quot;</span><span class="default">) ||</span>
<a name="4632"><font size=-1>4632     </font></a><span class="default">                                        Token::Match(tok-&gt;astParent()-&gt;previous(), </span><span class="string">&quot;if|while (&quot;</span><span class="default">))) {</span>
<a name="4633"><font size=-1>4633     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;=&quot;</span><span class="default">))</span>
<a name="4634"><font size=-1>4634     </font></a><span class="default">                vartok = tok-&gt;astOperand1();</span>
<a name="4635"><font size=-1>4635     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%comp%|%assign%&quot;</span><span class="default">))</span>
<a name="4636"><font size=-1>4636     </font></a><span class="default">                vartok = tok;</span>
<a name="4637"><font size=-1>4637     </font></a><span class="default">        }</span>
<a name="4638"><font size=-1>4638     </font></a><span class="default"></span>
<a name="4639"><font size=-1>4639     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!vartok)</span>
<a name="4640"><font size=-1>4640     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="4641"><font size=-1>4641     </font></a><span class="default">        cond.true_values.emplace_back(tok, </span><span class="number">0LL</span><span class="default">);</span>
<a name="4642"><font size=-1>4642     </font></a><span class="default">        cond.false_values.emplace_back(tok, </span><span class="number">0LL</span><span class="default">);</span>
<a name="4643"><font size=-1>4643     </font></a><span class="default">        cond.vartok = vartok;</span>
<a name="4644"><font size=-1>4644     </font></a><span class="default"></span>
<a name="4645"><font size=-1>4645     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="4646"><font size=-1>4646     </font></a><span class="default">    };</span>
<a name="4647"><font size=-1>4647     </font></a><span class="default">    handler.afterCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="4648"><font size=-1>4648     </font></a><span class="default">}</span>
<a name="4649"><font size=-1>4649     </font></a><span class="default"></span>
<a name="4650"><font size=-1>4650     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">execute(</span><span class="keyword">const </span><span class="default">Token *expr,</span>
<a name="4651"><font size=-1>4651     </font></a><span class="default">                    ProgramMemory * </span><span class="keyword">const </span><span class="default">programMemory,</span>
<a name="4652"><font size=-1>4652     </font></a><span class="default">                    MathLib::bigint *result,</span>
<a name="4653"><font size=-1>4653     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">*error)</span>
<a name="4654"><font size=-1>4654     </font></a><span class="default">{</span>
<a name="4655"><font size=-1>4655     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!expr)</span>
<a name="4656"><font size=-1>4656     </font></a><span class="default">        *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4657"><font size=-1>4657     </font></a><span class="default"></span>
<a name="4658"><font size=-1>4658     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;hasKnownIntValue()) {</span>
<a name="4659"><font size=-1>4659     </font></a><span class="default">        *result = expr-&gt;values().front().intvalue;</span>
<a name="4660"><font size=-1>4660     </font></a><span class="default">    }</span>
<a name="4661"><font size=-1>4661     </font></a><span class="default"></span>
<a name="4662"><font size=-1>4662     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;isNumber()) {</span>
<a name="4663"><font size=-1>4663     </font></a><span class="default">        *result = MathLib::toLongNumber(expr-&gt;str());</span>
<a name="4664"><font size=-1>4664     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(MathLib::isFloat(expr-&gt;str()))</span>
<a name="4665"><font size=-1>4665     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4666"><font size=-1>4666     </font></a><span class="default">    }</span>
<a name="4667"><font size=-1>4667     </font></a><span class="default"></span>
<a name="4668"><font size=-1>4668     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;varId() &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="4669"><font size=-1>4669     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!programMemory-&gt;getIntValue(expr-&gt;varId(), result))</span>
<a name="4670"><font size=-1>4670     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4671"><font size=-1>4671     </font></a><span class="default">    }</span>
<a name="4672"><font size=-1>4672     </font></a><span class="default"></span>
<a name="4673"><font size=-1>4673     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;isComparisonOp()) {</span>
<a name="4674"><font size=-1>4674     </font></a><span class="default">        MathLib::bigint result1(</span><span class="number">0</span><span class="default">), result2(</span><span class="number">0</span><span class="default">);</span>
<a name="4675"><font size=-1>4675     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, &amp;result1, error);</span>
<a name="4676"><font size=-1>4676     </font></a><span class="default">        execute(expr-&gt;astOperand2(), programMemory, &amp;result2, error);</span>
<a name="4677"><font size=-1>4677     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;&quot;</span><span class="default">)</span>
<a name="4678"><font size=-1>4678     </font></a><span class="default">            *result = result1 &lt; result2;</span>
<a name="4679"><font size=-1>4679     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;=&quot;</span><span class="default">)</span>
<a name="4680"><font size=-1>4680     </font></a><span class="default">            *result = result1 &lt;= result2;</span>
<a name="4681"><font size=-1>4681     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;&quot;</span><span class="default">)</span>
<a name="4682"><font size=-1>4682     </font></a><span class="default">            *result = result1 &gt; result2;</span>
<a name="4683"><font size=-1>4683     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;=&quot;</span><span class="default">)</span>
<a name="4684"><font size=-1>4684     </font></a><span class="default">            *result = result1 &gt;= result2;</span>
<a name="4685"><font size=-1>4685     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;==&quot;</span><span class="default">)</span>
<a name="4686"><font size=-1>4686     </font></a><span class="default">            *result = result1 == result2;</span>
<a name="4687"><font size=-1>4687     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;!=&quot;</span><span class="default">)</span>
<a name="4688"><font size=-1>4688     </font></a><span class="default">            *result = result1 != result2;</span>
<a name="4689"><font size=-1>4689     </font></a><span class="default">    }</span>
<a name="4690"><font size=-1>4690     </font></a><span class="default"></span>
<a name="4691"><font size=-1>4691     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;isAssignmentOp()) {</span>
<a name="4692"><font size=-1>4692     </font></a><span class="default">        execute(expr-&gt;astOperand2(), programMemory, result, error);</span>
<a name="4693"><font size=-1>4693     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!expr-&gt;astOperand1() || !expr-&gt;astOperand1()-&gt;varId())</span>
<a name="4694"><font size=-1>4694     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4695"><font size=-1>4695     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(*error)</span>
<a name="4696"><font size=-1>4696     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="4697"><font size=-1>4697     </font></a><span class="default"></span>
<a name="4698"><font size=-1>4698     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;=&quot;</span><span class="default">) {</span>
<a name="4699"><font size=-1>4699     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), *result);</span>
<a name="4700"><font size=-1>4700     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="4701"><font size=-1>4701     </font></a><span class="default">        }</span>
<a name="4702"><font size=-1>4702     </font></a><span class="default"></span>
<a name="4703"><font size=-1>4703     </font></a><span class="default">        </span><span class="keyword">long long </span><span class="default">intValue;</span>
<a name="4704"><font size=-1>4704     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!programMemory-&gt;getIntValue(expr-&gt;astOperand1()-&gt;varId(), &amp;intValue)) {</span>
<a name="4705"><font size=-1>4705     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4706"><font size=-1>4706     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="4707"><font size=-1>4707     </font></a><span class="default">        }</span>
<a name="4708"><font size=-1>4708     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;+=&quot;</span><span class="default">)</span>
<a name="4709"><font size=-1>4709     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue + *result);</span>
<a name="4710"><font size=-1>4710     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;-=&quot;</span><span class="default">)</span>
<a name="4711"><font size=-1>4711     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue - *result);</span>
<a name="4712"><font size=-1>4712     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;*=&quot;</span><span class="default">)</span>
<a name="4713"><font size=-1>4713     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue * *result);</span>
<a name="4714"><font size=-1>4714     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;/=&quot; </span><span class="default">&amp;&amp; *result != </span><span class="number">0</span><span class="default">)</span>
<a name="4715"><font size=-1>4715     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue / *result);</span>
<a name="4716"><font size=-1>4716     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;%=&quot; </span><span class="default">&amp;&amp; *result != </span><span class="number">0</span><span class="default">)</span>
<a name="4717"><font size=-1>4717     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue % *result);</span>
<a name="4718"><font size=-1>4718     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&amp;=&quot;</span><span class="default">)</span>
<a name="4719"><font size=-1>4719     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue &amp; *result);</span>
<a name="4720"><font size=-1>4720     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;|=&quot;</span><span class="default">)</span>
<a name="4721"><font size=-1>4721     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue | *result);</span>
<a name="4722"><font size=-1>4722     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;^=&quot;</span><span class="default">)</span>
<a name="4723"><font size=-1>4723     </font></a><span class="default">            programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), intValue ^ *result);</span>
<a name="4724"><font size=-1>4724     </font></a><span class="default">    }</span>
<a name="4725"><font size=-1>4725     </font></a><span class="default"></span>
<a name="4726"><font size=-1>4726     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(Token::Match(expr, </span><span class="string">&quot;++|--&quot;</span><span class="default">)) {</span>
<a name="4727"><font size=-1>4727     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!expr-&gt;astOperand1() || expr-&gt;astOperand1()-&gt;varId() == </span><span class="number">0U</span><span class="default">)</span>
<a name="4728"><font size=-1>4728     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4729"><font size=-1>4729     </font></a><span class="default">        </span><span class="keyword">else </span><span class="default">{</span>
<a name="4730"><font size=-1>4730     </font></a><span class="default">            </span><span class="keyword">long long </span><span class="default">intValue;</span>
<a name="4731"><font size=-1>4731     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!programMemory-&gt;getIntValue(expr-&gt;astOperand1()-&gt;varId(), &amp;intValue))</span>
<a name="4732"><font size=-1>4732     </font></a><span class="default">                *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4733"><font size=-1>4733     </font></a><span class="default">            </span><span class="keyword">else </span><span class="default">{</span>
<a name="4734"><font size=-1>4734     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(intValue == </span><span class="number">0 </span><span class="default">&amp;&amp;</span>
<a name="4735"><font size=-1>4735     </font></a><span class="default">                    expr-&gt;str() == </span><span class="string">&quot;--&quot; </span><span class="default">&amp;&amp;</span>
<a name="4736"><font size=-1>4736     </font></a><span class="default">                    expr-&gt;astOperand1()-&gt;variable() &amp;&amp;</span>
<a name="4737"><font size=-1>4737     </font></a><span class="default">                    expr-&gt;astOperand1()-&gt;variable()-&gt;typeStartToken()-&gt;isUnsigned())</span>
<a name="4738"><font size=-1>4738     </font></a><span class="default">                    *error = </span><span class="keyword">true</span><span class="default">; </span><span class="comment">// overflow</span>
<a name="4739"><font size=-1>4739     </font></a><span class="comment">                </span><span class="default">*result = intValue + (expr-&gt;str() == </span><span class="string">&quot;++&quot; </span><span class="default">? </span><span class="number">1 </span><span class="default">: -</span><span class="number">1</span><span class="default">);</span>
<a name="4740"><font size=-1>4740     </font></a><span class="default">                programMemory-&gt;setIntValue(expr-&gt;astOperand1()-&gt;varId(), *result);</span>
<a name="4741"><font size=-1>4741     </font></a><span class="default">            }</span>
<a name="4742"><font size=-1>4742     </font></a><span class="default">        }</span>
<a name="4743"><font size=-1>4743     </font></a><span class="default">    }</span>
<a name="4744"><font size=-1>4744     </font></a><span class="default"></span>
<a name="4745"><font size=-1>4745     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;isArithmeticalOp() &amp;&amp; expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="4746"><font size=-1>4746     </font></a><span class="default">        MathLib::bigint result1(</span><span class="number">0</span><span class="default">), result2(</span><span class="number">0</span><span class="default">);</span>
<a name="4747"><font size=-1>4747     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, &amp;result1, error);</span>
<a name="4748"><font size=-1>4748     </font></a><span class="default">        execute(expr-&gt;astOperand2(), programMemory, &amp;result2, error);</span>
<a name="4749"><font size=-1>4749     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;+&quot;</span><span class="default">)</span>
<a name="4750"><font size=-1>4750     </font></a><span class="default">            *result = result1 + result2;</span>
<a name="4751"><font size=-1>4751     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;-&quot;</span><span class="default">)</span>
<a name="4752"><font size=-1>4752     </font></a><span class="default">            *result = result1 - result2;</span>
<a name="4753"><font size=-1>4753     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;*&quot;</span><span class="default">) {</span>
<a name="4754"><font size=-1>4754     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(result2 &amp;&amp; (result1 &gt; std::numeric_limits&lt;MathLib::bigint&gt;::max()/result2))</span>
<a name="4755"><font size=-1>4755     </font></a><span class="default">                *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4756"><font size=-1>4756     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="4757"><font size=-1>4757     </font></a><span class="keyword">                </span><span class="default">*result = result1 * result2;</span>
<a name="4758"><font size=-1>4758     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(result2 == </span><span class="number">0</span><span class="default">)</span>
<a name="4759"><font size=-1>4759     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4760"><font size=-1>4760     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;/&quot;</span><span class="default">)</span>
<a name="4761"><font size=-1>4761     </font></a><span class="default">            *result = result1 / result2;</span>
<a name="4762"><font size=-1>4762     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;%&quot;</span><span class="default">)</span>
<a name="4763"><font size=-1>4763     </font></a><span class="default">            *result = result1 % result2;</span>
<a name="4764"><font size=-1>4764     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;&lt;&quot;</span><span class="default">)  {</span>
<a name="4765"><font size=-1>4765     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(result2 &lt; </span><span class="number">0 </span><span class="default">|| result1 &lt; </span><span class="number">0 </span><span class="default">|| result2 &gt;= MathLib::bigint_bits)  { </span><span class="comment">// don't perform UB</span>
<a name="4766"><font size=-1>4766     </font></a><span class="comment">                </span><span class="default">*error= </span><span class="keyword">true</span><span class="default">;</span>
<a name="4767"><font size=-1>4767     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="4768"><font size=-1>4768     </font></a><span class="default">                *result = result1 &lt;&lt; result2;</span>
<a name="4769"><font size=-1>4769     </font></a><span class="default">            }</span>
<a name="4770"><font size=-1>4770     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;&gt;&quot;</span><span class="default">) {</span>
<a name="4771"><font size=-1>4771     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(result2 &lt; </span><span class="number">0</span><span class="default">) { </span><span class="comment">// don't perform UB</span>
<a name="4772"><font size=-1>4772     </font></a><span class="comment">                </span><span class="default">*error=</span><span class="keyword">true</span><span class="default">;</span>
<a name="4773"><font size=-1>4773     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="4774"><font size=-1>4774     </font></a><span class="default">                *result = result1 &gt;&gt; result2;</span>
<a name="4775"><font size=-1>4775     </font></a><span class="default">            }</span>
<a name="4776"><font size=-1>4776     </font></a><span class="default">        }</span>
<a name="4777"><font size=-1>4777     </font></a><span class="default">    }</span>
<a name="4778"><font size=-1>4778     </font></a><span class="default"></span>
<a name="4779"><font size=-1>4779     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">) {</span>
<a name="4780"><font size=-1>4780     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">error1 = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4781"><font size=-1>4781     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, result, &amp;error1);</span>
<a name="4782"><font size=-1>4782     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!error1 &amp;&amp; *result == </span><span class="number">0</span><span class="default">)</span>
<a name="4783"><font size=-1>4783     </font></a><span class="default">            *result = </span><span class="number">0</span><span class="default">;</span>
<a name="4784"><font size=-1>4784     </font></a><span class="default">        </span><span class="keyword">else </span><span class="default">{</span>
<a name="4785"><font size=-1>4785     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">error2 = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4786"><font size=-1>4786     </font></a><span class="default">            execute(expr-&gt;astOperand2(), programMemory, result, &amp;error2);</span>
<a name="4787"><font size=-1>4787     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(error1 &amp;&amp; error2)</span>
<a name="4788"><font size=-1>4788     </font></a><span class="default">                *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4789"><font size=-1>4789     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(error2)</span>
<a name="4790"><font size=-1>4790     </font></a><span class="default">                *result = </span><span class="number">1</span><span class="default">;</span>
<a name="4791"><font size=-1>4791     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="4792"><font size=-1>4792     </font></a><span class="keyword">                </span><span class="default">*result = !!*result;</span>
<a name="4793"><font size=-1>4793     </font></a><span class="default">        }</span>
<a name="4794"><font size=-1>4794     </font></a><span class="default">    }</span>
<a name="4795"><font size=-1>4795     </font></a><span class="default"></span>
<a name="4796"><font size=-1>4796     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;||&quot;</span><span class="default">) {</span>
<a name="4797"><font size=-1>4797     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, result, error);</span>
<a name="4798"><font size=-1>4798     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(*result == </span><span class="number">0 </span><span class="default">&amp;&amp; *error == </span><span class="keyword">false</span><span class="default">)</span>
<a name="4799"><font size=-1>4799     </font></a><span class="default">            execute(expr-&gt;astOperand2(), programMemory, result, error);</span>
<a name="4800"><font size=-1>4800     </font></a><span class="default">    }</span>
<a name="4801"><font size=-1>4801     </font></a><span class="default"></span>
<a name="4802"><font size=-1>4802     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;!&quot;</span><span class="default">) {</span>
<a name="4803"><font size=-1>4803     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, result, error);</span>
<a name="4804"><font size=-1>4804     </font></a><span class="default">        *result = !(*result);</span>
<a name="4805"><font size=-1>4805     </font></a><span class="default">    }</span>
<a name="4806"><font size=-1>4806     </font></a><span class="default"></span>
<a name="4807"><font size=-1>4807     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;,&quot; </span><span class="default">&amp;&amp; expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="4808"><font size=-1>4808     </font></a><span class="default">        execute(expr-&gt;astOperand1(), programMemory, result, error);</span>
<a name="4809"><font size=-1>4809     </font></a><span class="default">        execute(expr-&gt;astOperand2(), programMemory, result, error);</span>
<a name="4810"><font size=-1>4810     </font></a><span class="default">    }</span>
<a name="4811"><font size=-1>4811     </font></a><span class="default"></span>
<a name="4812"><font size=-1>4812     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;[&quot; </span><span class="default">&amp;&amp; expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="4813"><font size=-1>4813     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *tokvalue = nullptr;</span>
<a name="4814"><font size=-1>4814     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!programMemory-&gt;getTokValue(expr-&gt;astOperand1()-&gt;varId(), &amp;tokvalue)) {</span>
<a name="4815"><font size=-1>4815     </font></a><span class="default">            </span><span class="keyword">auto </span><span class="default">tokvalue_it = std::find_if(expr-&gt;astOperand1()-&gt;values().begin(),</span>
<a name="4816"><font size=-1>4816     </font></a><span class="default">                                            expr-&gt;astOperand1()-&gt;values().end(),</span>
<a name="4817"><font size=-1>4817     </font></a><span class="default">                                            std::mem_fn(&amp;ValueFlow::Value::isTokValue));</span>
<a name="4818"><font size=-1>4818     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tokvalue_it == expr-&gt;astOperand1()-&gt;values().end()) {</span>
<a name="4819"><font size=-1>4819     </font></a><span class="default">                *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4820"><font size=-1>4820     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="4821"><font size=-1>4821     </font></a><span class="default">            }</span>
<a name="4822"><font size=-1>4822     </font></a><span class="default">            tokvalue = tokvalue_it-&gt;tokvalue;</span>
<a name="4823"><font size=-1>4823     </font></a><span class="default">        }</span>
<a name="4824"><font size=-1>4824     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tokvalue || !tokvalue-&gt;isLiteral()) {</span>
<a name="4825"><font size=-1>4825     </font></a><span class="default">            *error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4826"><font size=-1>4826     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="4827"><font size=-1>4827     </font></a><span class="default">        }</span>
<a name="4828"><font size=-1>4828     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::string strValue = tokvalue-&gt;strValue();</span>
<a name="4829"><font size=-1>4829     </font></a><span class="default">        MathLib::bigint index = </span><span class="number">0</span><span class="default">;</span>
<a name="4830"><font size=-1>4830     </font></a><span class="default">        execute(expr-&gt;astOperand2(), programMemory, &amp;index, error);</span>
<a name="4831"><font size=-1>4831     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(index &gt;= </span><span class="number">0 </span><span class="default">&amp;&amp; index &lt; strValue.size())</span>
<a name="4832"><font size=-1>4832     </font></a><span class="default">            *result = strValue[index];</span>
<a name="4833"><font size=-1>4833     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(index == strValue.size())</span>
<a name="4834"><font size=-1>4834     </font></a><span class="default">            *result = </span><span class="number">0</span><span class="default">;</span>
<a name="4835"><font size=-1>4835     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="4836"><font size=-1>4836     </font></a><span class="keyword">            </span><span class="default">*error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4837"><font size=-1>4837     </font></a><span class="default">    }</span>
<a name="4838"><font size=-1>4838     </font></a><span class="default"></span>
<a name="4839"><font size=-1>4839     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="4840"><font size=-1>4840     </font></a><span class="keyword">        </span><span class="default">*error = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4841"><font size=-1>4841     </font></a><span class="default">}</span>
<a name="4842"><font size=-1>4842     </font></a><span class="default"></span>
<a name="4843"><font size=-1>4843     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isInBounds(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; value, MathLib::bigint x)</span>
<a name="4844"><font size=-1>4844     </font></a><span class="default">{</span>
<a name="4845"><font size=-1>4845     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.intvalue == x)</span>
<a name="4846"><font size=-1>4846     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="4847"><font size=-1>4847     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.bound == ValueFlow::Value::Bound::Lower &amp;&amp; value.intvalue &gt; x)</span>
<a name="4848"><font size=-1>4848     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4849"><font size=-1>4849     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(value.bound == ValueFlow::Value::Bound::Upper &amp;&amp; value.intvalue &lt; x)</span>
<a name="4850"><font size=-1>4850     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4851"><font size=-1>4851     </font></a><span class="default">    </span><span class="comment">// Checking for equality is not necessary since we already know the value is not equal</span>
<a name="4852"><font size=-1>4852     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(value.bound == ValueFlow::Value::Bound::Point)</span>
<a name="4853"><font size=-1>4853     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4854"><font size=-1>4854     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="4855"><font size=-1>4855     </font></a><span class="default">}</span>
<a name="4856"><font size=-1>4856     </font></a><span class="default"></span>
<a name="4857"><font size=-1>4857     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">ValueFlow::Value* proveNotEqual(</span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values, MathLib::bigint x)</span>
<a name="4858"><font size=-1>4858     </font></a><span class="default">{</span>
<a name="4859"><font size=-1>4859     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">ValueFlow::Value* result = nullptr;</span>
<a name="4860"><font size=-1>4860     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value&amp; value : values) {</span>
<a name="4861"><font size=-1>4861     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.valueType != ValueFlow::Value::INT)</span>
<a name="4862"><font size=-1>4862     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4863"><font size=-1>4863     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(result &amp;&amp; !isInBounds(value, result-&gt;intvalue))</span>
<a name="4864"><font size=-1>4864     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4865"><font size=-1>4865     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.isImpossible()) {</span>
<a name="4866"><font size=-1>4866     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(value.intvalue == x)</span>
<a name="4867"><font size=-1>4867     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">&amp;value;</span>
<a name="4868"><font size=-1>4868     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isInBounds(value, x))</span>
<a name="4869"><font size=-1>4869     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4870"><font size=-1>4870     </font></a><span class="default">            result = &amp;value;</span>
<a name="4871"><font size=-1>4871     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="4872"><font size=-1>4872     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(value.intvalue == x)</span>
<a name="4873"><font size=-1>4873     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="4874"><font size=-1>4874     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isInBounds(value, x))</span>
<a name="4875"><font size=-1>4875     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4876"><font size=-1>4876     </font></a><span class="default">            result = nullptr;</span>
<a name="4877"><font size=-1>4877     </font></a><span class="default">        }</span>
<a name="4878"><font size=-1>4878     </font></a><span class="default">    }</span>
<a name="4879"><font size=-1>4879     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">result;</span>
<a name="4880"><font size=-1>4880     </font></a><span class="default">}</span>
<a name="4881"><font size=-1>4881     </font></a><span class="default"></span>
<a name="4882"><font size=-1>4882     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowInferCondition(TokenList* tokenlist,</span>
<a name="4883"><font size=-1>4883     </font></a><span class="default">                                    </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="4884"><font size=-1>4884     </font></a><span class="default">{</span>
<a name="4885"><font size=-1>4885     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token* tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="4886"><font size=-1>4886     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astParent())</span>
<a name="4887"><font size=-1>4887     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4888"><font size=-1>4888     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="4889"><font size=-1>4889     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4890"><font size=-1>4890     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var%&quot;</span><span class="default">) &amp;&amp; (Token::Match(tok-&gt;astParent(), </span><span class="string">&quot;?|&amp;&amp;|!|%oror%&quot;</span><span class="default">) ||</span>
<a name="4891"><font size=-1>4891     </font></a><span class="default">                                           Token::Match(tok-&gt;astParent()-&gt;previous(), </span><span class="string">&quot;if|while (&quot;</span><span class="default">))) {</span>
<a name="4892"><font size=-1>4892     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueFlow::Value* result = proveNotEqual(tok-&gt;values(), </span><span class="number">0</span><span class="default">);</span>
<a name="4893"><font size=-1>4893     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!result)</span>
<a name="4894"><font size=-1>4894     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4895"><font size=-1>4895     </font></a><span class="default">            ValueFlow::Value value = *result;</span>
<a name="4896"><font size=-1>4896     </font></a><span class="default">            value.intvalue = </span><span class="number">1</span><span class="default">;</span>
<a name="4897"><font size=-1>4897     </font></a><span class="default">            value.setKnown();</span>
<a name="4898"><font size=-1>4898     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="4899"><font size=-1>4899     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;==|!=&quot;</span><span class="default">)) {</span>
<a name="4900"><font size=-1>4900     </font></a><span class="default">            MathLib::bigint val = </span><span class="number">0</span><span class="default">;</span>
<a name="4901"><font size=-1>4901     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* varTok = nullptr;</span>
<a name="4902"><font size=-1>4902     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;astOperand1()-&gt;hasKnownIntValue()) {</span>
<a name="4903"><font size=-1>4903     </font></a><span class="default">                val = tok-&gt;astOperand1()-&gt;values().front().intvalue;</span>
<a name="4904"><font size=-1>4904     </font></a><span class="default">                varTok = tok-&gt;astOperand2();</span>
<a name="4905"><font size=-1>4905     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(tok-&gt;astOperand2()-&gt;hasKnownIntValue()) {</span>
<a name="4906"><font size=-1>4906     </font></a><span class="default">                val = tok-&gt;astOperand2()-&gt;values().front().intvalue;</span>
<a name="4907"><font size=-1>4907     </font></a><span class="default">                varTok = tok-&gt;astOperand1();</span>
<a name="4908"><font size=-1>4908     </font></a><span class="default">            }</span>
<a name="4909"><font size=-1>4909     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!varTok)</span>
<a name="4910"><font size=-1>4910     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4911"><font size=-1>4911     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(varTok-&gt;hasKnownIntValue())</span>
<a name="4912"><font size=-1>4912     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4913"><font size=-1>4913     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ValueFlow::Value* result = proveNotEqual(varTok-&gt;values(), val);</span>
<a name="4914"><font size=-1>4914     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!result)</span>
<a name="4915"><font size=-1>4915     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="4916"><font size=-1>4916     </font></a><span class="default">            ValueFlow::Value value = *result;</span>
<a name="4917"><font size=-1>4917     </font></a><span class="default">            value.intvalue = tok-&gt;str() == </span><span class="string">&quot;!=&quot;</span><span class="default">;</span>
<a name="4918"><font size=-1>4918     </font></a><span class="default">            value.setKnown();</span>
<a name="4919"><font size=-1>4919     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="4920"><font size=-1>4920     </font></a><span class="default">        }</span>
<a name="4921"><font size=-1>4921     </font></a><span class="default">    }</span>
<a name="4922"><font size=-1>4922     </font></a><span class="default">}</span>
<a name="4923"><font size=-1>4923     </font></a><span class="default"></span>
<a name="4924"><font size=-1>4924     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">valueFlowForLoop1(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">int </span><span class="default">* </span><span class="keyword">const </span><span class="default">varid, MathLib::bigint * </span><span class="keyword">const </span><span class="default">num1, MathLib::bigint * </span><span class="keyword">const </span><span class="default">num2, MathLib::bigint * </span><span class="keyword">const </span><span class="default">numAfter)</span>
<a name="4925"><font size=-1>4925     </font></a><span class="default">{</span>
<a name="4926"><font size=-1>4926     </font></a><span class="default">    tok = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="4927"><font size=-1>4927     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%type%| %var% =&quot;</span><span class="default">))</span>
<a name="4928"><font size=-1>4928     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4929"><font size=-1>4929     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">vartok = Token::Match(tok, </span><span class="string">&quot;%var% =&quot;</span><span class="default">) ? tok : tok-&gt;next();</span>
<a name="4930"><font size=-1>4930     </font></a><span class="default">    *varid = vartok-&gt;varId();</span>
<a name="4931"><font size=-1>4931     </font></a><span class="default">    tok = vartok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="4932"><font size=-1>4932     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">num1tok = Token::Match(tok, </span><span class="string">&quot;%num% ;&quot;</span><span class="default">) ? tok : nullptr;</span>
<a name="4933"><font size=-1>4933     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(num1tok)</span>
<a name="4934"><font size=-1>4934     </font></a><span class="default">        *num1 = MathLib::toLongNumber(num1tok-&gt;str());</span>
<a name="4935"><font size=-1>4935     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name%|%num%|%or%|+|-|*|/|&amp;|[|]|(&quot;</span><span class="default">))</span>
<a name="4936"><font size=-1>4936     </font></a><span class="default">        tok = (tok-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">) ? tok-&gt;link()-&gt;next() : tok-&gt;next();</span>
<a name="4937"><font size=-1>4937     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok || tok-&gt;str() != </span><span class="string">&quot;;&quot;</span><span class="default">)</span>
<a name="4938"><font size=-1>4938     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4939"><font size=-1>4939     </font></a><span class="default">    tok = tok-&gt;next();</span>
<a name="4940"><font size=-1>4940     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *num2tok = nullptr;</span>
<a name="4941"><font size=-1>4941     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%varid% &lt;|&lt;=|!=&quot;</span><span class="default">, vartok-&gt;varId())) {</span>
<a name="4942"><font size=-1>4942     </font></a><span class="default">        tok = tok-&gt;next();</span>
<a name="4943"><font size=-1>4943     </font></a><span class="default">        num2tok = tok-&gt;astOperand2();</span>
<a name="4944"><font size=-1>4944     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(num2tok &amp;&amp; num2tok-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; !num2tok-&gt;astOperand2())</span>
<a name="4945"><font size=-1>4945     </font></a><span class="default">            num2tok = num2tok-&gt;astOperand1();</span>
<a name="4946"><font size=-1>4946     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(num2tok, </span><span class="string">&quot;%num% ;|%oror%&quot;</span><span class="default">)) </span><span class="comment">// TODO: || enlarges the scope of the condition, so it should not cause FP, but it should no lnger be part of this pattern as soon as valueFlowForLoop2 can handle an unknown RHS of || better</span>
<a name="4947"><font size=-1>4947     </font></a><span class="comment">            </span><span class="default">num2tok = nullptr;</span>
<a name="4948"><font size=-1>4948     </font></a><span class="default">    }</span>
<a name="4949"><font size=-1>4949     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!num2tok)</span>
<a name="4950"><font size=-1>4950     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4951"><font size=-1>4951     </font></a><span class="default">    *num2 = MathLib::toLongNumber(num2tok-&gt;str()) - ((tok-&gt;str()==</span><span class="string">&quot;&lt;=&quot;</span><span class="default">) ? </span><span class="number">0 </span><span class="default">: </span><span class="number">1</span><span class="default">);</span>
<a name="4952"><font size=-1>4952     </font></a><span class="default">    *numAfter = *num2 + </span><span class="number">1</span><span class="default">;</span>
<a name="4953"><font size=-1>4953     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!num1tok)</span>
<a name="4954"><font size=-1>4954     </font></a><span class="default">        *num1 = *num2;</span>
<a name="4955"><font size=-1>4955     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(tok &amp;&amp; tok-&gt;str() != </span><span class="string">&quot;;&quot;</span><span class="default">)</span>
<a name="4956"><font size=-1>4956     </font></a><span class="default">        tok = tok-&gt;next();</span>
<a name="4957"><font size=-1>4957     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;; %varid% ++ ) {&quot;</span><span class="default">, vartok-&gt;varId()) &amp;&amp; !Token::Match(tok, </span><span class="string">&quot;; ++ %varid% ) {&quot;</span><span class="default">, vartok-&gt;varId()))</span>
<a name="4958"><font size=-1>4958     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4959"><font size=-1>4959     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="4960"><font size=-1>4960     </font></a><span class="default">}</span>
<a name="4961"><font size=-1>4961     </font></a><span class="default"></span>
<a name="4962"><font size=-1>4962     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">valueFlowForLoop2(</span><span class="keyword">const </span><span class="default">Token *tok,</span>
<a name="4963"><font size=-1>4963     </font></a><span class="default">                              ProgramMemory *memory1,</span>
<a name="4964"><font size=-1>4964     </font></a><span class="default">                              ProgramMemory *memory2,</span>
<a name="4965"><font size=-1>4965     </font></a><span class="default">                              ProgramMemory *memoryAfter)</span>
<a name="4966"><font size=-1>4966     </font></a><span class="default">{</span>
<a name="4967"><font size=-1>4967     </font></a><span class="default">    </span><span class="comment">// for ( firstExpression ; secondExpression ; thirdExpression )</span>
<a name="4968"><font size=-1>4968     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Token *firstExpression  = tok-&gt;next()-&gt;astOperand2()-&gt;astOperand1();</span>
<a name="4969"><font size=-1>4969     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *secondExpression = tok-&gt;next()-&gt;astOperand2()-&gt;astOperand2()-&gt;astOperand1();</span>
<a name="4970"><font size=-1>4970     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *thirdExpression = tok-&gt;next()-&gt;astOperand2()-&gt;astOperand2()-&gt;astOperand2();</span>
<a name="4971"><font size=-1>4971     </font></a><span class="default"></span>
<a name="4972"><font size=-1>4972     </font></a><span class="default">    ProgramMemory programMemory;</span>
<a name="4973"><font size=-1>4973     </font></a><span class="default">    MathLib::bigint result(</span><span class="number">0</span><span class="default">);</span>
<a name="4974"><font size=-1>4974     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">error = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4975"><font size=-1>4975     </font></a><span class="default">    execute(firstExpression, &amp;programMemory, &amp;result, &amp;error);</span>
<a name="4976"><font size=-1>4976     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(error)</span>
<a name="4977"><font size=-1>4977     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4978"><font size=-1>4978     </font></a><span class="default">    execute(secondExpression, &amp;programMemory, &amp;result, &amp;error);</span>
<a name="4979"><font size=-1>4979     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(result == </span><span class="number">0</span><span class="default">) </span><span class="comment">// 2nd expression is false =&gt; no looping</span>
<a name="4980"><font size=-1>4980     </font></a><span class="comment">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4981"><font size=-1>4981     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(error) {</span>
<a name="4982"><font size=-1>4982     </font></a><span class="default">        </span><span class="comment">// If a variable is reassigned in second expression, return false</span>
<a name="4983"><font size=-1>4983     </font></a><span class="comment">        </span><span class="keyword">bool </span><span class="default">reassign = </span><span class="keyword">false</span><span class="default">;</span>
<a name="4984"><font size=-1>4984     </font></a><span class="default">        visitAstNodes(secondExpression,</span>
<a name="4985"><font size=-1>4985     </font></a><span class="default">        [&amp;](</span><span class="keyword">const </span><span class="default">Token *t) {</span>
<a name="4986"><font size=-1>4986     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(t-&gt;str() == </span><span class="string">&quot;=&quot; </span><span class="default">&amp;&amp; t-&gt;astOperand1() &amp;&amp; programMemory.hasValue(t-&gt;astOperand1()-&gt;varId()))</span>
<a name="4987"><font size=-1>4987     </font></a><span class="default">                </span><span class="comment">// TODO: investigate what variable is assigned.</span>
<a name="4988"><font size=-1>4988     </font></a><span class="comment">                </span><span class="default">reassign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="4989"><font size=-1>4989     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">reassign ? ChildrenToVisit::done : ChildrenToVisit::op1_and_op2;</span>
<a name="4990"><font size=-1>4990     </font></a><span class="default">        });</span>
<a name="4991"><font size=-1>4991     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(reassign)</span>
<a name="4992"><font size=-1>4992     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="4993"><font size=-1>4993     </font></a><span class="default">    }</span>
<a name="4994"><font size=-1>4994     </font></a><span class="default"></span>
<a name="4995"><font size=-1>4995     </font></a><span class="default">    ProgramMemory startMemory(programMemory);</span>
<a name="4996"><font size=-1>4996     </font></a><span class="default">    ProgramMemory endMemory;</span>
<a name="4997"><font size=-1>4997     </font></a><span class="default"></span>
<a name="4998"><font size=-1>4998     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">maxcount = </span><span class="number">10000</span><span class="default">;</span>
<a name="4999"><font size=-1>4999     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(result != </span><span class="number">0 </span><span class="default">&amp;&amp; !error &amp;&amp; --maxcount &gt; </span><span class="number">0</span><span class="default">) {</span>
<a name="5000"><font size=-1>5000     </font></a><span class="default">        endMemory = programMemory;</span>
<a name="5001"><font size=-1>5001     </font></a><span class="default">        execute(thirdExpression, &amp;programMemory, &amp;result, &amp;error);</span>
<a name="5002"><font size=-1>5002     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!error)</span>
<a name="5003"><font size=-1>5003     </font></a><span class="default">            execute(secondExpression, &amp;programMemory, &amp;result, &amp;error);</span>
<a name="5004"><font size=-1>5004     </font></a><span class="default">    }</span>
<a name="5005"><font size=-1>5005     </font></a><span class="default"></span>
<a name="5006"><font size=-1>5006     </font></a><span class="default">    memory1-&gt;swap(startMemory);</span>
<a name="5007"><font size=-1>5007     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!error) {</span>
<a name="5008"><font size=-1>5008     </font></a><span class="default">        memory2-&gt;swap(endMemory);</span>
<a name="5009"><font size=-1>5009     </font></a><span class="default">        memoryAfter-&gt;swap(programMemory);</span>
<a name="5010"><font size=-1>5010     </font></a><span class="default">    }</span>
<a name="5011"><font size=-1>5011     </font></a><span class="default"></span>
<a name="5012"><font size=-1>5012     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5013"><font size=-1>5013     </font></a><span class="default">}</span>
<a name="5014"><font size=-1>5014     </font></a><span class="default"></span>
<a name="5015"><font size=-1>5015     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForLoopSimplify(Token * </span><span class="keyword">const </span><span class="default">bodyStart, </span><span class="keyword">const </span><span class="default">nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">bool </span><span class="default">globalvar, </span><span class="keyword">const </span><span class="default">MathLib::bigint value, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5016"><font size=-1>5016     </font></a><span class="default">{</span>
<a name="5017"><font size=-1>5017     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">bodyEnd = bodyStart-&gt;link();</span>
<a name="5018"><font size=-1>5018     </font></a><span class="default"></span>
<a name="5019"><font size=-1>5019     </font></a><span class="default">    </span><span class="comment">// Is variable modified inside for loop</span>
<a name="5020"><font size=-1>5020     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(isVariableChanged(bodyStart, bodyEnd, varid, globalvar, settings, tokenlist-&gt;isCPP()))</span>
<a name="5021"><font size=-1>5021     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5022"><font size=-1>5022     </font></a><span class="default"></span>
<a name="5023"><font size=-1>5023     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok2 = bodyStart-&gt;next(); tok2 != bodyEnd; tok2 = tok2-&gt;next()) {</span>
<a name="5024"><font size=-1>5024     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok2-&gt;varId() == varid) {</span>
<a name="5025"><font size=-1>5025     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * parent = tok2-&gt;astParent();</span>
<a name="5026"><font size=-1>5026     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(parent) {</span>
<a name="5027"><font size=-1>5027     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">p = parent;</span>
<a name="5028"><font size=-1>5028     </font></a><span class="default">                parent = parent-&gt;astParent();</span>
<a name="5029"><font size=-1>5029     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!parent || parent-&gt;str() == </span><span class="string">&quot;:&quot;</span><span class="default">)</span>
<a name="5030"><font size=-1>5030     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="5031"><font size=-1>5031     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(parent-&gt;str() == </span><span class="string">&quot;?&quot;</span><span class="default">) {</span>
<a name="5032"><font size=-1>5032     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(parent-&gt;astOperand2() != p)</span>
<a name="5033"><font size=-1>5033     </font></a><span class="default">                        parent = nullptr;</span>
<a name="5034"><font size=-1>5034     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="5035"><font size=-1>5035     </font></a><span class="default">                }</span>
<a name="5036"><font size=-1>5036     </font></a><span class="default">            }</span>
<a name="5037"><font size=-1>5037     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(parent) {</span>
<a name="5038"><font size=-1>5038     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5039"><font size=-1>5039     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;For loop variable &quot; </span><span class="default">+ tok2-&gt;str() + </span><span class="string">&quot; stopping on ?&quot;</span><span class="default">);</span>
<a name="5040"><font size=-1>5040     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5041"><font size=-1>5041     </font></a><span class="default">            }</span>
<a name="5042"><font size=-1>5042     </font></a><span class="default"></span>
<a name="5043"><font size=-1>5043     </font></a><span class="default">            ValueFlow::Value value1(value);</span>
<a name="5044"><font size=-1>5044     </font></a><span class="default">            value1.varId = tok2-&gt;varId();</span>
<a name="5045"><font size=-1>5045     </font></a><span class="default">            setTokenValue(tok2, value1, settings);</span>
<a name="5046"><font size=-1>5046     </font></a><span class="default">        }</span>
<a name="5047"><font size=-1>5047     </font></a><span class="default"></span>
<a name="5048"><font size=-1>5048     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;%oror%|&amp;&amp;&quot;</span><span class="default">)) {</span>
<a name="5049"><font size=-1>5049     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">ProgramMemory programMemory(getProgramMemory(tok2-&gt;astTop(), varid, ValueFlow::Value(value)));</span>
<a name="5050"><font size=-1>5050     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">((tok2-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot; </span><span class="default">&amp;&amp; !conditionIsTrue(tok2-&gt;astOperand1(), programMemory)) ||</span>
<a name="5051"><font size=-1>5051     </font></a><span class="default">                (tok2-&gt;str() == </span><span class="string">&quot;||&quot; </span><span class="default">&amp;&amp; !conditionIsFalse(tok2-&gt;astOperand1(), programMemory))) {</span>
<a name="5052"><font size=-1>5052     </font></a><span class="default">                </span><span class="comment">// Skip second expression..</span>
<a name="5053"><font size=-1>5053     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">Token *parent = tok2;</span>
<a name="5054"><font size=-1>5054     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(parent &amp;&amp; parent-&gt;str() == tok2-&gt;str())</span>
<a name="5055"><font size=-1>5055     </font></a><span class="default">                    parent = parent-&gt;astParent();</span>
<a name="5056"><font size=-1>5056     </font></a><span class="default">                </span><span class="comment">// Jump to end of condition</span>
<a name="5057"><font size=-1>5057     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(parent &amp;&amp; parent-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">) {</span>
<a name="5058"><font size=-1>5058     </font></a><span class="default">                    tok2 = parent-&gt;link();</span>
<a name="5059"><font size=-1>5059     </font></a><span class="default">                    </span><span class="comment">// cast</span>
<a name="5060"><font size=-1>5060     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;) (&quot;</span><span class="default">))</span>
<a name="5061"><font size=-1>5061     </font></a><span class="default">                        tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="5062"><font size=-1>5062     </font></a><span class="default">                }</span>
<a name="5063"><font size=-1>5063     </font></a><span class="default">            }</span>
<a name="5064"><font size=-1>5064     </font></a><span class="default"></span>
<a name="5065"><font size=-1>5065     </font></a><span class="default">        }</span>
<a name="5066"><font size=-1>5066     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">((tok2-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot; </span><span class="default">&amp;&amp; conditionIsFalse(tok2-&gt;astOperand1(), getProgramMemory(tok2-&gt;astTop(), varid, ValueFlow::Value(value)))) ||</span>
<a name="5067"><font size=-1>5067     </font></a><span class="default">            (tok2-&gt;str() == </span><span class="string">&quot;||&quot; </span><span class="default">&amp;&amp; conditionIsTrue(tok2-&gt;astOperand1(), getProgramMemory(tok2-&gt;astTop(), varid, ValueFlow::Value(value)))))</span>
<a name="5068"><font size=-1>5068     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5069"><font size=-1>5069     </font></a><span class="default"></span>
<a name="5070"><font size=-1>5070     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;) {&quot;</span><span class="default">) &amp;&amp; Token::findmatch(tok2-&gt;link(), </span><span class="string">&quot;%varid%&quot;</span><span class="default">, tok2, varid)) {</span>
<a name="5071"><font size=-1>5071     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::findmatch(tok2, </span><span class="string">&quot;continue|break|return&quot;</span><span class="default">, tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">), varid)) {</span>
<a name="5072"><font size=-1>5072     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5073"><font size=-1>5073     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;For loop variable bailout on conditional continue|break|return&quot;</span><span class="default">);</span>
<a name="5074"><font size=-1>5074     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5075"><font size=-1>5075     </font></a><span class="default">            }</span>
<a name="5076"><font size=-1>5076     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5077"><font size=-1>5077     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;For loop variable skipping conditional scope&quot;</span><span class="default">);</span>
<a name="5078"><font size=-1>5078     </font></a><span class="default">            tok2 = tok2-&gt;next()-&gt;link();</span>
<a name="5079"><font size=-1>5079     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;} else {&quot;</span><span class="default">)) {</span>
<a name="5080"><font size=-1>5080     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::findmatch(tok2, </span><span class="string">&quot;continue|break|return&quot;</span><span class="default">, tok2-&gt;linkAt(</span><span class="number">2</span><span class="default">), varid)) {</span>
<a name="5081"><font size=-1>5081     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5082"><font size=-1>5082     </font></a><span class="default">                        bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;For loop variable bailout on conditional continue|break|return&quot;</span><span class="default">);</span>
<a name="5083"><font size=-1>5083     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="5084"><font size=-1>5084     </font></a><span class="default">                }</span>
<a name="5085"><font size=-1>5085     </font></a><span class="default"></span>
<a name="5086"><font size=-1>5086     </font></a><span class="default">                tok2 = tok2-&gt;linkAt(</span><span class="number">2</span><span class="default">);</span>
<a name="5087"><font size=-1>5087     </font></a><span class="default">            }</span>
<a name="5088"><font size=-1>5088     </font></a><span class="default">        }</span>
<a name="5089"><font size=-1>5089     </font></a><span class="default"></span>
<a name="5090"><font size=-1>5090     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;) {&quot;</span><span class="default">)) {</span>
<a name="5091"><font size=-1>5091     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5092"><font size=-1>5092     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok2, </span><span class="string">&quot;For loop skipping {} code&quot;</span><span class="default">);</span>
<a name="5093"><font size=-1>5093     </font></a><span class="default">            tok2 = tok2-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="5094"><font size=-1>5094     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2, </span><span class="string">&quot;} else {&quot;</span><span class="default">))</span>
<a name="5095"><font size=-1>5095     </font></a><span class="default">                tok2 = tok2-&gt;linkAt(</span><span class="number">2</span><span class="default">);</span>
<a name="5096"><font size=-1>5096     </font></a><span class="default">        }</span>
<a name="5097"><font size=-1>5097     </font></a><span class="default">    }</span>
<a name="5098"><font size=-1>5098     </font></a><span class="default">}</span>
<a name="5099"><font size=-1>5099     </font></a><span class="default"></span>
<a name="5100"><font size=-1>5100     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForLoopSimplifyAfter(Token *fortok, nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">MathLib::bigint num, TokenList *tokenlist, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5101"><font size=-1>5101     </font></a><span class="default">{</span>
<a name="5102"><font size=-1>5102     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *vartok = nullptr;</span>
<a name="5103"><font size=-1>5103     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = fortok; tok; tok = tok-&gt;next()) {</span>
<a name="5104"><font size=-1>5104     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == varid) {</span>
<a name="5105"><font size=-1>5105     </font></a><span class="default">            vartok = tok;</span>
<a name="5106"><font size=-1>5106     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5107"><font size=-1>5107     </font></a><span class="default">        }</span>
<a name="5108"><font size=-1>5108     </font></a><span class="default">    }</span>
<a name="5109"><font size=-1>5109     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vartok || !vartok-&gt;variable())</span>
<a name="5110"><font size=-1>5110     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5111"><font size=-1>5111     </font></a><span class="default"></span>
<a name="5112"><font size=-1>5112     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Variable *var = vartok-&gt;variable();</span>
<a name="5113"><font size=-1>5113     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *endToken = nullptr;</span>
<a name="5114"><font size=-1>5114     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(var-&gt;isLocal())</span>
<a name="5115"><font size=-1>5115     </font></a><span class="default">        endToken = var-&gt;typeStartToken()-&gt;scope()-&gt;bodyEnd;</span>
<a name="5116"><font size=-1>5116     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="5117"><font size=-1>5117     </font></a><span class="keyword">        </span><span class="default">endToken = fortok-&gt;scope()-&gt;bodyEnd;</span>
<a name="5118"><font size=-1>5118     </font></a><span class="default"></span>
<a name="5119"><font size=-1>5119     </font></a><span class="default">    std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5120"><font size=-1>5120     </font></a><span class="default">    values.emplace_back(num);</span>
<a name="5121"><font size=-1>5121     </font></a><span class="default">    values.back().errorPath.emplace_back(fortok,</span><span class="string">&quot;After for loop, &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; has value &quot; </span><span class="default">+ values.back().infoString());</span>
<a name="5122"><font size=-1>5122     </font></a><span class="default"></span>
<a name="5123"><font size=-1>5123     </font></a><span class="default">    valueFlowForwardVariable(</span>
<a name="5124"><font size=-1>5124     </font></a><span class="default">        fortok-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next(), endToken, var, varid, values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5125"><font size=-1>5125     </font></a><span class="default">}</span>
<a name="5126"><font size=-1>5126     </font></a><span class="default"></span>
<a name="5127"><font size=-1>5127     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowForLoop(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5128"><font size=-1>5128     </font></a><span class="default">{</span>
<a name="5129"><font size=-1>5129     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope &amp;scope : symboldatabase-&gt;scopeList) {</span>
<a name="5130"><font size=-1>5130     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope.type != Scope::eFor)</span>
<a name="5131"><font size=-1>5131     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5132"><font size=-1>5132     </font></a><span class="default"></span>
<a name="5133"><font size=-1>5133     </font></a><span class="default">        Token* tok = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(scope.classDef);</span>
<a name="5134"><font size=-1>5134     </font></a><span class="default">        Token* </span><span class="keyword">const </span><span class="default">bodyStart = </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(scope.bodyStart);</span>
<a name="5135"><font size=-1>5135     </font></a><span class="default"></span>
<a name="5136"><font size=-1>5136     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok-&gt;next()-&gt;astOperand2(), </span><span class="string">&quot;;&quot;</span><span class="default">) ||</span>
<a name="5137"><font size=-1>5137     </font></a><span class="default">            !Token::simpleMatch(tok-&gt;next()-&gt;astOperand2()-&gt;astOperand2(), </span><span class="string">&quot;;&quot;</span><span class="default">))</span>
<a name="5138"><font size=-1>5138     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5139"><font size=-1>5139     </font></a><span class="default"></span>
<a name="5140"><font size=-1>5140     </font></a><span class="default">        </span><span class="keyword">int </span><span class="default">varid(</span><span class="number">0</span><span class="default">);</span>
<a name="5141"><font size=-1>5141     </font></a><span class="default">        MathLib::bigint num1(</span><span class="number">0</span><span class="default">), num2(</span><span class="number">0</span><span class="default">), numAfter(</span><span class="number">0</span><span class="default">);</span>
<a name="5142"><font size=-1>5142     </font></a><span class="default"></span>
<a name="5143"><font size=-1>5143     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(valueFlowForLoop1(tok, &amp;varid, &amp;num1, &amp;num2, &amp;numAfter)) {</span>
<a name="5144"><font size=-1>5144     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(num1 &lt;= num2) {</span>
<a name="5145"><font size=-1>5145     </font></a><span class="default">                valueFlowForLoopSimplify(bodyStart, varid, </span><span class="keyword">false</span><span class="default">, num1, tokenlist, errorLogger, settings);</span>
<a name="5146"><font size=-1>5146     </font></a><span class="default">                valueFlowForLoopSimplify(bodyStart, varid, </span><span class="keyword">false</span><span class="default">, num2, tokenlist, errorLogger, settings);</span>
<a name="5147"><font size=-1>5147     </font></a><span class="default">                valueFlowForLoopSimplifyAfter(tok, varid, numAfter, tokenlist, errorLogger, settings);</span>
<a name="5148"><font size=-1>5148     </font></a><span class="default">            } </span><span class="keyword">else</span>
<a name="5149"><font size=-1>5149     </font></a><span class="keyword">                </span><span class="default">valueFlowForLoopSimplifyAfter(tok, varid, num1, tokenlist, errorLogger, settings);</span>
<a name="5150"><font size=-1>5150     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="5151"><font size=-1>5151     </font></a><span class="default">            ProgramMemory mem1, mem2, memAfter;</span>
<a name="5152"><font size=-1>5152     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(valueFlowForLoop2(tok, &amp;mem1, &amp;mem2, &amp;memAfter)) {</span>
<a name="5153"><font size=-1>5153     </font></a><span class="default">                std::map&lt;</span><span class="keyword">int</span><span class="default">, ValueFlow::Value&gt;::const_iterator it;</span>
<a name="5154"><font size=-1>5154     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(it = mem1.values.begin(); it != mem1.values.end(); ++it) {</span>
<a name="5155"><font size=-1>5155     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!it-&gt;second.isIntValue())</span>
<a name="5156"><font size=-1>5156     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5157"><font size=-1>5157     </font></a><span class="default">                    valueFlowForLoopSimplify(bodyStart, it-&gt;first, </span><span class="keyword">false</span><span class="default">, it-&gt;second.intvalue, tokenlist, errorLogger, settings);</span>
<a name="5158"><font size=-1>5158     </font></a><span class="default">                }</span>
<a name="5159"><font size=-1>5159     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(it = mem2.values.begin(); it != mem2.values.end(); ++it) {</span>
<a name="5160"><font size=-1>5160     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!it-&gt;second.isIntValue())</span>
<a name="5161"><font size=-1>5161     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5162"><font size=-1>5162     </font></a><span class="default">                    valueFlowForLoopSimplify(bodyStart, it-&gt;first, </span><span class="keyword">false</span><span class="default">, it-&gt;second.intvalue, tokenlist, errorLogger, settings);</span>
<a name="5163"><font size=-1>5163     </font></a><span class="default">                }</span>
<a name="5164"><font size=-1>5164     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(it = memAfter.values.begin(); it != memAfter.values.end(); ++it) {</span>
<a name="5165"><font size=-1>5165     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!it-&gt;second.isIntValue())</span>
<a name="5166"><font size=-1>5166     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5167"><font size=-1>5167     </font></a><span class="default">                    valueFlowForLoopSimplifyAfter(tok, it-&gt;first, it-&gt;second.intvalue, tokenlist, errorLogger, settings);</span>
<a name="5168"><font size=-1>5168     </font></a><span class="default">                }</span>
<a name="5169"><font size=-1>5169     </font></a><span class="default">            }</span>
<a name="5170"><font size=-1>5170     </font></a><span class="default">        }</span>
<a name="5171"><font size=-1>5171     </font></a><span class="default">    }</span>
<a name="5172"><font size=-1>5172     </font></a><span class="default">}</span>
<a name="5173"><font size=-1>5173     </font></a><span class="default"></span>
<a name="5174"><font size=-1>5174     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowInjectParameter(TokenList* tokenlist, ErrorLogger* errorLogger, </span><span class="keyword">const </span><span class="default">Settings* settings, </span><span class="keyword">const </span><span class="default">Variable* arg, </span><span class="keyword">const </span><span class="default">Scope* functionScope, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; argvalues)</span>
<a name="5175"><font size=-1>5175     </font></a><span class="default">{</span>
<a name="5176"><font size=-1>5176     </font></a><span class="default">    </span><span class="comment">// Is argument passed by value or const reference, and is it a known non-class type?</span>
<a name="5177"><font size=-1>5177     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(arg-&gt;isReference() &amp;&amp; !arg-&gt;isConst() &amp;&amp; !arg-&gt;isClass())</span>
<a name="5178"><font size=-1>5178     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5179"><font size=-1>5179     </font></a><span class="default"></span>
<a name="5180"><font size=-1>5180     </font></a><span class="default">    </span><span class="comment">// Set value in function scope..</span>
<a name="5181"><font size=-1>5181     </font></a><span class="comment">    </span><span class="keyword">const int </span><span class="default">varid2 = arg-&gt;declarationId();</span>
<a name="5182"><font size=-1>5182     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!varid2)</span>
<a name="5183"><font size=-1>5183     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5184"><font size=-1>5184     </font></a><span class="default"></span>
<a name="5185"><font size=-1>5185     </font></a><span class="default">    valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(functionScope-&gt;bodyStart-&gt;next()),</span>
<a name="5186"><font size=-1>5186     </font></a><span class="default">                             functionScope-&gt;bodyEnd,</span>
<a name="5187"><font size=-1>5187     </font></a><span class="default">                             arg,</span>
<a name="5188"><font size=-1>5188     </font></a><span class="default">                             varid2,</span>
<a name="5189"><font size=-1>5189     </font></a><span class="default">                             argvalues,</span>
<a name="5190"><font size=-1>5190     </font></a><span class="default">                             </span><span class="keyword">false</span><span class="default">,</span>
<a name="5191"><font size=-1>5191     </font></a><span class="default">                             </span><span class="keyword">true</span><span class="default">,</span>
<a name="5192"><font size=-1>5192     </font></a><span class="default">                             tokenlist,</span>
<a name="5193"><font size=-1>5193     </font></a><span class="default">                             errorLogger,</span>
<a name="5194"><font size=-1>5194     </font></a><span class="default">                             settings);</span>
<a name="5195"><font size=-1>5195     </font></a><span class="default">}</span>
<a name="5196"><font size=-1>5196     </font></a><span class="default"></span>
<a name="5197"><font size=-1>5197     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSwitchVariable(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5198"><font size=-1>5198     </font></a><span class="default">{</span>
<a name="5199"><font size=-1>5199     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope &amp;scope : symboldatabase-&gt;scopeList) {</span>
<a name="5200"><font size=-1>5200     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope.type != Scope::ScopeType::eSwitch)</span>
<a name="5201"><font size=-1>5201     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5202"><font size=-1>5202     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(scope.classDef, </span><span class="string">&quot;switch ( %var% ) {&quot;</span><span class="default">))</span>
<a name="5203"><font size=-1>5203     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5204"><font size=-1>5204     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vartok = scope.classDef-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="5205"><font size=-1>5205     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var = vartok-&gt;variable();</span>
<a name="5206"><font size=-1>5206     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="5207"><font size=-1>5207     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5208"><font size=-1>5208     </font></a><span class="default"></span>
<a name="5209"><font size=-1>5209     </font></a><span class="default">        </span><span class="comment">// bailout: global non-const variables</span>
<a name="5210"><font size=-1>5210     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!(var-&gt;isLocal() || var-&gt;isArgument()) &amp;&amp; !var-&gt;isConst()) {</span>
<a name="5211"><font size=-1>5211     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(settings-&gt;debugwarnings)</span>
<a name="5212"><font size=-1>5212     </font></a><span class="default">                bailout(tokenlist, errorLogger, vartok, </span><span class="string">&quot;switch variable &quot; </span><span class="default">+ var-&gt;name() + </span><span class="string">&quot; is global&quot;</span><span class="default">);</span>
<a name="5213"><font size=-1>5213     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5214"><font size=-1>5214     </font></a><span class="default">        }</span>
<a name="5215"><font size=-1>5215     </font></a><span class="default"></span>
<a name="5216"><font size=-1>5216     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(Token *tok = scope.bodyStart-&gt;next(); tok != scope.bodyEnd; tok = tok-&gt;next()) {</span>
<a name="5217"><font size=-1>5217     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">) {</span>
<a name="5218"><font size=-1>5218     </font></a><span class="default">                tok = tok-&gt;link();</span>
<a name="5219"><font size=-1>5219     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5220"><font size=-1>5220     </font></a><span class="default">            }</span>
<a name="5221"><font size=-1>5221     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;case %num% :&quot;</span><span class="default">)) {</span>
<a name="5222"><font size=-1>5222     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5223"><font size=-1>5223     </font></a><span class="default">                values.emplace_back(MathLib::toLongNumber(tok-&gt;next()-&gt;str()));</span>
<a name="5224"><font size=-1>5224     </font></a><span class="default">                values.back().condition = tok;</span>
<a name="5225"><font size=-1>5225     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::string info(</span><span class="string">&quot;case &quot; </span><span class="default">+ tok-&gt;next()-&gt;str() + </span><span class="string">&quot;: &quot; </span><span class="default">+ vartok-&gt;str() + </span><span class="string">&quot; is &quot; </span><span class="default">+ tok-&gt;next()-&gt;str() + </span><span class="string">&quot; here.&quot;</span><span class="default">);</span>
<a name="5226"><font size=-1>5226     </font></a><span class="default">                values.back().errorPath.emplace_back(tok, info);</span>
<a name="5227"><font size=-1>5227     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">known = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5228"><font size=-1>5228     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">((Token::simpleMatch(tok-&gt;previous(), </span><span class="string">&quot;{&quot;</span><span class="default">) || Token::simpleMatch(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;break ;&quot;</span><span class="default">)) &amp;&amp; !Token::Match(tok-&gt;tokAt(</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;;| case&quot;</span><span class="default">))</span>
<a name="5229"><font size=-1>5229     </font></a><span class="default">                    known = </span><span class="keyword">true</span><span class="default">;</span>
<a name="5230"><font size=-1>5230     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(Token::Match(tok-&gt;tokAt(</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;;| case %num% :&quot;</span><span class="default">)) {</span>
<a name="5231"><font size=-1>5231     </font></a><span class="default">                    known = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5232"><font size=-1>5232     </font></a><span class="default">                    tok = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="5233"><font size=-1>5233     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!tok-&gt;isName())</span>
<a name="5234"><font size=-1>5234     </font></a><span class="default">                        tok = tok-&gt;next();</span>
<a name="5235"><font size=-1>5235     </font></a><span class="default">                    values.emplace_back(MathLib::toLongNumber(tok-&gt;next()-&gt;str()));</span>
<a name="5236"><font size=-1>5236     </font></a><span class="default">                    values.back().condition = tok;</span>
<a name="5237"><font size=-1>5237     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">std::string info2(</span><span class="string">&quot;case &quot; </span><span class="default">+ tok-&gt;next()-&gt;str() + </span><span class="string">&quot;: &quot; </span><span class="default">+ vartok-&gt;str() + </span><span class="string">&quot; is &quot; </span><span class="default">+ tok-&gt;next()-&gt;str() + </span><span class="string">&quot; here.&quot;</span><span class="default">);</span>
<a name="5238"><font size=-1>5238     </font></a><span class="default">                    values.back().errorPath.emplace_back(tok, info2);</span>
<a name="5239"><font size=-1>5239     </font></a><span class="default">                }</span>
<a name="5240"><font size=-1>5240     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(std::list&lt;ValueFlow::Value&gt;::const_iterator val = values.begin(); val != values.end(); ++val) {</span>
<a name="5241"><font size=-1>5241     </font></a><span class="default">                    valueFlowReverse(tokenlist,</span>
<a name="5242"><font size=-1>5242     </font></a><span class="default">                                     </span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(scope.classDef),</span>
<a name="5243"><font size=-1>5243     </font></a><span class="default">                                     vartok,</span>
<a name="5244"><font size=-1>5244     </font></a><span class="default">                                     *val,</span>
<a name="5245"><font size=-1>5245     </font></a><span class="default">                                     ValueFlow::Value(),</span>
<a name="5246"><font size=-1>5246     </font></a><span class="default">                                     errorLogger,</span>
<a name="5247"><font size=-1>5247     </font></a><span class="default">                                     settings);</span>
<a name="5248"><font size=-1>5248     </font></a><span class="default">                }</span>
<a name="5249"><font size=-1>5249     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(vartok-&gt;variable()-&gt;scope()) {</span>
<a name="5250"><font size=-1>5250     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(known)</span>
<a name="5251"><font size=-1>5251     </font></a><span class="default">                        values.back().setKnown();</span>
<a name="5252"><font size=-1>5252     </font></a><span class="default">                    valueFlowForwardVariable(tok-&gt;tokAt(</span><span class="number">3</span><span class="default">),</span>
<a name="5253"><font size=-1>5253     </font></a><span class="default">                                             vartok-&gt;variable()-&gt;scope()-&gt;bodyEnd,</span>
<a name="5254"><font size=-1>5254     </font></a><span class="default">                                             vartok-&gt;variable(),</span>
<a name="5255"><font size=-1>5255     </font></a><span class="default">                                             vartok-&gt;varId(),</span>
<a name="5256"><font size=-1>5256     </font></a><span class="default">                                             values,</span>
<a name="5257"><font size=-1>5257     </font></a><span class="default">                                             values.back().isKnown(),</span>
<a name="5258"><font size=-1>5258     </font></a><span class="default">                                             </span><span class="keyword">false</span><span class="default">,</span>
<a name="5259"><font size=-1>5259     </font></a><span class="default">                                             tokenlist,</span>
<a name="5260"><font size=-1>5260     </font></a><span class="default">                                             errorLogger,</span>
<a name="5261"><font size=-1>5261     </font></a><span class="default">                                             settings);</span>
<a name="5262"><font size=-1>5262     </font></a><span class="default">                }</span>
<a name="5263"><font size=-1>5263     </font></a><span class="default">            }</span>
<a name="5264"><font size=-1>5264     </font></a><span class="default">        }</span>
<a name="5265"><font size=-1>5265     </font></a><span class="default">    }</span>
<a name="5266"><font size=-1>5266     </font></a><span class="default">}</span>
<a name="5267"><font size=-1>5267     </font></a><span class="default"></span>
<a name="5268"><font size=-1>5268     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">setTokenValues(Token *tok, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; &amp;values, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5269"><font size=-1>5269     </font></a><span class="default">{</span>
<a name="5270"><font size=-1>5270     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value : values) {</span>
<a name="5271"><font size=-1>5271     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(value.isIntValue())</span>
<a name="5272"><font size=-1>5272     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="5273"><font size=-1>5273     </font></a><span class="default">    }</span>
<a name="5274"><font size=-1>5274     </font></a><span class="default">}</span>
<a name="5275"><font size=-1>5275     </font></a><span class="default"></span>
<a name="5276"><font size=-1>5276     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">evaluate(</span><span class="keyword">const </span><span class="default">Token *expr, </span><span class="keyword">const </span><span class="default">std::vector&lt;std::list&lt;ValueFlow::Value&gt;&gt; &amp;values, std::list&lt;ValueFlow::Value&gt; *result)</span>
<a name="5277"><font size=-1>5277     </font></a><span class="default">{</span>
<a name="5278"><font size=-1>5278     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!expr)</span>
<a name="5279"><font size=-1>5279     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5280"><font size=-1>5280     </font></a><span class="default"></span>
<a name="5281"><font size=-1>5281     </font></a><span class="default">    </span><span class="comment">// strlen(arg)..</span>
<a name="5282"><font size=-1>5282     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; Token::Match(expr-&gt;previous(), </span><span class="string">&quot;strlen ( %name% )&quot;</span><span class="default">)) {</span>
<a name="5283"><font size=-1>5283     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *arg = expr-&gt;next();</span>
<a name="5284"><font size=-1>5284     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(arg-&gt;str().compare(</span><span class="number">0</span><span class="default">,</span><span class="number">3</span><span class="default">,</span><span class="string">&quot;arg&quot;</span><span class="default">) != </span><span class="number">0 </span><span class="default">|| arg-&gt;str().size() != </span><span class="number">4</span><span class="default">)</span>
<a name="5285"><font size=-1>5285     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5286"><font size=-1>5286     </font></a><span class="default">        </span><span class="keyword">const char </span><span class="default">n = arg-&gt;str()[</span><span class="number">3</span><span class="default">];</span>
<a name="5287"><font size=-1>5287     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(n &lt; </span><span class="string">'1' </span><span class="default">|| n - </span><span class="string">'1' </span><span class="default">&gt;= values.size())</span>
<a name="5288"><font size=-1>5288     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5289"><font size=-1>5289     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;argvalue : values[n - </span><span class="string">'1'</span><span class="default">]) {</span>
<a name="5290"><font size=-1>5290     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(argvalue.isTokValue() &amp;&amp; argvalue.tokvalue-&gt;tokType() == Token::eString) {</span>
<a name="5291"><font size=-1>5291     </font></a><span class="default">                ValueFlow::Value res(argvalue); </span><span class="comment">// copy all &quot;inconclusive&quot;, &quot;condition&quot;, etc attributes</span>
<a name="5292"><font size=-1>5292     </font></a><span class="comment">                // set return value..</span>
<a name="5293"><font size=-1>5293     </font></a><span class="comment">                </span><span class="default">res.valueType = ValueFlow::Value::INT;</span>
<a name="5294"><font size=-1>5294     </font></a><span class="default">                res.tokvalue = nullptr;</span>
<a name="5295"><font size=-1>5295     </font></a><span class="default">                res.intvalue = Token::getStrLength(argvalue.tokvalue);</span>
<a name="5296"><font size=-1>5296     </font></a><span class="default">                result-&gt;emplace_back(std::move(res));</span>
<a name="5297"><font size=-1>5297     </font></a><span class="default">            }</span>
<a name="5298"><font size=-1>5298     </font></a><span class="default">        }</span>
<a name="5299"><font size=-1>5299     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">!result-&gt;empty();</span>
<a name="5300"><font size=-1>5300     </font></a><span class="default">    }</span>
<a name="5301"><font size=-1>5301     </font></a><span class="default"></span>
<a name="5302"><font size=-1>5302     </font></a><span class="default">    </span><span class="comment">// unary operands</span>
<a name="5303"><font size=-1>5303     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(expr-&gt;astOperand1() &amp;&amp; !expr-&gt;astOperand2()) {</span>
<a name="5304"><font size=-1>5304     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; opvalues;</span>
<a name="5305"><font size=-1>5305     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!evaluate(expr-&gt;astOperand1(), values, &amp;opvalues))</span>
<a name="5306"><font size=-1>5306     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5307"><font size=-1>5307     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;+&quot;</span><span class="default">) {</span>
<a name="5308"><font size=-1>5308     </font></a><span class="default">            result-&gt;swap(opvalues);</span>
<a name="5309"><font size=-1>5309     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5310"><font size=-1>5310     </font></a><span class="default">        }</span>
<a name="5311"><font size=-1>5311     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;-&quot;</span><span class="default">) {</span>
<a name="5312"><font size=-1>5312     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(ValueFlow::Value v: opvalues) {</span>
<a name="5313"><font size=-1>5313     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(v.isIntValue()) {</span>
<a name="5314"><font size=-1>5314     </font></a><span class="default">                    v.intvalue = -v.intvalue;</span>
<a name="5315"><font size=-1>5315     </font></a><span class="default">                    result-&gt;emplace_back(std::move(v));</span>
<a name="5316"><font size=-1>5316     </font></a><span class="default">                }</span>
<a name="5317"><font size=-1>5317     </font></a><span class="default">            }</span>
<a name="5318"><font size=-1>5318     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5319"><font size=-1>5319     </font></a><span class="default">        }</span>
<a name="5320"><font size=-1>5320     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5321"><font size=-1>5321     </font></a><span class="default">    }</span>
<a name="5322"><font size=-1>5322     </font></a><span class="default">    </span><span class="comment">// binary/ternary operands</span>
<a name="5323"><font size=-1>5323     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(expr-&gt;astOperand1() &amp;&amp; expr-&gt;astOperand2()) {</span>
<a name="5324"><font size=-1>5324     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; lhsValues, rhsValues;</span>
<a name="5325"><font size=-1>5325     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!evaluate(expr-&gt;astOperand1(), values, &amp;lhsValues))</span>
<a name="5326"><font size=-1>5326     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5327"><font size=-1>5327     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(expr-&gt;str() != </span><span class="string">&quot;?&quot; </span><span class="default">&amp;&amp; !evaluate(expr-&gt;astOperand2(), values, &amp;rhsValues))</span>
<a name="5328"><font size=-1>5328     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5329"><font size=-1>5329     </font></a><span class="default"></span>
<a name="5330"><font size=-1>5330     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val1 : lhsValues) {</span>
<a name="5331"><font size=-1>5331     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!val1.isIntValue())</span>
<a name="5332"><font size=-1>5332     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5333"><font size=-1>5333     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;?&quot;</span><span class="default">) {</span>
<a name="5334"><font size=-1>5334     </font></a><span class="default">                rhsValues.clear();</span>
<a name="5335"><font size=-1>5335     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *expr2 = val1.intvalue ? expr-&gt;astOperand2()-&gt;astOperand1() : expr-&gt;astOperand2()-&gt;astOperand2();</span>
<a name="5336"><font size=-1>5336     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!evaluate(expr2, values, &amp;rhsValues))</span>
<a name="5337"><font size=-1>5337     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5338"><font size=-1>5338     </font></a><span class="default">                result-&gt;insert(result-&gt;end(), rhsValues.begin(), rhsValues.end());</span>
<a name="5339"><font size=-1>5339     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5340"><font size=-1>5340     </font></a><span class="default">            }</span>
<a name="5341"><font size=-1>5341     </font></a><span class="default"></span>
<a name="5342"><font size=-1>5342     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;val2 : rhsValues) {</span>
<a name="5343"><font size=-1>5343     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!val2.isIntValue())</span>
<a name="5344"><font size=-1>5344     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5345"><font size=-1>5345     </font></a><span class="default"></span>
<a name="5346"><font size=-1>5346     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(val1.varId != </span><span class="number">0 </span><span class="default">&amp;&amp; val2.varId != </span><span class="number">0</span><span class="default">) {</span>
<a name="5347"><font size=-1>5347     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(val1.varId != val2.varId || val1.varvalue != val2.varvalue)</span>
<a name="5348"><font size=-1>5348     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5349"><font size=-1>5349     </font></a><span class="default">                }</span>
<a name="5350"><font size=-1>5350     </font></a><span class="default"></span>
<a name="5351"><font size=-1>5351     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;+&quot;</span><span class="default">)</span>
<a name="5352"><font size=-1>5352     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue + val2.intvalue));</span>
<a name="5353"><font size=-1>5353     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;-&quot;</span><span class="default">)</span>
<a name="5354"><font size=-1>5354     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue - val2.intvalue));</span>
<a name="5355"><font size=-1>5355     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;*&quot;</span><span class="default">)</span>
<a name="5356"><font size=-1>5356     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue * val2.intvalue));</span>
<a name="5357"><font size=-1>5357     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;/&quot; </span><span class="default">&amp;&amp; val2.intvalue != </span><span class="number">0</span><span class="default">)</span>
<a name="5358"><font size=-1>5358     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue / val2.intvalue));</span>
<a name="5359"><font size=-1>5359     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;%&quot; </span><span class="default">&amp;&amp; val2.intvalue != </span><span class="number">0</span><span class="default">)</span>
<a name="5360"><font size=-1>5360     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue % val2.intvalue));</span>
<a name="5361"><font size=-1>5361     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="5362"><font size=-1>5362     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &amp; val2.intvalue));</span>
<a name="5363"><font size=-1>5363     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;|&quot;</span><span class="default">)</span>
<a name="5364"><font size=-1>5364     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue | val2.intvalue));</span>
<a name="5365"><font size=-1>5365     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;^&quot;</span><span class="default">)</span>
<a name="5366"><font size=-1>5366     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue ^ val2.intvalue));</span>
<a name="5367"><font size=-1>5367     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;==&quot;</span><span class="default">)</span>
<a name="5368"><font size=-1>5368     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue == val2.intvalue));</span>
<a name="5369"><font size=-1>5369     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;!=&quot;</span><span class="default">)</span>
<a name="5370"><font size=-1>5370     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue != val2.intvalue));</span>
<a name="5371"><font size=-1>5371     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;&quot;</span><span class="default">)</span>
<a name="5372"><font size=-1>5372     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &lt; val2.intvalue));</span>
<a name="5373"><font size=-1>5373     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;&quot;</span><span class="default">)</span>
<a name="5374"><font size=-1>5374     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &gt; val2.intvalue));</span>
<a name="5375"><font size=-1>5375     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;=&quot;</span><span class="default">)</span>
<a name="5376"><font size=-1>5376     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &gt;= val2.intvalue));</span>
<a name="5377"><font size=-1>5377     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;=&quot;</span><span class="default">)</span>
<a name="5378"><font size=-1>5378     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &lt;= val2.intvalue));</span>
<a name="5379"><font size=-1>5379     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&amp;&amp;&quot;</span><span class="default">)</span>
<a name="5380"><font size=-1>5380     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &amp;&amp; val2.intvalue));</span>
<a name="5381"><font size=-1>5381     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;||&quot;</span><span class="default">)</span>
<a name="5382"><font size=-1>5382     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue || val2.intvalue));</span>
<a name="5383"><font size=-1>5383     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&lt;&lt;&quot;</span><span class="default">)</span>
<a name="5384"><font size=-1>5384     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &lt;&lt; val2.intvalue));</span>
<a name="5385"><font size=-1>5385     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(expr-&gt;str() == </span><span class="string">&quot;&gt;&gt;&quot;</span><span class="default">)</span>
<a name="5386"><font size=-1>5386     </font></a><span class="default">                    result-&gt;emplace_back(ValueFlow::Value(val1.intvalue &gt;&gt; val2.intvalue));</span>
<a name="5387"><font size=-1>5387     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="5388"><font size=-1>5388     </font></a><span class="keyword">                    return false</span><span class="default">;</span>
<a name="5389"><font size=-1>5389     </font></a><span class="default">                combineValueProperties(val1, val2, &amp;result-&gt;back());</span>
<a name="5390"><font size=-1>5390     </font></a><span class="default">            }</span>
<a name="5391"><font size=-1>5391     </font></a><span class="default">        }</span>
<a name="5392"><font size=-1>5392     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">!result-&gt;empty();</span>
<a name="5393"><font size=-1>5393     </font></a><span class="default">    }</span>
<a name="5394"><font size=-1>5394     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;str().compare(</span><span class="number">0</span><span class="default">,</span><span class="number">3</span><span class="default">,</span><span class="string">&quot;arg&quot;</span><span class="default">)==</span><span class="number">0</span><span class="default">) {</span>
<a name="5395"><font size=-1>5395     </font></a><span class="default">        *result = values[expr-&gt;str()[</span><span class="number">3</span><span class="default">] - </span><span class="string">'1'</span><span class="default">];</span>
<a name="5396"><font size=-1>5396     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5397"><font size=-1>5397     </font></a><span class="default">    }</span>
<a name="5398"><font size=-1>5398     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr-&gt;isNumber()) {</span>
<a name="5399"><font size=-1>5399     </font></a><span class="default">        result-&gt;emplace_back(ValueFlow::Value(MathLib::toLongNumber(expr-&gt;str())));</span>
<a name="5400"><font size=-1>5400     </font></a><span class="default">        result-&gt;back().setKnown();</span>
<a name="5401"><font size=-1>5401     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5402"><font size=-1>5402     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(expr-&gt;tokType() == Token::eChar) {</span>
<a name="5403"><font size=-1>5403     </font></a><span class="default">        result-&gt;emplace_back(ValueFlow::Value(MathLib::toLongNumber(expr-&gt;str())));</span>
<a name="5404"><font size=-1>5404     </font></a><span class="default">        result-&gt;back().setKnown();</span>
<a name="5405"><font size=-1>5405     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5406"><font size=-1>5406     </font></a><span class="default">    }</span>
<a name="5407"><font size=-1>5407     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5408"><font size=-1>5408     </font></a><span class="default">}</span>
<a name="5409"><font size=-1>5409     </font></a><span class="default"></span>
<a name="5410"><font size=-1>5410     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::list&lt;ValueFlow::Value&gt; getFunctionArgumentValues(</span><span class="keyword">const </span><span class="default">Token *argtok)</span>
<a name="5411"><font size=-1>5411     </font></a><span class="default">{</span>
<a name="5412"><font size=-1>5412     </font></a><span class="default">    std::list&lt;ValueFlow::Value&gt; argvalues(argtok-&gt;values());</span>
<a name="5413"><font size=-1>5413     </font></a><span class="default">    removeImpossible(argvalues);</span>
<a name="5414"><font size=-1>5414     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(argvalues.empty() &amp;&amp; Token::Match(argtok, </span><span class="string">&quot;%comp%|%oror%|&amp;&amp;|!&quot;</span><span class="default">)) {</span>
<a name="5415"><font size=-1>5415     </font></a><span class="default">        argvalues.emplace_back(</span><span class="number">0</span><span class="default">);</span>
<a name="5416"><font size=-1>5416     </font></a><span class="default">        argvalues.emplace_back(</span><span class="number">1</span><span class="default">);</span>
<a name="5417"><font size=-1>5417     </font></a><span class="default">    }</span>
<a name="5418"><font size=-1>5418     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">argvalues;</span>
<a name="5419"><font size=-1>5419     </font></a><span class="default">}</span>
<a name="5420"><font size=-1>5420     </font></a><span class="default"></span>
<a name="5421"><font size=-1>5421     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowLibraryFunction(Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;returnValue, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5422"><font size=-1>5422     </font></a><span class="default">{</span>
<a name="5423"><font size=-1>5423     </font></a><span class="default">    std::vector&lt;std::list&lt;ValueFlow::Value&gt;&gt; argValues;</span>
<a name="5424"><font size=-1>5424     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *argtok : getArguments(tok-&gt;previous())) {</span>
<a name="5425"><font size=-1>5425     </font></a><span class="default">        argValues.emplace_back(getFunctionArgumentValues(argtok));</span>
<a name="5426"><font size=-1>5426     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(argValues.back().empty())</span>
<a name="5427"><font size=-1>5427     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="5428"><font size=-1>5428     </font></a><span class="default">    }</span>
<a name="5429"><font size=-1>5429     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(returnValue.find(</span><span class="string">&quot;arg&quot;</span><span class="default">) != std::string::npos &amp;&amp; argValues.empty())</span>
<a name="5430"><font size=-1>5430     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5431"><font size=-1>5431     </font></a><span class="default"></span>
<a name="5432"><font size=-1>5432     </font></a><span class="default">    TokenList tokenList(settings);</span>
<a name="5433"><font size=-1>5433     </font></a><span class="default">    {</span>
<a name="5434"><font size=-1>5434     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::string code = </span><span class="string">&quot;return &quot; </span><span class="default">+ returnValue + </span><span class="string">&quot;;&quot;</span><span class="default">;</span>
<a name="5435"><font size=-1>5435     </font></a><span class="default">        std::istringstream istr(code);</span>
<a name="5436"><font size=-1>5436     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tokenList.createTokens(istr))</span>
<a name="5437"><font size=-1>5437     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="5438"><font size=-1>5438     </font></a><span class="default">    }</span>
<a name="5439"><font size=-1>5439     </font></a><span class="default"></span>
<a name="5440"><font size=-1>5440     </font></a><span class="default">    </span><span class="comment">// combine operators, set links, etc..</span>
<a name="5441"><font size=-1>5441     </font></a><span class="comment">    </span><span class="default">std::stack&lt;Token *&gt; lpar;</span>
<a name="5442"><font size=-1>5442     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok2 = tokenList.front(); tok2; tok2 = tok2-&gt;next()) {</span>
<a name="5443"><font size=-1>5443     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[!&lt;&gt;=] =&quot;</span><span class="default">)) {</span>
<a name="5444"><font size=-1>5444     </font></a><span class="default">            tok2-&gt;str(tok2-&gt;str() + </span><span class="string">&quot;=&quot;</span><span class="default">);</span>
<a name="5445"><font size=-1>5445     </font></a><span class="default">            tok2-&gt;deleteNext();</span>
<a name="5446"><font size=-1>5446     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="5447"><font size=-1>5447     </font></a><span class="default">            lpar.push(tok2);</span>
<a name="5448"><font size=-1>5448     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;)&quot;</span><span class="default">) {</span>
<a name="5449"><font size=-1>5449     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(lpar.empty())</span>
<a name="5450"><font size=-1>5450     </font></a><span class="default">                </span><span class="keyword">return</span><span class="default">;</span>
<a name="5451"><font size=-1>5451     </font></a><span class="default">            Token::createMutualLinks(lpar.top(), tok2);</span>
<a name="5452"><font size=-1>5452     </font></a><span class="default">            lpar.pop();</span>
<a name="5453"><font size=-1>5453     </font></a><span class="default">        }</span>
<a name="5454"><font size=-1>5454     </font></a><span class="default">    }</span>
<a name="5455"><font size=-1>5455     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!lpar.empty())</span>
<a name="5456"><font size=-1>5456     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5457"><font size=-1>5457     </font></a><span class="default"></span>
<a name="5458"><font size=-1>5458     </font></a><span class="default">    </span><span class="comment">// Evaluate expression</span>
<a name="5459"><font size=-1>5459     </font></a><span class="comment">    </span><span class="default">tokenList.createAst();</span>
<a name="5460"><font size=-1>5460     </font></a><span class="default">    std::list&lt;ValueFlow::Value&gt; results;</span>
<a name="5461"><font size=-1>5461     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(evaluate(tokenList.front()-&gt;astOperand1(), argValues, &amp;results))</span>
<a name="5462"><font size=-1>5462     </font></a><span class="default">        setTokenValues(tok, results, settings);</span>
<a name="5463"><font size=-1>5463     </font></a><span class="default">}</span>
<a name="5464"><font size=-1>5464     </font></a><span class="default"></span>
<a name="5465"><font size=-1>5465     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSubFunction(TokenList* tokenlist, ErrorLogger* errorLogger, </span><span class="keyword">const </span><span class="default">Settings* settings)</span>
<a name="5466"><font size=-1>5466     </font></a><span class="default">{</span>
<a name="5467"><font size=-1>5467     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="5468"><font size=-1>5468     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%name% (&quot;</span><span class="default">))</span>
<a name="5469"><font size=-1>5469     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5470"><font size=-1>5470     </font></a><span class="default"></span>
<a name="5471"><font size=-1>5471     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function * </span><span class="keyword">const </span><span class="default">calledFunction = tok-&gt;function();</span>
<a name="5472"><font size=-1>5472     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!calledFunction) {</span>
<a name="5473"><font size=-1>5473     </font></a><span class="default">            </span><span class="comment">// library function?</span>
<a name="5474"><font size=-1>5474     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">std::string&amp; returnValue(settings-&gt;library.returnValue(tok));</span>
<a name="5475"><font size=-1>5475     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!returnValue.empty())</span>
<a name="5476"><font size=-1>5476     </font></a><span class="default">                valueFlowLibraryFunction(tok-&gt;next(), returnValue, settings);</span>
<a name="5477"><font size=-1>5477     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5478"><font size=-1>5478     </font></a><span class="default">        }</span>
<a name="5479"><font size=-1>5479     </font></a><span class="default"></span>
<a name="5480"><font size=-1>5480     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Scope * </span><span class="keyword">const </span><span class="default">calledFunctionScope = calledFunction-&gt;functionScope;</span>
<a name="5481"><font size=-1>5481     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!calledFunctionScope)</span>
<a name="5482"><font size=-1>5482     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5483"><font size=-1>5483     </font></a><span class="default"></span>
<a name="5484"><font size=-1>5484     </font></a><span class="default">        </span><span class="comment">// TODO: Rewrite this. It does not work well to inject 1 argument at a time.</span>
<a name="5485"><font size=-1>5485     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">std::vector&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp;callArguments = getArguments(tok);</span>
<a name="5486"><font size=-1>5486     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">argnr = </span><span class="number">0U</span><span class="default">; argnr &lt; callArguments.size(); ++argnr) {</span>
<a name="5487"><font size=-1>5487     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *argtok = callArguments[argnr];</span>
<a name="5488"><font size=-1>5488     </font></a><span class="default">            </span><span class="comment">// Get function argument</span>
<a name="5489"><font size=-1>5489     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">argvar = calledFunction-&gt;getArgumentVar(argnr);</span>
<a name="5490"><font size=-1>5490     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!argvar)</span>
<a name="5491"><font size=-1>5491     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5492"><font size=-1>5492     </font></a><span class="default"></span>
<a name="5493"><font size=-1>5493     </font></a><span class="default">            </span><span class="comment">// passing value(s) to function</span>
<a name="5494"><font size=-1>5494     </font></a><span class="comment">            </span><span class="default">std::list&lt;ValueFlow::Value&gt; argvalues(getFunctionArgumentValues(argtok));</span>
<a name="5495"><font size=-1>5495     </font></a><span class="default"></span>
<a name="5496"><font size=-1>5496     </font></a><span class="default">            </span><span class="comment">// Don't forward lifetime values</span>
<a name="5497"><font size=-1>5497     </font></a><span class="comment">            </span><span class="default">argvalues.remove_if(std::mem_fn(&amp;ValueFlow::Value::isLifetimeValue));</span>
<a name="5498"><font size=-1>5498     </font></a><span class="default"></span>
<a name="5499"><font size=-1>5499     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(argvalues.empty())</span>
<a name="5500"><font size=-1>5500     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5501"><font size=-1>5501     </font></a><span class="default"></span>
<a name="5502"><font size=-1>5502     </font></a><span class="default">            </span><span class="comment">// Error path..</span>
<a name="5503"><font size=-1>5503     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(ValueFlow::Value &amp;v : argvalues) {</span>
<a name="5504"><font size=-1>5504     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::string nr = MathLib::toString(argnr + </span><span class="number">1</span><span class="default">) + getOrdinalText(argnr + </span><span class="number">1</span><span class="default">);</span>
<a name="5505"><font size=-1>5505     </font></a><span class="default"></span>
<a name="5506"><font size=-1>5506     </font></a><span class="default">                v.errorPath.emplace_back(argtok,</span>
<a name="5507"><font size=-1>5507     </font></a><span class="default">                                         </span><span class="string">&quot;Calling function '&quot; </span><span class="default">+</span>
<a name="5508"><font size=-1>5508     </font></a><span class="default">                                         calledFunction-&gt;name() +</span>
<a name="5509"><font size=-1>5509     </font></a><span class="default">                                         </span><span class="string">&quot;', &quot; </span><span class="default">+</span>
<a name="5510"><font size=-1>5510     </font></a><span class="default">                                         nr +</span>
<a name="5511"><font size=-1>5511     </font></a><span class="default">                                         </span><span class="string">&quot; argument '&quot; </span><span class="default">+</span>
<a name="5512"><font size=-1>5512     </font></a><span class="default">                                         argtok-&gt;expressionString() +</span>
<a name="5513"><font size=-1>5513     </font></a><span class="default">                                         </span><span class="string">&quot;' value is &quot; </span><span class="default">+</span>
<a name="5514"><font size=-1>5514     </font></a><span class="default">                                         v.infoString());</span>
<a name="5515"><font size=-1>5515     </font></a><span class="default">            }</span>
<a name="5516"><font size=-1>5516     </font></a><span class="default"></span>
<a name="5517"><font size=-1>5517     </font></a><span class="default">            </span><span class="comment">// passed values are not &quot;known&quot;..</span>
<a name="5518"><font size=-1>5518     </font></a><span class="comment">            </span><span class="default">lowerToPossible(argvalues);</span>
<a name="5519"><font size=-1>5519     </font></a><span class="default"></span>
<a name="5520"><font size=-1>5520     </font></a><span class="default">            valueFlowInjectParameter(tokenlist, errorLogger, settings, argvar, calledFunctionScope, argvalues);</span>
<a name="5521"><font size=-1>5521     </font></a><span class="default">            </span><span class="comment">// FIXME: We need to rewrite the valueflow analysis to better handle multiple arguments</span>
<a name="5522"><font size=-1>5522     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!argvalues.empty())</span>
<a name="5523"><font size=-1>5523     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5524"><font size=-1>5524     </font></a><span class="default">        }</span>
<a name="5525"><font size=-1>5525     </font></a><span class="default">    }</span>
<a name="5526"><font size=-1>5526     </font></a><span class="default">}</span>
<a name="5527"><font size=-1>5527     </font></a><span class="default"></span>
<a name="5528"><font size=-1>5528     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowFunctionDefaultParameter(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5529"><font size=-1>5529     </font></a><span class="default">{</span>
<a name="5530"><font size=-1>5530     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tokenlist-&gt;isCPP())</span>
<a name="5531"><font size=-1>5531     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="5532"><font size=-1>5532     </font></a><span class="default"></span>
<a name="5533"><font size=-1>5533     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope* scope : symboldatabase-&gt;functionScopes) {</span>
<a name="5534"><font size=-1>5534     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function* function = scope-&gt;function;</span>
<a name="5535"><font size=-1>5535     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!function)</span>
<a name="5536"><font size=-1>5536     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5537"><font size=-1>5537     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::size_t arg = function-&gt;minArgCount(); arg &lt; function-&gt;argCount(); arg++) {</span>
<a name="5538"><font size=-1>5538     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable* var = function-&gt;getArgumentVar(arg);</span>
<a name="5539"><font size=-1>5539     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;hasDefault() &amp;&amp; Token::Match(var-&gt;nameToken(), </span><span class="string">&quot;%var% = %num%|%str% [,)]&quot;</span><span class="default">)) {</span>
<a name="5540"><font size=-1>5540     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; &amp;values = var-&gt;nameToken()-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;values();</span>
<a name="5541"><font size=-1>5541     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; argvalues;</span>
<a name="5542"><font size=-1>5542     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value : values) {</span>
<a name="5543"><font size=-1>5543     </font></a><span class="default">                    ValueFlow::Value v(value);</span>
<a name="5544"><font size=-1>5544     </font></a><span class="default">                    v.defaultArg = </span><span class="keyword">true</span><span class="default">;</span>
<a name="5545"><font size=-1>5545     </font></a><span class="default">                    v.changeKnownToPossible();</span>
<a name="5546"><font size=-1>5546     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(v.isPossible())</span>
<a name="5547"><font size=-1>5547     </font></a><span class="default">                        argvalues.push_back(v);</span>
<a name="5548"><font size=-1>5548     </font></a><span class="default">                }</span>
<a name="5549"><font size=-1>5549     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!argvalues.empty())</span>
<a name="5550"><font size=-1>5550     </font></a><span class="default">                    valueFlowInjectParameter(tokenlist, errorLogger, settings, var, scope, argvalues);</span>
<a name="5551"><font size=-1>5551     </font></a><span class="default">            }</span>
<a name="5552"><font size=-1>5552     </font></a><span class="default">        }</span>
<a name="5553"><font size=-1>5553     </font></a><span class="default">    }</span>
<a name="5554"><font size=-1>5554     </font></a><span class="default">}</span>
<a name="5555"><font size=-1>5555     </font></a><span class="default"></span>
<a name="5556"><font size=-1>5556     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isKnown(</span><span class="keyword">const </span><span class="default">Token * tok)</span>
<a name="5557"><font size=-1>5557     </font></a><span class="default">{</span>
<a name="5558"><font size=-1>5558     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">tok &amp;&amp; tok-&gt;hasKnownIntValue();</span>
<a name="5559"><font size=-1>5559     </font></a><span class="default">}</span>
<a name="5560"><font size=-1>5560     </font></a><span class="default"></span>
<a name="5561"><font size=-1>5561     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowFunctionReturn(TokenList *tokenlist, ErrorLogger *errorLogger)</span>
<a name="5562"><font size=-1>5562     </font></a><span class="default">{</span>
<a name="5563"><font size=-1>5563     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;back(); tok; tok = tok-&gt;previous()) {</span>
<a name="5564"><font size=-1>5564     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;(&quot; </span><span class="default">|| !tok-&gt;astOperand1() || !tok-&gt;astOperand1()-&gt;function())</span>
<a name="5565"><font size=-1>5565     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5566"><font size=-1>5566     </font></a><span class="default"></span>
<a name="5567"><font size=-1>5567     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;hasKnownValue())</span>
<a name="5568"><font size=-1>5568     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5569"><font size=-1>5569     </font></a><span class="default"></span>
<a name="5570"><font size=-1>5570     </font></a><span class="default">        </span><span class="comment">// Arguments..</span>
<a name="5571"><font size=-1>5571     </font></a><span class="comment">        </span><span class="default">std::vector&lt;MathLib::bigint&gt; parvalues;</span>
<a name="5572"><font size=-1>5572     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;astOperand2()) {</span>
<a name="5573"><font size=-1>5573     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *partok = tok-&gt;astOperand2();</span>
<a name="5574"><font size=-1>5574     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(partok &amp;&amp; partok-&gt;str() == </span><span class="string">&quot;,&quot; </span><span class="default">&amp;&amp; isKnown(partok-&gt;astOperand2()))</span>
<a name="5575"><font size=-1>5575     </font></a><span class="default">                partok = partok-&gt;astOperand1();</span>
<a name="5576"><font size=-1>5576     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isKnown(partok))</span>
<a name="5577"><font size=-1>5577     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5578"><font size=-1>5578     </font></a><span class="default">            parvalues.push_back(partok-&gt;values().front().intvalue);</span>
<a name="5579"><font size=-1>5579     </font></a><span class="default">            partok = partok-&gt;astParent();</span>
<a name="5580"><font size=-1>5580     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(partok &amp;&amp; partok-&gt;str() == </span><span class="string">&quot;,&quot;</span><span class="default">) {</span>
<a name="5581"><font size=-1>5581     </font></a><span class="default">                parvalues.push_back(partok-&gt;astOperand2()-&gt;values().front().intvalue);</span>
<a name="5582"><font size=-1>5582     </font></a><span class="default">                partok = partok-&gt;astParent();</span>
<a name="5583"><font size=-1>5583     </font></a><span class="default">            }</span>
<a name="5584"><font size=-1>5584     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(partok != tok)</span>
<a name="5585"><font size=-1>5585     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5586"><font size=-1>5586     </font></a><span class="default">        }</span>
<a name="5587"><font size=-1>5587     </font></a><span class="default"></span>
<a name="5588"><font size=-1>5588     </font></a><span class="default">        </span><span class="comment">// Get scope and args of function</span>
<a name="5589"><font size=-1>5589     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">Function * </span><span class="keyword">const </span><span class="default">function = tok-&gt;astOperand1()-&gt;function();</span>
<a name="5590"><font size=-1>5590     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Scope * </span><span class="keyword">const </span><span class="default">functionScope = function-&gt;functionScope;</span>
<a name="5591"><font size=-1>5591     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!functionScope || !Token::simpleMatch(functionScope-&gt;bodyStart, </span><span class="string">&quot;{ return&quot;</span><span class="default">)) {</span>
<a name="5592"><font size=-1>5592     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(functionScope &amp;&amp; tokenlist-&gt;getSettings()-&gt;debugwarnings &amp;&amp; Token::findsimplematch(functionScope-&gt;bodyStart, </span><span class="string">&quot;return&quot;</span><span class="default">, functionScope-&gt;bodyEnd))</span>
<a name="5593"><font size=-1>5593     </font></a><span class="default">                bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;function return; nontrivial function body&quot;</span><span class="default">);</span>
<a name="5594"><font size=-1>5594     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5595"><font size=-1>5595     </font></a><span class="default">        }</span>
<a name="5596"><font size=-1>5596     </font></a><span class="default"></span>
<a name="5597"><font size=-1>5597     </font></a><span class="default">        ProgramMemory programMemory;</span>
<a name="5598"><font size=-1>5598     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::size_t i = </span><span class="number">0</span><span class="default">; i &lt; parvalues.size(); ++i) {</span>
<a name="5599"><font size=-1>5599     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">arg = function-&gt;getArgumentVar(i);</span>
<a name="5600"><font size=-1>5600     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!arg || !Token::Match(arg-&gt;typeStartToken(), </span><span class="string">&quot;%type% %name% ,|)&quot;</span><span class="default">)) {</span>
<a name="5601"><font size=-1>5601     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tokenlist-&gt;getSettings()-&gt;debugwarnings)</span>
<a name="5602"><font size=-1>5602     </font></a><span class="default">                    bailout(tokenlist, errorLogger, tok, </span><span class="string">&quot;function return; unhandled argument type&quot;</span><span class="default">);</span>
<a name="5603"><font size=-1>5603     </font></a><span class="default">                programMemory.clear();</span>
<a name="5604"><font size=-1>5604     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5605"><font size=-1>5605     </font></a><span class="default">            }</span>
<a name="5606"><font size=-1>5606     </font></a><span class="default">            programMemory.setIntValue(arg-&gt;declarationId(), parvalues[i]);</span>
<a name="5607"><font size=-1>5607     </font></a><span class="default">        }</span>
<a name="5608"><font size=-1>5608     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(programMemory.empty() &amp;&amp; !parvalues.empty())</span>
<a name="5609"><font size=-1>5609     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5610"><font size=-1>5610     </font></a><span class="default"></span>
<a name="5611"><font size=-1>5611     </font></a><span class="default">        </span><span class="comment">// Determine return value of subfunction..</span>
<a name="5612"><font size=-1>5612     </font></a><span class="comment">        </span><span class="default">MathLib::bigint result = </span><span class="number">0</span><span class="default">;</span>
<a name="5613"><font size=-1>5613     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">error = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5614"><font size=-1>5614     </font></a><span class="default">        execute(functionScope-&gt;bodyStart-&gt;next()-&gt;astOperand1(),</span>
<a name="5615"><font size=-1>5615     </font></a><span class="default">                &amp;programMemory,</span>
<a name="5616"><font size=-1>5616     </font></a><span class="default">                &amp;result,</span>
<a name="5617"><font size=-1>5617     </font></a><span class="default">                &amp;error);</span>
<a name="5618"><font size=-1>5618     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!error) {</span>
<a name="5619"><font size=-1>5619     </font></a><span class="default">            ValueFlow::Value v(result);</span>
<a name="5620"><font size=-1>5620     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(function-&gt;hasVirtualSpecifier())</span>
<a name="5621"><font size=-1>5621     </font></a><span class="default">                v.setPossible();</span>
<a name="5622"><font size=-1>5622     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="5623"><font size=-1>5623     </font></a><span class="keyword">                </span><span class="default">v.setKnown();</span>
<a name="5624"><font size=-1>5624     </font></a><span class="default">            setTokenValue(tok, v, tokenlist-&gt;getSettings());</span>
<a name="5625"><font size=-1>5625     </font></a><span class="default">        }</span>
<a name="5626"><font size=-1>5626     </font></a><span class="default">    }</span>
<a name="5627"><font size=-1>5627     </font></a><span class="default">}</span>
<a name="5628"><font size=-1>5628     </font></a><span class="default"></span>
<a name="5629"><font size=-1>5629     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowUninit(TokenList *tokenlist, SymbolDatabase * </span><span class="comment">/*symbolDatabase*/</span><span class="default">, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5630"><font size=-1>5630     </font></a><span class="default">{</span>
<a name="5631"><font size=-1>5631     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="5632"><font size=-1>5632     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(tok,</span><span class="string">&quot;[;{}] %type%&quot;</span><span class="default">))</span>
<a name="5633"><font size=-1>5633     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5634"><font size=-1>5634     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope()-&gt;isExecutable())</span>
<a name="5635"><font size=-1>5635     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5636"><font size=-1>5636     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vardecl = tok-&gt;next();</span>
<a name="5637"><font size=-1>5637     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">stdtype = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5638"><font size=-1>5638     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">pointer = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5639"><font size=-1>5639     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(Token::Match(vardecl, </span><span class="string">&quot;%name%|::|*&quot;</span><span class="default">) &amp;&amp; vardecl-&gt;varId() == </span><span class="number">0</span><span class="default">) {</span>
<a name="5640"><font size=-1>5640     </font></a><span class="default">            stdtype |= vardecl-&gt;isStandardType();</span>
<a name="5641"><font size=-1>5641     </font></a><span class="default">            pointer |= vardecl-&gt;str() == </span><span class="string">&quot;*&quot;</span><span class="default">;</span>
<a name="5642"><font size=-1>5642     </font></a><span class="default">            vardecl = vardecl-&gt;next();</span>
<a name="5643"><font size=-1>5643     </font></a><span class="default">        }</span>
<a name="5644"><font size=-1>5644     </font></a><span class="default">        </span><span class="comment">// if (!stdtype &amp;&amp; !pointer)</span>
<a name="5645"><font size=-1>5645     </font></a><span class="comment">        // continue;</span>
<a name="5646"><font size=-1>5646     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!Token::Match(vardecl, </span><span class="string">&quot;%var% ;&quot;</span><span class="default">))</span>
<a name="5647"><font size=-1>5647     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5648"><font size=-1>5648     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(vardecl, </span><span class="string">&quot;%varid% ; %varid% =&quot;</span><span class="default">, vardecl-&gt;varId()))</span>
<a name="5649"><font size=-1>5649     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5650"><font size=-1>5650     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var = vardecl-&gt;variable();</span>
<a name="5651"><font size=-1>5651     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var || var-&gt;nameToken() != vardecl)</span>
<a name="5652"><font size=-1>5652     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5653"><font size=-1>5653     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">((!var-&gt;isPointer() &amp;&amp; var-&gt;type() &amp;&amp; var-&gt;type()-&gt;needInitialization != Type::NeedInitialization::True) ||</span>
<a name="5654"><font size=-1>5654     </font></a><span class="default">            !var-&gt;isLocal() || var-&gt;isStatic() || var-&gt;isExtern() || var-&gt;isReference() || var-&gt;isThrow())</span>
<a name="5655"><font size=-1>5655     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5656"><font size=-1>5656     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;type() &amp;&amp; !stdtype &amp;&amp; !pointer)</span>
<a name="5657"><font size=-1>5657     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5658"><font size=-1>5658     </font></a><span class="default"></span>
<a name="5659"><font size=-1>5659     </font></a><span class="default">        ValueFlow::Value uninitValue;</span>
<a name="5660"><font size=-1>5660     </font></a><span class="default">        uninitValue.setKnown();</span>
<a name="5661"><font size=-1>5661     </font></a><span class="default">        uninitValue.valueType = ValueFlow::Value::UNINIT;</span>
<a name="5662"><font size=-1>5662     </font></a><span class="default">        uninitValue.tokvalue = vardecl;</span>
<a name="5663"><font size=-1>5663     </font></a><span class="default">        std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5664"><font size=-1>5664     </font></a><span class="default">        values.push_back(uninitValue);</span>
<a name="5665"><font size=-1>5665     </font></a><span class="default"></span>
<a name="5666"><font size=-1>5666     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">constValue = </span><span class="keyword">true</span><span class="default">;</span>
<a name="5667"><font size=-1>5667     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">subFunction = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5668"><font size=-1>5668     </font></a><span class="default"></span>
<a name="5669"><font size=-1>5669     </font></a><span class="default">        valueFlowForwardVariable(vardecl-&gt;next(),</span>
<a name="5670"><font size=-1>5670     </font></a><span class="default">                                 vardecl-&gt;scope()-&gt;bodyEnd,</span>
<a name="5671"><font size=-1>5671     </font></a><span class="default">                                 var,</span>
<a name="5672"><font size=-1>5672     </font></a><span class="default">                                 vardecl-&gt;varId(),</span>
<a name="5673"><font size=-1>5673     </font></a><span class="default">                                 values,</span>
<a name="5674"><font size=-1>5674     </font></a><span class="default">                                 constValue,</span>
<a name="5675"><font size=-1>5675     </font></a><span class="default">                                 subFunction,</span>
<a name="5676"><font size=-1>5676     </font></a><span class="default">                                 tokenlist,</span>
<a name="5677"><font size=-1>5677     </font></a><span class="default">                                 errorLogger,</span>
<a name="5678"><font size=-1>5678     </font></a><span class="default">                                 settings);</span>
<a name="5679"><font size=-1>5679     </font></a><span class="default">    }</span>
<a name="5680"><font size=-1>5680     </font></a><span class="default">}</span>
<a name="5681"><font size=-1>5681     </font></a><span class="default"></span>
<a name="5682"><font size=-1>5682     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">hasContainerSizeGuard(</span><span class="keyword">const </span><span class="default">Token *tok, nonneg </span><span class="keyword">int </span><span class="default">containerId)</span>
<a name="5683"><font size=-1>5683     </font></a><span class="default">{</span>
<a name="5684"><font size=-1>5684     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(; tok &amp;&amp; tok-&gt;astParent(); tok = tok-&gt;astParent()) {</span>
<a name="5685"><font size=-1>5685     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *parent = tok-&gt;astParent();</span>
<a name="5686"><font size=-1>5686     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok != parent-&gt;astOperand2())</span>
<a name="5687"><font size=-1>5687     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5688"><font size=-1>5688     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(parent, </span><span class="string">&quot;%oror%|&amp;&amp;|?&quot;</span><span class="default">))</span>
<a name="5689"><font size=-1>5689     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5690"><font size=-1>5690     </font></a><span class="default">        </span><span class="comment">// is container found in lhs?</span>
<a name="5691"><font size=-1>5691     </font></a><span class="comment">        </span><span class="keyword">bool </span><span class="default">found = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5692"><font size=-1>5692     </font></a><span class="default">        visitAstNodes(parent-&gt;astOperand1(),</span>
<a name="5693"><font size=-1>5693     </font></a><span class="default">        [&amp;](</span><span class="keyword">const </span><span class="default">Token *t) {</span>
<a name="5694"><font size=-1>5694     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(t-&gt;varId() == containerId)</span>
<a name="5695"><font size=-1>5695     </font></a><span class="default">                found = </span><span class="keyword">true</span><span class="default">;</span>
<a name="5696"><font size=-1>5696     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">found ? ChildrenToVisit::done : ChildrenToVisit::op1_and_op2;</span>
<a name="5697"><font size=-1>5697     </font></a><span class="default">        });</span>
<a name="5698"><font size=-1>5698     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(found)</span>
<a name="5699"><font size=-1>5699     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5700"><font size=-1>5700     </font></a><span class="default">    }</span>
<a name="5701"><font size=-1>5701     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5702"><font size=-1>5702     </font></a><span class="default">}</span>
<a name="5703"><font size=-1>5703     </font></a><span class="default"></span>
<a name="5704"><font size=-1>5704     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isContainerSize(</span><span class="keyword">const </span><span class="default">Token* tok)</span>
<a name="5705"><font size=-1>5705     </font></a><span class="default">{</span>
<a name="5706"><font size=-1>5706     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%var% . %name% (&quot;</span><span class="default">))</span>
<a name="5707"><font size=-1>5707     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5708"><font size=-1>5708     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!astIsContainer(tok))</span>
<a name="5709"><font size=-1>5709     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5710"><font size=-1>5710     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;valueType()-&gt;container &amp;&amp; tok-&gt;valueType()-&gt;container-&gt;getYield(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) == Library::Container::Yield::SIZE)</span>
<a name="5711"><font size=-1>5711     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5712"><font size=-1>5712     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;size|length ( )&quot;</span><span class="default">))</span>
<a name="5713"><font size=-1>5713     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5714"><font size=-1>5714     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5715"><font size=-1>5715     </font></a><span class="default">}</span>
<a name="5716"><font size=-1>5716     </font></a><span class="default"></span>
<a name="5717"><font size=-1>5717     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isContainerEmpty(</span><span class="keyword">const </span><span class="default">Token* tok)</span>
<a name="5718"><font size=-1>5718     </font></a><span class="default">{</span>
<a name="5719"><font size=-1>5719     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%var% . %name% (&quot;</span><span class="default">))</span>
<a name="5720"><font size=-1>5720     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5721"><font size=-1>5721     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!astIsContainer(tok))</span>
<a name="5722"><font size=-1>5722     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5723"><font size=-1>5723     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok-&gt;valueType()-&gt;container &amp;&amp; tok-&gt;valueType()-&gt;container-&gt;getYield(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) == Library::Container::Yield::EMPTY)</span>
<a name="5724"><font size=-1>5724     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5725"><font size=-1>5725     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;empty ( )&quot;</span><span class="default">))</span>
<a name="5726"><font size=-1>5726     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5727"><font size=-1>5727     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5728"><font size=-1>5728     </font></a><span class="default">}</span>
<a name="5729"><font size=-1>5729     </font></a><span class="default"></span>
<a name="5730"><font size=-1>5730     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isContainerSizeChanged(nonneg </span><span class="keyword">int </span><span class="default">varId, </span><span class="keyword">const </span><span class="default">Token *start, </span><span class="keyword">const </span><span class="default">Token *end, </span><span class="keyword">int </span><span class="default">depth = </span><span class="number">20</span><span class="default">);</span>
<a name="5731"><font size=-1>5731     </font></a><span class="default"></span>
<a name="5732"><font size=-1>5732     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isContainerSizeChangedByFunction(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">int </span><span class="default">depth = </span><span class="number">20</span><span class="default">)</span>
<a name="5733"><font size=-1>5733     </font></a><span class="default">{</span>
<a name="5734"><font size=-1>5734     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;container)</span>
<a name="5735"><font size=-1>5735     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5736"><font size=-1>5736     </font></a><span class="default">    </span><span class="comment">// If we are accessing an element then we are not changing the container size</span>
<a name="5737"><font size=-1>5737     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% . %name% (&quot;</span><span class="default">)) {</span>
<a name="5738"><font size=-1>5738     </font></a><span class="default">        Library::Container::Yield yield = tok-&gt;valueType()-&gt;container-&gt;getYield(tok-&gt;strAt(</span><span class="number">2</span><span class="default">));</span>
<a name="5739"><font size=-1>5739     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(yield != Library::Container::Yield::NO_YIELD)</span>
<a name="5740"><font size=-1>5740     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5741"><font size=-1>5741     </font></a><span class="default">    }</span>
<a name="5742"><font size=-1>5742     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;astParent(), </span><span class="string">&quot;[&quot;</span><span class="default">))</span>
<a name="5743"><font size=-1>5743     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5744"><font size=-1>5744     </font></a><span class="default"></span>
<a name="5745"><font size=-1>5745     </font></a><span class="default">    </span><span class="comment">// address of variable</span>
<a name="5746"><font size=-1>5746     </font></a><span class="comment">    </span><span class="keyword">const bool </span><span class="default">addressOf = tok-&gt;astParent() &amp;&amp; tok-&gt;astParent()-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">);</span>
<a name="5747"><font size=-1>5747     </font></a><span class="default"></span>
<a name="5748"><font size=-1>5748     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">narg;</span>
<a name="5749"><font size=-1>5749     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * ftok = getTokenArgumentFunction(tok, narg);</span>
<a name="5750"><font size=-1>5750     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!ftok)</span>
<a name="5751"><font size=-1>5751     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">; </span><span class="comment">// not a function =&gt; variable not changed</span>
<a name="5752"><font size=-1>5752     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Function * fun = ftok-&gt;function();</span>
<a name="5753"><font size=-1>5753     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(fun) {</span>
<a name="5754"><font size=-1>5754     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *arg = fun-&gt;getArgumentVar(narg);</span>
<a name="5755"><font size=-1>5755     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(arg) {</span>
<a name="5756"><font size=-1>5756     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!arg-&gt;isReference() &amp;&amp; !addressOf)</span>
<a name="5757"><font size=-1>5757     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5758"><font size=-1>5758     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(arg-&gt;isConst())</span>
<a name="5759"><font size=-1>5759     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5760"><font size=-1>5760     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope * scope = fun-&gt;functionScope;</span>
<a name="5761"><font size=-1>5761     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(scope) {</span>
<a name="5762"><font size=-1>5762     </font></a><span class="default">                </span><span class="comment">// Argument not used</span>
<a name="5763"><font size=-1>5763     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!arg-&gt;nameToken())</span>
<a name="5764"><font size=-1>5764     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5765"><font size=-1>5765     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(depth &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="5766"><font size=-1>5766     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">isContainerSizeChanged(arg-&gt;declarationId(), scope-&gt;bodyStart, scope-&gt;bodyEnd, depth - </span><span class="number">1</span><span class="default">);</span>
<a name="5767"><font size=-1>5767     </font></a><span class="default">            }</span>
<a name="5768"><font size=-1>5768     </font></a><span class="default">        }</span>
<a name="5769"><font size=-1>5769     </font></a><span class="default">    }</span>
<a name="5770"><font size=-1>5770     </font></a><span class="default"></span>
<a name="5771"><font size=-1>5771     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">inconclusive = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5772"><font size=-1>5772     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">isChanged = isVariableChangedByFunctionCall(tok, </span><span class="number">0</span><span class="default">, nullptr, &amp;inconclusive);</span>
<a name="5773"><font size=-1>5773     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">(isChanged || inconclusive);</span>
<a name="5774"><font size=-1>5774     </font></a><span class="default">}</span>
<a name="5775"><font size=-1>5775     </font></a><span class="default"></span>
<a name="5776"><font size=-1>5776     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowContainerReverse(Token *tok, nonneg </span><span class="keyword">int </span><span class="default">containerId, </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5777"><font size=-1>5777     </font></a><span class="default">{</span>
<a name="5778"><font size=-1>5778     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(nullptr != (tok = tok-&gt;previous())) {</span>
<a name="5779"><font size=-1>5779     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[{}]&quot;</span><span class="default">))</span>
<a name="5780"><font size=-1>5780     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5781"><font size=-1>5781     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;return|break|continue&quot;</span><span class="default">))</span>
<a name="5782"><font size=-1>5782     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5783"><font size=-1>5783     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() != containerId)</span>
<a name="5784"><font size=-1>5784     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5785"><font size=-1>5785     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">))</span>
<a name="5786"><font size=-1>5786     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5787"><font size=-1>5787     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isContainerSizeChangedByFunction(tok))</span>
<a name="5788"><font size=-1>5788     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5789"><font size=-1>5789     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;container)</span>
<a name="5790"><font size=-1>5790     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5791"><font size=-1>5791     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% . %name% (&quot;</span><span class="default">) &amp;&amp; tok-&gt;valueType()-&gt;container-&gt;getAction(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) != Library::Container::Action::NO_ACTION)</span>
<a name="5792"><font size=-1>5792     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5793"><font size=-1>5793     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!hasContainerSizeGuard(tok, containerId))</span>
<a name="5794"><font size=-1>5794     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="5795"><font size=-1>5795     </font></a><span class="default">    }</span>
<a name="5796"><font size=-1>5796     </font></a><span class="default">}</span>
<a name="5797"><font size=-1>5797     </font></a><span class="default"></span>
<a name="5798"><font size=-1>5798     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowContainerForward(Token *tok, nonneg </span><span class="keyword">int </span><span class="default">containerId, ValueFlow::Value value, </span><span class="keyword">const </span><span class="default">Settings *settings, </span><span class="keyword">bool </span><span class="default">cpp)</span>
<a name="5799"><font size=-1>5799     </font></a><span class="default">{</span>
<a name="5800"><font size=-1>5800     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(nullptr != (tok = tok-&gt;next())) {</span>
<a name="5801"><font size=-1>5801     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[{}]&quot;</span><span class="default">))</span>
<a name="5802"><font size=-1>5802     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5803"><font size=-1>5803     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;while|for (&quot;</span><span class="default">)) {</span>
<a name="5804"><font size=-1>5804     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *start = tok-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="5805"><font size=-1>5805     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(start-&gt;link(), </span><span class="string">&quot;{&quot;</span><span class="default">))</span>
<a name="5806"><font size=-1>5806     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5807"><font size=-1>5807     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isContainerSizeChanged(containerId, start, start-&gt;link()))</span>
<a name="5808"><font size=-1>5808     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5809"><font size=-1>5809     </font></a><span class="default">        }</span>
<a name="5810"><font size=-1>5810     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;) {&quot;</span><span class="default">) &amp;&amp; Token::Match(tok-&gt;link()-&gt;previous(), </span><span class="string">&quot;while|for|if (&quot;</span><span class="default">)) {</span>
<a name="5811"><font size=-1>5811     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *start = tok-&gt;next();</span>
<a name="5812"><font size=-1>5812     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isContainerSizeChanged(containerId, start, start-&gt;link()))</span>
<a name="5813"><font size=-1>5813     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5814"><font size=-1>5814     </font></a><span class="default">            tok = start-&gt;link();</span>
<a name="5815"><font size=-1>5815     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok, </span><span class="string">&quot;} else {&quot;</span><span class="default">)) {</span>
<a name="5816"><font size=-1>5816     </font></a><span class="default">                start = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="5817"><font size=-1>5817     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isContainerSizeChanged(containerId, start, start-&gt;link()))</span>
<a name="5818"><font size=-1>5818     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="5819"><font size=-1>5819     </font></a><span class="default">                tok = start-&gt;link();</span>
<a name="5820"><font size=-1>5820     </font></a><span class="default">            }</span>
<a name="5821"><font size=-1>5821     </font></a><span class="default">        }</span>
<a name="5822"><font size=-1>5822     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() != containerId)</span>
<a name="5823"><font size=-1>5823     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5824"><font size=-1>5824     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">))</span>
<a name="5825"><font size=-1>5825     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5826"><font size=-1>5826     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% +=&quot;</span><span class="default">)) {</span>
<a name="5827"><font size=-1>5827     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;container || !tok-&gt;valueType()-&gt;container-&gt;stdStringLike)</span>
<a name="5828"><font size=-1>5828     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5829"><font size=-1>5829     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *rhs = tok-&gt;next()-&gt;astOperand2();</span>
<a name="5830"><font size=-1>5830     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(rhs-&gt;tokType() == Token::eString)</span>
<a name="5831"><font size=-1>5831     </font></a><span class="default">                value.intvalue += Token::getStrLength(rhs);</span>
<a name="5832"><font size=-1>5832     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(rhs-&gt;valueType() &amp;&amp; rhs-&gt;valueType()-&gt;container &amp;&amp; rhs-&gt;valueType()-&gt;container-&gt;stdStringLike) {</span>
<a name="5833"><font size=-1>5833     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">found = </span><span class="keyword">false</span><span class="default">;</span>
<a name="5834"><font size=-1>5834     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;rhsval : rhs-&gt;values()) {</span>
<a name="5835"><font size=-1>5835     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(rhsval.isKnown() &amp;&amp; rhsval.isContainerSizeValue()) {</span>
<a name="5836"><font size=-1>5836     </font></a><span class="default">                        value.intvalue += rhsval.intvalue;</span>
<a name="5837"><font size=-1>5837     </font></a><span class="default">                        found = </span><span class="keyword">true</span><span class="default">;</span>
<a name="5838"><font size=-1>5838     </font></a><span class="default">                    }</span>
<a name="5839"><font size=-1>5839     </font></a><span class="default">                }</span>
<a name="5840"><font size=-1>5840     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!found)</span>
<a name="5841"><font size=-1>5841     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="5842"><font size=-1>5842     </font></a><span class="default">            } </span><span class="keyword">else</span>
<a name="5843"><font size=-1>5843     </font></a><span class="keyword">                break</span><span class="default">;</span>
<a name="5844"><font size=-1>5844     </font></a><span class="default">        }</span>
<a name="5845"><font size=-1>5845     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isLikelyStreamRead(cpp, tok-&gt;astParent()))</span>
<a name="5846"><font size=-1>5846     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5847"><font size=-1>5847     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isContainerSizeChangedByFunction(tok))</span>
<a name="5848"><font size=-1>5848     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5849"><font size=-1>5849     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;container)</span>
<a name="5850"><font size=-1>5850     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5851"><font size=-1>5851     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% . %name% (&quot;</span><span class="default">) &amp;&amp; tok-&gt;valueType()-&gt;container-&gt;getAction(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) != Library::Container::Action::NO_ACTION)</span>
<a name="5852"><font size=-1>5852     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="5853"><font size=-1>5853     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!hasContainerSizeGuard(tok, containerId))</span>
<a name="5854"><font size=-1>5854     </font></a><span class="default">            setTokenValue(tok, value, settings);</span>
<a name="5855"><font size=-1>5855     </font></a><span class="default">    }</span>
<a name="5856"><font size=-1>5856     </font></a><span class="default">}</span>
<a name="5857"><font size=-1>5857     </font></a><span class="default"></span>
<a name="5858"><font size=-1>5858     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isContainerSizeChanged(nonneg </span><span class="keyword">int </span><span class="default">varId, </span><span class="keyword">const </span><span class="default">Token *start, </span><span class="keyword">const </span><span class="default">Token *end, </span><span class="keyword">int </span><span class="default">depth)</span>
<a name="5859"><font size=-1>5859     </font></a><span class="default">{</span>
<a name="5860"><font size=-1>5860     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = start; tok != end; tok = tok-&gt;next()) {</span>
<a name="5861"><font size=-1>5861     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() != varId)</span>
<a name="5862"><font size=-1>5862     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5863"><font size=-1>5863     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;container)</span>
<a name="5864"><font size=-1>5864     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5865"><font size=-1>5865     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% %assign%|&lt;&lt;&quot;</span><span class="default">))</span>
<a name="5866"><font size=-1>5866     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5867"><font size=-1>5867     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% . %name% (&quot;</span><span class="default">)) {</span>
<a name="5868"><font size=-1>5868     </font></a><span class="default">            Library::Container::Action action = tok-&gt;valueType()-&gt;container-&gt;getAction(tok-&gt;strAt(</span><span class="number">2</span><span class="default">));</span>
<a name="5869"><font size=-1>5869     </font></a><span class="default">            </span><span class="keyword">switch </span><span class="default">(action) {</span>
<a name="5870"><font size=-1>5870     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::RESIZE:</span>
<a name="5871"><font size=-1>5871     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::CLEAR:</span>
<a name="5872"><font size=-1>5872     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::PUSH:</span>
<a name="5873"><font size=-1>5873     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::POP:</span>
<a name="5874"><font size=-1>5874     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::CHANGE:</span>
<a name="5875"><font size=-1>5875     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::INSERT:</span>
<a name="5876"><font size=-1>5876     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::ERASE:</span>
<a name="5877"><font size=-1>5877     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::CHANGE_INTERNAL:</span>
<a name="5878"><font size=-1>5878     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5879"><font size=-1>5879     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::NO_ACTION: </span><span class="comment">// might be unknown action</span>
<a name="5880"><font size=-1>5880     </font></a><span class="comment">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5881"><font size=-1>5881     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::FIND:</span>
<a name="5882"><font size=-1>5882     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::Container::Action::CHANGE_CONTENT:</span>
<a name="5883"><font size=-1>5883     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="5884"><font size=-1>5884     </font></a><span class="default">            };</span>
<a name="5885"><font size=-1>5885     </font></a><span class="default">        }</span>
<a name="5886"><font size=-1>5886     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isContainerSizeChangedByFunction(tok, depth))</span>
<a name="5887"><font size=-1>5887     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="5888"><font size=-1>5888     </font></a><span class="default">    }</span>
<a name="5889"><font size=-1>5889     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="5890"><font size=-1>5890     </font></a><span class="default">}</span>
<a name="5891"><font size=-1>5891     </font></a><span class="default"></span>
<a name="5892"><font size=-1>5892     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSmartPointer(TokenList *tokenlist, ErrorLogger * errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5893"><font size=-1>5893     </font></a><span class="default">{</span>
<a name="5894"><font size=-1>5894     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="5895"><font size=-1>5895     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope())</span>
<a name="5896"><font size=-1>5896     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5897"><font size=-1>5897     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope()-&gt;isExecutable())</span>
<a name="5898"><font size=-1>5898     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5899"><font size=-1>5899     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;variable())</span>
<a name="5900"><font size=-1>5900     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5901"><font size=-1>5901     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable * var = tok-&gt;variable();</span>
<a name="5902"><font size=-1>5902     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;isSmartPointer())</span>
<a name="5903"><font size=-1>5903     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5904"><font size=-1>5904     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;nameToken() == tok) {</span>
<a name="5905"><font size=-1>5905     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% (|{&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;astOperand2() &amp;&amp; tok-&gt;next()-&gt;astOperand2()-&gt;str() != </span><span class="string">&quot;,&quot;</span><span class="default">) {</span>
<a name="5906"><font size=-1>5906     </font></a><span class="default">                Token * inTok = tok-&gt;next()-&gt;astOperand2();</span>
<a name="5907"><font size=-1>5907     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values = inTok-&gt;values();</span>
<a name="5908"><font size=-1>5908     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">constValue = inTok-&gt;isNumber();</span>
<a name="5909"><font size=-1>5909     </font></a><span class="default">                valueFlowForwardAssign(inTok, var, values, constValue, </span><span class="keyword">true</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5910"><font size=-1>5910     </font></a><span class="default"></span>
<a name="5911"><font size=-1>5911     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% ;&quot;</span><span class="default">)) {</span>
<a name="5912"><font size=-1>5912     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5913"><font size=-1>5913     </font></a><span class="default">                ValueFlow::Value v(</span><span class="number">0</span><span class="default">);</span>
<a name="5914"><font size=-1>5914     </font></a><span class="default">                v.setKnown();</span>
<a name="5915"><font size=-1>5915     </font></a><span class="default">                values.push_back(v);</span>
<a name="5916"><font size=-1>5916     </font></a><span class="default">                valueFlowForwardAssign(tok, var, values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">true</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5917"><font size=-1>5917     </font></a><span class="default">            }</span>
<a name="5918"><font size=-1>5918     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% . reset (&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;originalName() != </span><span class="string">&quot;-&gt;&quot;</span><span class="default">) {</span>
<a name="5919"><font size=-1>5919     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;tokAt(</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;( )&quot;</span><span class="default">)) {</span>
<a name="5920"><font size=-1>5920     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5921"><font size=-1>5921     </font></a><span class="default">                ValueFlow::Value v(</span><span class="number">0</span><span class="default">);</span>
<a name="5922"><font size=-1>5922     </font></a><span class="default">                v.setKnown();</span>
<a name="5923"><font size=-1>5923     </font></a><span class="default">                values.push_back(v);</span>
<a name="5924"><font size=-1>5924     </font></a><span class="default">                valueFlowForwardAssign(tok-&gt;tokAt(</span><span class="number">4</span><span class="default">), var, values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5925"><font size=-1>5925     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="5926"><font size=-1>5926     </font></a><span class="default">                tok-&gt;removeValues(std::mem_fn(&amp;ValueFlow::Value::isIntValue));</span>
<a name="5927"><font size=-1>5927     </font></a><span class="default">                Token * inTok = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">)-&gt;astOperand2();</span>
<a name="5928"><font size=-1>5928     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!inTok)</span>
<a name="5929"><font size=-1>5929     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5930"><font size=-1>5930     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; values = inTok-&gt;values();</span>
<a name="5931"><font size=-1>5931     </font></a><span class="default">                </span><span class="keyword">const bool </span><span class="default">constValue = inTok-&gt;isNumber();</span>
<a name="5932"><font size=-1>5932     </font></a><span class="default">                valueFlowForwardAssign(inTok, var, values, constValue, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5933"><font size=-1>5933     </font></a><span class="default">            }</span>
<a name="5934"><font size=-1>5934     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% . release ( )&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;originalName() != </span><span class="string">&quot;-&gt;&quot;</span><span class="default">) {</span>
<a name="5935"><font size=-1>5935     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt; values;</span>
<a name="5936"><font size=-1>5936     </font></a><span class="default">            ValueFlow::Value v(</span><span class="number">0</span><span class="default">);</span>
<a name="5937"><font size=-1>5937     </font></a><span class="default">            v.setKnown();</span>
<a name="5938"><font size=-1>5938     </font></a><span class="default">            values.push_back(v);</span>
<a name="5939"><font size=-1>5939     </font></a><span class="default">            valueFlowForwardAssign(tok-&gt;tokAt(</span><span class="number">4</span><span class="default">), var, values, </span><span class="keyword">false</span><span class="default">, </span><span class="keyword">false</span><span class="default">, tokenlist, errorLogger, settings);</span>
<a name="5940"><font size=-1>5940     </font></a><span class="default">        }</span>
<a name="5941"><font size=-1>5941     </font></a><span class="default">    }</span>
<a name="5942"><font size=-1>5942     </font></a><span class="default">}</span>
<a name="5943"><font size=-1>5943     </font></a><span class="default"></span>
<a name="5944"><font size=-1>5944     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowContainerSize(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger * </span><span class="comment">/*errorLogger*/</span><span class="default">, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="5945"><font size=-1>5945     </font></a><span class="default">{</span>
<a name="5946"><font size=-1>5946     </font></a><span class="default">    </span><span class="comment">// declaration</span>
<a name="5947"><font size=-1>5947     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable *var : symboldatabase-&gt;variableList()) {</span>
<a name="5948"><font size=-1>5948     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var || !var-&gt;isLocal() || var-&gt;isPointer() || var-&gt;isReference())</span>
<a name="5949"><font size=-1>5949     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5950"><font size=-1>5950     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var-&gt;valueType() || !var-&gt;valueType()-&gt;container)</span>
<a name="5951"><font size=-1>5951     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5952"><font size=-1>5952     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(var-&gt;nameToken(), </span><span class="string">&quot;%name% ;&quot;</span><span class="default">))</span>
<a name="5953"><font size=-1>5953     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5954"><font size=-1>5954     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;nameToken()-&gt;hasKnownValue())</span>
<a name="5955"><font size=-1>5955     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5956"><font size=-1>5956     </font></a><span class="default">        ValueFlow::Value value(</span><span class="number">0</span><span class="default">);</span>
<a name="5957"><font size=-1>5957     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;valueType()-&gt;container-&gt;size_templateArgNo &gt;= </span><span class="number">0</span><span class="default">) {</span>
<a name="5958"><font size=-1>5958     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var-&gt;dimensions().size() == </span><span class="number">1 </span><span class="default">&amp;&amp; var-&gt;dimensions().front().tok &amp;&amp; var-&gt;dimensions().front().tok-&gt;hasKnownIntValue())</span>
<a name="5959"><font size=-1>5959     </font></a><span class="default">                value.intvalue = var-&gt;dimensions().front().tok-&gt;getKnownIntValue();</span>
<a name="5960"><font size=-1>5960     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="5961"><font size=-1>5961     </font></a><span class="keyword">                continue</span><span class="default">;</span>
<a name="5962"><font size=-1>5962     </font></a><span class="default">        }</span>
<a name="5963"><font size=-1>5963     </font></a><span class="default">        value.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="5964"><font size=-1>5964     </font></a><span class="default">        value.setKnown();</span>
<a name="5965"><font size=-1>5965     </font></a><span class="default">        valueFlowContainerForward(var-&gt;nameToken()-&gt;next(), var-&gt;declarationId(), value, settings, tokenlist-&gt;isCPP());</span>
<a name="5966"><font size=-1>5966     </font></a><span class="default">    }</span>
<a name="5967"><font size=-1>5967     </font></a><span class="default"></span>
<a name="5968"><font size=-1>5968     </font></a><span class="default">    </span><span class="comment">// after assignment</span>
<a name="5969"><font size=-1>5969     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *functionScope : symboldatabase-&gt;functionScopes) {</span>
<a name="5970"><font size=-1>5970     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = functionScope-&gt;bodyStart; tok != functionScope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="5971"><font size=-1>5971     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name%|;|{|} %var% = %str% ;&quot;</span><span class="default">)) {</span>
<a name="5972"><font size=-1>5972     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *containerTok = tok-&gt;next();</span>
<a name="5973"><font size=-1>5973     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(containerTok &amp;&amp; containerTok-&gt;valueType() &amp;&amp; containerTok-&gt;valueType()-&gt;container &amp;&amp; containerTok-&gt;valueType()-&gt;container-&gt;stdStringLike) {</span>
<a name="5974"><font size=-1>5974     </font></a><span class="default">                    ValueFlow::Value value(Token::getStrLength(containerTok-&gt;tokAt(</span><span class="number">2</span><span class="default">)));</span>
<a name="5975"><font size=-1>5975     </font></a><span class="default">                    value.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="5976"><font size=-1>5976     </font></a><span class="default">                    value.setKnown();</span>
<a name="5977"><font size=-1>5977     </font></a><span class="default">                    valueFlowContainerForward(containerTok-&gt;next(), containerTok-&gt;varId(), value, settings, tokenlist-&gt;isCPP());</span>
<a name="5978"><font size=-1>5978     </font></a><span class="default">                }</span>
<a name="5979"><font size=-1>5979     </font></a><span class="default">            }</span>
<a name="5980"><font size=-1>5980     </font></a><span class="default">        }</span>
<a name="5981"><font size=-1>5981     </font></a><span class="default">    }</span>
<a name="5982"><font size=-1>5982     </font></a><span class="default"></span>
<a name="5983"><font size=-1>5983     </font></a><span class="default">    </span><span class="comment">// conditional conditionSize</span>
<a name="5984"><font size=-1>5984     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope &amp;scope : symboldatabase-&gt;scopeList) {</span>
<a name="5985"><font size=-1>5985     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope.type != Scope::ScopeType::eIf) </span><span class="comment">// TODO: while</span>
<a name="5986"><font size=-1>5986     </font></a><span class="comment">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5987"><font size=-1>5987     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = scope.classDef; tok &amp;&amp; tok-&gt;str() != </span><span class="string">&quot;{&quot;</span><span class="default">; tok = tok-&gt;next()) {</span>
<a name="5988"><font size=-1>5988     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;isName() || !tok-&gt;valueType() || tok-&gt;valueType()-&gt;type != ValueType::CONTAINER || !tok-&gt;valueType()-&gt;container)</span>
<a name="5989"><font size=-1>5989     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5990"><font size=-1>5990     </font></a><span class="default"></span>
<a name="5991"><font size=-1>5991     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *conditionToken;</span>
<a name="5992"><font size=-1>5992     </font></a><span class="default">            MathLib::bigint intval;</span>
<a name="5993"><font size=-1>5993     </font></a><span class="default"></span>
<a name="5994"><font size=-1>5994     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% . %name% (&quot;</span><span class="default">)) {</span>
<a name="5995"><font size=-1>5995     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;valueType()-&gt;container-&gt;getYield(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) == Library::Container::Yield::SIZE) {</span>
<a name="5996"><font size=-1>5996     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token *parent = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">)-&gt;astParent();</span>
<a name="5997"><font size=-1>5997     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!parent || !parent-&gt;isComparisonOp() || !parent-&gt;astOperand2())</span>
<a name="5998"><font size=-1>5998     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="5999"><font size=-1>5999     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(parent-&gt;astOperand1()-&gt;hasKnownIntValue())</span>
<a name="6000"><font size=-1>6000     </font></a><span class="default">                        intval = parent-&gt;astOperand1()-&gt;values().front().intvalue;</span>
<a name="6001"><font size=-1>6001     </font></a><span class="default">                    </span><span class="keyword">else if </span><span class="default">(parent-&gt;astOperand2()-&gt;hasKnownIntValue())</span>
<a name="6002"><font size=-1>6002     </font></a><span class="default">                        intval = parent-&gt;astOperand2()-&gt;values().front().intvalue;</span>
<a name="6003"><font size=-1>6003     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="6004"><font size=-1>6004     </font></a><span class="keyword">                        continue</span><span class="default">;</span>
<a name="6005"><font size=-1>6005     </font></a><span class="default">                    conditionToken = parent;</span>
<a name="6006"><font size=-1>6006     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(tok-&gt;valueType()-&gt;container-&gt;getYield(tok-&gt;strAt(</span><span class="number">2</span><span class="default">)) == Library::Container::Yield::EMPTY) {</span>
<a name="6007"><font size=-1>6007     </font></a><span class="default">                    conditionToken = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="6008"><font size=-1>6008     </font></a><span class="default">                    intval = </span><span class="number">0</span><span class="default">;</span>
<a name="6009"><font size=-1>6009     </font></a><span class="default">                } </span><span class="keyword">else </span><span class="default">{</span>
<a name="6010"><font size=-1>6010     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6011"><font size=-1>6011     </font></a><span class="default">                }</span>
<a name="6012"><font size=-1>6012     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(tok-&gt;valueType()-&gt;container-&gt;stdStringLike &amp;&amp; Token::Match(tok, </span><span class="string">&quot;%name% ==|!= %str%&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;astOperand2() == tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)) {</span>
<a name="6013"><font size=-1>6013     </font></a><span class="default">                intval = Token::getStrLength(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">));</span>
<a name="6014"><font size=-1>6014     </font></a><span class="default">                conditionToken = tok-&gt;next();</span>
<a name="6015"><font size=-1>6015     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="6016"><font size=-1>6016     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6017"><font size=-1>6017     </font></a><span class="default">            }</span>
<a name="6018"><font size=-1>6018     </font></a><span class="default"></span>
<a name="6019"><font size=-1>6019     </font></a><span class="default">            ValueFlow::Value value(conditionToken, intval);</span>
<a name="6020"><font size=-1>6020     </font></a><span class="default">            value.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="6021"><font size=-1>6021     </font></a><span class="default"></span>
<a name="6022"><font size=-1>6022     </font></a><span class="default">            </span><span class="comment">// possible value before condition</span>
<a name="6023"><font size=-1>6023     </font></a><span class="comment">            </span><span class="default">valueFlowContainerReverse(</span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(scope.classDef), tok-&gt;varId(), value, settings);</span>
<a name="6024"><font size=-1>6024     </font></a><span class="default">        }</span>
<a name="6025"><font size=-1>6025     </font></a><span class="default">    }</span>
<a name="6026"><font size=-1>6026     </font></a><span class="default">}</span>
<a name="6027"><font size=-1>6027     </font></a><span class="default"></span>
<a name="6028"><font size=-1>6028     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowContainerAfterCondition(TokenList *tokenlist,</span>
<a name="6029"><font size=-1>6029     </font></a><span class="default">        SymbolDatabase *symboldatabase,</span>
<a name="6030"><font size=-1>6030     </font></a><span class="default">        ErrorLogger *errorLogger,</span>
<a name="6031"><font size=-1>6031     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6032"><font size=-1>6032     </font></a><span class="default">{</span>
<a name="6033"><font size=-1>6033     </font></a><span class="default">    ValueFlowConditionHandler handler;</span>
<a name="6034"><font size=-1>6034     </font></a><span class="default">    handler.forward =</span>
<a name="6035"><font size=-1>6035     </font></a><span class="default">    [&amp;](Token* start, </span><span class="keyword">const </span><span class="default">Token* stop, </span><span class="keyword">const </span><span class="default">Token* vartok, </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt;&amp; values, </span><span class="keyword">bool</span><span class="default">) {</span>
<a name="6036"><font size=-1>6036     </font></a><span class="default">        </span><span class="comment">// TODO: Forward multiple values</span>
<a name="6037"><font size=-1>6037     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(values.empty())</span>
<a name="6038"><font size=-1>6038     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6039"><font size=-1>6039     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable* var = vartok-&gt;variable();</span>
<a name="6040"><font size=-1>6040     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="6041"><font size=-1>6041     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6042"><font size=-1>6042     </font></a><span class="default">        valueFlowContainerForward(start, var-&gt;declarationId(), values.front(), settings, tokenlist-&gt;isCPP());</span>
<a name="6043"><font size=-1>6043     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">isContainerSizeChanged(var-&gt;declarationId(), start, stop);</span>
<a name="6044"><font size=-1>6044     </font></a><span class="default">    };</span>
<a name="6045"><font size=-1>6045     </font></a><span class="default">    handler.parse = [&amp;](</span><span class="keyword">const </span><span class="default">Token *tok) {</span>
<a name="6046"><font size=-1>6046     </font></a><span class="default">        ValueFlowConditionHandler::Condition cond;</span>
<a name="6047"><font size=-1>6047     </font></a><span class="default">        ValueFlow::Value true_value;</span>
<a name="6048"><font size=-1>6048     </font></a><span class="default">        ValueFlow::Value false_value;</span>
<a name="6049"><font size=-1>6049     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *vartok = parseCompareInt(tok, true_value, false_value);</span>
<a name="6050"><font size=-1>6050     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vartok) {</span>
<a name="6051"><font size=-1>6051     </font></a><span class="default">            vartok = vartok-&gt;tokAt(-</span><span class="number">3</span><span class="default">);</span>
<a name="6052"><font size=-1>6052     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isContainerSize(vartok))</span>
<a name="6053"><font size=-1>6053     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6054"><font size=-1>6054     </font></a><span class="default">            true_value.valueType = ValueFlow::Value::CONTAINER_SIZE;</span>
<a name="6055"><font size=-1>6055     </font></a><span class="default">            false_value.valueType = ValueFlow::Value::CONTAINER_SIZE;</span>
<a name="6056"><font size=-1>6056     </font></a><span class="default">            cond.true_values.push_back(true_value);</span>
<a name="6057"><font size=-1>6057     </font></a><span class="default">            cond.false_values.push_back(false_value);</span>
<a name="6058"><font size=-1>6058     </font></a><span class="default">            cond.vartok = vartok;</span>
<a name="6059"><font size=-1>6059     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6060"><font size=-1>6060     </font></a><span class="default">        }</span>
<a name="6061"><font size=-1>6061     </font></a><span class="default"></span>
<a name="6062"><font size=-1>6062     </font></a><span class="default">        </span><span class="comment">// Empty check</span>
<a name="6063"><font size=-1>6063     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">) {</span>
<a name="6064"><font size=-1>6064     </font></a><span class="default">            vartok = tok-&gt;tokAt(-</span><span class="number">3</span><span class="default">);</span>
<a name="6065"><font size=-1>6065     </font></a><span class="default">            </span><span class="comment">// TODO: Handle .size()</span>
<a name="6066"><font size=-1>6066     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!isContainerEmpty(vartok))</span>
<a name="6067"><font size=-1>6067     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6068"><font size=-1>6068     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *parent = tok-&gt;astParent();</span>
<a name="6069"><font size=-1>6069     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(parent) {</span>
<a name="6070"><font size=-1>6070     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(parent, </span><span class="string">&quot;%comp%|!&quot;</span><span class="default">))</span>
<a name="6071"><font size=-1>6071     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6072"><font size=-1>6072     </font></a><span class="default">                parent = parent-&gt;astParent();</span>
<a name="6073"><font size=-1>6073     </font></a><span class="default">            }</span>
<a name="6074"><font size=-1>6074     </font></a><span class="default">            ValueFlow::Value value(tok, </span><span class="number">0LL</span><span class="default">);</span>
<a name="6075"><font size=-1>6075     </font></a><span class="default">            value.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="6076"><font size=-1>6076     </font></a><span class="default">            cond.true_values.emplace_back(value);</span>
<a name="6077"><font size=-1>6077     </font></a><span class="default">            cond.false_values.emplace_back(std::move(value));</span>
<a name="6078"><font size=-1>6078     </font></a><span class="default">            cond.vartok = vartok;</span>
<a name="6079"><font size=-1>6079     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6080"><font size=-1>6080     </font></a><span class="default">        }</span>
<a name="6081"><font size=-1>6081     </font></a><span class="default">        </span><span class="comment">// String compare</span>
<a name="6082"><font size=-1>6082     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;==|!=&quot;</span><span class="default">)) {</span>
<a name="6083"><font size=-1>6083     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *strtok = nullptr;</span>
<a name="6084"><font size=-1>6084     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;astOperand1(), </span><span class="string">&quot;%str%&quot;</span><span class="default">)) {</span>
<a name="6085"><font size=-1>6085     </font></a><span class="default">                strtok = tok-&gt;astOperand1();</span>
<a name="6086"><font size=-1>6086     </font></a><span class="default">                vartok = tok-&gt;astOperand2();</span>
<a name="6087"><font size=-1>6087     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;astOperand2(), </span><span class="string">&quot;%str%&quot;</span><span class="default">)) {</span>
<a name="6088"><font size=-1>6088     </font></a><span class="default">                strtok = tok-&gt;astOperand2();</span>
<a name="6089"><font size=-1>6089     </font></a><span class="default">                vartok = tok-&gt;astOperand1();</span>
<a name="6090"><font size=-1>6090     </font></a><span class="default">            }</span>
<a name="6091"><font size=-1>6091     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!strtok)</span>
<a name="6092"><font size=-1>6092     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6093"><font size=-1>6093     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!astIsContainer(vartok))</span>
<a name="6094"><font size=-1>6094     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6095"><font size=-1>6095     </font></a><span class="default">            ValueFlow::Value value(tok, Token::getStrLength(strtok));</span>
<a name="6096"><font size=-1>6096     </font></a><span class="default">            value.valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="6097"><font size=-1>6097     </font></a><span class="default">            cond.false_values.emplace_back(value);</span>
<a name="6098"><font size=-1>6098     </font></a><span class="default">            cond.true_values.emplace_back(std::move(value));</span>
<a name="6099"><font size=-1>6099     </font></a><span class="default">            cond.vartok = vartok;</span>
<a name="6100"><font size=-1>6100     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6101"><font size=-1>6101     </font></a><span class="default">        }</span>
<a name="6102"><font size=-1>6102     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">cond;</span>
<a name="6103"><font size=-1>6103     </font></a><span class="default">    };</span>
<a name="6104"><font size=-1>6104     </font></a><span class="default">    handler.afterCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6105"><font size=-1>6105     </font></a><span class="default">}</span>
<a name="6106"><font size=-1>6106     </font></a><span class="default"></span>
<a name="6107"><font size=-1>6107     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowFwdAnalysis(</span><span class="keyword">const </span><span class="default">TokenList *tokenlist, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6108"><font size=-1>6108     </font></a><span class="default">{</span>
<a name="6109"><font size=-1>6109     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="6110"><font size=-1>6110     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;=&quot; </span><span class="default">|| !tok-&gt;astOperand1() || !tok-&gt;astOperand2())</span>
<a name="6111"><font size=-1>6111     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6112"><font size=-1>6112     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;scope()-&gt;isExecutable())</span>
<a name="6113"><font size=-1>6113     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6114"><font size=-1>6114     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand2()-&gt;hasKnownIntValue())</span>
<a name="6115"><font size=-1>6115     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6116"><font size=-1>6116     </font></a><span class="default">        ValueFlow::Value v(tok-&gt;astOperand2()-&gt;values().front());</span>
<a name="6117"><font size=-1>6117     </font></a><span class="default">        v.errorPath.emplace_back(tok, tok-&gt;astOperand1()-&gt;expressionString() + </span><span class="string">&quot; is assigned value &quot; </span><span class="default">+ MathLib::toString(v.intvalue));</span>
<a name="6118"><font size=-1>6118     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *startToken = tok-&gt;findExpressionStartEndTokens().second-&gt;next();</span>
<a name="6119"><font size=-1>6119     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Scope *functionScope = tok-&gt;scope();</span>
<a name="6120"><font size=-1>6120     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(functionScope-&gt;nestedIn &amp;&amp; functionScope-&gt;nestedIn-&gt;isExecutable())</span>
<a name="6121"><font size=-1>6121     </font></a><span class="default">            functionScope = functionScope-&gt;nestedIn;</span>
<a name="6122"><font size=-1>6122     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *endToken = functionScope-&gt;bodyEnd;</span>
<a name="6123"><font size=-1>6123     </font></a><span class="default">        valueFlowForwardExpression(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(startToken), endToken, tok-&gt;astOperand1(), {v}, tokenlist, settings);</span>
<a name="6124"><font size=-1>6124     </font></a><span class="default">    }</span>
<a name="6125"><font size=-1>6125     </font></a><span class="default">}</span>
<a name="6126"><font size=-1>6126     </font></a><span class="default"></span>
<a name="6127"><font size=-1>6127     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowDynamicBufferSize(TokenList *tokenlist, SymbolDatabase *symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6128"><font size=-1>6128     </font></a><span class="default">{</span>
<a name="6129"><font size=-1>6129     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *functionScope : symboldatabase-&gt;functionScopes) {</span>
<a name="6130"><font size=-1>6130     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = functionScope-&gt;bodyStart; tok != functionScope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="6131"><font size=-1>6131     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;[;{}] %var% =&quot;</span><span class="default">))</span>
<a name="6132"><font size=-1>6132     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6133"><font size=-1>6133     </font></a><span class="default"></span>
<a name="6134"><font size=-1>6134     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!tok-&gt;next()-&gt;variable())</span>
<a name="6135"><font size=-1>6135     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6136"><font size=-1>6136     </font></a><span class="default"></span>
<a name="6137"><font size=-1>6137     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *rhs = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;astOperand2();</span>
<a name="6138"><font size=-1>6138     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(rhs &amp;&amp; rhs-&gt;isCast())</span>
<a name="6139"><font size=-1>6139     </font></a><span class="default">                rhs = rhs-&gt;astOperand2() ? rhs-&gt;astOperand2() : rhs-&gt;astOperand1();</span>
<a name="6140"><font size=-1>6140     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!rhs)</span>
<a name="6141"><font size=-1>6141     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6142"><font size=-1>6142     </font></a><span class="default"></span>
<a name="6143"><font size=-1>6143     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::Match(rhs-&gt;previous(), </span><span class="string">&quot;%name% (&quot;</span><span class="default">))</span>
<a name="6144"><font size=-1>6144     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6145"><font size=-1>6145     </font></a><span class="default"></span>
<a name="6146"><font size=-1>6146     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Library::AllocFunc *allocFunc = settings-&gt;library.getAllocFuncInfo(rhs-&gt;previous());</span>
<a name="6147"><font size=-1>6147     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!allocFunc)</span>
<a name="6148"><font size=-1>6148     </font></a><span class="default">                allocFunc = settings-&gt;library.getReallocFuncInfo(rhs-&gt;previous());</span>
<a name="6149"><font size=-1>6149     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!allocFunc || allocFunc-&gt;bufferSize == Library::AllocFunc::BufferSize::none)</span>
<a name="6150"><font size=-1>6150     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6151"><font size=-1>6151     </font></a><span class="default"></span>
<a name="6152"><font size=-1>6152     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::vector&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; args = getArguments(rhs-&gt;previous());</span>
<a name="6153"><font size=-1>6153     </font></a><span class="default"></span>
<a name="6154"><font size=-1>6154     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">arg1 = (args.size() &gt;= allocFunc-&gt;bufferSizeArg1) ? args[allocFunc-&gt;bufferSizeArg1 - </span><span class="number">1</span><span class="default">] : nullptr;</span>
<a name="6155"><font size=-1>6155     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">arg2 = (args.size() &gt;= allocFunc-&gt;bufferSizeArg2) ? args[allocFunc-&gt;bufferSizeArg2 - </span><span class="number">1</span><span class="default">] : nullptr;</span>
<a name="6156"><font size=-1>6156     </font></a><span class="default"></span>
<a name="6157"><font size=-1>6157     </font></a><span class="default">            MathLib::bigint sizeValue = -</span><span class="number">1</span><span class="default">;</span>
<a name="6158"><font size=-1>6158     </font></a><span class="default">            </span><span class="keyword">switch </span><span class="default">(allocFunc-&gt;bufferSize) {</span>
<a name="6159"><font size=-1>6159     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::AllocFunc::BufferSize::none:</span>
<a name="6160"><font size=-1>6160     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="6161"><font size=-1>6161     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::AllocFunc::BufferSize::malloc:</span>
<a name="6162"><font size=-1>6162     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(arg1 &amp;&amp; arg1-&gt;hasKnownIntValue())</span>
<a name="6163"><font size=-1>6163     </font></a><span class="default">                    sizeValue = arg1-&gt;getKnownIntValue();</span>
<a name="6164"><font size=-1>6164     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="6165"><font size=-1>6165     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::AllocFunc::BufferSize::calloc:</span>
<a name="6166"><font size=-1>6166     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(arg1 &amp;&amp; arg2 &amp;&amp; arg1-&gt;hasKnownIntValue() &amp;&amp; arg2-&gt;hasKnownIntValue())</span>
<a name="6167"><font size=-1>6167     </font></a><span class="default">                    sizeValue = arg1-&gt;getKnownIntValue() * arg2-&gt;getKnownIntValue();</span>
<a name="6168"><font size=-1>6168     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="6169"><font size=-1>6169     </font></a><span class="default">            </span><span class="keyword">case </span><span class="default">Library::AllocFunc::BufferSize::strdup:</span>
<a name="6170"><font size=-1>6170     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(arg1 &amp;&amp; arg1-&gt;hasKnownValue()) {</span>
<a name="6171"><font size=-1>6171     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value = arg1-&gt;values().back();</span>
<a name="6172"><font size=-1>6172     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(value.isTokValue() &amp;&amp; value.tokvalue-&gt;tokType() == Token::eString)</span>
<a name="6173"><font size=-1>6173     </font></a><span class="default">                        sizeValue = Token::getStrLength(value.tokvalue) + </span><span class="number">1</span><span class="default">; </span><span class="comment">// Add one for the null terminator</span>
<a name="6174"><font size=-1>6174     </font></a><span class="comment">                </span><span class="default">}</span>
<a name="6175"><font size=-1>6175     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="6176"><font size=-1>6176     </font></a><span class="default">            };</span>
<a name="6177"><font size=-1>6177     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(sizeValue &lt; </span><span class="number">0</span><span class="default">)</span>
<a name="6178"><font size=-1>6178     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6179"><font size=-1>6179     </font></a><span class="default"></span>
<a name="6180"><font size=-1>6180     </font></a><span class="default">            ValueFlow::Value value(sizeValue);</span>
<a name="6181"><font size=-1>6181     </font></a><span class="default">            value.errorPath.emplace_back(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;Assign &quot; </span><span class="default">+ tok-&gt;strAt(</span><span class="number">1</span><span class="default">) + </span><span class="string">&quot;, buffer with size &quot; </span><span class="default">+ MathLib::toString(sizeValue));</span>
<a name="6182"><font size=-1>6182     </font></a><span class="default">            value.valueType = ValueFlow::Value::ValueType::BUFFER_SIZE;</span>
<a name="6183"><font size=-1>6183     </font></a><span class="default">            value.setKnown();</span>
<a name="6184"><font size=-1>6184     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::list&lt;ValueFlow::Value&gt; values{value};</span>
<a name="6185"><font size=-1>6185     </font></a><span class="default">            valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(rhs),</span>
<a name="6186"><font size=-1>6186     </font></a><span class="default">                                     functionScope-&gt;bodyEnd,</span>
<a name="6187"><font size=-1>6187     </font></a><span class="default">                                     tok-&gt;next()-&gt;variable(),</span>
<a name="6188"><font size=-1>6188     </font></a><span class="default">                                     tok-&gt;next()-&gt;varId(),</span>
<a name="6189"><font size=-1>6189     </font></a><span class="default">                                     values,</span>
<a name="6190"><font size=-1>6190     </font></a><span class="default">                                     </span><span class="keyword">true</span><span class="default">,</span>
<a name="6191"><font size=-1>6191     </font></a><span class="default">                                     </span><span class="keyword">false</span><span class="default">,</span>
<a name="6192"><font size=-1>6192     </font></a><span class="default">                                     tokenlist,</span>
<a name="6193"><font size=-1>6193     </font></a><span class="default">                                     errorLogger,</span>
<a name="6194"><font size=-1>6194     </font></a><span class="default">                                     settings);</span>
<a name="6195"><font size=-1>6195     </font></a><span class="default">        }</span>
<a name="6196"><font size=-1>6196     </font></a><span class="default">    }</span>
<a name="6197"><font size=-1>6197     </font></a><span class="default">}</span>
<a name="6198"><font size=-1>6198     </font></a><span class="default"></span>
<a name="6199"><font size=-1>6199     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">getMinMaxValues(</span><span class="keyword">const </span><span class="default">ValueType *vt, </span><span class="keyword">const </span><span class="default">cppcheck::Platform &amp;platform, MathLib::bigint *minValue, MathLib::bigint *maxValue)</span>
<a name="6200"><font size=-1>6200     </font></a><span class="default">{</span>
<a name="6201"><font size=-1>6201     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!vt || !vt-&gt;isIntegral() || vt-&gt;pointer)</span>
<a name="6202"><font size=-1>6202     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6203"><font size=-1>6203     </font></a><span class="default"></span>
<a name="6204"><font size=-1>6204     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">bits;</span>
<a name="6205"><font size=-1>6205     </font></a><span class="default">    </span><span class="keyword">switch </span><span class="default">(vt-&gt;type) {</span>
<a name="6206"><font size=-1>6206     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::BOOL:</span>
<a name="6207"><font size=-1>6207     </font></a><span class="default">        bits = </span><span class="number">1</span><span class="default">;</span>
<a name="6208"><font size=-1>6208     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6209"><font size=-1>6209     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::CHAR:</span>
<a name="6210"><font size=-1>6210     </font></a><span class="default">        bits = platform.char_bit;</span>
<a name="6211"><font size=-1>6211     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6212"><font size=-1>6212     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::SHORT:</span>
<a name="6213"><font size=-1>6213     </font></a><span class="default">        bits = platform.short_bit;</span>
<a name="6214"><font size=-1>6214     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6215"><font size=-1>6215     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::INT:</span>
<a name="6216"><font size=-1>6216     </font></a><span class="default">        bits = platform.int_bit;</span>
<a name="6217"><font size=-1>6217     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6218"><font size=-1>6218     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::LONG:</span>
<a name="6219"><font size=-1>6219     </font></a><span class="default">        bits = platform.long_bit;</span>
<a name="6220"><font size=-1>6220     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6221"><font size=-1>6221     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">ValueType::Type::LONGLONG:</span>
<a name="6222"><font size=-1>6222     </font></a><span class="default">        bits = platform.long_long_bit;</span>
<a name="6223"><font size=-1>6223     </font></a><span class="default">        </span><span class="keyword">break</span><span class="default">;</span>
<a name="6224"><font size=-1>6224     </font></a><span class="default">    </span><span class="keyword">default</span><span class="default">:</span>
<a name="6225"><font size=-1>6225     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6226"><font size=-1>6226     </font></a><span class="default">    };</span>
<a name="6227"><font size=-1>6227     </font></a><span class="default"></span>
<a name="6228"><font size=-1>6228     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(bits == </span><span class="number">1</span><span class="default">) {</span>
<a name="6229"><font size=-1>6229     </font></a><span class="default">        *minValue = </span><span class="number">0</span><span class="default">;</span>
<a name="6230"><font size=-1>6230     </font></a><span class="default">        *maxValue = </span><span class="number">1</span><span class="default">;</span>
<a name="6231"><font size=-1>6231     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(bits &lt; </span><span class="number">62</span><span class="default">) {</span>
<a name="6232"><font size=-1>6232     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vt-&gt;sign == ValueType::Sign::UNSIGNED) {</span>
<a name="6233"><font size=-1>6233     </font></a><span class="default">            *minValue = </span><span class="number">0</span><span class="default">;</span>
<a name="6234"><font size=-1>6234     </font></a><span class="default">            *maxValue = (</span><span class="number">1LL </span><span class="default">&lt;&lt; bits) - </span><span class="number">1</span><span class="default">;</span>
<a name="6235"><font size=-1>6235     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="6236"><font size=-1>6236     </font></a><span class="default">            *minValue = -(</span><span class="number">1LL </span><span class="default">&lt;&lt; (bits - </span><span class="number">1</span><span class="default">));</span>
<a name="6237"><font size=-1>6237     </font></a><span class="default">            *maxValue = (</span><span class="number">1LL </span><span class="default">&lt;&lt; (bits - </span><span class="number">1</span><span class="default">)) - </span><span class="number">1</span><span class="default">;</span>
<a name="6238"><font size=-1>6238     </font></a><span class="default">        }</span>
<a name="6239"><font size=-1>6239     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(bits == </span><span class="number">64</span><span class="default">) {</span>
<a name="6240"><font size=-1>6240     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(vt-&gt;sign == ValueType::Sign::UNSIGNED) {</span>
<a name="6241"><font size=-1>6241     </font></a><span class="default">            *minValue = </span><span class="number">0</span><span class="default">;</span>
<a name="6242"><font size=-1>6242     </font></a><span class="default">            *maxValue = LLONG_MAX; </span><span class="comment">// todo max unsigned value</span>
<a name="6243"><font size=-1>6243     </font></a><span class="comment">        </span><span class="default">} </span><span class="keyword">else </span><span class="default">{</span>
<a name="6244"><font size=-1>6244     </font></a><span class="default">            *minValue = LLONG_MIN;</span>
<a name="6245"><font size=-1>6245     </font></a><span class="default">            *maxValue = LLONG_MAX;</span>
<a name="6246"><font size=-1>6246     </font></a><span class="default">        }</span>
<a name="6247"><font size=-1>6247     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="6248"><font size=-1>6248     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6249"><font size=-1>6249     </font></a><span class="default">    }</span>
<a name="6250"><font size=-1>6250     </font></a><span class="default"></span>
<a name="6251"><font size=-1>6251     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="6252"><font size=-1>6252     </font></a><span class="default">}</span>
<a name="6253"><font size=-1>6253     </font></a><span class="default"></span>
<a name="6254"><font size=-1>6254     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">getMinMaxValues(</span><span class="keyword">const </span><span class="default">std::string &amp;typestr, </span><span class="keyword">const </span><span class="default">Settings *settings, MathLib::bigint *minvalue, MathLib::bigint *maxvalue)</span>
<a name="6255"><font size=-1>6255     </font></a><span class="default">{</span>
<a name="6256"><font size=-1>6256     </font></a><span class="default">    TokenList typeTokens(settings);</span>
<a name="6257"><font size=-1>6257     </font></a><span class="default">    std::istringstream istr(typestr+</span><span class="string">&quot;;&quot;</span><span class="default">);</span>
<a name="6258"><font size=-1>6258     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!typeTokens.createTokens(istr))</span>
<a name="6259"><font size=-1>6259     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="6260"><font size=-1>6260     </font></a><span class="default">    typeTokens.simplifyPlatformTypes();</span>
<a name="6261"><font size=-1>6261     </font></a><span class="default">    typeTokens.simplifyStdType();</span>
<a name="6262"><font size=-1>6262     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">ValueType &amp;vt = ValueType::parseDecl(typeTokens.front(), settings);</span>
<a name="6263"><font size=-1>6263     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">getMinMaxValues(&amp;vt, *settings, minvalue, maxvalue);</span>
<a name="6264"><font size=-1>6264     </font></a><span class="default">}</span>
<a name="6265"><font size=-1>6265     </font></a><span class="default"></span>
<a name="6266"><font size=-1>6266     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowSafeFunctions(TokenList *tokenlist, SymbolDatabase *symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6267"><font size=-1>6267     </font></a><span class="default">{</span>
<a name="6268"><font size=-1>6268     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *functionScope : symboldatabase-&gt;functionScopes) {</span>
<a name="6269"><font size=-1>6269     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!functionScope-&gt;bodyStart)</span>
<a name="6270"><font size=-1>6270     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6271"><font size=-1>6271     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function *function = functionScope-&gt;function;</span>
<a name="6272"><font size=-1>6272     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!function)</span>
<a name="6273"><font size=-1>6273     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6274"><font size=-1>6274     </font></a><span class="default"></span>
<a name="6275"><font size=-1>6275     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">safe = function-&gt;isSafe(settings);</span>
<a name="6276"><font size=-1>6276     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">all = safe &amp;&amp; settings-&gt;platformType != cppcheck::Platform::PlatformType::Unspecified;</span>
<a name="6277"><font size=-1>6277     </font></a><span class="default"></span>
<a name="6278"><font size=-1>6278     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;arg : function-&gt;argumentList) {</span>
<a name="6279"><font size=-1>6279     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!arg.nameToken() || !arg.valueType())</span>
<a name="6280"><font size=-1>6280     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6281"><font size=-1>6281     </font></a><span class="default"></span>
<a name="6282"><font size=-1>6282     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(arg.valueType()-&gt;type == ValueType::Type::CONTAINER) {</span>
<a name="6283"><font size=-1>6283     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!safe)</span>
<a name="6284"><font size=-1>6284     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6285"><font size=-1>6285     </font></a><span class="default">                std::list&lt;ValueFlow::Value&gt; argValues;</span>
<a name="6286"><font size=-1>6286     </font></a><span class="default">                argValues.emplace_back(</span><span class="number">0</span><span class="default">);</span>
<a name="6287"><font size=-1>6287     </font></a><span class="default">                argValues.back().valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="6288"><font size=-1>6288     </font></a><span class="default">                argValues.back().errorPath.emplace_back(arg.nameToken(), </span><span class="string">&quot;Assuming &quot; </span><span class="default">+ arg.name() + </span><span class="string">&quot; is empty&quot;</span><span class="default">);</span>
<a name="6289"><font size=-1>6289     </font></a><span class="default">                argValues.back().safe = </span><span class="keyword">true</span><span class="default">;</span>
<a name="6290"><font size=-1>6290     </font></a><span class="default">                argValues.emplace_back(</span><span class="number">1000000</span><span class="default">);</span>
<a name="6291"><font size=-1>6291     </font></a><span class="default">                argValues.back().valueType = ValueFlow::Value::ValueType::CONTAINER_SIZE;</span>
<a name="6292"><font size=-1>6292     </font></a><span class="default">                argValues.back().errorPath.emplace_back(arg.nameToken(), </span><span class="string">&quot;Assuming &quot; </span><span class="default">+ arg.name() + </span><span class="string">&quot; size is 1000000&quot;</span><span class="default">);</span>
<a name="6293"><font size=-1>6293     </font></a><span class="default">                argValues.back().safe = </span><span class="keyword">true</span><span class="default">;</span>
<a name="6294"><font size=-1>6294     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">ValueFlow::Value &amp;value : argValues)</span>
<a name="6295"><font size=-1>6295     </font></a><span class="default">                    valueFlowContainerForward(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(functionScope-&gt;bodyStart), arg.declarationId(), value, settings, tokenlist-&gt;isCPP());</span>
<a name="6296"><font size=-1>6296     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6297"><font size=-1>6297     </font></a><span class="default">            }</span>
<a name="6298"><font size=-1>6298     </font></a><span class="default"></span>
<a name="6299"><font size=-1>6299     </font></a><span class="default">            MathLib::bigint low, high;</span>
<a name="6300"><font size=-1>6300     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">isLow = arg.nameToken()-&gt;getCppcheckAttribute(TokenImpl::CppcheckAttributes::Type::LOW, &amp;low);</span>
<a name="6301"><font size=-1>6301     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">isHigh = arg.nameToken()-&gt;getCppcheckAttribute(TokenImpl::CppcheckAttributes::Type::HIGH, &amp;high);</span>
<a name="6302"><font size=-1>6302     </font></a><span class="default"></span>
<a name="6303"><font size=-1>6303     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!isLow &amp;&amp; !isHigh &amp;&amp; !all)</span>
<a name="6304"><font size=-1>6304     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6305"><font size=-1>6305     </font></a><span class="default"></span>
<a name="6306"><font size=-1>6306     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">safeLow = !isLow;</span>
<a name="6307"><font size=-1>6307     </font></a><span class="default">            </span><span class="keyword">const bool </span><span class="default">safeHigh = !isHigh;</span>
<a name="6308"><font size=-1>6308     </font></a><span class="default"></span>
<a name="6309"><font size=-1>6309     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">((!isLow || !isHigh) &amp;&amp; all) {</span>
<a name="6310"><font size=-1>6310     </font></a><span class="default">                MathLib::bigint minValue, maxValue;</span>
<a name="6311"><font size=-1>6311     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(getMinMaxValues(arg.valueType(), *settings, &amp;minValue, &amp;maxValue)) {</span>
<a name="6312"><font size=-1>6312     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!isLow)</span>
<a name="6313"><font size=-1>6313     </font></a><span class="default">                        low = minValue;</span>
<a name="6314"><font size=-1>6314     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!isHigh)</span>
<a name="6315"><font size=-1>6315     </font></a><span class="default">                        high = maxValue;</span>
<a name="6316"><font size=-1>6316     </font></a><span class="default">                    isLow = isHigh = </span><span class="keyword">true</span><span class="default">;</span>
<a name="6317"><font size=-1>6317     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(arg.valueType()-&gt;type == ValueType::Type::FLOAT || arg.valueType()-&gt;type == ValueType::Type::DOUBLE || arg.valueType()-&gt;type == ValueType::Type::LONGDOUBLE) {</span>
<a name="6318"><font size=-1>6318     </font></a><span class="default">                    std::list&lt;ValueFlow::Value&gt; argValues;</span>
<a name="6319"><font size=-1>6319     </font></a><span class="default">                    argValues.emplace_back(</span><span class="number">0</span><span class="default">);</span>
<a name="6320"><font size=-1>6320     </font></a><span class="default">                    argValues.back().valueType = ValueFlow::Value::ValueType::FLOAT;</span>
<a name="6321"><font size=-1>6321     </font></a><span class="default">                    argValues.back().floatValue = isLow ? low : -</span><span class="number">1E25f</span><span class="default">;</span>
<a name="6322"><font size=-1>6322     </font></a><span class="default">                    argValues.back().errorPath.emplace_back(arg.nameToken(), </span><span class="string">&quot;Safe checks: Assuming argument has value &quot; </span><span class="default">+ MathLib::toString(argValues.back().floatValue));</span>
<a name="6323"><font size=-1>6323     </font></a><span class="default">                    argValues.back().safe = </span><span class="keyword">true</span><span class="default">;</span>
<a name="6324"><font size=-1>6324     </font></a><span class="default">                    argValues.emplace_back(</span><span class="number">0</span><span class="default">);</span>
<a name="6325"><font size=-1>6325     </font></a><span class="default">                    argValues.back().valueType = ValueFlow::Value::ValueType::FLOAT;</span>
<a name="6326"><font size=-1>6326     </font></a><span class="default">                    argValues.back().floatValue = isHigh ? high : </span><span class="number">1E25f</span><span class="default">;</span>
<a name="6327"><font size=-1>6327     </font></a><span class="default">                    argValues.back().errorPath.emplace_back(arg.nameToken(), </span><span class="string">&quot;Safe checks: Assuming argument has value &quot; </span><span class="default">+ MathLib::toString(argValues.back().floatValue));</span>
<a name="6328"><font size=-1>6328     </font></a><span class="default">                    argValues.back().safe = </span><span class="keyword">true</span><span class="default">;</span>
<a name="6329"><font size=-1>6329     </font></a><span class="default">                    valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(functionScope-&gt;bodyStart-&gt;next()),</span>
<a name="6330"><font size=-1>6330     </font></a><span class="default">                                             functionScope-&gt;bodyEnd,</span>
<a name="6331"><font size=-1>6331     </font></a><span class="default">                                             &amp;arg,</span>
<a name="6332"><font size=-1>6332     </font></a><span class="default">                                             arg.declarationId(),</span>
<a name="6333"><font size=-1>6333     </font></a><span class="default">                                             argValues,</span>
<a name="6334"><font size=-1>6334     </font></a><span class="default">                                             </span><span class="keyword">false</span><span class="default">,</span>
<a name="6335"><font size=-1>6335     </font></a><span class="default">                                             </span><span class="keyword">false</span><span class="default">,</span>
<a name="6336"><font size=-1>6336     </font></a><span class="default">                                             tokenlist,</span>
<a name="6337"><font size=-1>6337     </font></a><span class="default">                                             errorLogger,</span>
<a name="6338"><font size=-1>6338     </font></a><span class="default">                                             settings);</span>
<a name="6339"><font size=-1>6339     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6340"><font size=-1>6340     </font></a><span class="default">                }</span>
<a name="6341"><font size=-1>6341     </font></a><span class="default">            }</span>
<a name="6342"><font size=-1>6342     </font></a><span class="default"></span>
<a name="6343"><font size=-1>6343     </font></a><span class="default">            std::list&lt;ValueFlow::Value&gt; argValues;</span>
<a name="6344"><font size=-1>6344     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isLow) {</span>
<a name="6345"><font size=-1>6345     </font></a><span class="default">                argValues.emplace_back(low);</span>
<a name="6346"><font size=-1>6346     </font></a><span class="default">                argValues.back().errorPath.emplace_back(arg.nameToken(), std::string(safeLow ? </span><span class="string">&quot;Safe checks: &quot; </span><span class="default">: </span><span class="string">&quot;&quot;</span><span class="default">) + </span><span class="string">&quot;Assuming argument has value &quot; </span><span class="default">+ MathLib::toString(low));</span>
<a name="6347"><font size=-1>6347     </font></a><span class="default">                argValues.back().safe = safeLow;</span>
<a name="6348"><font size=-1>6348     </font></a><span class="default">            }</span>
<a name="6349"><font size=-1>6349     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isHigh) {</span>
<a name="6350"><font size=-1>6350     </font></a><span class="default">                argValues.emplace_back(high);</span>
<a name="6351"><font size=-1>6351     </font></a><span class="default">                argValues.back().errorPath.emplace_back(arg.nameToken(), std::string(safeHigh ? </span><span class="string">&quot;Safe checks: &quot; </span><span class="default">: </span><span class="string">&quot;&quot;</span><span class="default">) + </span><span class="string">&quot;Assuming argument has value &quot; </span><span class="default">+ MathLib::toString(high));</span>
<a name="6352"><font size=-1>6352     </font></a><span class="default">                argValues.back().safe = safeHigh;</span>
<a name="6353"><font size=-1>6353     </font></a><span class="default">            }</span>
<a name="6354"><font size=-1>6354     </font></a><span class="default"></span>
<a name="6355"><font size=-1>6355     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!argValues.empty())</span>
<a name="6356"><font size=-1>6356     </font></a><span class="default">                valueFlowForwardVariable(</span><span class="keyword">const_cast</span><span class="default">&lt;Token*&gt;(functionScope-&gt;bodyStart-&gt;next()),</span>
<a name="6357"><font size=-1>6357     </font></a><span class="default">                                         functionScope-&gt;bodyEnd,</span>
<a name="6358"><font size=-1>6358     </font></a><span class="default">                                         &amp;arg,</span>
<a name="6359"><font size=-1>6359     </font></a><span class="default">                                         arg.declarationId(),</span>
<a name="6360"><font size=-1>6360     </font></a><span class="default">                                         argValues,</span>
<a name="6361"><font size=-1>6361     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">,</span>
<a name="6362"><font size=-1>6362     </font></a><span class="default">                                         </span><span class="keyword">false</span><span class="default">,</span>
<a name="6363"><font size=-1>6363     </font></a><span class="default">                                         tokenlist,</span>
<a name="6364"><font size=-1>6364     </font></a><span class="default">                                         errorLogger,</span>
<a name="6365"><font size=-1>6365     </font></a><span class="default">                                         settings);</span>
<a name="6366"><font size=-1>6366     </font></a><span class="default">        }</span>
<a name="6367"><font size=-1>6367     </font></a><span class="default">    }</span>
<a name="6368"><font size=-1>6368     </font></a><span class="default">}</span>
<a name="6369"><font size=-1>6369     </font></a><span class="default"></span>
<a name="6370"><font size=-1>6370     </font></a><span class="default"></span><span class="keyword">static void </span><span class="default">valueFlowUnknownFunctionReturn(TokenList *tokenlist, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6371"><font size=-1>6371     </font></a><span class="default">{</span>
<a name="6372"><font size=-1>6372     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(settings-&gt;checkUnknownFunctionReturn.empty())</span>
<a name="6373"><font size=-1>6373     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="6374"><font size=-1>6374     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next()) {</span>
<a name="6375"><font size=-1>6375     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok-&gt;astParent() || tok-&gt;str() != </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="6376"><font size=-1>6376     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6377"><font size=-1>6377     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(tok-&gt;previous(), </span><span class="string">&quot;%name%&quot;</span><span class="default">))</span>
<a name="6378"><font size=-1>6378     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6379"><font size=-1>6379     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(settings-&gt;checkUnknownFunctionReturn.find(tok-&gt;previous()-&gt;str()) == settings-&gt;checkUnknownFunctionReturn.end())</span>
<a name="6380"><font size=-1>6380     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6381"><font size=-1>6381     </font></a><span class="default">        std::vector&lt;MathLib::bigint&gt; unknownValues = settings-&gt;library.unknownReturnValues(tok-&gt;astOperand1());</span>
<a name="6382"><font size=-1>6382     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(unknownValues.empty())</span>
<a name="6383"><font size=-1>6383     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6384"><font size=-1>6384     </font></a><span class="default"></span>
<a name="6385"><font size=-1>6385     </font></a><span class="default">        </span><span class="comment">// Get min/max values for return type</span>
<a name="6386"><font size=-1>6386     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">std::string &amp;typestr = settings-&gt;library.returnValueType(tok-&gt;previous());</span>
<a name="6387"><font size=-1>6387     </font></a><span class="default">        MathLib::bigint minvalue, maxvalue;</span>
<a name="6388"><font size=-1>6388     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!getMinMaxValues(typestr, settings, &amp;minvalue, &amp;maxvalue))</span>
<a name="6389"><font size=-1>6389     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="6390"><font size=-1>6390     </font></a><span class="default"></span>
<a name="6391"><font size=-1>6391     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(MathLib::bigint value : unknownValues) {</span>
<a name="6392"><font size=-1>6392     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(value &lt; minvalue)</span>
<a name="6393"><font size=-1>6393     </font></a><span class="default">                value = minvalue;</span>
<a name="6394"><font size=-1>6394     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(value &gt; maxvalue)</span>
<a name="6395"><font size=-1>6395     </font></a><span class="default">                value = maxvalue;</span>
<a name="6396"><font size=-1>6396     </font></a><span class="default">            setTokenValue(</span><span class="keyword">const_cast</span><span class="default">&lt;Token *&gt;(tok), ValueFlow::Value(value), settings);</span>
<a name="6397"><font size=-1>6397     </font></a><span class="default">        }</span>
<a name="6398"><font size=-1>6398     </font></a><span class="default">    }</span>
<a name="6399"><font size=-1>6399     </font></a><span class="default">}</span>
<a name="6400"><font size=-1>6400     </font></a><span class="default"></span>
<a name="6401"><font size=-1>6401     </font></a><span class="default">ValueFlow::Value::Value(</span><span class="keyword">const </span><span class="default">Token* c, </span><span class="keyword">long long </span><span class="default">val)</span>
<a name="6402"><font size=-1>6402     </font></a><span class="default">    : valueType(INT),</span>
<a name="6403"><font size=-1>6403     </font></a><span class="default">      bound(Bound::Point),</span>
<a name="6404"><font size=-1>6404     </font></a><span class="default">      intvalue(val),</span>
<a name="6405"><font size=-1>6405     </font></a><span class="default">      tokvalue(nullptr),</span>
<a name="6406"><font size=-1>6406     </font></a><span class="default">      floatValue(</span><span class="number">0.0</span><span class="default">),</span>
<a name="6407"><font size=-1>6407     </font></a><span class="default">      moveKind(MoveKind::NonMovedVariable),</span>
<a name="6408"><font size=-1>6408     </font></a><span class="default">      varvalue(val),</span>
<a name="6409"><font size=-1>6409     </font></a><span class="default">      condition(c),</span>
<a name="6410"><font size=-1>6410     </font></a><span class="default">      varId(</span><span class="number">0U</span><span class="default">),</span>
<a name="6411"><font size=-1>6411     </font></a><span class="default">      safe(</span><span class="keyword">false</span><span class="default">),</span>
<a name="6412"><font size=-1>6412     </font></a><span class="default">      conditional(</span><span class="keyword">false</span><span class="default">),</span>
<a name="6413"><font size=-1>6413     </font></a><span class="default">      defaultArg(</span><span class="keyword">false</span><span class="default">),</span>
<a name="6414"><font size=-1>6414     </font></a><span class="default">      indirect(</span><span class="number">0</span><span class="default">),</span>
<a name="6415"><font size=-1>6415     </font></a><span class="default">      lifetimeKind(LifetimeKind::Object),</span>
<a name="6416"><font size=-1>6416     </font></a><span class="default">      lifetimeScope(LifetimeScope::Local),</span>
<a name="6417"><font size=-1>6417     </font></a><span class="default">      valueKind(ValueKind::Possible)</span>
<a name="6418"><font size=-1>6418     </font></a><span class="default">{</span>
<a name="6419"><font size=-1>6419     </font></a><span class="default">    errorPath.emplace_back(c, </span><span class="string">&quot;Assuming that condition '&quot; </span><span class="default">+ c-&gt;expressionString() + </span><span class="string">&quot;' is not redundant&quot;</span><span class="default">);</span>
<a name="6420"><font size=-1>6420     </font></a><span class="default">}</span>
<a name="6421"><font size=-1>6421     </font></a><span class="default"></span>
<a name="6422"><font size=-1>6422     </font></a><span class="default">std::string ValueFlow::Value::infoString() </span><span class="keyword">const</span>
<a name="6423"><font size=-1>6423     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="6424"><font size=-1>6424     </font></a><span class="default">    </span><span class="keyword">switch </span><span class="default">(valueType) {</span>
<a name="6425"><font size=-1>6425     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">INT:</span>
<a name="6426"><font size=-1>6426     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">MathLib::toString(intvalue);</span>
<a name="6427"><font size=-1>6427     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">TOK:</span>
<a name="6428"><font size=-1>6428     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">tokvalue-&gt;str();</span>
<a name="6429"><font size=-1>6429     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">FLOAT:</span>
<a name="6430"><font size=-1>6430     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">MathLib::toString(floatValue);</span>
<a name="6431"><font size=-1>6431     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">MOVED:</span>
<a name="6432"><font size=-1>6432     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;&lt;Moved&gt;&quot;</span><span class="default">;</span>
<a name="6433"><font size=-1>6433     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">UNINIT:</span>
<a name="6434"><font size=-1>6434     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;&lt;Uninit&gt;&quot;</span><span class="default">;</span>
<a name="6435"><font size=-1>6435     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">BUFFER_SIZE:</span>
<a name="6436"><font size=-1>6436     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">CONTAINER_SIZE:</span>
<a name="6437"><font size=-1>6437     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;size=&quot; </span><span class="default">+ MathLib::toString(intvalue);</span>
<a name="6438"><font size=-1>6438     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">LIFETIME:</span>
<a name="6439"><font size=-1>6439     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;lifetime=&quot; </span><span class="default">+ tokvalue-&gt;str();</span>
<a name="6440"><font size=-1>6440     </font></a><span class="default">    };</span>
<a name="6441"><font size=-1>6441     </font></a><span class="default">    </span><span class="keyword">throw </span><span class="default">InternalError(nullptr, </span><span class="string">&quot;Invalid ValueFlow Value type&quot;</span><span class="default">);</span>
<a name="6442"><font size=-1>6442     </font></a><span class="default">}</span>
<a name="6443"><font size=-1>6443     </font></a><span class="default"></span>
<a name="6444"><font size=-1>6444     </font></a><span class="default"></span><span class="keyword">const </span><span class="default">ValueFlow::Value *ValueFlow::valueFlowConstantFoldAST(Token *expr, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6445"><font size=-1>6445     </font></a><span class="default">{</span>
<a name="6446"><font size=-1>6446     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(expr &amp;&amp; expr-&gt;values().empty()) {</span>
<a name="6447"><font size=-1>6447     </font></a><span class="default">        valueFlowConstantFoldAST(expr-&gt;astOperand1(), settings);</span>
<a name="6448"><font size=-1>6448     </font></a><span class="default">        valueFlowConstantFoldAST(expr-&gt;astOperand2(), settings);</span>
<a name="6449"><font size=-1>6449     </font></a><span class="default">        valueFlowSetConstantValue(expr, settings, </span><span class="keyword">true </span><span class="comment">/* TODO: this is a guess */</span><span class="default">);</span>
<a name="6450"><font size=-1>6450     </font></a><span class="default">    }</span>
<a name="6451"><font size=-1>6451     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">expr &amp;&amp; expr-&gt;hasKnownValue() ? &amp;expr-&gt;values().front() : nullptr;</span>
<a name="6452"><font size=-1>6452     </font></a><span class="default">}</span>
<a name="6453"><font size=-1>6453     </font></a><span class="default"></span>
<a name="6454"><font size=-1>6454     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::size_t getTotalValues(TokenList *tokenlist)</span>
<a name="6455"><font size=-1>6455     </font></a><span class="default">{</span>
<a name="6456"><font size=-1>6456     </font></a><span class="default">    std::size_t n = </span><span class="number">1</span><span class="default">;</span>
<a name="6457"><font size=-1>6457     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next())</span>
<a name="6458"><font size=-1>6458     </font></a><span class="default">        n += tok-&gt;values().size();</span>
<a name="6459"><font size=-1>6459     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">n;</span>
<a name="6460"><font size=-1>6460     </font></a><span class="default">}</span>
<a name="6461"><font size=-1>6461     </font></a><span class="default"></span>
<a name="6462"><font size=-1>6462     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">ValueFlow::setValues(TokenList *tokenlist, SymbolDatabase* symboldatabase, ErrorLogger *errorLogger, </span><span class="keyword">const </span><span class="default">Settings *settings)</span>
<a name="6463"><font size=-1>6463     </font></a><span class="default">{</span>
<a name="6464"><font size=-1>6464     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Token *tok = tokenlist-&gt;front(); tok; tok = tok-&gt;next())</span>
<a name="6465"><font size=-1>6465     </font></a><span class="default">        tok-&gt;clearValueFlow();</span>
<a name="6466"><font size=-1>6466     </font></a><span class="default"></span>
<a name="6467"><font size=-1>6467     </font></a><span class="default">    valueFlowNumber(tokenlist);</span>
<a name="6468"><font size=-1>6468     </font></a><span class="default">    valueFlowString(tokenlist);</span>
<a name="6469"><font size=-1>6469     </font></a><span class="default">    valueFlowArray(tokenlist);</span>
<a name="6470"><font size=-1>6470     </font></a><span class="default">    valueFlowUnknownFunctionReturn(tokenlist, settings);</span>
<a name="6471"><font size=-1>6471     </font></a><span class="default">    valueFlowGlobalConstVar(tokenlist, settings);</span>
<a name="6472"><font size=-1>6472     </font></a><span class="default">    valueFlowGlobalStaticVar(tokenlist, settings);</span>
<a name="6473"><font size=-1>6473     </font></a><span class="default">    valueFlowPointerAlias(tokenlist);</span>
<a name="6474"><font size=-1>6474     </font></a><span class="default">    valueFlowLifetime(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6475"><font size=-1>6475     </font></a><span class="default">    valueFlowFunctionReturn(tokenlist, errorLogger);</span>
<a name="6476"><font size=-1>6476     </font></a><span class="default">    valueFlowBitAnd(tokenlist);</span>
<a name="6477"><font size=-1>6477     </font></a><span class="default">    valueFlowSameExpressions(tokenlist);</span>
<a name="6478"><font size=-1>6478     </font></a><span class="default">    valueFlowFwdAnalysis(tokenlist, settings);</span>
<a name="6479"><font size=-1>6479     </font></a><span class="default"></span>
<a name="6480"><font size=-1>6480     </font></a><span class="default">    std::size_t values = </span><span class="number">0</span><span class="default">;</span>
<a name="6481"><font size=-1>6481     </font></a><span class="default">    std::size_t n = </span><span class="number">4</span><span class="default">;</span>
<a name="6482"><font size=-1>6482     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(n &gt; </span><span class="number">0 </span><span class="default">&amp;&amp; values &lt; getTotalValues(tokenlist)) {</span>
<a name="6483"><font size=-1>6483     </font></a><span class="default">        values = getTotalValues(tokenlist);</span>
<a name="6484"><font size=-1>6484     </font></a><span class="default">        valueFlowPointerAliasDeref(tokenlist);</span>
<a name="6485"><font size=-1>6485     </font></a><span class="default">        valueFlowArrayBool(tokenlist);</span>
<a name="6486"><font size=-1>6486     </font></a><span class="default">        valueFlowRightShift(tokenlist, settings);</span>
<a name="6487"><font size=-1>6487     </font></a><span class="default">        valueFlowOppositeCondition(symboldatabase, settings);</span>
<a name="6488"><font size=-1>6488     </font></a><span class="default">        valueFlowTerminatingCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6489"><font size=-1>6489     </font></a><span class="default">        valueFlowBeforeCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6490"><font size=-1>6490     </font></a><span class="default">        valueFlowAfterMove(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6491"><font size=-1>6491     </font></a><span class="default">        valueFlowAfterAssign(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6492"><font size=-1>6492     </font></a><span class="default">        valueFlowAfterCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6493"><font size=-1>6493     </font></a><span class="default">        valueFlowInferCondition(tokenlist, settings);</span>
<a name="6494"><font size=-1>6494     </font></a><span class="default">        valueFlowSwitchVariable(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6495"><font size=-1>6495     </font></a><span class="default">        valueFlowForLoop(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6496"><font size=-1>6496     </font></a><span class="default">        valueFlowSubFunction(tokenlist, errorLogger, settings);</span>
<a name="6497"><font size=-1>6497     </font></a><span class="default">        valueFlowFunctionDefaultParameter(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6498"><font size=-1>6498     </font></a><span class="default">        valueFlowUninit(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6499"><font size=-1>6499     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tokenlist-&gt;isCPP()) {</span>
<a name="6500"><font size=-1>6500     </font></a><span class="default">            valueFlowSmartPointer(tokenlist, errorLogger, settings);</span>
<a name="6501"><font size=-1>6501     </font></a><span class="default">            valueFlowContainerSize(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6502"><font size=-1>6502     </font></a><span class="default">            valueFlowContainerAfterCondition(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6503"><font size=-1>6503     </font></a><span class="default">        }</span>
<a name="6504"><font size=-1>6504     </font></a><span class="default">        valueFlowSafeFunctions(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6505"><font size=-1>6505     </font></a><span class="default">        n--;</span>
<a name="6506"><font size=-1>6506     </font></a><span class="default">    }</span>
<a name="6507"><font size=-1>6507     </font></a><span class="default"></span>
<a name="6508"><font size=-1>6508     </font></a><span class="default">    valueFlowDynamicBufferSize(tokenlist, symboldatabase, errorLogger, settings);</span>
<a name="6509"><font size=-1>6509     </font></a><span class="default">}</span>
<a name="6510"><font size=-1>6510     </font></a><span class="default"></span>
<a name="6511"><font size=-1>6511     </font></a><span class="default"></span>
<a name="6512"><font size=-1>6512     </font></a><span class="default">std::string ValueFlow::eitherTheConditionIsRedundant(</span><span class="keyword">const </span><span class="default">Token *condition)</span>
<a name="6513"><font size=-1>6513     </font></a><span class="default">{</span>
<a name="6514"><font size=-1>6514     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!condition)</span>
<a name="6515"><font size=-1>6515     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;Either the condition is redundant&quot;</span><span class="default">;</span>
<a name="6516"><font size=-1>6516     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(condition-&gt;str() == </span><span class="string">&quot;case&quot;</span><span class="default">) {</span>
<a name="6517"><font size=-1>6517     </font></a><span class="default">        std::string expr;</span>
<a name="6518"><font size=-1>6518     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = condition; tok &amp;&amp; tok-&gt;str() != </span><span class="string">&quot;:&quot;</span><span class="default">; tok = tok-&gt;next()) {</span>
<a name="6519"><font size=-1>6519     </font></a><span class="default">            expr += tok-&gt;str();</span>
<a name="6520"><font size=-1>6520     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name%|%num% %name%|%num%&quot;</span><span class="default">))</span>
<a name="6521"><font size=-1>6521     </font></a><span class="default">                expr += </span><span class="string">' '</span><span class="default">;</span>
<a name="6522"><font size=-1>6522     </font></a><span class="default">        }</span>
<a name="6523"><font size=-1>6523     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;Either the switch case '&quot; </span><span class="default">+ expr + </span><span class="string">&quot;' is redundant&quot;</span><span class="default">;</span>
<a name="6524"><font size=-1>6524     </font></a><span class="default">    }</span>
<a name="6525"><font size=-1>6525     </font></a><span class="default">    </span><span class="keyword">return </span><span class="string">&quot;Either the condition '&quot; </span><span class="default">+ condition-&gt;expressionString() + </span><span class="string">&quot;' is redundant&quot;</span><span class="default">;</span>
<a name="6526"><font size=-1>6526     </font></a><span class="default">}</span>
<a name="6527"><font size=-1>6527     </font></a><span class="default"></span>
</pre></body></html>
