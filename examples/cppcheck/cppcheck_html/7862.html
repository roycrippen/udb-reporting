<html><head><title>checkclass.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="sourcestyles.css" />
</head><body link="blue" vlink="blue">
<h3>File: /home/crippenre/dev/cpp/cppcheck/lib/checkclass.cpp</h3>
<SCRIPT>
defaultStatus = "File: /home/crippenre/dev/cpp/cppcheck/lib/checkclass.cpp";
top.document.title  = "checkclass.cpp";
</SCRIPT>
<pre><span class="default"></span><a name="1"><font size=-1>1     </font></a><span class="default"></span><span class="comment">/*</span>
<a name="2"><font size=-1>2     </font></a><span class="comment"> * Cppcheck - A tool for static C/C++ code analysis</span>
<a name="3"><font size=-1>3     </font></a><span class="comment"> * Copyright (C) 2007-2019 Cppcheck team.</span>
<a name="4"><font size=-1>4     </font></a><span class="comment"> *</span>
<a name="5"><font size=-1>5     </font></a><span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="6"><font size=-1>6     </font></a><span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="7"><font size=-1>7     </font></a><span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="8"><font size=-1>8     </font></a><span class="comment"> * (at your option) any later version.</span>
<a name="9"><font size=-1>9     </font></a><span class="comment"> *</span>
<a name="10"><font size=-1>10     </font></a><span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="11"><font size=-1>11     </font></a><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="12"><font size=-1>12     </font></a><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="13"><font size=-1>13     </font></a><span class="comment"> * GNU General Public License for more details.</span>
<a name="14"><font size=-1>14     </font></a><span class="comment"> *</span>
<a name="15"><font size=-1>15     </font></a><span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="16"><font size=-1>16     </font></a><span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="17"><font size=-1>17     </font></a><span class="comment"> */</span>
<a name="18"><font size=-1>18     </font></a><span class="comment"></span>
<a name="19"><font size=-1>19     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="20"><font size=-1>20     </font></a><span class="comment"></span><span class="preproc">#include </span><span class="string">&quot;checkclass.h&quot;</span>
<a name="21"><font size=-1>21     </font></a><span class="string"></span>
<a name="22"><font size=-1>22     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;astutils.h&quot;</span>
<a name="23"><font size=-1>23     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;errorlogger.h&quot;</span>
<a name="24"><font size=-1>24     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;library.h&quot;</span>
<a name="25"><font size=-1>25     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;settings.h&quot;</span>
<a name="26"><font size=-1>26     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;standards.h&quot;</span>
<a name="27"><font size=-1>27     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;symboldatabase.h&quot;</span>
<a name="28"><font size=-1>28     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;token.h&quot;</span>
<a name="29"><font size=-1>29     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;tokenize.h&quot;</span>
<a name="30"><font size=-1>30     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&quot;utils.h&quot;</span>
<a name="31"><font size=-1>31     </font></a><span class="string"></span>
<a name="32"><font size=-1>32     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;algorithm&gt;</span>
<a name="33"><font size=-1>33     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;cstdlib&gt;</span>
<a name="34"><font size=-1>34     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;stack&gt;</span>
<a name="35"><font size=-1>35     </font></a><span class="string"></span><span class="preproc">#include </span><span class="string">&lt;utility&gt;</span>
<a name="36"><font size=-1>36     </font></a><span class="string"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="37"><font size=-1>37     </font></a><span class="comment"></span>
<a name="38"><font size=-1>38     </font></a><span class="comment">// Register CheckClass..</span>
<a name="39"><font size=-1>39     </font></a><span class="comment"></span><span class="keyword">namespace </span><span class="default">{</span>
<a name="40"><font size=-1>40     </font></a><span class="default">    CheckClass instance;</span>
<a name="41"><font size=-1>41     </font></a><span class="default">}</span>
<a name="42"><font size=-1>42     </font></a><span class="default"></span>
<a name="43"><font size=-1>43     </font></a><span class="default"></span><span class="keyword">static const </span><span class="default">CWE CWE398(</span><span class="number">398U</span><span class="default">);  </span><span class="comment">// Indicator of Poor Code Quality</span>
<a name="44"><font size=-1>44     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">CWE CWE404(</span><span class="number">404U</span><span class="default">);  </span><span class="comment">// Improper Resource Shutdown or Release</span>
<a name="45"><font size=-1>45     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">CWE CWE665(</span><span class="number">665U</span><span class="default">);  </span><span class="comment">// Improper Initialization</span>
<a name="46"><font size=-1>46     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">CWE CWE758(</span><span class="number">758U</span><span class="default">);  </span><span class="comment">// Reliance on Undefined, Unspecified, or Implementation-Defined Behavior</span>
<a name="47"><font size=-1>47     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">CWE CWE762(</span><span class="number">762U</span><span class="default">);  </span><span class="comment">// Mismatched Memory Management Routines</span>
<a name="48"><font size=-1>48     </font></a><span class="comment"></span>
<a name="49"><font size=-1>49     </font></a><span class="comment"></span><span class="keyword">static const char </span><span class="default">* getFunctionTypeName(Function::Type type)</span>
<a name="50"><font size=-1>50     </font></a><span class="default">{</span>
<a name="51"><font size=-1>51     </font></a><span class="default">    </span><span class="keyword">switch </span><span class="default">(type) {</span>
<a name="52"><font size=-1>52     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eConstructor:</span>
<a name="53"><font size=-1>53     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;constructor&quot;</span><span class="default">;</span>
<a name="54"><font size=-1>54     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eCopyConstructor:</span>
<a name="55"><font size=-1>55     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;copy constructor&quot;</span><span class="default">;</span>
<a name="56"><font size=-1>56     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eMoveConstructor:</span>
<a name="57"><font size=-1>57     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;move constructor&quot;</span><span class="default">;</span>
<a name="58"><font size=-1>58     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eDestructor:</span>
<a name="59"><font size=-1>59     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;destructor&quot;</span><span class="default">;</span>
<a name="60"><font size=-1>60     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eFunction:</span>
<a name="61"><font size=-1>61     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;function&quot;</span><span class="default">;</span>
<a name="62"><font size=-1>62     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eOperatorEqual:</span>
<a name="63"><font size=-1>63     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;operator=&quot;</span><span class="default">;</span>
<a name="64"><font size=-1>64     </font></a><span class="default">    </span><span class="keyword">case </span><span class="default">Function::eLambda:</span>
<a name="65"><font size=-1>65     </font></a><span class="default">        </span><span class="keyword">return </span><span class="string">&quot;lambda&quot;</span><span class="default">;</span>
<a name="66"><font size=-1>66     </font></a><span class="default">    }</span>
<a name="67"><font size=-1>67     </font></a><span class="default">    </span><span class="keyword">return </span><span class="string">&quot;&quot;</span><span class="default">;</span>
<a name="68"><font size=-1>68     </font></a><span class="default">}</span>
<a name="69"><font size=-1>69     </font></a><span class="default"></span>
<a name="70"><font size=-1>70     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isVariableCopyNeeded(</span><span class="keyword">const </span><span class="default">Variable &amp;var)</span>
<a name="71"><font size=-1>71     </font></a><span class="default">{</span>
<a name="72"><font size=-1>72     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">var.isPointer() || (var.type() &amp;&amp; var.type()-&gt;needInitialization == Type::NeedInitialization::True) || (var.valueType()-&gt;type &gt;= ValueType::Type::CHAR);</span>
<a name="73"><font size=-1>73     </font></a><span class="default">}</span>
<a name="74"><font size=-1>74     </font></a><span class="default"></span>
<a name="75"><font size=-1>75     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="76"><font size=-1>76     </font></a><span class="comment"></span>
<a name="77"><font size=-1>77     </font></a><span class="comment"></span><span class="default">CheckClass::CheckClass(</span><span class="keyword">const </span><span class="default">Tokenizer *tokenizer, </span><span class="keyword">const </span><span class="default">Settings *settings, ErrorLogger *errorLogger)</span>
<a name="78"><font size=-1>78     </font></a><span class="default">    : Check(myName(), tokenizer, settings, errorLogger),</span>
<a name="79"><font size=-1>79     </font></a><span class="default">      mSymbolDatabase(tokenizer?tokenizer-&gt;getSymbolDatabase():nullptr)</span>
<a name="80"><font size=-1>80     </font></a><span class="default">{</span>
<a name="81"><font size=-1>81     </font></a><span class="default"></span>
<a name="82"><font size=-1>82     </font></a><span class="default">}</span>
<a name="83"><font size=-1>83     </font></a><span class="default"></span>
<a name="84"><font size=-1>84     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="85"><font size=-1>85     </font></a><span class="comment">// ClassCheck: Check that all class constructors are ok.</span>
<a name="86"><font size=-1>86     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="87"><font size=-1>87     </font></a><span class="comment"></span>
<a name="88"><font size=-1>88     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::constructors()</span>
<a name="89"><font size=-1>89     </font></a><span class="default">{</span>
<a name="90"><font size=-1>90     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">printStyle = mSettings-&gt;isEnabled(Settings::STYLE);</span>
<a name="91"><font size=-1>91     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">printWarnings = mSettings-&gt;isEnabled(Settings::WARNING);</span>
<a name="92"><font size=-1>92     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!printStyle &amp;&amp; !printWarnings)</span>
<a name="93"><font size=-1>93     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="94"><font size=-1>94     </font></a><span class="default"></span>
<a name="95"><font size=-1>95     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">printInconclusive = mSettings-&gt;inconclusive;</span>
<a name="96"><font size=-1>96     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="97"><font size=-1>97     </font></a><span class="default">        </span><span class="keyword">const bool </span><span class="default">unusedTemplate = Token::simpleMatch(scope-&gt;classDef-&gt;previous(), </span><span class="string">&quot;&gt;&quot;</span><span class="default">);</span>
<a name="98"><font size=-1>98     </font></a><span class="default"></span>
<a name="99"><font size=-1>99     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">usedInUnion = </span><span class="keyword">false</span><span class="default">;</span>
<a name="100"><font size=-1>100     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope &amp;unionScope : mSymbolDatabase-&gt;scopeList) {</span>
<a name="101"><font size=-1>101     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(unionScope.type != Scope::eUnion)</span>
<a name="102"><font size=-1>102     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="103"><font size=-1>103     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : unionScope.varlist) {</span>
<a name="104"><font size=-1>104     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var.type() &amp;&amp; var.type()-&gt;classScope == scope) {</span>
<a name="105"><font size=-1>105     </font></a><span class="default">                    usedInUnion = </span><span class="keyword">true</span><span class="default">;</span>
<a name="106"><font size=-1>106     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="107"><font size=-1>107     </font></a><span class="default">                }</span>
<a name="108"><font size=-1>108     </font></a><span class="default">            }</span>
<a name="109"><font size=-1>109     </font></a><span class="default">        }</span>
<a name="110"><font size=-1>110     </font></a><span class="default"></span>
<a name="111"><font size=-1>111     </font></a><span class="default">        </span><span class="comment">// There are no constructors.</span>
<a name="112"><font size=-1>112     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(scope-&gt;numConstructors == </span><span class="number">0 </span><span class="default">&amp;&amp; printStyle &amp;&amp; !usedInUnion) {</span>
<a name="113"><font size=-1>113     </font></a><span class="default">            </span><span class="comment">// If there is a private variable, there should be a constructor..</span>
<a name="114"><font size=-1>114     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : scope-&gt;varlist) {</span>
<a name="115"><font size=-1>115     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *initTok = var.nameToken();</span>
<a name="116"><font size=-1>116     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(Token::simpleMatch(initTok-&gt;next(), </span><span class="string">&quot;[&quot;</span><span class="default">))</span>
<a name="117"><font size=-1>117     </font></a><span class="default">                    initTok = initTok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="118"><font size=-1>118     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var.isPrivate() &amp;&amp; !var.isStatic() &amp;&amp; !Token::Match(var.nameToken(), </span><span class="string">&quot;%varid% ; %varid% =&quot;</span><span class="default">, var.declarationId()) &amp;&amp;</span>
<a name="119"><font size=-1>119     </font></a><span class="default">                    !Token::Match(initTok, </span><span class="string">&quot;%var%|] {|=&quot;</span><span class="default">) &amp;&amp;</span>
<a name="120"><font size=-1>120     </font></a><span class="default">                    (!var.isClass() || (var.type() &amp;&amp; var.type()-&gt;needInitialization == Type::NeedInitialization::True))) {</span>
<a name="121"><font size=-1>121     </font></a><span class="default">                    noConstructorError(scope-&gt;classDef, scope-&gt;className, scope-&gt;classDef-&gt;str() == </span><span class="string">&quot;struct&quot;</span><span class="default">);</span>
<a name="122"><font size=-1>122     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="123"><font size=-1>123     </font></a><span class="default">                }</span>
<a name="124"><font size=-1>124     </font></a><span class="default">            }</span>
<a name="125"><font size=-1>125     </font></a><span class="default">        }</span>
<a name="126"><font size=-1>126     </font></a><span class="default"></span>
<a name="127"><font size=-1>127     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!printWarnings)</span>
<a name="128"><font size=-1>128     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="129"><font size=-1>129     </font></a><span class="default"></span>
<a name="130"><font size=-1>130     </font></a><span class="default">        </span><span class="comment">// #3196 =&gt; bailout if there are nested unions</span>
<a name="131"><font size=-1>131     </font></a><span class="comment">        // TODO: handle union variables better</span>
<a name="132"><font size=-1>132     </font></a><span class="comment">        </span><span class="default">{</span>
<a name="133"><font size=-1>133     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">bailout = </span><span class="keyword">false</span><span class="default">;</span>
<a name="134"><font size=-1>134     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * </span><span class="keyword">const </span><span class="default">nestedScope : scope-&gt;nestedList) {</span>
<a name="135"><font size=-1>135     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(nestedScope-&gt;type == Scope::eUnion) {</span>
<a name="136"><font size=-1>136     </font></a><span class="default">                    bailout = </span><span class="keyword">true</span><span class="default">;</span>
<a name="137"><font size=-1>137     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="138"><font size=-1>138     </font></a><span class="default">                }</span>
<a name="139"><font size=-1>139     </font></a><span class="default">            }</span>
<a name="140"><font size=-1>140     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(bailout)</span>
<a name="141"><font size=-1>141     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="142"><font size=-1>142     </font></a><span class="default">        }</span>
<a name="143"><font size=-1>143     </font></a><span class="default"></span>
<a name="144"><font size=-1>144     </font></a><span class="default"></span>
<a name="145"><font size=-1>145     </font></a><span class="default">        std::vector&lt;Usage&gt; usage(scope-&gt;varlist.size());</span>
<a name="146"><font size=-1>146     </font></a><span class="default"></span>
<a name="147"><font size=-1>147     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="148"><font size=-1>148     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!func.hasBody() || !(func.isConstructor() || func.type == Function::eOperatorEqual))</span>
<a name="149"><font size=-1>149     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="150"><font size=-1>150     </font></a><span class="default"></span>
<a name="151"><font size=-1>151     </font></a><span class="default">            </span><span class="comment">// Bail: If initializer list is not recognized as a variable or type then skip since parsing is incomplete</span>
<a name="152"><font size=-1>152     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(unusedTemplate &amp;&amp; func.type == Function::eConstructor) {</span>
<a name="153"><font size=-1>153     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *initList = func.constructorMemberInitialization();</span>
<a name="154"><font size=-1>154     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(initList, </span><span class="string">&quot;: %name% (&quot;</span><span class="default">) &amp;&amp; initList-&gt;next()-&gt;tokType() == Token::eName)</span>
<a name="155"><font size=-1>155     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="156"><font size=-1>156     </font></a><span class="default">            }</span>
<a name="157"><font size=-1>157     </font></a><span class="default"></span>
<a name="158"><font size=-1>158     </font></a><span class="default">            </span><span class="comment">// Mark all variables not used</span>
<a name="159"><font size=-1>159     </font></a><span class="comment">            </span><span class="default">clearAllVar(usage);</span>
<a name="160"><font size=-1>160     </font></a><span class="default"></span>
<a name="161"><font size=-1>161     </font></a><span class="default">            std::list&lt;</span><span class="keyword">const </span><span class="default">Function *&gt; callstack;</span>
<a name="162"><font size=-1>162     </font></a><span class="default">            initializeVarList(func, callstack, scope, usage);</span>
<a name="163"><font size=-1>163     </font></a><span class="default"></span>
<a name="164"><font size=-1>164     </font></a><span class="default">            </span><span class="comment">// Check if any variables are uninitialized</span>
<a name="165"><font size=-1>165     </font></a><span class="comment">            </span><span class="keyword">int </span><span class="default">count = -</span><span class="number">1</span><span class="default">;</span>
<a name="166"><font size=-1>166     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : scope-&gt;varlist) {</span>
<a name="167"><font size=-1>167     </font></a><span class="default">                ++count;</span>
<a name="168"><font size=-1>168     </font></a><span class="default"></span>
<a name="169"><font size=-1>169     </font></a><span class="default">                </span><span class="comment">// check for C++11 initializer</span>
<a name="170"><font size=-1>170     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(var.hasDefault()) {</span>
<a name="171"><font size=-1>171     </font></a><span class="default">                    usage[count].init = </span><span class="keyword">true</span><span class="default">;</span>
<a name="172"><font size=-1>172     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="173"><font size=-1>173     </font></a><span class="default">                }</span>
<a name="174"><font size=-1>174     </font></a><span class="default"></span>
<a name="175"><font size=-1>175     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(usage[count].assign || usage[count].init || var.isStatic())</span>
<a name="176"><font size=-1>176     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="177"><font size=-1>177     </font></a><span class="default"></span>
<a name="178"><font size=-1>178     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var.valueType()-&gt;pointer == </span><span class="number">0 </span><span class="default">&amp;&amp; var.type() &amp;&amp; var.type()-&gt;needInitialization == Type::NeedInitialization::False &amp;&amp; var.type()-&gt;derivedFrom.empty())</span>
<a name="179"><font size=-1>179     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="180"><font size=-1>180     </font></a><span class="default"></span>
<a name="181"><font size=-1>181     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var.isConst() &amp;&amp; func.isOperator()) </span><span class="comment">// We can't set const members in assignment operator</span>
<a name="182"><font size=-1>182     </font></a><span class="comment">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="183"><font size=-1>183     </font></a><span class="default"></span>
<a name="184"><font size=-1>184     </font></a><span class="default">                </span><span class="comment">// Check if this is a class constructor</span>
<a name="185"><font size=-1>185     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!var.isPointer() &amp;&amp; !var.isPointerArray() &amp;&amp; var.isClass() &amp;&amp; func.type == Function::eConstructor) {</span>
<a name="186"><font size=-1>186     </font></a><span class="default">                    </span><span class="comment">// Unknown type so assume it is initialized</span>
<a name="187"><font size=-1>187     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(!var.type())</span>
<a name="188"><font size=-1>188     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="189"><font size=-1>189     </font></a><span class="default"></span>
<a name="190"><font size=-1>190     </font></a><span class="default">                    </span><span class="comment">// Known type that doesn't need initialization or</span>
<a name="191"><font size=-1>191     </font></a><span class="comment">                    // known type that has member variables of an unknown type</span>
<a name="192"><font size=-1>192     </font></a><span class="comment">                    </span><span class="keyword">else if </span><span class="default">(var.type()-&gt;needInitialization != Type::NeedInitialization::True)</span>
<a name="193"><font size=-1>193     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="194"><font size=-1>194     </font></a><span class="default">                }</span>
<a name="195"><font size=-1>195     </font></a><span class="default"></span>
<a name="196"><font size=-1>196     </font></a><span class="default">                </span><span class="comment">// Check if type can't be copied</span>
<a name="197"><font size=-1>197     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!var.isPointer() &amp;&amp; !var.isPointerArray() &amp;&amp; var.typeScope()) {</span>
<a name="198"><font size=-1>198     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(func.type == Function::eMoveConstructor) {</span>
<a name="199"><font size=-1>199     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(canNotMove(var.typeScope()))</span>
<a name="200"><font size=-1>200     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="201"><font size=-1>201     </font></a><span class="default">                    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="202"><font size=-1>202     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(canNotCopy(var.typeScope()))</span>
<a name="203"><font size=-1>203     </font></a><span class="default">                            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="204"><font size=-1>204     </font></a><span class="default">                    }</span>
<a name="205"><font size=-1>205     </font></a><span class="default">                }</span>
<a name="206"><font size=-1>206     </font></a><span class="default"></span>
<a name="207"><font size=-1>207     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">inconclusive = </span><span class="keyword">false</span><span class="default">;</span>
<a name="208"><font size=-1>208     </font></a><span class="default">                </span><span class="comment">// Don't warn about unknown types in copy constructors since we</span>
<a name="209"><font size=-1>209     </font></a><span class="comment">                // don't know if they can be copied or not..</span>
<a name="210"><font size=-1>210     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">((func.type == Function::eCopyConstructor || func.type == Function::eMoveConstructor || func.type == Function::eOperatorEqual) &amp;&amp; !isVariableCopyNeeded(var))</span>
<a name="211"><font size=-1>211     </font></a><span class="default">                    inconclusive = </span><span class="keyword">true</span><span class="default">;</span>
<a name="212"><font size=-1>212     </font></a><span class="default"></span>
<a name="213"><font size=-1>213     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!printInconclusive &amp;&amp; inconclusive)</span>
<a name="214"><font size=-1>214     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="215"><font size=-1>215     </font></a><span class="default"></span>
<a name="216"><font size=-1>216     </font></a><span class="default">                </span><span class="comment">// It's non-static and it's not initialized =&gt; error</span>
<a name="217"><font size=-1>217     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(func.type == Function::eOperatorEqual) {</span>
<a name="218"><font size=-1>218     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Token *operStart = func.arg;</span>
<a name="219"><font size=-1>219     </font></a><span class="default"></span>
<a name="220"><font size=-1>220     </font></a><span class="default">                    </span><span class="keyword">bool </span><span class="default">classNameUsed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="221"><font size=-1>221     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *operTok = operStart; operTok != operStart-&gt;link(); operTok = operTok-&gt;next()) {</span>
<a name="222"><font size=-1>222     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(operTok-&gt;str() == scope-&gt;className) {</span>
<a name="223"><font size=-1>223     </font></a><span class="default">                            classNameUsed = </span><span class="keyword">true</span><span class="default">;</span>
<a name="224"><font size=-1>224     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="225"><font size=-1>225     </font></a><span class="default">                        }</span>
<a name="226"><font size=-1>226     </font></a><span class="default">                    }</span>
<a name="227"><font size=-1>227     </font></a><span class="default"></span>
<a name="228"><font size=-1>228     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(classNameUsed)</span>
<a name="229"><font size=-1>229     </font></a><span class="default">                        operatorEqVarError(func.token, scope-&gt;className, var.name(), inconclusive);</span>
<a name="230"><font size=-1>230     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(func.access != AccessControl::Private || mSettings-&gt;standards.cpp &gt;= Standards::CPP11) {</span>
<a name="231"><font size=-1>231     </font></a><span class="default">                    </span><span class="comment">// If constructor is not in scope then we maybe using a oonstructor from a different template specialization</span>
<a name="232"><font size=-1>232     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(!precedes(scope-&gt;bodyStart, func.tokenDef))</span>
<a name="233"><font size=-1>233     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="234"><font size=-1>234     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Scope *varType = var.typeScope();</span>
<a name="235"><font size=-1>235     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!varType || varType-&gt;type != Scope::eUnion) {</span>
<a name="236"><font size=-1>236     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(func.type == Function::eConstructor &amp;&amp;</span>
<a name="237"><font size=-1>237     </font></a><span class="default">                            func.nestedIn &amp;&amp; (func.nestedIn-&gt;numConstructors - func.nestedIn-&gt;numCopyOrMoveConstructors) &gt; </span><span class="number">1 </span><span class="default">&amp;&amp;</span>
<a name="238"><font size=-1>238     </font></a><span class="default">                            func.argCount() == </span><span class="number">0 </span><span class="default">&amp;&amp; func.functionScope &amp;&amp;</span>
<a name="239"><font size=-1>239     </font></a><span class="default">                            func.arg &amp;&amp; func.arg-&gt;link()-&gt;next() == func.functionScope-&gt;bodyStart &amp;&amp;</span>
<a name="240"><font size=-1>240     </font></a><span class="default">                            func.functionScope-&gt;bodyStart-&gt;link() == func.functionScope-&gt;bodyStart-&gt;next()) {</span>
<a name="241"><font size=-1>241     </font></a><span class="default">                            </span><span class="comment">// don't warn about user defined default constructor when there are other constructors</span>
<a name="242"><font size=-1>242     </font></a><span class="comment">                            </span><span class="keyword">if </span><span class="default">(printInconclusive)</span>
<a name="243"><font size=-1>243     </font></a><span class="default">                                uninitVarError(func.token, func.access == AccessControl::Private, scope-&gt;className, var.name(), </span><span class="keyword">true</span><span class="default">);</span>
<a name="244"><font size=-1>244     </font></a><span class="default">                        } </span><span class="keyword">else</span>
<a name="245"><font size=-1>245     </font></a><span class="keyword">                            </span><span class="default">uninitVarError(func.token, func.access == AccessControl::Private, scope-&gt;className, var.name(), inconclusive);</span>
<a name="246"><font size=-1>246     </font></a><span class="default">                    }</span>
<a name="247"><font size=-1>247     </font></a><span class="default">                }</span>
<a name="248"><font size=-1>248     </font></a><span class="default">            }</span>
<a name="249"><font size=-1>249     </font></a><span class="default">        }</span>
<a name="250"><font size=-1>250     </font></a><span class="default">    }</span>
<a name="251"><font size=-1>251     </font></a><span class="default">}</span>
<a name="252"><font size=-1>252     </font></a><span class="default"></span>
<a name="253"><font size=-1>253     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkExplicitConstructors()</span>
<a name="254"><font size=-1>254     </font></a><span class="default">{</span>
<a name="255"><font size=-1>255     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="256"><font size=-1>256     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="257"><font size=-1>257     </font></a><span class="default"></span>
<a name="258"><font size=-1>258     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="259"><font size=-1>259     </font></a><span class="default">        </span><span class="comment">// Do not perform check, if the class/struct has not any constructors</span>
<a name="260"><font size=-1>260     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(scope-&gt;numConstructors == </span><span class="number">0</span><span class="default">)</span>
<a name="261"><font size=-1>261     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="262"><font size=-1>262     </font></a><span class="default"></span>
<a name="263"><font size=-1>263     </font></a><span class="default">        </span><span class="comment">// Is class abstract? Maybe this test is over-simplification, but it will suffice for simple cases,</span>
<a name="264"><font size=-1>264     </font></a><span class="comment">        // and it will avoid false positives.</span>
<a name="265"><font size=-1>265     </font></a><span class="comment">        </span><span class="keyword">bool </span><span class="default">isAbstractClass = </span><span class="keyword">false</span><span class="default">;</span>
<a name="266"><font size=-1>266     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="267"><font size=-1>267     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.isPure()) {</span>
<a name="268"><font size=-1>268     </font></a><span class="default">                isAbstractClass = </span><span class="keyword">true</span><span class="default">;</span>
<a name="269"><font size=-1>269     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="270"><font size=-1>270     </font></a><span class="default">            }</span>
<a name="271"><font size=-1>271     </font></a><span class="default">        }</span>
<a name="272"><font size=-1>272     </font></a><span class="default"></span>
<a name="273"><font size=-1>273     </font></a><span class="default">        </span><span class="comment">// Abstract classes can't be instantiated. But if there is C++11</span>
<a name="274"><font size=-1>274     </font></a><span class="comment">        // &quot;misuse&quot; by derived classes then these constructors must be explicit.</span>
<a name="275"><font size=-1>275     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(isAbstractClass &amp;&amp; mSettings-&gt;standards.cpp != Standards::CPP11)</span>
<a name="276"><font size=-1>276     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="277"><font size=-1>277     </font></a><span class="default"></span>
<a name="278"><font size=-1>278     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="279"><font size=-1>279     </font></a><span class="default"></span>
<a name="280"><font size=-1>280     </font></a><span class="default">            </span><span class="comment">// We are looking for constructors, which are meeting following criteria:</span>
<a name="281"><font size=-1>281     </font></a><span class="comment">            //  1) Constructor is declared with a single parameter</span>
<a name="282"><font size=-1>282     </font></a><span class="comment">            //  2) Constructor is not declared as explicit</span>
<a name="283"><font size=-1>283     </font></a><span class="comment">            //  3) It is not a copy/move constructor of non-abstract class</span>
<a name="284"><font size=-1>284     </font></a><span class="comment">            //  4) Constructor is not marked as delete (programmer can mark the default constructor as deleted, which is ok)</span>
<a name="285"><font size=-1>285     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!func.isConstructor() || func.isDelete() || (!func.hasBody() &amp;&amp; func.access == AccessControl::Private))</span>
<a name="286"><font size=-1>286     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="287"><font size=-1>287     </font></a><span class="default"></span>
<a name="288"><font size=-1>288     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!func.isExplicit() &amp;&amp;</span>
<a name="289"><font size=-1>289     </font></a><span class="default">                func.minArgCount() == </span><span class="number">1 </span><span class="default">&amp;&amp;</span>
<a name="290"><font size=-1>290     </font></a><span class="default">                func.type != Function::eCopyConstructor &amp;&amp;</span>
<a name="291"><font size=-1>291     </font></a><span class="default">                func.type != Function::eMoveConstructor) {</span>
<a name="292"><font size=-1>292     </font></a><span class="default">                noExplicitConstructorError(func.tokenDef, scope-&gt;className, scope-&gt;type == Scope::eStruct);</span>
<a name="293"><font size=-1>293     </font></a><span class="default">            }</span>
<a name="294"><font size=-1>294     </font></a><span class="default">        }</span>
<a name="295"><font size=-1>295     </font></a><span class="default">    }</span>
<a name="296"><font size=-1>296     </font></a><span class="default">}</span>
<a name="297"><font size=-1>297     </font></a><span class="default"></span>
<a name="298"><font size=-1>298     </font></a><span class="default"></span><span class="keyword">static bool </span><span class="default">isNonCopyable(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">bool </span><span class="default">*unknown)</span>
<a name="299"><font size=-1>299     </font></a><span class="default">{</span>
<a name="300"><font size=-1>300     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">u = </span><span class="keyword">false</span><span class="default">;</span>
<a name="301"><font size=-1>301     </font></a><span class="default">    </span><span class="comment">// check if there is base class that is not copyable</span>
<a name="302"><font size=-1>302     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp;baseInfo : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="303"><font size=-1>303     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!baseInfo.type || !baseInfo.type-&gt;classScope) {</span>
<a name="304"><font size=-1>304     </font></a><span class="default">            u = </span><span class="keyword">true</span><span class="default">;</span>
<a name="305"><font size=-1>305     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="306"><font size=-1>306     </font></a><span class="default">        }</span>
<a name="307"><font size=-1>307     </font></a><span class="default"></span>
<a name="308"><font size=-1>308     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isNonCopyable(baseInfo.type-&gt;classScope, &amp;u))</span>
<a name="309"><font size=-1>309     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="310"><font size=-1>310     </font></a><span class="default"></span>
<a name="311"><font size=-1>311     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : baseInfo.type-&gt;classScope-&gt;functionList) {</span>
<a name="312"><font size=-1>312     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.type != Function::eCopyConstructor)</span>
<a name="313"><font size=-1>313     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="314"><font size=-1>314     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.access == AccessControl::Private || func.isDelete())</span>
<a name="315"><font size=-1>315     </font></a><span class="default">                </span><span class="keyword">return true</span><span class="default">;</span>
<a name="316"><font size=-1>316     </font></a><span class="default">        }</span>
<a name="317"><font size=-1>317     </font></a><span class="default">    }</span>
<a name="318"><font size=-1>318     </font></a><span class="default">    *unknown = u;</span>
<a name="319"><font size=-1>319     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="320"><font size=-1>320     </font></a><span class="default">}</span>
<a name="321"><font size=-1>321     </font></a><span class="default"></span>
<a name="322"><font size=-1>322     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::copyconstructors()</span>
<a name="323"><font size=-1>323     </font></a><span class="default">{</span>
<a name="324"><font size=-1>324     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="325"><font size=-1>325     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="326"><font size=-1>326     </font></a><span class="default"></span>
<a name="327"><font size=-1>327     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="328"><font size=-1>328     </font></a><span class="default">        std::map&lt;</span><span class="keyword">int</span><span class="default">, </span><span class="keyword">const </span><span class="default">Token*&gt; allocatedVars;</span>
<a name="329"><font size=-1>329     </font></a><span class="default"></span>
<a name="330"><font size=-1>330     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="331"><font size=-1>331     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.type != Function::eConstructor || !func.functionScope)</span>
<a name="332"><font size=-1>332     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="333"><font size=-1>333     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* tok = func.token-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="334"><font size=-1>334     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* </span><span class="keyword">const </span><span class="default">end = func.functionScope-&gt;bodyStart; tok != end; tok = tok-&gt;next()) {</span>
<a name="335"><font size=-1>335     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% ( new&quot;</span><span class="default">) ||</span>
<a name="336"><font size=-1>336     </font></a><span class="default">                    (Token::Match(tok, </span><span class="string">&quot;%var% ( %name% (&quot;</span><span class="default">) &amp;&amp; mSettings-&gt;library.getAllocFuncInfo(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)))) {</span>
<a name="337"><font size=-1>337     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable* var = tok-&gt;variable();</span>
<a name="338"><font size=-1>338     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;isPointer() &amp;&amp; var-&gt;scope() == scope)</span>
<a name="339"><font size=-1>339     </font></a><span class="default">                        allocatedVars[tok-&gt;varId()] = tok;</span>
<a name="340"><font size=-1>340     </font></a><span class="default">                }</span>
<a name="341"><font size=-1>341     </font></a><span class="default">            }</span>
<a name="342"><font size=-1>342     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* </span><span class="keyword">const </span><span class="default">end = func.functionScope-&gt;bodyEnd; tok != end; tok = tok-&gt;next()) {</span>
<a name="343"><font size=-1>343     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% = new&quot;</span><span class="default">) ||</span>
<a name="344"><font size=-1>344     </font></a><span class="default">                    (Token::Match(tok, </span><span class="string">&quot;%var% = %name% (&quot;</span><span class="default">) &amp;&amp; mSettings-&gt;library.getAllocFuncInfo(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)))) {</span>
<a name="345"><font size=-1>345     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable* var = tok-&gt;variable();</span>
<a name="346"><font size=-1>346     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;isPointer() &amp;&amp; var-&gt;scope() == scope &amp;&amp; !var-&gt;isStatic())</span>
<a name="347"><font size=-1>347     </font></a><span class="default">                        allocatedVars[tok-&gt;varId()] = tok;</span>
<a name="348"><font size=-1>348     </font></a><span class="default">                }</span>
<a name="349"><font size=-1>349     </font></a><span class="default">            }</span>
<a name="350"><font size=-1>350     </font></a><span class="default">        }</span>
<a name="351"><font size=-1>351     </font></a><span class="default"></span>
<a name="352"><font size=-1>352     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!allocatedVars.empty()) {</span>
<a name="353"><font size=-1>353     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Function *funcCopyCtor = nullptr;</span>
<a name="354"><font size=-1>354     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Function *funcOperatorEq = nullptr;</span>
<a name="355"><font size=-1>355     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Function *funcDestructor = nullptr;</span>
<a name="356"><font size=-1>356     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="357"><font size=-1>357     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(func.type == Function::eCopyConstructor)</span>
<a name="358"><font size=-1>358     </font></a><span class="default">                    funcCopyCtor = &amp;func;</span>
<a name="359"><font size=-1>359     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(func.type == Function::eOperatorEqual)</span>
<a name="360"><font size=-1>360     </font></a><span class="default">                    funcOperatorEq = &amp;func;</span>
<a name="361"><font size=-1>361     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(func.type == Function::eDestructor)</span>
<a name="362"><font size=-1>362     </font></a><span class="default">                    funcDestructor = &amp;func;</span>
<a name="363"><font size=-1>363     </font></a><span class="default">            }</span>
<a name="364"><font size=-1>364     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!funcCopyCtor || funcCopyCtor-&gt;isDefault()) {</span>
<a name="365"><font size=-1>365     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">unknown = </span><span class="keyword">false</span><span class="default">;</span>
<a name="366"><font size=-1>366     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!isNonCopyable(scope, &amp;unknown) &amp;&amp; !unknown)</span>
<a name="367"><font size=-1>367     </font></a><span class="default">                    noCopyConstructorError(scope, funcCopyCtor, allocatedVars.begin()-&gt;second, unknown);</span>
<a name="368"><font size=-1>368     </font></a><span class="default">            }</span>
<a name="369"><font size=-1>369     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!funcOperatorEq || funcOperatorEq-&gt;isDefault()) {</span>
<a name="370"><font size=-1>370     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">unknown = </span><span class="keyword">false</span><span class="default">;</span>
<a name="371"><font size=-1>371     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!isNonCopyable(scope, &amp;unknown) &amp;&amp; !unknown)</span>
<a name="372"><font size=-1>372     </font></a><span class="default">                    noOperatorEqError(scope, funcOperatorEq, allocatedVars.begin()-&gt;second, unknown);</span>
<a name="373"><font size=-1>373     </font></a><span class="default">            }</span>
<a name="374"><font size=-1>374     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!funcDestructor || funcDestructor-&gt;isDefault()) {</span>
<a name="375"><font size=-1>375     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token * mustDealloc = nullptr;</span>
<a name="376"><font size=-1>376     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(std::map&lt;</span><span class="keyword">int</span><span class="default">, </span><span class="keyword">const </span><span class="default">Token*&gt;::const_iterator it = allocatedVars.begin(); it != allocatedVars.end(); ++it) {</span>
<a name="377"><font size=-1>377     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!Token::Match(it-&gt;second, </span><span class="string">&quot;%var% [(=] new %type%&quot;</span><span class="default">)) {</span>
<a name="378"><font size=-1>378     </font></a><span class="default">                        mustDealloc = it-&gt;second;</span>
<a name="379"><font size=-1>379     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="380"><font size=-1>380     </font></a><span class="default">                    }</span>
<a name="381"><font size=-1>381     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(it-&gt;second-&gt;valueType() &amp;&amp; it-&gt;second-&gt;valueType()-&gt;isIntegral()) {</span>
<a name="382"><font size=-1>382     </font></a><span class="default">                        mustDealloc = it-&gt;second;</span>
<a name="383"><font size=-1>383     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="384"><font size=-1>384     </font></a><span class="default">                    }</span>
<a name="385"><font size=-1>385     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable *var = it-&gt;second-&gt;variable();</span>
<a name="386"><font size=-1>386     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;typeScope() &amp;&amp; var-&gt;typeScope()-&gt;functionList.empty() &amp;&amp; var-&gt;type()-&gt;derivedFrom.empty())</span>
<a name="387"><font size=-1>387     </font></a><span class="default">                        mustDealloc = it-&gt;second;</span>
<a name="388"><font size=-1>388     </font></a><span class="default">                }</span>
<a name="389"><font size=-1>389     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(mustDealloc)</span>
<a name="390"><font size=-1>390     </font></a><span class="default">                    noDestructorError(scope, funcDestructor, mustDealloc);</span>
<a name="391"><font size=-1>391     </font></a><span class="default">            }</span>
<a name="392"><font size=-1>392     </font></a><span class="default">        }</span>
<a name="393"><font size=-1>393     </font></a><span class="default"></span>
<a name="394"><font size=-1>394     </font></a><span class="default">        std::set&lt;</span><span class="keyword">const </span><span class="default">Token*&gt; copiedVars;</span>
<a name="395"><font size=-1>395     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token* copyCtor = nullptr;</span>
<a name="396"><font size=-1>396     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="397"><font size=-1>397     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.type != Function::eCopyConstructor)</span>
<a name="398"><font size=-1>398     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="399"><font size=-1>399     </font></a><span class="default">            copyCtor = func.tokenDef;</span>
<a name="400"><font size=-1>400     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!func.functionScope) {</span>
<a name="401"><font size=-1>401     </font></a><span class="default">                allocatedVars.clear();</span>
<a name="402"><font size=-1>402     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="403"><font size=-1>403     </font></a><span class="default">            }</span>
<a name="404"><font size=-1>404     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* tok = func.tokenDef-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;next();</span>
<a name="405"><font size=-1>405     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;str()==</span><span class="string">&quot;:&quot;</span><span class="default">) {</span>
<a name="406"><font size=-1>406     </font></a><span class="default">                tok=tok-&gt;next();</span>
<a name="407"><font size=-1>407     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) {</span>
<a name="408"><font size=-1>408     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(allocatedVars.find(tok-&gt;varId()) != allocatedVars.end()) {</span>
<a name="409"><font size=-1>409     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() &amp;&amp; Token::Match(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;%name% . %name% )&quot;</span><span class="default">))</span>
<a name="410"><font size=-1>410     </font></a><span class="default">                            copiedVars.insert(tok);</span>
<a name="411"><font size=-1>411     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(!Token::Match(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;%any% )&quot;</span><span class="default">))</span>
<a name="412"><font size=-1>412     </font></a><span class="default">                            allocatedVars.erase(tok-&gt;varId()); </span><span class="comment">// Assume memory is allocated</span>
<a name="413"><font size=-1>413     </font></a><span class="comment">                    </span><span class="default">}</span>
<a name="414"><font size=-1>414     </font></a><span class="default">                    tok = tok-&gt;linkAt(</span><span class="number">1</span><span class="default">)-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="415"><font size=-1>415     </font></a><span class="default">                }</span>
<a name="416"><font size=-1>416     </font></a><span class="default">            }</span>
<a name="417"><font size=-1>417     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(tok = func.functionScope-&gt;bodyStart; tok != func.functionScope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="418"><font size=-1>418     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% = new|malloc|g_malloc|g_try_malloc|realloc|g_realloc|g_try_realloc&quot;</span><span class="default">)) {</span>
<a name="419"><font size=-1>419     </font></a><span class="default">                    allocatedVars.erase(tok-&gt;varId());</span>
<a name="420"><font size=-1>420     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% = %name% . %name% ;&quot;</span><span class="default">) &amp;&amp; allocatedVars.find(tok-&gt;varId()) != allocatedVars.end()) {</span>
<a name="421"><font size=-1>421     </font></a><span class="default">                    copiedVars.insert(tok);</span>
<a name="422"><font size=-1>422     </font></a><span class="default">                }</span>
<a name="423"><font size=-1>423     </font></a><span class="default">            }</span>
<a name="424"><font size=-1>424     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="425"><font size=-1>425     </font></a><span class="default">        }</span>
<a name="426"><font size=-1>426     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(copyCtor &amp;&amp; !copiedVars.empty()) {</span>
<a name="427"><font size=-1>427     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *cv : copiedVars)</span>
<a name="428"><font size=-1>428     </font></a><span class="default">                copyConstructorShallowCopyError(cv, cv-&gt;str());</span>
<a name="429"><font size=-1>429     </font></a><span class="default">            </span><span class="comment">// throw error if count mismatch</span>
<a name="430"><font size=-1>430     </font></a><span class="comment">            /* FIXME: This doesn't work. See #4154</span>
<a name="431"><font size=-1>431     </font></a><span class="comment">            for (std::map&lt;int, const Token*&gt;::const_iterator i = allocatedVars.begin(); i != allocatedVars.end(); ++i) {</span>
<a name="432"><font size=-1>432     </font></a><span class="comment">                copyConstructorMallocError(copyCtor, i-&gt;second, i-&gt;second-&gt;str());</span>
<a name="433"><font size=-1>433     </font></a><span class="comment">            }</span>
<a name="434"><font size=-1>434     </font></a><span class="comment">            */</span>
<a name="435"><font size=-1>435     </font></a><span class="comment">        </span><span class="default">}</span>
<a name="436"><font size=-1>436     </font></a><span class="default">    }</span>
<a name="437"><font size=-1>437     </font></a><span class="default">}</span>
<a name="438"><font size=-1>438     </font></a><span class="default"></span>
<a name="439"><font size=-1>439     </font></a><span class="default"></span><span class="comment">/* This doesn't work. See #4154</span>
<a name="440"><font size=-1>440     </font></a><span class="comment">void CheckClass::copyConstructorMallocError(const Token *cctor, const Token *alloc, const std::string&amp; varname)</span>
<a name="441"><font size=-1>441     </font></a><span class="comment">{</span>
<a name="442"><font size=-1>442     </font></a><span class="comment">    std::list&lt;const Token*&gt; callstack;</span>
<a name="443"><font size=-1>443     </font></a><span class="comment">    callstack.push_back(cctor);</span>
<a name="444"><font size=-1>444     </font></a><span class="comment">    callstack.push_back(alloc);</span>
<a name="445"><font size=-1>445     </font></a><span class="comment">    reportError(callstack, Severity::warning, &quot;copyCtorNoAllocation&quot;, &quot;Copy constructor does not allocate memory for member '&quot; + varname + &quot;' although memory has been allocated in other constructors.&quot;);</span>
<a name="446"><font size=-1>446     </font></a><span class="comment">}</span>
<a name="447"><font size=-1>447     </font></a><span class="comment">*/</span>
<a name="448"><font size=-1>448     </font></a><span class="comment"></span>
<a name="449"><font size=-1>449     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::copyConstructorShallowCopyError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string&amp; varname)</span>
<a name="450"><font size=-1>450     </font></a><span class="default">{</span>
<a name="451"><font size=-1>451     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;copyCtorPointerCopying&quot;</span><span class="default">,</span>
<a name="452"><font size=-1>452     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\nValue of pointer '$symbol', which points to allocated memory, is copied in copy constructor instead of allocating new memory.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="453"><font size=-1>453     </font></a><span class="default">}</span>
<a name="454"><font size=-1>454     </font></a><span class="default"></span>
<a name="455"><font size=-1>455     </font></a><span class="default"></span><span class="keyword">static </span><span class="default">std::string noMemberErrorMessage(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const char </span><span class="default">function[], </span><span class="keyword">bool </span><span class="default">isdefault)</span>
<a name="456"><font size=-1>456     </font></a><span class="default">{</span>
<a name="457"><font size=-1>457     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string &amp;classname = scope ? scope-&gt;className : </span><span class="string">&quot;class&quot;</span><span class="default">;</span>
<a name="458"><font size=-1>458     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string type = (scope &amp;&amp; scope-&gt;type == Scope::eStruct) ? </span><span class="string">&quot;Struct&quot; </span><span class="default">: </span><span class="string">&quot;Class&quot;</span><span class="default">;</span>
<a name="459"><font size=-1>459     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">isDestructor = (function[</span><span class="number">0</span><span class="default">] == </span><span class="string">'d'</span><span class="default">);</span>
<a name="460"><font size=-1>460     </font></a><span class="default">    std::string errmsg = </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">'\n'</span><span class="default">;</span>
<a name="461"><font size=-1>461     </font></a><span class="default"></span>
<a name="462"><font size=-1>462     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(isdefault) {</span>
<a name="463"><font size=-1>463     </font></a><span class="default">        errmsg += type + </span><span class="string">&quot; '$symbol' has dynamic memory/resource allocation(s). The &quot; </span><span class="default">+ function + </span><span class="string">&quot; is explicitly defaulted but the default &quot; </span><span class="default">+ function + </span><span class="string">&quot; does not work well.&quot;</span><span class="default">;</span>
<a name="464"><font size=-1>464     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(isDestructor)</span>
<a name="465"><font size=-1>465     </font></a><span class="default">            errmsg += </span><span class="string">&quot; It is recommended to define the &quot; </span><span class="default">+ std::string(function) + </span><span class="string">'.'</span><span class="default">;</span>
<a name="466"><font size=-1>466     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="467"><font size=-1>467     </font></a><span class="keyword">            </span><span class="default">errmsg += </span><span class="string">&quot; It is recommended to define or delete the &quot; </span><span class="default">+ std::string(function) + </span><span class="string">'.'</span><span class="default">;</span>
<a name="468"><font size=-1>468     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="469"><font size=-1>469     </font></a><span class="default">        errmsg += type + </span><span class="string">&quot; '$symbol' does not have a &quot; </span><span class="default">+ function + </span><span class="string">&quot; which is recommended since it has dynamic memory/resource allocation(s).&quot;</span><span class="default">;</span>
<a name="470"><font size=-1>470     </font></a><span class="default">    }</span>
<a name="471"><font size=-1>471     </font></a><span class="default"></span>
<a name="472"><font size=-1>472     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">errmsg;</span>
<a name="473"><font size=-1>473     </font></a><span class="default">}</span>
<a name="474"><font size=-1>474     </font></a><span class="default"></span>
<a name="475"><font size=-1>475     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::noCopyConstructorError(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">bool </span><span class="default">isdefault, </span><span class="keyword">const </span><span class="default">Token *alloc, </span><span class="keyword">bool </span><span class="default">inconclusive)</span>
<a name="476"><font size=-1>476     </font></a><span class="default">{</span>
<a name="477"><font size=-1>477     </font></a><span class="default">    reportError(alloc, Severity::warning, </span><span class="string">&quot;noCopyConstructor&quot;</span><span class="default">, noMemberErrorMessage(scope, </span><span class="string">&quot;copy constructor&quot;</span><span class="default">, isdefault), CWE398, inconclusive);</span>
<a name="478"><font size=-1>478     </font></a><span class="default">}</span>
<a name="479"><font size=-1>479     </font></a><span class="default"></span>
<a name="480"><font size=-1>480     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::noOperatorEqError(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">bool </span><span class="default">isdefault, </span><span class="keyword">const </span><span class="default">Token *alloc, </span><span class="keyword">bool </span><span class="default">inconclusive)</span>
<a name="481"><font size=-1>481     </font></a><span class="default">{</span>
<a name="482"><font size=-1>482     </font></a><span class="default">    reportError(alloc, Severity::warning, </span><span class="string">&quot;noOperatorEq&quot;</span><span class="default">, noMemberErrorMessage(scope, </span><span class="string">&quot;operator=&quot;</span><span class="default">, isdefault), CWE398, inconclusive);</span>
<a name="483"><font size=-1>483     </font></a><span class="default">}</span>
<a name="484"><font size=-1>484     </font></a><span class="default"></span>
<a name="485"><font size=-1>485     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::noDestructorError(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">bool </span><span class="default">isdefault, </span><span class="keyword">const </span><span class="default">Token *alloc)</span>
<a name="486"><font size=-1>486     </font></a><span class="default">{</span>
<a name="487"><font size=-1>487     </font></a><span class="default">    reportError(alloc, Severity::warning, </span><span class="string">&quot;noDestructor&quot;</span><span class="default">, noMemberErrorMessage(scope, </span><span class="string">&quot;destructor&quot;</span><span class="default">, isdefault), CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="488"><font size=-1>488     </font></a><span class="default">}</span>
<a name="489"><font size=-1>489     </font></a><span class="default"></span>
<a name="490"><font size=-1>490     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::canNotCopy(</span><span class="keyword">const </span><span class="default">Scope *scope)</span>
<a name="491"><font size=-1>491     </font></a><span class="default">{</span>
<a name="492"><font size=-1>492     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">constructor = </span><span class="keyword">false</span><span class="default">;</span>
<a name="493"><font size=-1>493     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">publicAssign = </span><span class="keyword">false</span><span class="default">;</span>
<a name="494"><font size=-1>494     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">publicCopy = </span><span class="keyword">false</span><span class="default">;</span>
<a name="495"><font size=-1>495     </font></a><span class="default"></span>
<a name="496"><font size=-1>496     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="497"><font size=-1>497     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.isConstructor())</span>
<a name="498"><font size=-1>498     </font></a><span class="default">            constructor = </span><span class="keyword">true</span><span class="default">;</span>
<a name="499"><font size=-1>499     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.access != AccessControl::Public)</span>
<a name="500"><font size=-1>500     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="501"><font size=-1>501     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.type == Function::eCopyConstructor) {</span>
<a name="502"><font size=-1>502     </font></a><span class="default">            publicCopy = </span><span class="keyword">true</span><span class="default">;</span>
<a name="503"><font size=-1>503     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="504"><font size=-1>504     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(func.type == Function::eOperatorEqual) {</span>
<a name="505"><font size=-1>505     </font></a><span class="default">            publicAssign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="506"><font size=-1>506     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="507"><font size=-1>507     </font></a><span class="default">        }</span>
<a name="508"><font size=-1>508     </font></a><span class="default">    }</span>
<a name="509"><font size=-1>509     </font></a><span class="default"></span>
<a name="510"><font size=-1>510     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">constructor &amp;&amp; !(publicAssign || publicCopy);</span>
<a name="511"><font size=-1>511     </font></a><span class="default">}</span>
<a name="512"><font size=-1>512     </font></a><span class="default"></span>
<a name="513"><font size=-1>513     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::canNotMove(</span><span class="keyword">const </span><span class="default">Scope *scope)</span>
<a name="514"><font size=-1>514     </font></a><span class="default">{</span>
<a name="515"><font size=-1>515     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">constructor = </span><span class="keyword">false</span><span class="default">;</span>
<a name="516"><font size=-1>516     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">publicAssign = </span><span class="keyword">false</span><span class="default">;</span>
<a name="517"><font size=-1>517     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">publicCopy = </span><span class="keyword">false</span><span class="default">;</span>
<a name="518"><font size=-1>518     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">publicMove = </span><span class="keyword">false</span><span class="default">;</span>
<a name="519"><font size=-1>519     </font></a><span class="default"></span>
<a name="520"><font size=-1>520     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="521"><font size=-1>521     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.isConstructor())</span>
<a name="522"><font size=-1>522     </font></a><span class="default">            constructor = </span><span class="keyword">true</span><span class="default">;</span>
<a name="523"><font size=-1>523     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.access != AccessControl::Public)</span>
<a name="524"><font size=-1>524     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="525"><font size=-1>525     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.type == Function::eCopyConstructor) {</span>
<a name="526"><font size=-1>526     </font></a><span class="default">            publicCopy = </span><span class="keyword">true</span><span class="default">;</span>
<a name="527"><font size=-1>527     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="528"><font size=-1>528     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(func.type == Function::eMoveConstructor) {</span>
<a name="529"><font size=-1>529     </font></a><span class="default">            publicMove = </span><span class="keyword">true</span><span class="default">;</span>
<a name="530"><font size=-1>530     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="531"><font size=-1>531     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(func.type == Function::eOperatorEqual) {</span>
<a name="532"><font size=-1>532     </font></a><span class="default">            publicAssign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="533"><font size=-1>533     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="534"><font size=-1>534     </font></a><span class="default">        }</span>
<a name="535"><font size=-1>535     </font></a><span class="default">    }</span>
<a name="536"><font size=-1>536     </font></a><span class="default"></span>
<a name="537"><font size=-1>537     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">constructor &amp;&amp; !(publicAssign || publicCopy || publicMove);</span>
<a name="538"><font size=-1>538     </font></a><span class="default">}</span>
<a name="539"><font size=-1>539     </font></a><span class="default"></span>
<a name="540"><font size=-1>540     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::assignVar(nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">Scope *scope, std::vector&lt;Usage&gt; &amp;usage)</span>
<a name="541"><font size=-1>541     </font></a><span class="default">{</span>
<a name="542"><font size=-1>542     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">count = </span><span class="number">0</span><span class="default">;</span>
<a name="543"><font size=-1>543     </font></a><span class="default"></span>
<a name="544"><font size=-1>544     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(std::list&lt;Variable&gt;::const_iterator var = scope-&gt;varlist.begin(); var != scope-&gt;varlist.end(); ++var, ++count) {</span>
<a name="545"><font size=-1>545     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;declarationId() == varid) {</span>
<a name="546"><font size=-1>546     </font></a><span class="default">            usage[count].assign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="547"><font size=-1>547     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="548"><font size=-1>548     </font></a><span class="default">        }</span>
<a name="549"><font size=-1>549     </font></a><span class="default">    }</span>
<a name="550"><font size=-1>550     </font></a><span class="default">}</span>
<a name="551"><font size=-1>551     </font></a><span class="default"></span>
<a name="552"><font size=-1>552     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::initVar(nonneg </span><span class="keyword">int </span><span class="default">varid, </span><span class="keyword">const </span><span class="default">Scope *scope, std::vector&lt;Usage&gt; &amp;usage)</span>
<a name="553"><font size=-1>553     </font></a><span class="default">{</span>
<a name="554"><font size=-1>554     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">count = </span><span class="number">0</span><span class="default">;</span>
<a name="555"><font size=-1>555     </font></a><span class="default"></span>
<a name="556"><font size=-1>556     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(std::list&lt;Variable&gt;::const_iterator var = scope-&gt;varlist.begin(); var != scope-&gt;varlist.end(); ++var, ++count) {</span>
<a name="557"><font size=-1>557     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var-&gt;declarationId() == varid) {</span>
<a name="558"><font size=-1>558     </font></a><span class="default">            usage[count].init = </span><span class="keyword">true</span><span class="default">;</span>
<a name="559"><font size=-1>559     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="560"><font size=-1>560     </font></a><span class="default">        }</span>
<a name="561"><font size=-1>561     </font></a><span class="default">    }</span>
<a name="562"><font size=-1>562     </font></a><span class="default">}</span>
<a name="563"><font size=-1>563     </font></a><span class="default"></span>
<a name="564"><font size=-1>564     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::assignAllVar(std::vector&lt;Usage&gt; &amp;usage)</span>
<a name="565"><font size=-1>565     </font></a><span class="default">{</span>
<a name="566"><font size=-1>566     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Usage &amp; i : usage)</span>
<a name="567"><font size=-1>567     </font></a><span class="default">        i.assign = </span><span class="keyword">true</span><span class="default">;</span>
<a name="568"><font size=-1>568     </font></a><span class="default">}</span>
<a name="569"><font size=-1>569     </font></a><span class="default"></span>
<a name="570"><font size=-1>570     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::clearAllVar(std::vector&lt;Usage&gt; &amp;usage)</span>
<a name="571"><font size=-1>571     </font></a><span class="default">{</span>
<a name="572"><font size=-1>572     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(Usage &amp; i : usage) {</span>
<a name="573"><font size=-1>573     </font></a><span class="default">        i.assign = </span><span class="keyword">false</span><span class="default">;</span>
<a name="574"><font size=-1>574     </font></a><span class="default">        i.init = </span><span class="keyword">false</span><span class="default">;</span>
<a name="575"><font size=-1>575     </font></a><span class="default">    }</span>
<a name="576"><font size=-1>576     </font></a><span class="default">}</span>
<a name="577"><font size=-1>577     </font></a><span class="default"></span>
<a name="578"><font size=-1>578     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::isBaseClassFunc(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Scope *scope)</span>
<a name="579"><font size=-1>579     </font></a><span class="default">{</span>
<a name="580"><font size=-1>580     </font></a><span class="default">    </span><span class="comment">// Iterate through each base class...</span>
<a name="581"><font size=-1>581     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; i : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="582"><font size=-1>582     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type *derivedFrom = i.type;</span>
<a name="583"><font size=-1>583     </font></a><span class="default"></span>
<a name="584"><font size=-1>584     </font></a><span class="default">        </span><span class="comment">// Check if base class exists in database</span>
<a name="585"><font size=-1>585     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(derivedFrom &amp;&amp; derivedFrom-&gt;classScope) {</span>
<a name="586"><font size=-1>586     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">std::list&lt;Function&gt;&amp; functionList = derivedFrom-&gt;classScope-&gt;functionList;</span>
<a name="587"><font size=-1>587     </font></a><span class="default"></span>
<a name="588"><font size=-1>588     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : functionList) {</span>
<a name="589"><font size=-1>589     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(func.tokenDef-&gt;str() == tok-&gt;str())</span>
<a name="590"><font size=-1>590     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="591"><font size=-1>591     </font></a><span class="default">            }</span>
<a name="592"><font size=-1>592     </font></a><span class="default">        }</span>
<a name="593"><font size=-1>593     </font></a><span class="default"></span>
<a name="594"><font size=-1>594     </font></a><span class="default">        </span><span class="comment">// Base class not found so assume it is in it.</span>
<a name="595"><font size=-1>595     </font></a><span class="comment">        </span><span class="keyword">else</span>
<a name="596"><font size=-1>596     </font></a><span class="keyword">            return true</span><span class="default">;</span>
<a name="597"><font size=-1>597     </font></a><span class="default">    }</span>
<a name="598"><font size=-1>598     </font></a><span class="default"></span>
<a name="599"><font size=-1>599     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="600"><font size=-1>600     </font></a><span class="default">}</span>
<a name="601"><font size=-1>601     </font></a><span class="default"></span>
<a name="602"><font size=-1>602     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::initializeVarList(</span><span class="keyword">const </span><span class="default">Function &amp;func, std::list&lt;</span><span class="keyword">const </span><span class="default">Function *&gt; &amp;callstack, </span><span class="keyword">const </span><span class="default">Scope *scope, std::vector&lt;Usage&gt; &amp;usage)</span>
<a name="603"><font size=-1>603     </font></a><span class="default">{</span>
<a name="604"><font size=-1>604     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!func.functionScope)</span>
<a name="605"><font size=-1>605     </font></a><span class="default">        </span><span class="keyword">throw </span><span class="default">InternalError(nullptr, </span><span class="string">&quot;Internal Error: Invalid syntax&quot;</span><span class="default">); </span><span class="comment">// #5702</span>
<a name="606"><font size=-1>606     </font></a><span class="comment">    </span><span class="keyword">bool </span><span class="default">initList = func.isConstructor();</span>
<a name="607"><font size=-1>607     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *ftok = func.arg-&gt;link()-&gt;next();</span>
<a name="608"><font size=-1>608     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">level = </span><span class="number">0</span><span class="default">;</span>
<a name="609"><font size=-1>609     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(; ftok &amp;&amp; ftok != func.functionScope-&gt;bodyEnd; ftok = ftok-&gt;next()) {</span>
<a name="610"><font size=-1>610     </font></a><span class="default">        </span><span class="comment">// Class constructor.. initializing variables like this</span>
<a name="611"><font size=-1>611     </font></a><span class="comment">        // clKalle::clKalle() : var(value) { }</span>
<a name="612"><font size=-1>612     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(initList) {</span>
<a name="613"><font size=-1>613     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(level == </span><span class="number">0 </span><span class="default">&amp;&amp; Token::Match(ftok, </span><span class="string">&quot;%name% {|(&quot;</span><span class="default">) &amp;&amp; Token::Match(ftok-&gt;linkAt(</span><span class="number">1</span><span class="default">), </span><span class="string">&quot;}|) ,|{&quot;</span><span class="default">)) {</span>
<a name="614"><font size=-1>614     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() != func.name()) {</span>
<a name="615"><font size=-1>615     </font></a><span class="default">                    initVar(ftok-&gt;varId(), scope, usage);</span>
<a name="616"><font size=-1>616     </font></a><span class="default">                } </span><span class="keyword">else </span><span class="default">{ </span><span class="comment">// c++11 delegate constructor</span>
<a name="617"><font size=-1>617     </font></a><span class="comment">                    </span><span class="keyword">const </span><span class="default">Function *member = ftok-&gt;function();</span>
<a name="618"><font size=-1>618     </font></a><span class="default">                    </span><span class="comment">// member function not found =&gt; assume it initializes all members</span>
<a name="619"><font size=-1>619     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(!member) {</span>
<a name="620"><font size=-1>620     </font></a><span class="default">                        assignAllVar(usage);</span>
<a name="621"><font size=-1>621     </font></a><span class="default">                        </span><span class="keyword">return</span><span class="default">;</span>
<a name="622"><font size=-1>622     </font></a><span class="default">                    }</span>
<a name="623"><font size=-1>623     </font></a><span class="default"></span>
<a name="624"><font size=-1>624     </font></a><span class="default">                    </span><span class="comment">// recursive call</span>
<a name="625"><font size=-1>625     </font></a><span class="comment">                    // assume that all variables are initialized</span>
<a name="626"><font size=-1>626     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(std::find(callstack.begin(), callstack.end(), member) != callstack.end()) {</span>
<a name="627"><font size=-1>627     </font></a><span class="default">                        </span><span class="comment">/** @todo false negative: just bail */</span>
<a name="628"><font size=-1>628     </font></a><span class="comment">                        </span><span class="default">assignAllVar(usage);</span>
<a name="629"><font size=-1>629     </font></a><span class="default">                        </span><span class="keyword">return</span><span class="default">;</span>
<a name="630"><font size=-1>630     </font></a><span class="default">                    }</span>
<a name="631"><font size=-1>631     </font></a><span class="default"></span>
<a name="632"><font size=-1>632     </font></a><span class="default">                    </span><span class="comment">// member function has implementation</span>
<a name="633"><font size=-1>633     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(member-&gt;hasBody()) {</span>
<a name="634"><font size=-1>634     </font></a><span class="default">                        </span><span class="comment">// initialize variable use list using member function</span>
<a name="635"><font size=-1>635     </font></a><span class="comment">                        </span><span class="default">callstack.push_back(member);</span>
<a name="636"><font size=-1>636     </font></a><span class="default">                        initializeVarList(*member, callstack, scope, usage);</span>
<a name="637"><font size=-1>637     </font></a><span class="default">                        callstack.pop_back();</span>
<a name="638"><font size=-1>638     </font></a><span class="default">                    }</span>
<a name="639"><font size=-1>639     </font></a><span class="default"></span>
<a name="640"><font size=-1>640     </font></a><span class="default">                    </span><span class="comment">// there is a called member function, but it has no implementation, so we assume it initializes everything</span>
<a name="641"><font size=-1>641     </font></a><span class="comment">                    </span><span class="keyword">else </span><span class="default">{</span>
<a name="642"><font size=-1>642     </font></a><span class="default">                        assignAllVar(usage);</span>
<a name="643"><font size=-1>643     </font></a><span class="default">                    }</span>
<a name="644"><font size=-1>644     </font></a><span class="default">                }</span>
<a name="645"><font size=-1>645     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(level != </span><span class="number">0 </span><span class="default">&amp;&amp; Token::Match(ftok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">)) </span><span class="comment">// assignment in the initializer: var(value = x)</span>
<a name="646"><font size=-1>646     </font></a><span class="comment">                </span><span class="default">assignVar(ftok-&gt;varId(), scope, usage);</span>
<a name="647"><font size=-1>647     </font></a><span class="default"></span>
<a name="648"><font size=-1>648     </font></a><span class="default">            </span><span class="comment">// Level handling</span>
<a name="649"><font size=-1>649     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;link() &amp;&amp; Token::Match(ftok, </span><span class="string">&quot;(|&lt;&quot;</span><span class="default">))</span>
<a name="650"><font size=-1>650     </font></a><span class="default">                level++;</span>
<a name="651"><font size=-1>651     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;{&quot;</span><span class="default">) {</span>
<a name="652"><font size=-1>652     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(level != </span><span class="number">0 </span><span class="default">||</span>
<a name="653"><font size=-1>653     </font></a><span class="default">                    (Token::Match(ftok-&gt;previous(), </span><span class="string">&quot;%name%|&gt;&quot;</span><span class="default">) &amp;&amp; Token::Match(ftok-&gt;link(), </span><span class="string">&quot;} ,|{&quot;</span><span class="default">)))</span>
<a name="654"><font size=-1>654     </font></a><span class="default">                    level++;</span>
<a name="655"><font size=-1>655     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="656"><font size=-1>656     </font></a><span class="keyword">                    </span><span class="default">initList = </span><span class="keyword">false</span><span class="default">;</span>
<a name="657"><font size=-1>657     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(ftok-&gt;link() &amp;&amp; Token::Match(ftok, </span><span class="string">&quot;)|&gt;|}&quot;</span><span class="default">))</span>
<a name="658"><font size=-1>658     </font></a><span class="default">                level--;</span>
<a name="659"><font size=-1>659     </font></a><span class="default">        }</span>
<a name="660"><font size=-1>660     </font></a><span class="default"></span>
<a name="661"><font size=-1>661     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(initList)</span>
<a name="662"><font size=-1>662     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="663"><font size=-1>663     </font></a><span class="default"></span>
<a name="664"><font size=-1>664     </font></a><span class="default">        </span><span class="comment">// Variable getting value from stream?</span>
<a name="665"><font size=-1>665     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;&gt;&gt;|&amp; %name%&quot;</span><span class="default">) &amp;&amp; isLikelyStreamRead(</span><span class="keyword">true</span><span class="default">, ftok)) {</span>
<a name="666"><font size=-1>666     </font></a><span class="default">            assignVar(ftok-&gt;next()-&gt;varId(), scope, usage);</span>
<a name="667"><font size=-1>667     </font></a><span class="default">        }</span>
<a name="668"><font size=-1>668     </font></a><span class="default"></span>
<a name="669"><font size=-1>669     </font></a><span class="default">        </span><span class="comment">// If assignment comes after an &amp;&amp; or || this is really inconclusive because of short circuiting</span>
<a name="670"><font size=-1>670     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;%oror%|&amp;&amp;&quot;</span><span class="default">))</span>
<a name="671"><font size=-1>671     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="672"><font size=-1>672     </font></a><span class="default"></span>
<a name="673"><font size=-1>673     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(ftok, </span><span class="string">&quot;( !&quot;</span><span class="default">))</span>
<a name="674"><font size=-1>674     </font></a><span class="default">            ftok = ftok-&gt;next();</span>
<a name="675"><font size=-1>675     </font></a><span class="default"></span>
<a name="676"><font size=-1>676     </font></a><span class="default">        </span><span class="comment">// Using the operator= function to initialize all variables..</span>
<a name="677"><font size=-1>677     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok-&gt;next(), </span><span class="string">&quot;return| (| * this )| =&quot;</span><span class="default">)) {</span>
<a name="678"><font size=-1>678     </font></a><span class="default">            assignAllVar(usage);</span>
<a name="679"><font size=-1>679     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="680"><font size=-1>680     </font></a><span class="default">        }</span>
<a name="681"><font size=-1>681     </font></a><span class="default"></span>
<a name="682"><font size=-1>682     </font></a><span class="default">        </span><span class="comment">// Using swap to assign all variables..</span>
<a name="683"><font size=-1>683     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(func.type == Function::eOperatorEqual &amp;&amp; Token::Match(ftok, </span><span class="string">&quot;[;{}] %name% (&quot;</span><span class="default">) &amp;&amp; Token::Match(ftok-&gt;linkAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;) . %name% ( *| this ) ;&quot;</span><span class="default">)) {</span>
<a name="684"><font size=-1>684     </font></a><span class="default">            assignAllVar(usage);</span>
<a name="685"><font size=-1>685     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="686"><font size=-1>686     </font></a><span class="default">        }</span>
<a name="687"><font size=-1>687     </font></a><span class="default"></span>
<a name="688"><font size=-1>688     </font></a><span class="default">        </span><span class="comment">// Calling member variable function?</span>
<a name="689"><font size=-1>689     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok-&gt;next(), </span><span class="string">&quot;%var% . %name% (&quot;</span><span class="default">)) {</span>
<a name="690"><font size=-1>690     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : scope-&gt;varlist) {</span>
<a name="691"><font size=-1>691     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var.declarationId() == ftok-&gt;next()-&gt;varId()) {</span>
<a name="692"><font size=-1>692     </font></a><span class="default">                    </span><span class="comment">/** @todo false negative: we assume function changes variable state */</span>
<a name="693"><font size=-1>693     </font></a><span class="comment">                    </span><span class="default">assignVar(ftok-&gt;next()-&gt;varId(), scope, usage);</span>
<a name="694"><font size=-1>694     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="695"><font size=-1>695     </font></a><span class="default">                }</span>
<a name="696"><font size=-1>696     </font></a><span class="default">            }</span>
<a name="697"><font size=-1>697     </font></a><span class="default"></span>
<a name="698"><font size=-1>698     </font></a><span class="default">            ftok = ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="699"><font size=-1>699     </font></a><span class="default">        }</span>
<a name="700"><font size=-1>700     </font></a><span class="default"></span>
<a name="701"><font size=-1>701     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::Match(ftok-&gt;next(), </span><span class="string">&quot;::| %name%&quot;</span><span class="default">) &amp;&amp;</span>
<a name="702"><font size=-1>702     </font></a><span class="default">            !Token::Match(ftok-&gt;next(), </span><span class="string">&quot;*| this . %name%&quot;</span><span class="default">) &amp;&amp;</span>
<a name="703"><font size=-1>703     </font></a><span class="default">            !Token::Match(ftok-&gt;next(), </span><span class="string">&quot;* %name% =&quot;</span><span class="default">) &amp;&amp;</span>
<a name="704"><font size=-1>704     </font></a><span class="default">            !Token::Match(ftok-&gt;next(), </span><span class="string">&quot;( * this ) . %name%&quot;</span><span class="default">))</span>
<a name="705"><font size=-1>705     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="706"><font size=-1>706     </font></a><span class="default"></span>
<a name="707"><font size=-1>707     </font></a><span class="default">        </span><span class="comment">// Goto the first token in this statement..</span>
<a name="708"><font size=-1>708     </font></a><span class="comment">        </span><span class="default">ftok = ftok-&gt;next();</span>
<a name="709"><font size=-1>709     </font></a><span class="default"></span>
<a name="710"><font size=-1>710     </font></a><span class="default">        </span><span class="comment">// skip &quot;return&quot;</span>
<a name="711"><font size=-1>711     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;return&quot;</span><span class="default">)</span>
<a name="712"><font size=-1>712     </font></a><span class="default">            ftok = ftok-&gt;next();</span>
<a name="713"><font size=-1>713     </font></a><span class="default"></span>
<a name="714"><font size=-1>714     </font></a><span class="default">        </span><span class="comment">// Skip &quot;( * this )&quot;</span>
<a name="715"><font size=-1>715     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(ftok, </span><span class="string">&quot;( * this ) .&quot;</span><span class="default">)) {</span>
<a name="716"><font size=-1>716     </font></a><span class="default">            ftok = ftok-&gt;tokAt(</span><span class="number">5</span><span class="default">);</span>
<a name="717"><font size=-1>717     </font></a><span class="default">        }</span>
<a name="718"><font size=-1>718     </font></a><span class="default"></span>
<a name="719"><font size=-1>719     </font></a><span class="default">        </span><span class="comment">// Skip &quot;this-&gt;&quot;</span>
<a name="720"><font size=-1>720     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(ftok, </span><span class="string">&quot;this .&quot;</span><span class="default">))</span>
<a name="721"><font size=-1>721     </font></a><span class="default">            ftok = ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="722"><font size=-1>722     </font></a><span class="default"></span>
<a name="723"><font size=-1>723     </font></a><span class="default">        </span><span class="comment">// Skip &quot;classname :: &quot;</span>
<a name="724"><font size=-1>724     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;:: %name%&quot;</span><span class="default">))</span>
<a name="725"><font size=-1>725     </font></a><span class="default">            ftok = ftok-&gt;next();</span>
<a name="726"><font size=-1>726     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;%name% ::&quot;</span><span class="default">))</span>
<a name="727"><font size=-1>727     </font></a><span class="default">            ftok = ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="728"><font size=-1>728     </font></a><span class="default"></span>
<a name="729"><font size=-1>729     </font></a><span class="default">        </span><span class="comment">// Clearing all variables..</span>
<a name="730"><font size=-1>730     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;::| memset ( this ,&quot;</span><span class="default">)) {</span>
<a name="731"><font size=-1>731     </font></a><span class="default">            assignAllVar(usage);</span>
<a name="732"><font size=-1>732     </font></a><span class="default">            </span><span class="keyword">return</span><span class="default">;</span>
<a name="733"><font size=-1>733     </font></a><span class="default">        }</span>
<a name="734"><font size=-1>734     </font></a><span class="default"></span>
<a name="735"><font size=-1>735     </font></a><span class="default">        </span><span class="comment">// Ticket #7068</span>
<a name="736"><font size=-1>736     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;::| memset ( &amp;| this . %name%&quot;</span><span class="default">)) {</span>
<a name="737"><font size=-1>737     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;::&quot;</span><span class="default">)</span>
<a name="738"><font size=-1>738     </font></a><span class="default">                ftok = ftok-&gt;next();</span>
<a name="739"><font size=-1>739     </font></a><span class="default">            </span><span class="keyword">int </span><span class="default">offsetToMember = </span><span class="number">4</span><span class="default">;</span>
<a name="740"><font size=-1>740     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;strAt(</span><span class="number">2</span><span class="default">) == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="741"><font size=-1>741     </font></a><span class="default">                ++offsetToMember;</span>
<a name="742"><font size=-1>742     </font></a><span class="default">            assignVar(ftok-&gt;tokAt(offsetToMember)-&gt;varId(), scope, usage);</span>
<a name="743"><font size=-1>743     </font></a><span class="default">            ftok = ftok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="744"><font size=-1>744     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="745"><font size=-1>745     </font></a><span class="default">        }</span>
<a name="746"><font size=-1>746     </font></a><span class="default"></span>
<a name="747"><font size=-1>747     </font></a><span class="default">        </span><span class="comment">// Clearing array..</span>
<a name="748"><font size=-1>748     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;::| memset ( %name% ,&quot;</span><span class="default">)) {</span>
<a name="749"><font size=-1>749     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;::&quot;</span><span class="default">)</span>
<a name="750"><font size=-1>750     </font></a><span class="default">                ftok = ftok-&gt;next();</span>
<a name="751"><font size=-1>751     </font></a><span class="default">            assignVar(ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;varId(), scope, usage);</span>
<a name="752"><font size=-1>752     </font></a><span class="default">            ftok = ftok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="753"><font size=-1>753     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="754"><font size=-1>754     </font></a><span class="default">        }</span>
<a name="755"><font size=-1>755     </font></a><span class="default"></span>
<a name="756"><font size=-1>756     </font></a><span class="default">        </span><span class="comment">// Calling member function?</span>
<a name="757"><font size=-1>757     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(ftok, </span><span class="string">&quot;operator= (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="758"><font size=-1>758     </font></a><span class="default">                 ftok-&gt;previous()-&gt;str() != </span><span class="string">&quot;::&quot;</span><span class="default">) {</span>
<a name="759"><font size=-1>759     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;function() &amp;&amp; ftok-&gt;function()-&gt;nestedIn == scope) {</span>
<a name="760"><font size=-1>760     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Function *member = ftok-&gt;function();</span>
<a name="761"><font size=-1>761     </font></a><span class="default">                </span><span class="comment">// recursive call</span>
<a name="762"><font size=-1>762     </font></a><span class="comment">                // assume that all variables are initialized</span>
<a name="763"><font size=-1>763     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(std::find(callstack.begin(), callstack.end(), member) != callstack.end()) {</span>
<a name="764"><font size=-1>764     </font></a><span class="default">                    </span><span class="comment">/** @todo false negative: just bail */</span>
<a name="765"><font size=-1>765     </font></a><span class="comment">                    </span><span class="default">assignAllVar(usage);</span>
<a name="766"><font size=-1>766     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="767"><font size=-1>767     </font></a><span class="default">                }</span>
<a name="768"><font size=-1>768     </font></a><span class="default"></span>
<a name="769"><font size=-1>769     </font></a><span class="default">                </span><span class="comment">// member function has implementation</span>
<a name="770"><font size=-1>770     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(member-&gt;hasBody()) {</span>
<a name="771"><font size=-1>771     </font></a><span class="default">                    </span><span class="comment">// initialize variable use list using member function</span>
<a name="772"><font size=-1>772     </font></a><span class="comment">                    </span><span class="default">callstack.push_back(member);</span>
<a name="773"><font size=-1>773     </font></a><span class="default">                    initializeVarList(*member, callstack, scope, usage);</span>
<a name="774"><font size=-1>774     </font></a><span class="default">                    callstack.pop_back();</span>
<a name="775"><font size=-1>775     </font></a><span class="default">                }</span>
<a name="776"><font size=-1>776     </font></a><span class="default"></span>
<a name="777"><font size=-1>777     </font></a><span class="default">                </span><span class="comment">// there is a called member function, but it has no implementation, so we assume it initializes everything</span>
<a name="778"><font size=-1>778     </font></a><span class="comment">                </span><span class="keyword">else </span><span class="default">{</span>
<a name="779"><font size=-1>779     </font></a><span class="default">                    assignAllVar(usage);</span>
<a name="780"><font size=-1>780     </font></a><span class="default">                }</span>
<a name="781"><font size=-1>781     </font></a><span class="default">            }</span>
<a name="782"><font size=-1>782     </font></a><span class="default"></span>
<a name="783"><font size=-1>783     </font></a><span class="default">            </span><span class="comment">// using default operator =, assume everything initialized</span>
<a name="784"><font size=-1>784     </font></a><span class="comment">            </span><span class="keyword">else </span><span class="default">{</span>
<a name="785"><font size=-1>785     </font></a><span class="default">                assignAllVar(usage);</span>
<a name="786"><font size=-1>786     </font></a><span class="default">            }</span>
<a name="787"><font size=-1>787     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;::| %name% (&quot;</span><span class="default">) &amp;&amp; !Token::Match(ftok, </span><span class="string">&quot;if|while|for&quot;</span><span class="default">)) {</span>
<a name="788"><font size=-1>788     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;::&quot;</span><span class="default">)</span>
<a name="789"><font size=-1>789     </font></a><span class="default">                ftok = ftok-&gt;next();</span>
<a name="790"><font size=-1>790     </font></a><span class="default"></span>
<a name="791"><font size=-1>791     </font></a><span class="default">            </span><span class="comment">// Passing &quot;this&quot; =&gt; assume that everything is initialized</span>
<a name="792"><font size=-1>792     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok2 = ftok-&gt;next()-&gt;link(); tok2 &amp;&amp; tok2 != ftok; tok2 = tok2-&gt;previous()) {</span>
<a name="793"><font size=-1>793     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;this&quot;</span><span class="default">) {</span>
<a name="794"><font size=-1>794     </font></a><span class="default">                    assignAllVar(usage);</span>
<a name="795"><font size=-1>795     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="796"><font size=-1>796     </font></a><span class="default">                }</span>
<a name="797"><font size=-1>797     </font></a><span class="default">            }</span>
<a name="798"><font size=-1>798     </font></a><span class="default"></span>
<a name="799"><font size=-1>799     </font></a><span class="default">            </span><span class="comment">// check if member function</span>
<a name="800"><font size=-1>800     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(ftok-&gt;function() &amp;&amp; ftok-&gt;function()-&gt;nestedIn == scope &amp;&amp;</span>
<a name="801"><font size=-1>801     </font></a><span class="default">                !ftok-&gt;function()-&gt;isConstructor()) {</span>
<a name="802"><font size=-1>802     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Function *member = ftok-&gt;function();</span>
<a name="803"><font size=-1>803     </font></a><span class="default"></span>
<a name="804"><font size=-1>804     </font></a><span class="default">                </span><span class="comment">// recursive call</span>
<a name="805"><font size=-1>805     </font></a><span class="comment">                // assume that all variables are initialized</span>
<a name="806"><font size=-1>806     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(std::find(callstack.begin(), callstack.end(), member) != callstack.end()) {</span>
<a name="807"><font size=-1>807     </font></a><span class="default">                    assignAllVar(usage);</span>
<a name="808"><font size=-1>808     </font></a><span class="default">                    </span><span class="keyword">return</span><span class="default">;</span>
<a name="809"><font size=-1>809     </font></a><span class="default">                }</span>
<a name="810"><font size=-1>810     </font></a><span class="default"></span>
<a name="811"><font size=-1>811     </font></a><span class="default">                </span><span class="comment">// member function has implementation</span>
<a name="812"><font size=-1>812     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(member-&gt;hasBody()) {</span>
<a name="813"><font size=-1>813     </font></a><span class="default">                    </span><span class="comment">// initialize variable use list using member function</span>
<a name="814"><font size=-1>814     </font></a><span class="comment">                    </span><span class="default">callstack.push_back(member);</span>
<a name="815"><font size=-1>815     </font></a><span class="default">                    initializeVarList(*member, callstack, scope, usage);</span>
<a name="816"><font size=-1>816     </font></a><span class="default">                    callstack.pop_back();</span>
<a name="817"><font size=-1>817     </font></a><span class="default"></span>
<a name="818"><font size=-1>818     </font></a><span class="default">                    </span><span class="comment">// Assume that variables that are passed to it are initialized..</span>
<a name="819"><font size=-1>819     </font></a><span class="comment">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok2 = ftok; tok2; tok2 = tok2-&gt;next()) {</span>
<a name="820"><font size=-1>820     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[;{}]&quot;</span><span class="default">))</span>
<a name="821"><font size=-1>821     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="822"><font size=-1>822     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;[(,] &amp;| %name% [,)]&quot;</span><span class="default">)) {</span>
<a name="823"><font size=-1>823     </font></a><span class="default">                            tok2 = tok2-&gt;next();</span>
<a name="824"><font size=-1>824     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="825"><font size=-1>825     </font></a><span class="default">                                tok2 = tok2-&gt;next();</span>
<a name="826"><font size=-1>826     </font></a><span class="default">                            assignVar(tok2-&gt;varId(), scope, usage);</span>
<a name="827"><font size=-1>827     </font></a><span class="default">                        }</span>
<a name="828"><font size=-1>828     </font></a><span class="default">                    }</span>
<a name="829"><font size=-1>829     </font></a><span class="default">                }</span>
<a name="830"><font size=-1>830     </font></a><span class="default"></span>
<a name="831"><font size=-1>831     </font></a><span class="default">                </span><span class="comment">// there is a called member function, but it has no implementation, so we assume it initializes everything</span>
<a name="832"><font size=-1>832     </font></a><span class="comment">                </span><span class="keyword">else </span><span class="default">{</span>
<a name="833"><font size=-1>833     </font></a><span class="default">                    assignAllVar(usage);</span>
<a name="834"><font size=-1>834     </font></a><span class="default">                }</span>
<a name="835"><font size=-1>835     </font></a><span class="default">            }</span>
<a name="836"><font size=-1>836     </font></a><span class="default"></span>
<a name="837"><font size=-1>837     </font></a><span class="default">            </span><span class="comment">// not member function</span>
<a name="838"><font size=-1>838     </font></a><span class="comment">            </span><span class="keyword">else </span><span class="default">{</span>
<a name="839"><font size=-1>839     </font></a><span class="default">                </span><span class="comment">// could be a base class virtual function, so we assume it initializes everything</span>
<a name="840"><font size=-1>840     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!func.isConstructor() &amp;&amp; isBaseClassFunc(ftok, scope)) {</span>
<a name="841"><font size=-1>841     </font></a><span class="default">                    </span><span class="comment">/** @todo False Negative: we should look at the base class functions to see if they</span>
<a name="842"><font size=-1>842     </font></a><span class="comment">                     *  call any derived class virtual functions that change the derived class state</span>
<a name="843"><font size=-1>843     </font></a><span class="comment">                     */</span>
<a name="844"><font size=-1>844     </font></a><span class="comment">                    </span><span class="default">assignAllVar(usage);</span>
<a name="845"><font size=-1>845     </font></a><span class="default">                }</span>
<a name="846"><font size=-1>846     </font></a><span class="default"></span>
<a name="847"><font size=-1>847     </font></a><span class="default">                </span><span class="comment">// has friends, so we assume it initializes everything</span>
<a name="848"><font size=-1>848     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;friendList.empty())</span>
<a name="849"><font size=-1>849     </font></a><span class="default">                    assignAllVar(usage);</span>
<a name="850"><font size=-1>850     </font></a><span class="default"></span>
<a name="851"><font size=-1>851     </font></a><span class="default">                </span><span class="comment">// the function is external and it's neither friend nor inherited virtual function.</span>
<a name="852"><font size=-1>852     </font></a><span class="comment">                // assume all variables that are passed to it are initialized..</span>
<a name="853"><font size=-1>853     </font></a><span class="comment">                </span><span class="keyword">else </span><span class="default">{</span>
<a name="854"><font size=-1>854     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">); tok &amp;&amp; tok != ftok-&gt;next()-&gt;link(); tok = tok-&gt;next()) {</span>
<a name="855"><font size=-1>855     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(tok-&gt;isName()) {</span>
<a name="856"><font size=-1>856     </font></a><span class="default">                            assignVar(tok-&gt;varId(), scope, usage);</span>
<a name="857"><font size=-1>857     </font></a><span class="default">                        }</span>
<a name="858"><font size=-1>858     </font></a><span class="default">                    }</span>
<a name="859"><font size=-1>859     </font></a><span class="default">                }</span>
<a name="860"><font size=-1>860     </font></a><span class="default">            }</span>
<a name="861"><font size=-1>861     </font></a><span class="default">        }</span>
<a name="862"><font size=-1>862     </font></a><span class="default"></span>
<a name="863"><font size=-1>863     </font></a><span class="default">        </span><span class="comment">// Assignment of member variable?</span>
<a name="864"><font size=-1>864     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;%name% =&quot;</span><span class="default">)) {</span>
<a name="865"><font size=-1>865     </font></a><span class="default">            assignVar(ftok-&gt;varId(), scope, usage);</span>
<a name="866"><font size=-1>866     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">bailout = ftok-&gt;variable() &amp;&amp; ftok-&gt;variable()-&gt;isReference();</span>
<a name="867"><font size=-1>867     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* tok2 = ftok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="868"><font size=-1>868     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">) {</span>
<a name="869"><font size=-1>869     </font></a><span class="default">                tok2 = tok2-&gt;next();</span>
<a name="870"><font size=-1>870     </font></a><span class="default">                bailout = </span><span class="keyword">true</span><span class="default">;</span>
<a name="871"><font size=-1>871     </font></a><span class="default">            }</span>
<a name="872"><font size=-1>872     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2-&gt;variable() &amp;&amp; (bailout || tok2-&gt;variable()-&gt;isArray()) &amp;&amp; tok2-&gt;strAt(</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;[&quot;</span><span class="default">)</span>
<a name="873"><font size=-1>873     </font></a><span class="default">                assignVar(tok2-&gt;varId(), scope, usage);</span>
<a name="874"><font size=-1>874     </font></a><span class="default">        }</span>
<a name="875"><font size=-1>875     </font></a><span class="default"></span>
<a name="876"><font size=-1>876     </font></a><span class="default">        </span><span class="comment">// Assignment of array item of member variable?</span>
<a name="877"><font size=-1>877     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;%name% [|.&quot;</span><span class="default">)) {</span>
<a name="878"><font size=-1>878     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *tok2 = ftok;</span>
<a name="879"><font size=-1>879     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(tok2) {</span>
<a name="880"><font size=-1>880     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;[&quot;</span><span class="default">)</span>
<a name="881"><font size=-1>881     </font></a><span class="default">                    tok2 = tok2-&gt;next()-&gt;link();</span>
<a name="882"><font size=-1>882     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2-&gt;next(), </span><span class="string">&quot;. %name%&quot;</span><span class="default">))</span>
<a name="883"><font size=-1>883     </font></a><span class="default">                    tok2 = tok2-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="884"><font size=-1>884     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="885"><font size=-1>885     </font></a><span class="keyword">                    break</span><span class="default">;</span>
<a name="886"><font size=-1>886     </font></a><span class="default">            }</span>
<a name="887"><font size=-1>887     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2 &amp;&amp; tok2-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;=&quot;</span><span class="default">)</span>
<a name="888"><font size=-1>888     </font></a><span class="default">                assignVar(ftok-&gt;varId(), scope, usage);</span>
<a name="889"><font size=-1>889     </font></a><span class="default">        }</span>
<a name="890"><font size=-1>890     </font></a><span class="default"></span>
<a name="891"><font size=-1>891     </font></a><span class="default">        </span><span class="comment">// Assignment of array item of member variable?</span>
<a name="892"><font size=-1>892     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;* %name% =&quot;</span><span class="default">)) {</span>
<a name="893"><font size=-1>893     </font></a><span class="default">            assignVar(ftok-&gt;next()-&gt;varId(), scope, usage);</span>
<a name="894"><font size=-1>894     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;* this . %name% =&quot;</span><span class="default">)) {</span>
<a name="895"><font size=-1>895     </font></a><span class="default">            assignVar(ftok-&gt;tokAt(</span><span class="number">3</span><span class="default">)-&gt;varId(), scope, usage);</span>
<a name="896"><font size=-1>896     </font></a><span class="default">        }</span>
<a name="897"><font size=-1>897     </font></a><span class="default"></span>
<a name="898"><font size=-1>898     </font></a><span class="default">        </span><span class="comment">// The functions 'clear' and 'Clear' are supposed to initialize variable.</span>
<a name="899"><font size=-1>899     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;%name% . clear|Clear (&quot;</span><span class="default">)) {</span>
<a name="900"><font size=-1>900     </font></a><span class="default">            assignVar(ftok-&gt;varId(), scope, usage);</span>
<a name="901"><font size=-1>901     </font></a><span class="default">        }</span>
<a name="902"><font size=-1>902     </font></a><span class="default">    }</span>
<a name="903"><font size=-1>903     </font></a><span class="default">}</span>
<a name="904"><font size=-1>904     </font></a><span class="default"></span>
<a name="905"><font size=-1>905     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::noConstructorError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">bool </span><span class="default">isStruct)</span>
<a name="906"><font size=-1>906     </font></a><span class="default">{</span>
<a name="907"><font size=-1>907     </font></a><span class="default">    </span><span class="comment">// For performance reasons the constructor might be intentionally missing. Therefore this is not a &quot;warning&quot;</span>
<a name="908"><font size=-1>908     </font></a><span class="comment">    </span><span class="default">reportError(tok, Severity::style, </span><span class="string">&quot;noConstructor&quot;</span><span class="default">,</span>
<a name="909"><font size=-1>909     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;\n&quot; </span><span class="default">+</span>
<a name="910"><font size=-1>910     </font></a><span class="default">                </span><span class="string">&quot;The &quot; </span><span class="default">+ std::string(isStruct ? </span><span class="string">&quot;struct&quot; </span><span class="default">: </span><span class="string">&quot;class&quot;</span><span class="default">) + </span><span class="string">&quot; '$symbol' does not have a constructor although it has private member variables.\n&quot;</span>
<a name="911"><font size=-1>911     </font></a><span class="string">                &quot;The &quot; </span><span class="default">+ std::string(isStruct ? </span><span class="string">&quot;struct&quot; </span><span class="default">: </span><span class="string">&quot;class&quot;</span><span class="default">) + </span><span class="string">&quot; '$symbol' does not have a constructor &quot;</span>
<a name="912"><font size=-1>912     </font></a><span class="string">                &quot;although it has private member variables. Member variables of builtin types are left &quot;</span>
<a name="913"><font size=-1>913     </font></a><span class="string">                &quot;uninitialized when the class is instantiated. That may cause bugs or undefined behavior.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="914"><font size=-1>914     </font></a><span class="default">}</span>
<a name="915"><font size=-1>915     </font></a><span class="default"></span>
<a name="916"><font size=-1>916     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::noExplicitConstructorError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">bool </span><span class="default">isStruct)</span>
<a name="917"><font size=-1>917     </font></a><span class="default">{</span>
<a name="918"><font size=-1>918     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string message(std::string(isStruct ? </span><span class="string">&quot;Struct&quot; </span><span class="default">: </span><span class="string">&quot;Class&quot;</span><span class="default">) + </span><span class="string">&quot; '$symbol' has a constructor with 1 argument that is not explicit.&quot;</span><span class="default">);</span>
<a name="919"><font size=-1>919     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string verbose(message + </span><span class="string">&quot; Such constructors should in general be explicit for type safety reasons. Using the explicit keyword in the constructor means some mistakes when using the class can be avoided.&quot;</span><span class="default">);</span>
<a name="920"><font size=-1>920     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;noExplicitConstructor&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">'\n' </span><span class="default">+ message + </span><span class="string">'\n' </span><span class="default">+ verbose, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="921"><font size=-1>921     </font></a><span class="default">}</span>
<a name="922"><font size=-1>922     </font></a><span class="default"></span>
<a name="923"><font size=-1>923     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::uninitVarError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">bool </span><span class="default">isprivate, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;varname, </span><span class="keyword">bool </span><span class="default">inconclusive)</span>
<a name="924"><font size=-1>924     </font></a><span class="default">{</span>
<a name="925"><font size=-1>925     </font></a><span class="default">    reportError(tok, Severity::warning, isprivate ? </span><span class="string">&quot;uninitMemberVarPrivate&quot; </span><span class="default">: </span><span class="string">&quot;uninitMemberVar&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\nMember variable '$symbol' is not initialized in the constructor.&quot;</span><span class="default">, CWE398, inconclusive);</span>
<a name="926"><font size=-1>926     </font></a><span class="default">}</span>
<a name="927"><font size=-1>927     </font></a><span class="default"></span>
<a name="928"><font size=-1>928     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqVarError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;varname, </span><span class="keyword">bool </span><span class="default">inconclusive)</span>
<a name="929"><font size=-1>929     </font></a><span class="default">{</span>
<a name="930"><font size=-1>930     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;operatorEqVarError&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\nMember variable '$symbol' is not assigned a value in '&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::operator='.&quot;</span><span class="default">, CWE398, inconclusive);</span>
<a name="931"><font size=-1>931     </font></a><span class="default">}</span>
<a name="932"><font size=-1>932     </font></a><span class="default"></span>
<a name="933"><font size=-1>933     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="934"><font size=-1>934     </font></a><span class="comment">// ClassCheck: Use initialization list instead of assignment</span>
<a name="935"><font size=-1>935     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="936"><font size=-1>936     </font></a><span class="comment"></span>
<a name="937"><font size=-1>937     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::initializationListUsage()</span>
<a name="938"><font size=-1>938     </font></a><span class="default">{</span>
<a name="939"><font size=-1>939     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::PERFORMANCE))</span>
<a name="940"><font size=-1>940     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="941"><font size=-1>941     </font></a><span class="default"></span>
<a name="942"><font size=-1>942     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *scope : mSymbolDatabase-&gt;functionScopes) {</span>
<a name="943"><font size=-1>943     </font></a><span class="default">        </span><span class="comment">// Check every constructor</span>
<a name="944"><font size=-1>944     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!scope-&gt;function || (!scope-&gt;function-&gt;isConstructor()))</span>
<a name="945"><font size=-1>945     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="946"><font size=-1>946     </font></a><span class="default"></span>
<a name="947"><font size=-1>947     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Scope* owner = scope-&gt;functionOf;</span>
<a name="948"><font size=-1>948     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* tok = scope-&gt;bodyStart; tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="949"><font size=-1>949     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) </span><span class="comment">// Assignments might depend on this function call or if/for/while/switch statement from now on.</span>
<a name="950"><font size=-1>950     </font></a><span class="comment">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="951"><font size=-1>951     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;try|do {&quot;</span><span class="default">))</span>
<a name="952"><font size=-1>952     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="953"><font size=-1>953     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::Match(tok, </span><span class="string">&quot;%var% =&quot;</span><span class="default">) || tok-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;*&quot; </span><span class="default">|| tok-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;.&quot;</span><span class="default">)</span>
<a name="954"><font size=-1>954     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="955"><font size=-1>955     </font></a><span class="default"></span>
<a name="956"><font size=-1>956     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable* var = tok-&gt;variable();</span>
<a name="957"><font size=-1>957     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var || var-&gt;scope() != owner || var-&gt;isStatic())</span>
<a name="958"><font size=-1>958     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="959"><font size=-1>959     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(var-&gt;isPointer() || var-&gt;isReference() || var-&gt;isEnumType() || var-&gt;valueType()-&gt;type &gt; ValueType::Type::ITERATOR)</span>
<a name="960"><font size=-1>960     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="961"><font size=-1>961     </font></a><span class="default"></span>
<a name="962"><font size=-1>962     </font></a><span class="default">            </span><span class="comment">// bailout: multi line lambda in rhs =&gt; do not warn</span>
<a name="963"><font size=-1>963     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(findLambdaEndToken(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)) &amp;&amp; tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;findExpressionStartEndTokens().second-&gt;linenr() &gt; tok-&gt;tokAt(</span><span class="number">2</span><span class="default">)-&gt;linenr())</span>
<a name="964"><font size=-1>964     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="965"><font size=-1>965     </font></a><span class="default"></span>
<a name="966"><font size=-1>966     </font></a><span class="default">            </span><span class="comment">// Access local var member in rhs =&gt; do not warn</span>
<a name="967"><font size=-1>967     </font></a><span class="comment">            </span><span class="keyword">bool </span><span class="default">localmember = </span><span class="keyword">false</span><span class="default">;</span>
<a name="968"><font size=-1>968     </font></a><span class="default">            visitAstNodes(tok-&gt;next()-&gt;astOperand2(),</span>
<a name="969"><font size=-1>969     </font></a><span class="default">            [&amp;](</span><span class="keyword">const </span><span class="default">Token *rhs) {</span>
<a name="970"><font size=-1>970     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(rhs-&gt;str() == </span><span class="string">&quot;.&quot; </span><span class="default">&amp;&amp; rhs-&gt;astOperand1() &amp;&amp; rhs-&gt;astOperand1()-&gt;variable() &amp;&amp; rhs-&gt;astOperand1()-&gt;variable()-&gt;isLocal())</span>
<a name="971"><font size=-1>971     </font></a><span class="default">                    localmember = </span><span class="keyword">true</span><span class="default">;</span>
<a name="972"><font size=-1>972     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">ChildrenToVisit::op1_and_op2;</span>
<a name="973"><font size=-1>973     </font></a><span class="default">            });</span>
<a name="974"><font size=-1>974     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(localmember)</span>
<a name="975"><font size=-1>975     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="976"><font size=-1>976     </font></a><span class="default"></span>
<a name="977"><font size=-1>977     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">allowed = </span><span class="keyword">true</span><span class="default">;</span>
<a name="978"><font size=-1>978     </font></a><span class="default">            visitAstNodes(tok-&gt;next()-&gt;astOperand2(),</span>
<a name="979"><font size=-1>979     </font></a><span class="default">            [&amp;](</span><span class="keyword">const </span><span class="default">Token *tok2) {</span>
<a name="980"><font size=-1>980     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable* var2 = tok2-&gt;variable();</span>
<a name="981"><font size=-1>981     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var2) {</span>
<a name="982"><font size=-1>982     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var2-&gt;scope() == owner &amp;&amp; tok2-&gt;strAt(-</span><span class="number">1</span><span class="default">)!=</span><span class="string">&quot;.&quot;</span><span class="default">) { </span><span class="comment">// Is there a dependency between two member variables?</span>
<a name="983"><font size=-1>983     </font></a><span class="comment">                        </span><span class="default">allowed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="984"><font size=-1>984     </font></a><span class="default">                        </span><span class="keyword">return </span><span class="default">ChildrenToVisit::done;</span>
<a name="985"><font size=-1>985     </font></a><span class="default">                    } </span><span class="keyword">else if </span><span class="default">(var2-&gt;isArray() &amp;&amp; var2-&gt;isLocal()) { </span><span class="comment">// Can't initialize with a local array</span>
<a name="986"><font size=-1>986     </font></a><span class="comment">                        </span><span class="default">allowed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="987"><font size=-1>987     </font></a><span class="default">                        </span><span class="keyword">return </span><span class="default">ChildrenToVisit::done;</span>
<a name="988"><font size=-1>988     </font></a><span class="default">                    }</span>
<a name="989"><font size=-1>989     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;this&quot;</span><span class="default">) { </span><span class="comment">// 'this' instance is not completely constructed in initialization list</span>
<a name="990"><font size=-1>990     </font></a><span class="comment">                    </span><span class="default">allowed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="991"><font size=-1>991     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">ChildrenToVisit::done;</span>
<a name="992"><font size=-1>992     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok2, </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; tok2-&gt;strAt(-</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;.&quot; </span><span class="default">&amp;&amp; isMemberFunc(owner, tok2)) { </span><span class="comment">// Member function called?</span>
<a name="993"><font size=-1>993     </font></a><span class="comment">                    </span><span class="default">allowed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="994"><font size=-1>994     </font></a><span class="default">                    </span><span class="keyword">return </span><span class="default">ChildrenToVisit::done;</span>
<a name="995"><font size=-1>995     </font></a><span class="default">                }</span>
<a name="996"><font size=-1>996     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">ChildrenToVisit::op1_and_op2;</span>
<a name="997"><font size=-1>997     </font></a><span class="default">            });</span>
<a name="998"><font size=-1>998     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!allowed)</span>
<a name="999"><font size=-1>999     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1000"><font size=-1>1000     </font></a><span class="default"></span>
<a name="1001"><font size=-1>1001     </font></a><span class="default">            suggestInitializationList(tok, tok-&gt;str());</span>
<a name="1002"><font size=-1>1002     </font></a><span class="default">        }</span>
<a name="1003"><font size=-1>1003     </font></a><span class="default">    }</span>
<a name="1004"><font size=-1>1004     </font></a><span class="default">}</span>
<a name="1005"><font size=-1>1005     </font></a><span class="default"></span>
<a name="1006"><font size=-1>1006     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::suggestInitializationList(</span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">std::string&amp; varname)</span>
<a name="1007"><font size=-1>1007     </font></a><span class="default">{</span>
<a name="1008"><font size=-1>1008     </font></a><span class="default">    reportError(tok, Severity::performance, </span><span class="string">&quot;useInitializationList&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\nVariable '$symbol' is assigned in constructor body. Consider performing initialization in initialization list.\n&quot;</span>
<a name="1009"><font size=-1>1009     </font></a><span class="string">                &quot;When an object of a class is created, the constructors of all member variables are called consecutively &quot;</span>
<a name="1010"><font size=-1>1010     </font></a><span class="string">                &quot;in the order the variables are declared, even if you don't explicitly write them to the initialization list. You &quot;</span>
<a name="1011"><font size=-1>1011     </font></a><span class="string">                &quot;could avoid assigning '$symbol' a value by passing the value to the constructor in the initialization list.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1012"><font size=-1>1012     </font></a><span class="default">}</span>
<a name="1013"><font size=-1>1013     </font></a><span class="default"></span>
<a name="1014"><font size=-1>1014     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1015"><font size=-1>1015     </font></a><span class="comment">// ClassCheck: Unused private functions</span>
<a name="1016"><font size=-1>1016     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1017"><font size=-1>1017     </font></a><span class="comment"></span>
<a name="1018"><font size=-1>1018     </font></a><span class="comment"></span><span class="keyword">static bool </span><span class="default">checkFunctionUsage(</span><span class="keyword">const </span><span class="default">Function *privfunc, </span><span class="keyword">const </span><span class="default">Scope* scope)</span>
<a name="1019"><font size=-1>1019     </font></a><span class="default">{</span>
<a name="1020"><font size=-1>1020     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!scope)</span>
<a name="1021"><font size=-1>1021     </font></a><span class="default">        </span><span class="keyword">return true</span><span class="default">; </span><span class="comment">// Assume it is used, if scope is not seen</span>
<a name="1022"><font size=-1>1022     </font></a><span class="comment"></span>
<a name="1023"><font size=-1>1023     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(std::list&lt;Function&gt;::const_iterator func = scope-&gt;functionList.begin(); func != scope-&gt;functionList.end(); ++func) {</span>
<a name="1024"><font size=-1>1024     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func-&gt;functionScope) {</span>
<a name="1025"><font size=-1>1025     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(func-&gt;tokenDef, </span><span class="string">&quot;%name% (&quot;</span><span class="default">)) {</span>
<a name="1026"><font size=-1>1026     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *ftok = func-&gt;tokenDef-&gt;tokAt(</span><span class="number">2</span><span class="default">); ftok &amp;&amp; ftok-&gt;str() != </span><span class="string">&quot;)&quot;</span><span class="default">; ftok = ftok-&gt;next()) {</span>
<a name="1027"><font size=-1>1027     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::Match(ftok, </span><span class="string">&quot;= %name% [(,)]&quot;</span><span class="default">) &amp;&amp; ftok-&gt;strAt(</span><span class="number">1</span><span class="default">) == privfunc-&gt;name())</span>
<a name="1028"><font size=-1>1028     </font></a><span class="default">                        </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1029"><font size=-1>1029     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(ftok-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="1030"><font size=-1>1030     </font></a><span class="default">                        ftok = ftok-&gt;link();</span>
<a name="1031"><font size=-1>1031     </font></a><span class="default">                }</span>
<a name="1032"><font size=-1>1032     </font></a><span class="default">            }</span>
<a name="1033"><font size=-1>1033     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *ftok = func-&gt;functionScope-&gt;classDef-&gt;linkAt(</span><span class="number">1</span><span class="default">); ftok != func-&gt;functionScope-&gt;bodyEnd; ftok = ftok-&gt;next()) {</span>
<a name="1034"><font size=-1>1034     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(ftok-&gt;function() == privfunc)</span>
<a name="1035"><font size=-1>1035     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1036"><font size=-1>1036     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(ftok-&gt;varId() == </span><span class="number">0U </span><span class="default">&amp;&amp; ftok-&gt;str() == privfunc-&gt;name()) </span><span class="comment">// TODO: This condition should be redundant</span>
<a name="1037"><font size=-1>1037     </font></a><span class="comment">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1038"><font size=-1>1038     </font></a><span class="default">            }</span>
<a name="1039"><font size=-1>1039     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">((func-&gt;type != Function::eCopyConstructor &amp;&amp;</span>
<a name="1040"><font size=-1>1040     </font></a><span class="default">                    func-&gt;type != Function::eOperatorEqual) ||</span>
<a name="1041"><font size=-1>1041     </font></a><span class="default">                   func-&gt;access != AccessControl::Private) </span><span class="comment">// Assume it is used, if a function implementation isn't seen, but empty private copy constructors and assignment operators are OK</span>
<a name="1042"><font size=-1>1042     </font></a><span class="comment">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1043"><font size=-1>1043     </font></a><span class="default">    }</span>
<a name="1044"><font size=-1>1044     </font></a><span class="default"></span>
<a name="1045"><font size=-1>1045     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::map&lt;std::string, Type*&gt;::const_iterator end = scope-&gt;definedTypesMap.end();</span>
<a name="1046"><font size=-1>1046     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(std::map&lt;std::string, Type*&gt;::const_iterator iter = scope-&gt;definedTypesMap.begin(); iter != end; ++ iter) {</span>
<a name="1047"><font size=-1>1047     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type *type = (*iter).second;</span>
<a name="1048"><font size=-1>1048     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(type-&gt;enclosingScope == scope &amp;&amp; checkFunctionUsage(privfunc, type-&gt;classScope))</span>
<a name="1049"><font size=-1>1049     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1050"><font size=-1>1050     </font></a><span class="default">    }</span>
<a name="1051"><font size=-1>1051     </font></a><span class="default"></span>
<a name="1052"><font size=-1>1052     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : scope-&gt;varlist) {</span>
<a name="1053"><font size=-1>1053     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var.isStatic()) {</span>
<a name="1054"><font size=-1>1054     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* tok = Token::findmatch(scope-&gt;bodyEnd, </span><span class="string">&quot;%varid% =|(|{&quot;</span><span class="default">, var.declarationId());</span>
<a name="1055"><font size=-1>1055     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok)</span>
<a name="1056"><font size=-1>1056     </font></a><span class="default">                tok = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1057"><font size=-1>1057     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(tok &amp;&amp; tok-&gt;str() != </span><span class="string">&quot;;&quot;</span><span class="default">) {</span>
<a name="1058"><font size=-1>1058     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;function() == privfunc)</span>
<a name="1059"><font size=-1>1059     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1060"><font size=-1>1060     </font></a><span class="default">                tok = tok-&gt;next();</span>
<a name="1061"><font size=-1>1061     </font></a><span class="default">            }</span>
<a name="1062"><font size=-1>1062     </font></a><span class="default">        }</span>
<a name="1063"><font size=-1>1063     </font></a><span class="default">    }</span>
<a name="1064"><font size=-1>1064     </font></a><span class="default"></span>
<a name="1065"><font size=-1>1065     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">; </span><span class="comment">// Unused in this scope</span>
<a name="1066"><font size=-1>1066     </font></a><span class="comment"></span><span class="default">}</span>
<a name="1067"><font size=-1>1067     </font></a><span class="default"></span>
<a name="1068"><font size=-1>1068     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::privateFunctions()</span>
<a name="1069"><font size=-1>1069     </font></a><span class="default">{</span>
<a name="1070"><font size=-1>1070     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="1071"><font size=-1>1071     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1072"><font size=-1>1072     </font></a><span class="default"></span>
<a name="1073"><font size=-1>1073     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1074"><font size=-1>1074     </font></a><span class="default"></span>
<a name="1075"><font size=-1>1075     </font></a><span class="default">        </span><span class="comment">// do not check borland classes with properties..</span>
<a name="1076"><font size=-1>1076     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(Token::findsimplematch(scope-&gt;bodyStart, </span><span class="string">&quot;; __property ;&quot;</span><span class="default">, scope-&gt;bodyEnd))</span>
<a name="1077"><font size=-1>1077     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1078"><font size=-1>1078     </font></a><span class="default"></span>
<a name="1079"><font size=-1>1079     </font></a><span class="default">        std::list&lt;</span><span class="keyword">const </span><span class="default">Function*&gt; privateFuncs;</span>
<a name="1080"><font size=-1>1080     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="1081"><font size=-1>1081     </font></a><span class="default">            </span><span class="comment">// Get private functions..</span>
<a name="1082"><font size=-1>1082     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(func.type == Function::eFunction &amp;&amp; func.access == AccessControl::Private &amp;&amp; !func.isOperator()) </span><span class="comment">// TODO: There are smarter ways to check private operator usage</span>
<a name="1083"><font size=-1>1083     </font></a><span class="comment">                </span><span class="default">privateFuncs.push_back(&amp;func);</span>
<a name="1084"><font size=-1>1084     </font></a><span class="default">        }</span>
<a name="1085"><font size=-1>1085     </font></a><span class="default"></span>
<a name="1086"><font size=-1>1086     </font></a><span class="default">        </span><span class="comment">// Bailout for overridden virtual functions of base classes</span>
<a name="1087"><font size=-1>1087     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;derivedFrom.empty()) {</span>
<a name="1088"><font size=-1>1088     </font></a><span class="default">            </span><span class="comment">// Check virtual functions</span>
<a name="1089"><font size=-1>1089     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(std::list&lt;</span><span class="keyword">const </span><span class="default">Function*&gt;::iterator it = privateFuncs.begin(); it != privateFuncs.end();) {</span>
<a name="1090"><font size=-1>1090     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">((*it)-&gt;isImplicitlyVirtual(</span><span class="keyword">true</span><span class="default">)) </span><span class="comment">// Give true as default value to be returned if we don't see all base classes</span>
<a name="1091"><font size=-1>1091     </font></a><span class="comment">                    </span><span class="default">privateFuncs.erase(it++);</span>
<a name="1092"><font size=-1>1092     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="1093"><font size=-1>1093     </font></a><span class="keyword">                    </span><span class="default">++it;</span>
<a name="1094"><font size=-1>1094     </font></a><span class="default">            }</span>
<a name="1095"><font size=-1>1095     </font></a><span class="default">        }</span>
<a name="1096"><font size=-1>1096     </font></a><span class="default"></span>
<a name="1097"><font size=-1>1097     </font></a><span class="default">        </span><span class="keyword">while </span><span class="default">(!privateFuncs.empty()) {</span>
<a name="1098"><font size=-1>1098     </font></a><span class="default">            </span><span class="comment">// Check that all private functions are used</span>
<a name="1099"><font size=-1>1099     </font></a><span class="comment">            </span><span class="keyword">bool </span><span class="default">used = checkFunctionUsage(privateFuncs.front(), scope); </span><span class="comment">// Usage in this class</span>
<a name="1100"><font size=-1>1100     </font></a><span class="comment">            // Check in friend classes</span>
<a name="1101"><font size=-1>1101     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">std::vector&lt;Type::FriendInfo&gt;&amp; friendList = scope-&gt;definedType-&gt;friendList;</span>
<a name="1102"><font size=-1>1102     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">i = </span><span class="number">0</span><span class="default">; i &lt; friendList.size() &amp;&amp; !used; i++) {</span>
<a name="1103"><font size=-1>1103     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(friendList[i].type)</span>
<a name="1104"><font size=-1>1104     </font></a><span class="default">                    used = checkFunctionUsage(privateFuncs.front(), friendList[i].type-&gt;classScope);</span>
<a name="1105"><font size=-1>1105     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="1106"><font size=-1>1106     </font></a><span class="keyword">                    </span><span class="default">used = </span><span class="keyword">true</span><span class="default">; </span><span class="comment">// Assume, it is used if we do not see friend class</span>
<a name="1107"><font size=-1>1107     </font></a><span class="comment">            </span><span class="default">}</span>
<a name="1108"><font size=-1>1108     </font></a><span class="default"></span>
<a name="1109"><font size=-1>1109     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!used)</span>
<a name="1110"><font size=-1>1110     </font></a><span class="default">                unusedPrivateFunctionError(privateFuncs.front()-&gt;tokenDef, scope-&gt;className, privateFuncs.front()-&gt;name());</span>
<a name="1111"><font size=-1>1111     </font></a><span class="default"></span>
<a name="1112"><font size=-1>1112     </font></a><span class="default">            privateFuncs.pop_front();</span>
<a name="1113"><font size=-1>1113     </font></a><span class="default">        }</span>
<a name="1114"><font size=-1>1114     </font></a><span class="default">    }</span>
<a name="1115"><font size=-1>1115     </font></a><span class="default">}</span>
<a name="1116"><font size=-1>1116     </font></a><span class="default"></span>
<a name="1117"><font size=-1>1117     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::unusedPrivateFunctionError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;funcname)</span>
<a name="1118"><font size=-1>1118     </font></a><span class="default">{</span>
<a name="1119"><font size=-1>1119     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;unusedPrivateFunction&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ funcname + </span><span class="string">&quot;\nUnused private function: '$symbol'&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1120"><font size=-1>1120     </font></a><span class="default">}</span>
<a name="1121"><font size=-1>1121     </font></a><span class="default"></span>
<a name="1122"><font size=-1>1122     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1123"><font size=-1>1123     </font></a><span class="comment">// ClassCheck: Check that memset is not used on classes</span>
<a name="1124"><font size=-1>1124     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1125"><font size=-1>1125     </font></a><span class="comment"></span>
<a name="1126"><font size=-1>1126     </font></a><span class="comment"></span><span class="keyword">static const </span><span class="default">Scope* findFunctionOf(</span><span class="keyword">const </span><span class="default">Scope* scope)</span>
<a name="1127"><font size=-1>1127     </font></a><span class="default">{</span>
<a name="1128"><font size=-1>1128     </font></a><span class="default">    </span><span class="keyword">while </span><span class="default">(scope) {</span>
<a name="1129"><font size=-1>1129     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope-&gt;type == Scope::eFunction)</span>
<a name="1130"><font size=-1>1130     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">scope-&gt;functionOf;</span>
<a name="1131"><font size=-1>1131     </font></a><span class="default">        scope = scope-&gt;nestedIn;</span>
<a name="1132"><font size=-1>1132     </font></a><span class="default">    }</span>
<a name="1133"><font size=-1>1133     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">nullptr;</span>
<a name="1134"><font size=-1>1134     </font></a><span class="default">}</span>
<a name="1135"><font size=-1>1135     </font></a><span class="default"></span>
<a name="1136"><font size=-1>1136     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkMemset()</span>
<a name="1137"><font size=-1>1137     </font></a><span class="default">{</span>
<a name="1138"><font size=-1>1138     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">printWarnings = mSettings-&gt;isEnabled(Settings::WARNING);</span>
<a name="1139"><font size=-1>1139     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *scope : mSymbolDatabase-&gt;functionScopes) {</span>
<a name="1140"><font size=-1>1140     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = scope-&gt;bodyStart; tok &amp;&amp; tok != scope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="1141"><font size=-1>1141     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;memset|memcpy|memmove (&quot;</span><span class="default">)) {</span>
<a name="1142"><font size=-1>1142     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token* arg1 = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1143"><font size=-1>1143     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token* arg3 = arg1-&gt;nextArgument();</span>
<a name="1144"><font size=-1>1144     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(arg3)</span>
<a name="1145"><font size=-1>1145     </font></a><span class="default">                    arg3 = arg3-&gt;nextArgument();</span>
<a name="1146"><font size=-1>1146     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!arg3)</span>
<a name="1147"><font size=-1>1147     </font></a><span class="default">                    </span><span class="comment">// weird, shouldn't happen: memset etc should have</span>
<a name="1148"><font size=-1>1148     </font></a><span class="comment">                    // 3 arguments.</span>
<a name="1149"><font size=-1>1149     </font></a><span class="comment">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1150"><font size=-1>1150     </font></a><span class="default"></span>
<a name="1151"><font size=-1>1151     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *typeTok = nullptr;</span>
<a name="1152"><font size=-1>1152     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Scope *type = nullptr;</span>
<a name="1153"><font size=-1>1153     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(arg3, </span><span class="string">&quot;sizeof ( %type% ) )&quot;</span><span class="default">))</span>
<a name="1154"><font size=-1>1154     </font></a><span class="default">                    typeTok = arg3-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1155"><font size=-1>1155     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(Token::Match(arg3, </span><span class="string">&quot;sizeof ( %type% :: %type% ) )&quot;</span><span class="default">))</span>
<a name="1156"><font size=-1>1156     </font></a><span class="default">                    typeTok = arg3-&gt;tokAt(</span><span class="number">4</span><span class="default">);</span>
<a name="1157"><font size=-1>1157     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(Token::Match(arg3, </span><span class="string">&quot;sizeof ( struct %type% ) )&quot;</span><span class="default">))</span>
<a name="1158"><font size=-1>1158     </font></a><span class="default">                    typeTok = arg3-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="1159"><font size=-1>1159     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(arg3, </span><span class="string">&quot;sizeof ( * this ) )&quot;</span><span class="default">) || Token::simpleMatch(arg1, </span><span class="string">&quot;this ,&quot;</span><span class="default">)) {</span>
<a name="1160"><font size=-1>1160     </font></a><span class="default">                    type = findFunctionOf(arg3-&gt;scope());</span>
<a name="1161"><font size=-1>1161     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(Token::Match(arg1, </span><span class="string">&quot;&amp;|*|%var%&quot;</span><span class="default">)) {</span>
<a name="1162"><font size=-1>1162     </font></a><span class="default">                    </span><span class="keyword">int </span><span class="default">numIndirToVariableType = </span><span class="number">0</span><span class="default">; </span><span class="comment">// Offset to the actual type in terms of dereference/addressof</span>
<a name="1163"><font size=-1>1163     </font></a><span class="comment">                    </span><span class="keyword">for </span><span class="default">(;; arg1 = arg1-&gt;next()) {</span>
<a name="1164"><font size=-1>1164     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(arg1-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="1165"><font size=-1>1165     </font></a><span class="default">                            ++numIndirToVariableType;</span>
<a name="1166"><font size=-1>1166     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(arg1-&gt;str() == </span><span class="string">&quot;*&quot;</span><span class="default">)</span>
<a name="1167"><font size=-1>1167     </font></a><span class="default">                            --numIndirToVariableType;</span>
<a name="1168"><font size=-1>1168     </font></a><span class="default">                        </span><span class="keyword">else</span>
<a name="1169"><font size=-1>1169     </font></a><span class="keyword">                            break</span><span class="default">;</span>
<a name="1170"><font size=-1>1170     </font></a><span class="default">                    }</span>
<a name="1171"><font size=-1>1171     </font></a><span class="default"></span>
<a name="1172"><font size=-1>1172     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">var = arg1-&gt;variable();</span>
<a name="1173"><font size=-1>1173     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(var &amp;&amp; arg1-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;,&quot;</span><span class="default">) {</span>
<a name="1174"><font size=-1>1174     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(var-&gt;isArrayOrPointer()) {</span>
<a name="1175"><font size=-1>1175     </font></a><span class="default">                            </span><span class="keyword">const </span><span class="default">Token *endTok = var-&gt;typeEndToken();</span>
<a name="1176"><font size=-1>1176     </font></a><span class="default">                            </span><span class="keyword">while </span><span class="default">(Token::simpleMatch(endTok, </span><span class="string">&quot;*&quot;</span><span class="default">)) {</span>
<a name="1177"><font size=-1>1177     </font></a><span class="default">                                ++numIndirToVariableType;</span>
<a name="1178"><font size=-1>1178     </font></a><span class="default">                                endTok = endTok-&gt;previous();</span>
<a name="1179"><font size=-1>1179     </font></a><span class="default">                            }</span>
<a name="1180"><font size=-1>1180     </font></a><span class="default">                        }</span>
<a name="1181"><font size=-1>1181     </font></a><span class="default"></span>
<a name="1182"><font size=-1>1182     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(var-&gt;isArray())</span>
<a name="1183"><font size=-1>1183     </font></a><span class="default">                            numIndirToVariableType += </span><span class="keyword">int</span><span class="default">(var-&gt;dimensions().size());</span>
<a name="1184"><font size=-1>1184     </font></a><span class="default"></span>
<a name="1185"><font size=-1>1185     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(numIndirToVariableType == </span><span class="number">1</span><span class="default">)</span>
<a name="1186"><font size=-1>1186     </font></a><span class="default">                            type = var-&gt;typeScope();</span>
<a name="1187"><font size=-1>1187     </font></a><span class="default">                    }</span>
<a name="1188"><font size=-1>1188     </font></a><span class="default">                }</span>
<a name="1189"><font size=-1>1189     </font></a><span class="default"></span>
<a name="1190"><font size=-1>1190     </font></a><span class="default">                </span><span class="comment">// No type defined =&gt; The tokens didn't match</span>
<a name="1191"><font size=-1>1191     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!typeTok &amp;&amp; !type)</span>
<a name="1192"><font size=-1>1192     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1193"><font size=-1>1193     </font></a><span class="default"></span>
<a name="1194"><font size=-1>1194     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(typeTok &amp;&amp; typeTok-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="1195"><font size=-1>1195     </font></a><span class="default">                    typeTok = typeTok-&gt;next();</span>
<a name="1196"><font size=-1>1196     </font></a><span class="default"></span>
<a name="1197"><font size=-1>1197     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!type &amp;&amp; typeTok-&gt;type())</span>
<a name="1198"><font size=-1>1198     </font></a><span class="default">                    type = typeTok-&gt;type()-&gt;classScope;</span>
<a name="1199"><font size=-1>1199     </font></a><span class="default"></span>
<a name="1200"><font size=-1>1200     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(type) {</span>
<a name="1201"><font size=-1>1201     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">std::set&lt;</span><span class="keyword">const </span><span class="default">Scope *&gt; parsedTypes;</span>
<a name="1202"><font size=-1>1202     </font></a><span class="default">                    checkMemsetType(scope, tok, type, </span><span class="keyword">false</span><span class="default">, parsedTypes);</span>
<a name="1203"><font size=-1>1203     </font></a><span class="default">                }</span>
<a name="1204"><font size=-1>1204     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(tok-&gt;variable() &amp;&amp; tok-&gt;variable()-&gt;typeScope() &amp;&amp; Token::Match(tok, </span><span class="string">&quot;%var% = calloc|malloc|realloc|g_malloc|g_try_malloc|g_realloc|g_try_realloc (&quot;</span><span class="default">)) {</span>
<a name="1205"><font size=-1>1205     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">std::set&lt;</span><span class="keyword">const </span><span class="default">Scope *&gt; parsedTypes;</span>
<a name="1206"><font size=-1>1206     </font></a><span class="default">                checkMemsetType(scope, tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), tok-&gt;variable()-&gt;typeScope(), </span><span class="keyword">true</span><span class="default">, parsedTypes);</span>
<a name="1207"><font size=-1>1207     </font></a><span class="default"></span>
<a name="1208"><font size=-1>1208     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(printWarnings &amp;&amp; tok-&gt;variable()-&gt;typeScope()-&gt;numConstructors &gt; </span><span class="number">0</span><span class="default">)</span>
<a name="1209"><font size=-1>1209     </font></a><span class="default">                    mallocOnClassWarning(tok, tok-&gt;strAt(</span><span class="number">2</span><span class="default">), tok-&gt;variable()-&gt;typeScope()-&gt;classDef);</span>
<a name="1210"><font size=-1>1210     </font></a><span class="default">            }</span>
<a name="1211"><font size=-1>1211     </font></a><span class="default">        }</span>
<a name="1212"><font size=-1>1212     </font></a><span class="default">    }</span>
<a name="1213"><font size=-1>1213     </font></a><span class="default">}</span>
<a name="1214"><font size=-1>1214     </font></a><span class="default"></span>
<a name="1215"><font size=-1>1215     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkMemsetType(</span><span class="keyword">const </span><span class="default">Scope *start, </span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Scope *type, </span><span class="keyword">bool </span><span class="default">allocation, std::set&lt;</span><span class="keyword">const </span><span class="default">Scope *&gt; parsedTypes)</span>
<a name="1216"><font size=-1>1216     </font></a><span class="default">{</span>
<a name="1217"><font size=-1>1217     </font></a><span class="default">    </span><span class="comment">// If type has been checked there is no need to check it again</span>
<a name="1218"><font size=-1>1218     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(parsedTypes.find(type) != parsedTypes.end())</span>
<a name="1219"><font size=-1>1219     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1220"><font size=-1>1220     </font></a><span class="default">    parsedTypes.insert(type);</span>
<a name="1221"><font size=-1>1221     </font></a><span class="default"></span>
<a name="1222"><font size=-1>1222     </font></a><span class="default">    </span><span class="keyword">const bool </span><span class="default">printPortability = mSettings-&gt;isEnabled(Settings::PORTABILITY);</span>
<a name="1223"><font size=-1>1223     </font></a><span class="default"></span>
<a name="1224"><font size=-1>1224     </font></a><span class="default">    </span><span class="comment">// recursively check all parent classes</span>
<a name="1225"><font size=-1>1225     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; i : type-&gt;definedType-&gt;derivedFrom) {</span>
<a name="1226"><font size=-1>1226     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Type* derivedFrom = i.type;</span>
<a name="1227"><font size=-1>1227     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(derivedFrom &amp;&amp; derivedFrom-&gt;classScope)</span>
<a name="1228"><font size=-1>1228     </font></a><span class="default">            checkMemsetType(start, tok, derivedFrom-&gt;classScope, allocation, parsedTypes);</span>
<a name="1229"><font size=-1>1229     </font></a><span class="default">    }</span>
<a name="1230"><font size=-1>1230     </font></a><span class="default"></span>
<a name="1231"><font size=-1>1231     </font></a><span class="default">    </span><span class="comment">// Warn if type is a class that contains any virtual functions</span>
<a name="1232"><font size=-1>1232     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : type-&gt;functionList) {</span>
<a name="1233"><font size=-1>1233     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(func.hasVirtualSpecifier()) {</span>
<a name="1234"><font size=-1>1234     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(allocation)</span>
<a name="1235"><font size=-1>1235     </font></a><span class="default">                mallocOnClassError(tok, tok-&gt;str(), type-&gt;classDef, </span><span class="string">&quot;virtual function&quot;</span><span class="default">);</span>
<a name="1236"><font size=-1>1236     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="1237"><font size=-1>1237     </font></a><span class="keyword">                </span><span class="default">memsetError(tok, tok-&gt;str(), </span><span class="string">&quot;virtual function&quot;</span><span class="default">, type-&gt;classDef-&gt;str());</span>
<a name="1238"><font size=-1>1238     </font></a><span class="default">        }</span>
<a name="1239"><font size=-1>1239     </font></a><span class="default">    }</span>
<a name="1240"><font size=-1>1240     </font></a><span class="default"></span>
<a name="1241"><font size=-1>1241     </font></a><span class="default">    </span><span class="comment">// Warn if type is a class or struct that contains any std::* variables</span>
<a name="1242"><font size=-1>1242     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : type-&gt;varlist) {</span>
<a name="1243"><font size=-1>1243     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var.isReference() &amp;&amp; !var.isStatic()) {</span>
<a name="1244"><font size=-1>1244     </font></a><span class="default">            memsetErrorReference(tok, tok-&gt;str(), type-&gt;classDef-&gt;str());</span>
<a name="1245"><font size=-1>1245     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1246"><font size=-1>1246     </font></a><span class="default">        }</span>
<a name="1247"><font size=-1>1247     </font></a><span class="default">        </span><span class="comment">// don't warn if variable static or const, pointer or array of pointers</span>
<a name="1248"><font size=-1>1248     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(!var.isStatic() &amp;&amp; !var.isConst() &amp;&amp; !var.isPointer() &amp;&amp; (!var.isArray() || var.typeEndToken()-&gt;str() != </span><span class="string">&quot;*&quot;</span><span class="default">)) {</span>
<a name="1249"><font size=-1>1249     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *tok1 = var.typeStartToken();</span>
<a name="1250"><font size=-1>1250     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope *typeScope = var.typeScope();</span>
<a name="1251"><font size=-1>1251     </font></a><span class="default"></span>
<a name="1252"><font size=-1>1252     </font></a><span class="default">            std::string typeName;</span>
<a name="1253"><font size=-1>1253     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok1, </span><span class="string">&quot;%type% ::&quot;</span><span class="default">)) {</span>
<a name="1254"><font size=-1>1254     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *typeTok = tok1;</span>
<a name="1255"><font size=-1>1255     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(Token::Match(typeTok, </span><span class="string">&quot;%type% ::&quot;</span><span class="default">)) {</span>
<a name="1256"><font size=-1>1256     </font></a><span class="default">                    typeName += typeTok-&gt;str() + </span><span class="string">&quot;::&quot;</span><span class="default">;</span>
<a name="1257"><font size=-1>1257     </font></a><span class="default">                    typeTok = typeTok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1258"><font size=-1>1258     </font></a><span class="default">                }</span>
<a name="1259"><font size=-1>1259     </font></a><span class="default">                typeName += typeTok-&gt;str();</span>
<a name="1260"><font size=-1>1260     </font></a><span class="default">            }</span>
<a name="1261"><font size=-1>1261     </font></a><span class="default"></span>
<a name="1262"><font size=-1>1262     </font></a><span class="default">            </span><span class="comment">// check for std:: type</span>
<a name="1263"><font size=-1>1263     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(var.isStlType() &amp;&amp; typeName != </span><span class="string">&quot;std::array&quot; </span><span class="default">&amp;&amp; !mSettings-&gt;library.podtype(typeName)) {</span>
<a name="1264"><font size=-1>1264     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(allocation)</span>
<a name="1265"><font size=-1>1265     </font></a><span class="default">                    mallocOnClassError(tok, tok-&gt;str(), type-&gt;classDef, </span><span class="string">&quot;'&quot; </span><span class="default">+ typeName + </span><span class="string">&quot;'&quot;</span><span class="default">);</span>
<a name="1266"><font size=-1>1266     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="1267"><font size=-1>1267     </font></a><span class="keyword">                    </span><span class="default">memsetError(tok, tok-&gt;str(), </span><span class="string">&quot;'&quot; </span><span class="default">+ typeName + </span><span class="string">&quot;'&quot;</span><span class="default">, type-&gt;classDef-&gt;str());</span>
<a name="1268"><font size=-1>1268     </font></a><span class="default">            }</span>
<a name="1269"><font size=-1>1269     </font></a><span class="default"></span>
<a name="1270"><font size=-1>1270     </font></a><span class="default">            </span><span class="comment">// check for known type</span>
<a name="1271"><font size=-1>1271     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(typeScope &amp;&amp; typeScope != type)</span>
<a name="1272"><font size=-1>1272     </font></a><span class="default">                checkMemsetType(start, tok, typeScope, allocation, parsedTypes);</span>
<a name="1273"><font size=-1>1273     </font></a><span class="default"></span>
<a name="1274"><font size=-1>1274     </font></a><span class="default">            </span><span class="comment">// check for float</span>
<a name="1275"><font size=-1>1275     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(printPortability &amp;&amp; var.isFloatingType() &amp;&amp; tok-&gt;str() == </span><span class="string">&quot;memset&quot;</span><span class="default">)</span>
<a name="1276"><font size=-1>1276     </font></a><span class="default">                memsetErrorFloat(tok, type-&gt;classDef-&gt;str());</span>
<a name="1277"><font size=-1>1277     </font></a><span class="default">        }</span>
<a name="1278"><font size=-1>1278     </font></a><span class="default">    }</span>
<a name="1279"><font size=-1>1279     </font></a><span class="default">}</span>
<a name="1280"><font size=-1>1280     </font></a><span class="default"></span>
<a name="1281"><font size=-1>1281     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::mallocOnClassWarning(</span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">std::string &amp;memfunc, </span><span class="keyword">const </span><span class="default">Token* classTok)</span>
<a name="1282"><font size=-1>1282     </font></a><span class="default">{</span>
<a name="1283"><font size=-1>1283     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; toks = { tok, classTok };</span>
<a name="1284"><font size=-1>1284     </font></a><span class="default">    reportError(toks, Severity::warning, </span><span class="string">&quot;mallocOnClassWarning&quot;</span><span class="default">,</span>
<a name="1285"><font size=-1>1285     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ memfunc +</span><span class="string">&quot;\n&quot;</span>
<a name="1286"><font size=-1>1286     </font></a><span class="string">                &quot;Memory for class instance allocated with $symbol(), but class provides constructors.\n&quot;</span>
<a name="1287"><font size=-1>1287     </font></a><span class="string">                &quot;Memory for class instance allocated with $symbol(), but class provides constructors. This is unsafe, &quot;</span>
<a name="1288"><font size=-1>1288     </font></a><span class="string">                &quot;since no constructor is called and class members remain uninitialized. Consider using 'new' instead.&quot;</span><span class="default">, CWE762, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1289"><font size=-1>1289     </font></a><span class="default">}</span>
<a name="1290"><font size=-1>1290     </font></a><span class="default"></span>
<a name="1291"><font size=-1>1291     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::mallocOnClassError(</span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">std::string &amp;memfunc, </span><span class="keyword">const </span><span class="default">Token* classTok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname)</span>
<a name="1292"><font size=-1>1292     </font></a><span class="default">{</span>
<a name="1293"><font size=-1>1293     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; toks = { tok, classTok };</span>
<a name="1294"><font size=-1>1294     </font></a><span class="default">    reportError(toks, Severity::error, </span><span class="string">&quot;mallocOnClassError&quot;</span><span class="default">,</span>
<a name="1295"><font size=-1>1295     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ memfunc +</span><span class="string">&quot;\n&quot;</span>
<a name="1296"><font size=-1>1296     </font></a><span class="string">                &quot;$symbol:&quot; </span><span class="default">+ classname +</span><span class="string">&quot;\n&quot;</span>
<a name="1297"><font size=-1>1297     </font></a><span class="string">                &quot;Memory for class instance allocated with &quot; </span><span class="default">+ memfunc + </span><span class="string">&quot;(), but class contains a &quot; </span><span class="default">+ classname + </span><span class="string">&quot;.\n&quot;</span>
<a name="1298"><font size=-1>1298     </font></a><span class="string">                &quot;Memory for class instance allocated with &quot; </span><span class="default">+ memfunc + </span><span class="string">&quot;(), but class a &quot; </span><span class="default">+ classname + </span><span class="string">&quot;. This is unsafe, &quot;</span>
<a name="1299"><font size=-1>1299     </font></a><span class="string">                &quot;since no constructor is called and class members remain uninitialized. Consider using 'new' instead.&quot;</span><span class="default">, CWE665, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1300"><font size=-1>1300     </font></a><span class="default">}</span>
<a name="1301"><font size=-1>1301     </font></a><span class="default"></span>
<a name="1302"><font size=-1>1302     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::memsetError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;memfunc, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;type)</span>
<a name="1303"><font size=-1>1303     </font></a><span class="default">{</span>
<a name="1304"><font size=-1>1304     </font></a><span class="default">    reportError(tok, Severity::error, </span><span class="string">&quot;memsetClass&quot;</span><span class="default">,</span>
<a name="1305"><font size=-1>1305     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ memfunc +</span><span class="string">&quot;\n&quot;</span>
<a name="1306"><font size=-1>1306     </font></a><span class="string">                &quot;$symbol:&quot; </span><span class="default">+ classname +</span><span class="string">&quot;\n&quot;</span>
<a name="1307"><font size=-1>1307     </font></a><span class="string">                &quot;Using '&quot; </span><span class="default">+ memfunc + </span><span class="string">&quot;' on &quot; </span><span class="default">+ type + </span><span class="string">&quot; that contains a &quot; </span><span class="default">+ classname + </span><span class="string">&quot;.\n&quot;</span>
<a name="1308"><font size=-1>1308     </font></a><span class="string">                &quot;Using '&quot; </span><span class="default">+ memfunc + </span><span class="string">&quot;' on &quot; </span><span class="default">+ type + </span><span class="string">&quot; that contains a &quot; </span><span class="default">+ classname + </span><span class="string">&quot; is unsafe, because constructor, destructor &quot;</span>
<a name="1309"><font size=-1>1309     </font></a><span class="string">                &quot;and copy operator calls are omitted. These are necessary for this non-POD type to ensure that a valid object &quot;</span>
<a name="1310"><font size=-1>1310     </font></a><span class="string">                &quot;is created.&quot;</span><span class="default">, CWE762, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1311"><font size=-1>1311     </font></a><span class="default">}</span>
<a name="1312"><font size=-1>1312     </font></a><span class="default"></span>
<a name="1313"><font size=-1>1313     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::memsetErrorReference(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;memfunc, </span><span class="keyword">const </span><span class="default">std::string &amp;type)</span>
<a name="1314"><font size=-1>1314     </font></a><span class="default">{</span>
<a name="1315"><font size=-1>1315     </font></a><span class="default">    reportError(tok, Severity::error, </span><span class="string">&quot;memsetClassReference&quot;</span><span class="default">,</span>
<a name="1316"><font size=-1>1316     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ memfunc +</span><span class="string">&quot;\n&quot;</span>
<a name="1317"><font size=-1>1317     </font></a><span class="string">                &quot;Using '&quot; </span><span class="default">+ memfunc + </span><span class="string">&quot;' on &quot; </span><span class="default">+ type + </span><span class="string">&quot; that contains a reference.&quot;</span><span class="default">, CWE665, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1318"><font size=-1>1318     </font></a><span class="default">}</span>
<a name="1319"><font size=-1>1319     </font></a><span class="default"></span>
<a name="1320"><font size=-1>1320     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::memsetErrorFloat(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;type)</span>
<a name="1321"><font size=-1>1321     </font></a><span class="default">{</span>
<a name="1322"><font size=-1>1322     </font></a><span class="default">    reportError(tok, Severity::portability, </span><span class="string">&quot;memsetClassFloat&quot;</span><span class="default">, </span><span class="string">&quot;Using memset() on &quot; </span><span class="default">+ type + </span><span class="string">&quot; which contains a floating point number.\n&quot;</span>
<a name="1323"><font size=-1>1323     </font></a><span class="string">                &quot;Using memset() on &quot; </span><span class="default">+ type + </span><span class="string">&quot; which contains a floating point number.&quot;</span>
<a name="1324"><font size=-1>1324     </font></a><span class="string">                &quot; This is not portable because memset() sets each byte of a block of memory to a specific value and&quot;</span>
<a name="1325"><font size=-1>1325     </font></a><span class="string">                &quot; the actual representation of a floating-point value is implementation defined.&quot;</span>
<a name="1326"><font size=-1>1326     </font></a><span class="string">                &quot; Note: In case of an IEEE754-1985 compatible implementation setting all bits to zero results in the value 0.0.&quot;</span><span class="default">, CWE758, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1327"><font size=-1>1327     </font></a><span class="default">}</span>
<a name="1328"><font size=-1>1328     </font></a><span class="default"></span>
<a name="1329"><font size=-1>1329     </font></a><span class="default"></span>
<a name="1330"><font size=-1>1330     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1331"><font size=-1>1331     </font></a><span class="comment">// ClassCheck: &quot;void operator=(&quot; and &quot;const type &amp; operator=(&quot;</span>
<a name="1332"><font size=-1>1332     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1333"><font size=-1>1333     </font></a><span class="comment"></span>
<a name="1334"><font size=-1>1334     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEq()</span>
<a name="1335"><font size=-1>1335     </font></a><span class="default">{</span>
<a name="1336"><font size=-1>1336     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="1337"><font size=-1>1337     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1338"><font size=-1>1338     </font></a><span class="default"></span>
<a name="1339"><font size=-1>1339     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1340"><font size=-1>1340     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::list&lt;Function&gt;::const_iterator func = scope-&gt;functionList.begin(); func != scope-&gt;functionList.end(); ++func) {</span>
<a name="1341"><font size=-1>1341     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func-&gt;type == Function::eOperatorEqual &amp;&amp; func-&gt;access == AccessControl::Public) {</span>
<a name="1342"><font size=-1>1342     </font></a><span class="default">                </span><span class="comment">// skip &quot;deleted&quot; functions - cannot be called anyway</span>
<a name="1343"><font size=-1>1343     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(func-&gt;isDelete())</span>
<a name="1344"><font size=-1>1344     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1345"><font size=-1>1345     </font></a><span class="default">                </span><span class="comment">// use definition for check so we don't have to deal with qualification</span>
<a name="1346"><font size=-1>1346     </font></a><span class="comment">                </span><span class="keyword">bool </span><span class="default">returnSelfRef = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1347"><font size=-1>1347     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(func-&gt;retDef-&gt;str() == scope-&gt;className) {</span>
<a name="1348"><font size=-1>1348     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::Match(func-&gt;retDef, </span><span class="string">&quot;%type% &amp;&quot;</span><span class="default">)) {</span>
<a name="1349"><font size=-1>1349     </font></a><span class="default">                        returnSelfRef = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1350"><font size=-1>1350     </font></a><span class="default">                    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1351"><font size=-1>1351     </font></a><span class="default">                        </span><span class="comment">// We might have &quot;Self&lt;template_parameters&gt;&amp;&quot;&quot;</span>
<a name="1352"><font size=-1>1352     </font></a><span class="comment">                        </span><span class="keyword">const </span><span class="default">Token * </span><span class="keyword">const </span><span class="default">tok = func-&gt;retDef-&gt;next();</span>
<a name="1353"><font size=-1>1353     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(tok &amp;&amp; tok-&gt;str() == </span><span class="string">&quot;&lt;&quot; </span><span class="default">&amp;&amp; tok-&gt;link() &amp;&amp; tok-&gt;link()-&gt;next() &amp;&amp; tok-&gt;link()-&gt;next()-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">)</span>
<a name="1354"><font size=-1>1354     </font></a><span class="default">                            returnSelfRef = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1355"><font size=-1>1355     </font></a><span class="default">                    }</span>
<a name="1356"><font size=-1>1356     </font></a><span class="default">                }</span>
<a name="1357"><font size=-1>1357     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!returnSelfRef) {</span>
<a name="1358"><font size=-1>1358     </font></a><span class="default">                    </span><span class="comment">// make sure we really have a copy assignment operator</span>
<a name="1359"><font size=-1>1359     </font></a><span class="comment">                    </span><span class="keyword">const </span><span class="default">Token *paramTok = func-&gt;tokenDef-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1360"><font size=-1>1360     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(Token::Match(paramTok, </span><span class="string">&quot;const| %name% &amp;&quot;</span><span class="default">)) {</span>
<a name="1361"><font size=-1>1361     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(paramTok-&gt;str() == </span><span class="string">&quot;const&quot; </span><span class="default">&amp;&amp;</span>
<a name="1362"><font size=-1>1362     </font></a><span class="default">                            paramTok-&gt;strAt(</span><span class="number">1</span><span class="default">) == scope-&gt;className)</span>
<a name="1363"><font size=-1>1363     </font></a><span class="default">                            operatorEqReturnError(func-&gt;retDef, scope-&gt;className);</span>
<a name="1364"><font size=-1>1364     </font></a><span class="default">                        </span><span class="keyword">else if </span><span class="default">(paramTok-&gt;str() == scope-&gt;className)</span>
<a name="1365"><font size=-1>1365     </font></a><span class="default">                            operatorEqReturnError(func-&gt;retDef, scope-&gt;className);</span>
<a name="1366"><font size=-1>1366     </font></a><span class="default">                    }</span>
<a name="1367"><font size=-1>1367     </font></a><span class="default">                }</span>
<a name="1368"><font size=-1>1368     </font></a><span class="default">            }</span>
<a name="1369"><font size=-1>1369     </font></a><span class="default">        }</span>
<a name="1370"><font size=-1>1370     </font></a><span class="default">    }</span>
<a name="1371"><font size=-1>1371     </font></a><span class="default">}</span>
<a name="1372"><font size=-1>1372     </font></a><span class="default"></span>
<a name="1373"><font size=-1>1373     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqReturnError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;className)</span>
<a name="1374"><font size=-1>1374     </font></a><span class="default">{</span>
<a name="1375"><font size=-1>1375     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;operatorEq&quot;</span><span class="default">,</span>
<a name="1376"><font size=-1>1376     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ className +</span><span class="string">&quot;\n&quot;</span>
<a name="1377"><font size=-1>1377     </font></a><span class="string">                &quot;'$symbol::operator=' should return '$symbol &amp;'.\n&quot;</span>
<a name="1378"><font size=-1>1378     </font></a><span class="string">                &quot;The $symbol::operator= does not conform to standard C/C++ behaviour. To conform to standard C/C++ behaviour, return a reference to self (such as: '$symbol &amp;$symbol::operator=(..) { .. return *this; }'. For safety reasons it might be better to not fix this message. If you think that safety is always more important than conformance then please ignore/suppress this message. For more details about this topic, see the book \&quot;Effective C++\&quot; by Scott Meyers.&quot;</span>
<a name="1379"><font size=-1>1379     </font></a><span class="string">                </span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1380"><font size=-1>1380     </font></a><span class="default">}</span>
<a name="1381"><font size=-1>1381     </font></a><span class="default"></span>
<a name="1382"><font size=-1>1382     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1383"><font size=-1>1383     </font></a><span class="comment">// ClassCheck: &quot;C&amp; operator=(const C&amp;) { ... return *this; }&quot;</span>
<a name="1384"><font size=-1>1384     </font></a><span class="comment">// operator= should return a reference to *this</span>
<a name="1385"><font size=-1>1385     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1386"><font size=-1>1386     </font></a><span class="comment"></span>
<a name="1387"><font size=-1>1387     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqRetRefThis()</span>
<a name="1388"><font size=-1>1388     </font></a><span class="default">{</span>
<a name="1389"><font size=-1>1389     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="1390"><font size=-1>1390     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1391"><font size=-1>1391     </font></a><span class="default"></span>
<a name="1392"><font size=-1>1392     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1393"><font size=-1>1393     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::list&lt;Function&gt;::const_iterator func = scope-&gt;functionList.begin(); func != scope-&gt;functionList.end(); ++func) {</span>
<a name="1394"><font size=-1>1394     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func-&gt;type == Function::eOperatorEqual &amp;&amp; func-&gt;hasBody()) {</span>
<a name="1395"><font size=-1>1395     </font></a><span class="default">                </span><span class="comment">// make sure return signature is correct</span>
<a name="1396"><font size=-1>1396     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(func-&gt;retType == func-&gt;nestedIn-&gt;definedType &amp;&amp; func-&gt;tokenDef-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;&amp;&quot;</span><span class="default">) {</span>
<a name="1397"><font size=-1>1397     </font></a><span class="default">                    checkReturnPtrThis(scope, &amp;(*func), func-&gt;functionScope-&gt;bodyStart, func-&gt;functionScope-&gt;bodyEnd);</span>
<a name="1398"><font size=-1>1398     </font></a><span class="default">                }</span>
<a name="1399"><font size=-1>1399     </font></a><span class="default">            }</span>
<a name="1400"><font size=-1>1400     </font></a><span class="default">        }</span>
<a name="1401"><font size=-1>1401     </font></a><span class="default">    }</span>
<a name="1402"><font size=-1>1402     </font></a><span class="default">}</span>
<a name="1403"><font size=-1>1403     </font></a><span class="default"></span>
<a name="1404"><font size=-1>1404     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkReturnPtrThis(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Function *func, </span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Token *last)</span>
<a name="1405"><font size=-1>1405     </font></a><span class="default">{</span>
<a name="1406"><font size=-1>1406     </font></a><span class="default">    std::set&lt;</span><span class="keyword">const </span><span class="default">Function*&gt; analyzedFunctions;</span>
<a name="1407"><font size=-1>1407     </font></a><span class="default">    checkReturnPtrThis(scope, func, tok, last, analyzedFunctions);</span>
<a name="1408"><font size=-1>1408     </font></a><span class="default">}</span>
<a name="1409"><font size=-1>1409     </font></a><span class="default"></span>
<a name="1410"><font size=-1>1410     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkReturnPtrThis(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Function *func, </span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">Token *last, std::set&lt;</span><span class="keyword">const </span><span class="default">Function*&gt;&amp; analyzedFunctions)</span>
<a name="1411"><font size=-1>1411     </font></a><span class="default">{</span>
<a name="1412"><font size=-1>1412     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">foundReturn = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1413"><font size=-1>1413     </font></a><span class="default"></span>
<a name="1414"><font size=-1>1414     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token* </span><span class="keyword">const </span><span class="default">startTok = tok;</span>
<a name="1415"><font size=-1>1415     </font></a><span class="default"></span>
<a name="1416"><font size=-1>1416     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(; tok &amp;&amp; tok != last; tok = tok-&gt;next()) {</span>
<a name="1417"><font size=-1>1417     </font></a><span class="default">        </span><span class="comment">// check for return of reference to this</span>
<a name="1418"><font size=-1>1418     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;return&quot;</span><span class="default">)</span>
<a name="1419"><font size=-1>1419     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1420"><font size=-1>1420     </font></a><span class="default"></span>
<a name="1421"><font size=-1>1421     </font></a><span class="default">        foundReturn = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1422"><font size=-1>1422     </font></a><span class="default"></span>
<a name="1423"><font size=-1>1423     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *retExpr = tok-&gt;astOperand1();</span>
<a name="1424"><font size=-1>1424     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(retExpr &amp;&amp; retExpr-&gt;str() == </span><span class="string">&quot;=&quot;</span><span class="default">)</span>
<a name="1425"><font size=-1>1425     </font></a><span class="default">            retExpr = retExpr-&gt;astOperand1();</span>
<a name="1426"><font size=-1>1426     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(retExpr &amp;&amp; retExpr-&gt;isUnaryOp(</span><span class="string">&quot;*&quot;</span><span class="default">) &amp;&amp; Token::simpleMatch(retExpr-&gt;astOperand1(), </span><span class="string">&quot;this&quot;</span><span class="default">))</span>
<a name="1427"><font size=-1>1427     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1428"><font size=-1>1428     </font></a><span class="default"></span>
<a name="1429"><font size=-1>1429     </font></a><span class="default">        std::string cast(</span><span class="string">&quot;( &quot; </span><span class="default">+ scope-&gt;className + </span><span class="string">&quot; &amp; )&quot;</span><span class="default">);</span>
<a name="1430"><font size=-1>1430     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;next(), cast.c_str()))</span>
<a name="1431"><font size=-1>1431     </font></a><span class="default">            tok = tok-&gt;tokAt(</span><span class="number">4</span><span class="default">);</span>
<a name="1432"><font size=-1>1432     </font></a><span class="default"></span>
<a name="1433"><font size=-1>1433     </font></a><span class="default">        </span><span class="comment">// check if a function is called</span>
<a name="1434"><font size=-1>1434     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(tok-&gt;strAt(</span><span class="number">2</span><span class="default">) == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp;</span>
<a name="1435"><font size=-1>1435     </font></a><span class="default">            tok-&gt;linkAt(</span><span class="number">2</span><span class="default">)-&gt;next()-&gt;str() == </span><span class="string">&quot;;&quot;</span><span class="default">) {</span>
<a name="1436"><font size=-1>1436     </font></a><span class="default">            </span><span class="comment">// check if it is a member function</span>
<a name="1437"><font size=-1>1437     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(std::list&lt;Function&gt;::const_iterator it = scope-&gt;functionList.begin(); it != scope-&gt;functionList.end(); ++it) {</span>
<a name="1438"><font size=-1>1438     </font></a><span class="default">                </span><span class="comment">// check for a regular function with the same name and a body</span>
<a name="1439"><font size=-1>1439     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(it-&gt;type == Function::eFunction &amp;&amp; it-&gt;hasBody() &amp;&amp;</span>
<a name="1440"><font size=-1>1440     </font></a><span class="default">                    it-&gt;token-&gt;str() == tok-&gt;next()-&gt;str()) {</span>
<a name="1441"><font size=-1>1441     </font></a><span class="default">                    </span><span class="comment">// check for the proper return type</span>
<a name="1442"><font size=-1>1442     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(it-&gt;tokenDef-&gt;previous()-&gt;str() == </span><span class="string">&quot;&amp;&quot; </span><span class="default">&amp;&amp;</span>
<a name="1443"><font size=-1>1443     </font></a><span class="default">                        it-&gt;tokenDef-&gt;strAt(-</span><span class="number">2</span><span class="default">) == scope-&gt;className) {</span>
<a name="1444"><font size=-1>1444     </font></a><span class="default">                        </span><span class="comment">// make sure it's not a const function</span>
<a name="1445"><font size=-1>1445     </font></a><span class="comment">                        </span><span class="keyword">if </span><span class="default">(!it-&gt;isConst()) {</span>
<a name="1446"><font size=-1>1446     </font></a><span class="default">                            </span><span class="comment">/** @todo make sure argument types match */</span>
<a name="1447"><font size=-1>1447     </font></a><span class="comment">                            // avoid endless recursions</span>
<a name="1448"><font size=-1>1448     </font></a><span class="comment">                            </span><span class="keyword">if </span><span class="default">(analyzedFunctions.find(&amp;*it) == analyzedFunctions.end()) {</span>
<a name="1449"><font size=-1>1449     </font></a><span class="default">                                analyzedFunctions.insert(&amp;*it);</span>
<a name="1450"><font size=-1>1450     </font></a><span class="default">                                checkReturnPtrThis(scope, &amp;*it, it-&gt;arg-&gt;link()-&gt;next(), it-&gt;arg-&gt;link()-&gt;next()-&gt;link(),</span>
<a name="1451"><font size=-1>1451     </font></a><span class="default">                                                   analyzedFunctions);</span>
<a name="1452"><font size=-1>1452     </font></a><span class="default">                            }</span>
<a name="1453"><font size=-1>1453     </font></a><span class="default">                            </span><span class="comment">// just bail for now</span>
<a name="1454"><font size=-1>1454     </font></a><span class="comment">                            </span><span class="keyword">else</span>
<a name="1455"><font size=-1>1455     </font></a><span class="keyword">                                return</span><span class="default">;</span>
<a name="1456"><font size=-1>1456     </font></a><span class="default">                        }</span>
<a name="1457"><font size=-1>1457     </font></a><span class="default">                    }</span>
<a name="1458"><font size=-1>1458     </font></a><span class="default">                }</span>
<a name="1459"><font size=-1>1459     </font></a><span class="default">            }</span>
<a name="1460"><font size=-1>1460     </font></a><span class="default">        }</span>
<a name="1461"><font size=-1>1461     </font></a><span class="default"></span>
<a name="1462"><font size=-1>1462     </font></a><span class="default">        </span><span class="comment">// check if *this is returned</span>
<a name="1463"><font size=-1>1463     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(!(Token::simpleMatch(tok-&gt;next(), </span><span class="string">&quot;operator= (&quot;</span><span class="default">) ||</span>
<a name="1464"><font size=-1>1464     </font></a><span class="default">                   Token::simpleMatch(tok-&gt;next(), </span><span class="string">&quot;this . operator= (&quot;</span><span class="default">) ||</span>
<a name="1465"><font size=-1>1465     </font></a><span class="default">                   (Token::Match(tok-&gt;next(), </span><span class="string">&quot;%type% :: operator= (&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1466"><font size=-1>1466     </font></a><span class="default">                    tok-&gt;next()-&gt;str() == scope-&gt;className)))</span>
<a name="1467"><font size=-1>1467     </font></a><span class="default">            operatorEqRetRefThisError(func-&gt;token);</span>
<a name="1468"><font size=-1>1468     </font></a><span class="default">    }</span>
<a name="1469"><font size=-1>1469     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(foundReturn) {</span>
<a name="1470"><font size=-1>1470     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1471"><font size=-1>1471     </font></a><span class="default">    }</span>
<a name="1472"><font size=-1>1472     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(startTok-&gt;next() == last) {</span>
<a name="1473"><font size=-1>1473     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(func-&gt;argDef, std::string(</span><span class="string">&quot;( const &quot; </span><span class="default">+ scope-&gt;className + </span><span class="string">&quot; &amp;&quot;</span><span class="default">).c_str())) {</span>
<a name="1474"><font size=-1>1474     </font></a><span class="default">            </span><span class="comment">// Typical wrong way to suppress default assignment operator by declaring it and leaving empty</span>
<a name="1475"><font size=-1>1475     </font></a><span class="comment">            </span><span class="default">operatorEqMissingReturnStatementError(func-&gt;token, func-&gt;access == AccessControl::Public);</span>
<a name="1476"><font size=-1>1476     </font></a><span class="default">        } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1477"><font size=-1>1477     </font></a><span class="default">            operatorEqMissingReturnStatementError(func-&gt;token, </span><span class="keyword">true</span><span class="default">);</span>
<a name="1478"><font size=-1>1478     </font></a><span class="default">        }</span>
<a name="1479"><font size=-1>1479     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1480"><font size=-1>1480     </font></a><span class="default">    }</span>
<a name="1481"><font size=-1>1481     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(mSettings-&gt;library.isScopeNoReturn(last, nullptr)) {</span>
<a name="1482"><font size=-1>1482     </font></a><span class="default">        </span><span class="comment">// Typical wrong way to prohibit default assignment operator</span>
<a name="1483"><font size=-1>1483     </font></a><span class="comment">        // by always throwing an exception or calling a noreturn function</span>
<a name="1484"><font size=-1>1484     </font></a><span class="comment">        </span><span class="default">operatorEqShouldBeLeftUnimplementedError(func-&gt;token);</span>
<a name="1485"><font size=-1>1485     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1486"><font size=-1>1486     </font></a><span class="default">    }</span>
<a name="1487"><font size=-1>1487     </font></a><span class="default"></span>
<a name="1488"><font size=-1>1488     </font></a><span class="default">    operatorEqMissingReturnStatementError(func-&gt;token, func-&gt;access == AccessControl::Public);</span>
<a name="1489"><font size=-1>1489     </font></a><span class="default">}</span>
<a name="1490"><font size=-1>1490     </font></a><span class="default"></span>
<a name="1491"><font size=-1>1491     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqRetRefThisError(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1492"><font size=-1>1492     </font></a><span class="default">{</span>
<a name="1493"><font size=-1>1493     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;operatorEqRetRefThis&quot;</span><span class="default">, </span><span class="string">&quot;'operator=' should return reference to 'this' instance.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1494"><font size=-1>1494     </font></a><span class="default">}</span>
<a name="1495"><font size=-1>1495     </font></a><span class="default"></span>
<a name="1496"><font size=-1>1496     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqShouldBeLeftUnimplementedError(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1497"><font size=-1>1497     </font></a><span class="default">{</span>
<a name="1498"><font size=-1>1498     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;operatorEqShouldBeLeftUnimplemented&quot;</span><span class="default">, </span><span class="string">&quot;'operator=' should either return reference to 'this' instance or be declared private and left unimplemented.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1499"><font size=-1>1499     </font></a><span class="default">}</span>
<a name="1500"><font size=-1>1500     </font></a><span class="default"></span>
<a name="1501"><font size=-1>1501     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqMissingReturnStatementError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">bool </span><span class="default">error)</span>
<a name="1502"><font size=-1>1502     </font></a><span class="default">{</span>
<a name="1503"><font size=-1>1503     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(error) {</span>
<a name="1504"><font size=-1>1504     </font></a><span class="default">        reportError(tok, Severity::error, </span><span class="string">&quot;operatorEqMissingReturnStatement&quot;</span><span class="default">, </span><span class="string">&quot;No 'return' statement in non-void function causes undefined behavior.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1505"><font size=-1>1505     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1506"><font size=-1>1506     </font></a><span class="default">        operatorEqRetRefThisError(tok);</span>
<a name="1507"><font size=-1>1507     </font></a><span class="default">    }</span>
<a name="1508"><font size=-1>1508     </font></a><span class="default">}</span>
<a name="1509"><font size=-1>1509     </font></a><span class="default"></span>
<a name="1510"><font size=-1>1510     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1511"><font size=-1>1511     </font></a><span class="comment">// ClassCheck: &quot;C&amp; operator=(const C&amp; rhs) { if (this == &amp;rhs) ... }&quot;</span>
<a name="1512"><font size=-1>1512     </font></a><span class="comment">// operator= should check for assignment to self</span>
<a name="1513"><font size=-1>1513     </font></a><span class="comment">//</span>
<a name="1514"><font size=-1>1514     </font></a><span class="comment">// For simple classes, an assignment to self check is only a potential optimization.</span>
<a name="1515"><font size=-1>1515     </font></a><span class="comment">//</span>
<a name="1516"><font size=-1>1516     </font></a><span class="comment">// For classes that allocate dynamic memory, assignment to self can be a real error</span>
<a name="1517"><font size=-1>1517     </font></a><span class="comment">// if it is deallocated and allocated again without being checked for.</span>
<a name="1518"><font size=-1>1518     </font></a><span class="comment">//</span>
<a name="1519"><font size=-1>1519     </font></a><span class="comment">// This check is not valid for classes with multiple inheritance because a</span>
<a name="1520"><font size=-1>1520     </font></a><span class="comment">// class can have multiple addresses so there is no trivial way to check for</span>
<a name="1521"><font size=-1>1521     </font></a><span class="comment">// assignment to self.</span>
<a name="1522"><font size=-1>1522     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1523"><font size=-1>1523     </font></a><span class="comment"></span>
<a name="1524"><font size=-1>1524     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqToSelf()</span>
<a name="1525"><font size=-1>1525     </font></a><span class="default">{</span>
<a name="1526"><font size=-1>1526     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="1527"><font size=-1>1527     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1528"><font size=-1>1528     </font></a><span class="default"></span>
<a name="1529"><font size=-1>1529     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1530"><font size=-1>1530     </font></a><span class="default">        </span><span class="comment">// skip classes with multiple inheritance</span>
<a name="1531"><font size=-1>1531     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(scope-&gt;definedType-&gt;derivedFrom.size() &gt; </span><span class="number">1</span><span class="default">)</span>
<a name="1532"><font size=-1>1532     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1533"><font size=-1>1533     </font></a><span class="default"></span>
<a name="1534"><font size=-1>1534     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="1535"><font size=-1>1535     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.type == Function::eOperatorEqual &amp;&amp; func.hasBody()) {</span>
<a name="1536"><font size=-1>1536     </font></a><span class="default">                </span><span class="comment">// make sure that the operator takes an object of the same type as *this, otherwise we can't detect self-assignment checks</span>
<a name="1537"><font size=-1>1537     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(func.argumentList.empty())</span>
<a name="1538"><font size=-1>1538     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1539"><font size=-1>1539     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token* typeTok = func.argumentList.front().typeEndToken();</span>
<a name="1540"><font size=-1>1540     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(typeTok-&gt;str() == </span><span class="string">&quot;const&quot; </span><span class="default">|| typeTok-&gt;str() == </span><span class="string">&quot;&amp;&quot; </span><span class="default">|| typeTok-&gt;str() == </span><span class="string">&quot;*&quot;</span><span class="default">)</span>
<a name="1541"><font size=-1>1541     </font></a><span class="default">                    typeTok = typeTok-&gt;previous();</span>
<a name="1542"><font size=-1>1542     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(typeTok-&gt;str() != scope-&gt;className)</span>
<a name="1543"><font size=-1>1543     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1544"><font size=-1>1544     </font></a><span class="default"></span>
<a name="1545"><font size=-1>1545     </font></a><span class="default">                </span><span class="comment">// make sure return signature is correct</span>
<a name="1546"><font size=-1>1546     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(Token::Match(func.retDef, </span><span class="string">&quot;%type% &amp;&quot;</span><span class="default">) &amp;&amp; func.retDef-&gt;str() == scope-&gt;className) {</span>
<a name="1547"><font size=-1>1547     </font></a><span class="default">                    </span><span class="comment">// find the parameter name</span>
<a name="1548"><font size=-1>1548     </font></a><span class="comment">                    </span><span class="keyword">const </span><span class="default">Token *rhs = func.argumentList.begin()-&gt;nameToken();</span>
<a name="1549"><font size=-1>1549     </font></a><span class="default"></span>
<a name="1550"><font size=-1>1550     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!hasAssignSelf(&amp;func, rhs)) {</span>
<a name="1551"><font size=-1>1551     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(hasAllocation(&amp;func, scope))</span>
<a name="1552"><font size=-1>1552     </font></a><span class="default">                            operatorEqToSelfError(func.token);</span>
<a name="1553"><font size=-1>1553     </font></a><span class="default">                    }</span>
<a name="1554"><font size=-1>1554     </font></a><span class="default">                }</span>
<a name="1555"><font size=-1>1555     </font></a><span class="default">            }</span>
<a name="1556"><font size=-1>1556     </font></a><span class="default">        }</span>
<a name="1557"><font size=-1>1557     </font></a><span class="default">    }</span>
<a name="1558"><font size=-1>1558     </font></a><span class="default">}</span>
<a name="1559"><font size=-1>1559     </font></a><span class="default"></span>
<a name="1560"><font size=-1>1560     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::hasAllocation(</span><span class="keyword">const </span><span class="default">Function *func, </span><span class="keyword">const </span><span class="default">Scope* scope) </span><span class="keyword">const</span>
<a name="1561"><font size=-1>1561     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="1562"><font size=-1>1562     </font></a><span class="default">    </span><span class="comment">// This function is called when no simple check was found for assignment</span>
<a name="1563"><font size=-1>1563     </font></a><span class="comment">    // to self.  We are currently looking for:</span>
<a name="1564"><font size=-1>1564     </font></a><span class="comment">    //    - deallocate member ; ... member =</span>
<a name="1565"><font size=-1>1565     </font></a><span class="comment">    //    - alloc member</span>
<a name="1566"><font size=-1>1566     </font></a><span class="comment">    // That is not ideal because it can cause false negatives but its currently</span>
<a name="1567"><font size=-1>1567     </font></a><span class="comment">    // necessary to prevent false positives.</span>
<a name="1568"><font size=-1>1568     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">Token *last = func-&gt;functionScope-&gt;bodyEnd;</span>
<a name="1569"><font size=-1>1569     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = func-&gt;functionScope-&gt;bodyStart; tok &amp;&amp; (tok != last); tok = tok-&gt;next()) {</span>
<a name="1570"><font size=-1>1570     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%var% = malloc|realloc|calloc|new&quot;</span><span class="default">) &amp;&amp; isMemberVar(scope, tok))</span>
<a name="1571"><font size=-1>1571     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1572"><font size=-1>1572     </font></a><span class="default"></span>
<a name="1573"><font size=-1>1573     </font></a><span class="default">        </span><span class="comment">// check for deallocating memory</span>
<a name="1574"><font size=-1>1574     </font></a><span class="comment">        </span><span class="keyword">const </span><span class="default">Token *var;</span>
<a name="1575"><font size=-1>1575     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;free ( %var%&quot;</span><span class="default">))</span>
<a name="1576"><font size=-1>1576     </font></a><span class="default">            var = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1577"><font size=-1>1577     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;delete [ ] %var%&quot;</span><span class="default">))</span>
<a name="1578"><font size=-1>1578     </font></a><span class="default">            var = tok-&gt;tokAt(</span><span class="number">3</span><span class="default">);</span>
<a name="1579"><font size=-1>1579     </font></a><span class="default">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;delete %var%&quot;</span><span class="default">))</span>
<a name="1580"><font size=-1>1580     </font></a><span class="default">            var = tok-&gt;next();</span>
<a name="1581"><font size=-1>1581     </font></a><span class="default">        </span><span class="keyword">else</span>
<a name="1582"><font size=-1>1582     </font></a><span class="keyword">            continue</span><span class="default">;</span>
<a name="1583"><font size=-1>1583     </font></a><span class="default">        </span><span class="comment">// Check for assignment to the deleted pointer (only if its a member of the class)</span>
<a name="1584"><font size=-1>1584     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(isMemberVar(scope, var)) {</span>
<a name="1585"><font size=-1>1585     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok1 = var-&gt;next(); tok1 &amp;&amp; (tok1 != last); tok1 = tok1-&gt;next()) {</span>
<a name="1586"><font size=-1>1586     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok1, </span><span class="string">&quot;%varid% =&quot;</span><span class="default">, var-&gt;varId()))</span>
<a name="1587"><font size=-1>1587     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1588"><font size=-1>1588     </font></a><span class="default">            }</span>
<a name="1589"><font size=-1>1589     </font></a><span class="default">        }</span>
<a name="1590"><font size=-1>1590     </font></a><span class="default">    }</span>
<a name="1591"><font size=-1>1591     </font></a><span class="default"></span>
<a name="1592"><font size=-1>1592     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1593"><font size=-1>1593     </font></a><span class="default">}</span>
<a name="1594"><font size=-1>1594     </font></a><span class="default"></span>
<a name="1595"><font size=-1>1595     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::hasAssignSelf(</span><span class="keyword">const </span><span class="default">Function *func, </span><span class="keyword">const </span><span class="default">Token *rhs)</span>
<a name="1596"><font size=-1>1596     </font></a><span class="default">{</span>
<a name="1597"><font size=-1>1597     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!rhs)</span>
<a name="1598"><font size=-1>1598     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1599"><font size=-1>1599     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *last = func-&gt;functionScope-&gt;bodyEnd;</span>
<a name="1600"><font size=-1>1600     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = func-&gt;functionScope-&gt;bodyStart; tok &amp;&amp; tok != last; tok = tok-&gt;next()) {</span>
<a name="1601"><font size=-1>1601     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!Token::simpleMatch(tok, </span><span class="string">&quot;if (&quot;</span><span class="default">))</span>
<a name="1602"><font size=-1>1602     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1603"><font size=-1>1603     </font></a><span class="default"></span>
<a name="1604"><font size=-1>1604     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">ret = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1605"><font size=-1>1605     </font></a><span class="default">        visitAstNodes(tok-&gt;next()-&gt;astOperand2(),</span>
<a name="1606"><font size=-1>1606     </font></a><span class="default">        [&amp;](</span><span class="keyword">const </span><span class="default">Token *tok2) {</span>
<a name="1607"><font size=-1>1607     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!Token::Match(tok2, </span><span class="string">&quot;==|!=&quot;</span><span class="default">))</span>
<a name="1608"><font size=-1>1608     </font></a><span class="default">                </span><span class="keyword">return </span><span class="default">ChildrenToVisit::op1_and_op2;</span>
<a name="1609"><font size=-1>1609     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok2-&gt;astOperand1(), </span><span class="string">&quot;this&quot;</span><span class="default">))</span>
<a name="1610"><font size=-1>1610     </font></a><span class="default">                tok2 = tok2-&gt;astOperand2();</span>
<a name="1611"><font size=-1>1611     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok2-&gt;astOperand2(), </span><span class="string">&quot;this&quot;</span><span class="default">))</span>
<a name="1612"><font size=-1>1612     </font></a><span class="default">                tok2 = tok2-&gt;astOperand1();</span>
<a name="1613"><font size=-1>1613     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="1614"><font size=-1>1614     </font></a><span class="keyword">                return </span><span class="default">ChildrenToVisit::op1_and_op2;</span>
<a name="1615"><font size=-1>1615     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok2 &amp;&amp; tok2-&gt;isUnaryOp(</span><span class="string">&quot;&amp;&quot;</span><span class="default">) &amp;&amp; tok2-&gt;astOperand1()-&gt;str() == rhs-&gt;str())</span>
<a name="1616"><font size=-1>1616     </font></a><span class="default">                ret = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1617"><font size=-1>1617     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">ret ? ChildrenToVisit::done : ChildrenToVisit::op1_and_op2;</span>
<a name="1618"><font size=-1>1618     </font></a><span class="default">        });</span>
<a name="1619"><font size=-1>1619     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(ret)</span>
<a name="1620"><font size=-1>1620     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">ret;</span>
<a name="1621"><font size=-1>1621     </font></a><span class="default">    }</span>
<a name="1622"><font size=-1>1622     </font></a><span class="default"></span>
<a name="1623"><font size=-1>1623     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1624"><font size=-1>1624     </font></a><span class="default">}</span>
<a name="1625"><font size=-1>1625     </font></a><span class="default"></span>
<a name="1626"><font size=-1>1626     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::operatorEqToSelfError(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1627"><font size=-1>1627     </font></a><span class="default">{</span>
<a name="1628"><font size=-1>1628     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;operatorEqToSelf&quot;</span><span class="default">,</span>
<a name="1629"><font size=-1>1629     </font></a><span class="default">                </span><span class="string">&quot;'operator=' should check for assignment to self to avoid problems with dynamic memory.\n&quot;</span>
<a name="1630"><font size=-1>1630     </font></a><span class="string">                &quot;'operator=' should check for assignment to self to ensure that each block of dynamically &quot;</span>
<a name="1631"><font size=-1>1631     </font></a><span class="string">                &quot;allocated memory is owned and managed by only one instance of the class.&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1632"><font size=-1>1632     </font></a><span class="default">}</span>
<a name="1633"><font size=-1>1633     </font></a><span class="default"></span>
<a name="1634"><font size=-1>1634     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1635"><font size=-1>1635     </font></a><span class="comment">// A destructor in a base class should be virtual</span>
<a name="1636"><font size=-1>1636     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1637"><font size=-1>1637     </font></a><span class="comment"></span>
<a name="1638"><font size=-1>1638     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::virtualDestructor()</span>
<a name="1639"><font size=-1>1639     </font></a><span class="default">{</span>
<a name="1640"><font size=-1>1640     </font></a><span class="default">    </span><span class="comment">// This error should only be given if:</span>
<a name="1641"><font size=-1>1641     </font></a><span class="comment">    // * base class doesn't have virtual destructor</span>
<a name="1642"><font size=-1>1642     </font></a><span class="comment">    // * derived class has non-empty destructor (only c++03, in c++11 it's UB see paragraph 3 in [expr.delete])</span>
<a name="1643"><font size=-1>1643     </font></a><span class="comment">    // * base class is deleted</span>
<a name="1644"><font size=-1>1644     </font></a><span class="comment">    // unless inconclusive in which case:</span>
<a name="1645"><font size=-1>1645     </font></a><span class="comment">    // * base class has virtual members but doesn't have virtual destructor</span>
<a name="1646"><font size=-1>1646     </font></a><span class="comment">    </span><span class="keyword">const bool </span><span class="default">printInconclusive = mSettings-&gt;inconclusive;</span>
<a name="1647"><font size=-1>1647     </font></a><span class="default"></span>
<a name="1648"><font size=-1>1648     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Function *&gt; inconclusiveErrors;</span>
<a name="1649"><font size=-1>1649     </font></a><span class="default"></span>
<a name="1650"><font size=-1>1650     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1651"><font size=-1>1651     </font></a><span class="default"></span>
<a name="1652"><font size=-1>1652     </font></a><span class="default">        </span><span class="comment">// Skip base classes (unless inconclusive)</span>
<a name="1653"><font size=-1>1653     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(scope-&gt;definedType-&gt;derivedFrom.empty()) {</span>
<a name="1654"><font size=-1>1654     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(printInconclusive) {</span>
<a name="1655"><font size=-1>1655     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Function *destructor = scope-&gt;getDestructor();</span>
<a name="1656"><font size=-1>1656     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(destructor &amp;&amp; !destructor-&gt;hasVirtualSpecifier()) {</span>
<a name="1657"><font size=-1>1657     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="1658"><font size=-1>1658     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(func.hasVirtualSpecifier()) {</span>
<a name="1659"><font size=-1>1659     </font></a><span class="default">                            inconclusiveErrors.push_back(destructor);</span>
<a name="1660"><font size=-1>1660     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1661"><font size=-1>1661     </font></a><span class="default">                        }</span>
<a name="1662"><font size=-1>1662     </font></a><span class="default">                    }</span>
<a name="1663"><font size=-1>1663     </font></a><span class="default">                }</span>
<a name="1664"><font size=-1>1664     </font></a><span class="default">            }</span>
<a name="1665"><font size=-1>1665     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1666"><font size=-1>1666     </font></a><span class="default">        }</span>
<a name="1667"><font size=-1>1667     </font></a><span class="default"></span>
<a name="1668"><font size=-1>1668     </font></a><span class="default">        </span><span class="comment">// Check if destructor is empty and non-empty ..</span>
<a name="1669"><font size=-1>1669     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(mSettings-&gt;standards.cpp &lt;= Standards::CPP03) {</span>
<a name="1670"><font size=-1>1670     </font></a><span class="default">            </span><span class="comment">// Find the destructor</span>
<a name="1671"><font size=-1>1671     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Function *destructor = scope-&gt;getDestructor();</span>
<a name="1672"><font size=-1>1672     </font></a><span class="default"></span>
<a name="1673"><font size=-1>1673     </font></a><span class="default">            </span><span class="comment">// Check for destructor with implementation</span>
<a name="1674"><font size=-1>1674     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!destructor || !destructor-&gt;hasBody())</span>
<a name="1675"><font size=-1>1675     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1676"><font size=-1>1676     </font></a><span class="default"></span>
<a name="1677"><font size=-1>1677     </font></a><span class="default">            </span><span class="comment">// Empty destructor</span>
<a name="1678"><font size=-1>1678     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(destructor-&gt;token-&gt;linkAt(</span><span class="number">3</span><span class="default">) == destructor-&gt;token-&gt;tokAt(</span><span class="number">4</span><span class="default">))</span>
<a name="1679"><font size=-1>1679     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1680"><font size=-1>1680     </font></a><span class="default">        }</span>
<a name="1681"><font size=-1>1681     </font></a><span class="default"></span>
<a name="1682"><font size=-1>1682     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *derived = scope-&gt;classDef;</span>
<a name="1683"><font size=-1>1683     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *derivedClass = derived-&gt;next();</span>
<a name="1684"><font size=-1>1684     </font></a><span class="default"></span>
<a name="1685"><font size=-1>1685     </font></a><span class="default">        </span><span class="comment">// Iterate through each base class...</span>
<a name="1686"><font size=-1>1686     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; j : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="1687"><font size=-1>1687     </font></a><span class="default">            </span><span class="comment">// Check if base class is public and exists in database</span>
<a name="1688"><font size=-1>1688     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(j.access != AccessControl::Private &amp;&amp; j.type) {</span>
<a name="1689"><font size=-1>1689     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Type *derivedFrom = j.type;</span>
<a name="1690"><font size=-1>1690     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Scope *derivedFromScope = derivedFrom-&gt;classScope;</span>
<a name="1691"><font size=-1>1691     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!derivedFromScope)</span>
<a name="1692"><font size=-1>1692     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1693"><font size=-1>1693     </font></a><span class="default"></span>
<a name="1694"><font size=-1>1694     </font></a><span class="default">                </span><span class="comment">// Check for this pattern:</span>
<a name="1695"><font size=-1>1695     </font></a><span class="comment">                // 1. Base class pointer is given the address of derived class instance</span>
<a name="1696"><font size=-1>1696     </font></a><span class="comment">                // 2. Base class pointer is deleted</span>
<a name="1697"><font size=-1>1697     </font></a><span class="comment">                //</span>
<a name="1698"><font size=-1>1698     </font></a><span class="comment">                // If this pattern is not seen then bailout the checking of these base/derived classes</span>
<a name="1699"><font size=-1>1699     </font></a><span class="comment">                </span><span class="default">{</span>
<a name="1700"><font size=-1>1700     </font></a><span class="default">                    </span><span class="comment">// pointer variables of type 'Base *'</span>
<a name="1701"><font size=-1>1701     </font></a><span class="comment">                    </span><span class="default">std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; baseClassPointers;</span>
<a name="1702"><font size=-1>1702     </font></a><span class="default"></span>
<a name="1703"><font size=-1>1703     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable* var : mSymbolDatabase-&gt;variableList()) {</span>
<a name="1704"><font size=-1>1704     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;isPointer() &amp;&amp; var-&gt;type() == derivedFrom)</span>
<a name="1705"><font size=-1>1705     </font></a><span class="default">                            baseClassPointers.insert(var-&gt;declarationId());</span>
<a name="1706"><font size=-1>1706     </font></a><span class="default">                    }</span>
<a name="1707"><font size=-1>1707     </font></a><span class="default"></span>
<a name="1708"><font size=-1>1708     </font></a><span class="default">                    </span><span class="comment">// pointer variables of type 'Base *' that should not be deleted</span>
<a name="1709"><font size=-1>1709     </font></a><span class="comment">                    </span><span class="default">std::set&lt;</span><span class="keyword">int</span><span class="default">&gt; dontDelete;</span>
<a name="1710"><font size=-1>1710     </font></a><span class="default"></span>
<a name="1711"><font size=-1>1711     </font></a><span class="default">                    </span><span class="comment">// No deletion of derived class instance through base class pointer found =&gt; the code is ok</span>
<a name="1712"><font size=-1>1712     </font></a><span class="comment">                    </span><span class="keyword">bool </span><span class="default">ok = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1713"><font size=-1>1713     </font></a><span class="default"></span>
<a name="1714"><font size=-1>1714     </font></a><span class="default">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = mTokenizer-&gt;tokens(); tok; tok = tok-&gt;next()) {</span>
<a name="1715"><font size=-1>1715     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[;{}] %var% =&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1716"><font size=-1>1716     </font></a><span class="default">                            baseClassPointers.find(tok-&gt;next()-&gt;varId()) != baseClassPointers.end()) {</span>
<a name="1717"><font size=-1>1717     </font></a><span class="default">                            </span><span class="comment">// new derived class..</span>
<a name="1718"><font size=-1>1718     </font></a><span class="comment">                            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(tok-&gt;tokAt(</span><span class="number">3</span><span class="default">), (</span><span class="string">&quot;new &quot; </span><span class="default">+ derivedClass-&gt;str()).c_str())) {</span>
<a name="1719"><font size=-1>1719     </font></a><span class="default">                                dontDelete.insert(tok-&gt;next()-&gt;varId());</span>
<a name="1720"><font size=-1>1720     </font></a><span class="default">                            }</span>
<a name="1721"><font size=-1>1721     </font></a><span class="default">                        }</span>
<a name="1722"><font size=-1>1722     </font></a><span class="default"></span>
<a name="1723"><font size=-1>1723     </font></a><span class="default">                        </span><span class="comment">// Delete base class pointer that might point at derived class</span>
<a name="1724"><font size=-1>1724     </font></a><span class="comment">                        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;delete %var% ;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="1725"><font size=-1>1725     </font></a><span class="default">                                 dontDelete.find(tok-&gt;next()-&gt;varId()) != dontDelete.end()) {</span>
<a name="1726"><font size=-1>1726     </font></a><span class="default">                            ok = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1727"><font size=-1>1727     </font></a><span class="default">                            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1728"><font size=-1>1728     </font></a><span class="default">                        }</span>
<a name="1729"><font size=-1>1729     </font></a><span class="default">                    }</span>
<a name="1730"><font size=-1>1730     </font></a><span class="default"></span>
<a name="1731"><font size=-1>1731     </font></a><span class="default">                    </span><span class="comment">// No base class pointer that points at a derived class is deleted</span>
<a name="1732"><font size=-1>1732     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(ok)</span>
<a name="1733"><font size=-1>1733     </font></a><span class="default">                        </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1734"><font size=-1>1734     </font></a><span class="default">                }</span>
<a name="1735"><font size=-1>1735     </font></a><span class="default"></span>
<a name="1736"><font size=-1>1736     </font></a><span class="default">                </span><span class="comment">// Find the destructor declaration for the base class.</span>
<a name="1737"><font size=-1>1737     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">Function *baseDestructor = derivedFromScope-&gt;getDestructor();</span>
<a name="1738"><font size=-1>1738     </font></a><span class="default"></span>
<a name="1739"><font size=-1>1739     </font></a><span class="default">                </span><span class="comment">// Check that there is a destructor..</span>
<a name="1740"><font size=-1>1740     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(!baseDestructor) {</span>
<a name="1741"><font size=-1>1741     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(derivedFrom-&gt;derivedFrom.empty()) {</span>
<a name="1742"><font size=-1>1742     </font></a><span class="default">                        virtualDestructorError(derivedFrom-&gt;classDef, derivedFrom-&gt;name(), derivedClass-&gt;str(), </span><span class="keyword">false</span><span class="default">);</span>
<a name="1743"><font size=-1>1743     </font></a><span class="default">                    }</span>
<a name="1744"><font size=-1>1744     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(!baseDestructor-&gt;hasVirtualSpecifier()) {</span>
<a name="1745"><font size=-1>1745     </font></a><span class="default">                    </span><span class="comment">// TODO: This is just a temporary fix, better solution is needed.</span>
<a name="1746"><font size=-1>1746     </font></a><span class="comment">                    // Skip situations where base class has base classes of its own, because</span>
<a name="1747"><font size=-1>1747     </font></a><span class="comment">                    // some of the base classes might have virtual destructor.</span>
<a name="1748"><font size=-1>1748     </font></a><span class="comment">                    // Proper solution is to check all of the base classes. If base class is not</span>
<a name="1749"><font size=-1>1749     </font></a><span class="comment">                    // found or if one of the base classes has virtual destructor, error should not</span>
<a name="1750"><font size=-1>1750     </font></a><span class="comment">                    // be printed. See TODO test case &quot;virtualDestructorInherited&quot;</span>
<a name="1751"><font size=-1>1751     </font></a><span class="comment">                    </span><span class="keyword">if </span><span class="default">(derivedFrom-&gt;derivedFrom.empty()) {</span>
<a name="1752"><font size=-1>1752     </font></a><span class="default">                        </span><span class="comment">// Make sure that the destructor is public (protected or private</span>
<a name="1753"><font size=-1>1753     </font></a><span class="comment">                        // would not compile if inheritance is used in a way that would</span>
<a name="1754"><font size=-1>1754     </font></a><span class="comment">                        // cause the bug we are trying to find here.)</span>
<a name="1755"><font size=-1>1755     </font></a><span class="comment">                        </span><span class="keyword">if </span><span class="default">(baseDestructor-&gt;access == AccessControl::Public) {</span>
<a name="1756"><font size=-1>1756     </font></a><span class="default">                            virtualDestructorError(baseDestructor-&gt;token, derivedFrom-&gt;name(), derivedClass-&gt;str(), </span><span class="keyword">false</span><span class="default">);</span>
<a name="1757"><font size=-1>1757     </font></a><span class="default">                            </span><span class="comment">// check for duplicate error and remove it if found</span>
<a name="1758"><font size=-1>1758     </font></a><span class="comment">                            </span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Function *&gt;::iterator found = find(inconclusiveErrors.begin(), inconclusiveErrors.end(), baseDestructor);</span>
<a name="1759"><font size=-1>1759     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(found != inconclusiveErrors.end())</span>
<a name="1760"><font size=-1>1760     </font></a><span class="default">                                inconclusiveErrors.erase(found);</span>
<a name="1761"><font size=-1>1761     </font></a><span class="default">                        }</span>
<a name="1762"><font size=-1>1762     </font></a><span class="default">                    }</span>
<a name="1763"><font size=-1>1763     </font></a><span class="default">                }</span>
<a name="1764"><font size=-1>1764     </font></a><span class="default">            }</span>
<a name="1765"><font size=-1>1765     </font></a><span class="default">        }</span>
<a name="1766"><font size=-1>1766     </font></a><span class="default">    }</span>
<a name="1767"><font size=-1>1767     </font></a><span class="default"></span>
<a name="1768"><font size=-1>1768     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function *func : inconclusiveErrors)</span>
<a name="1769"><font size=-1>1769     </font></a><span class="default">        virtualDestructorError(func-&gt;tokenDef, func-&gt;name(), emptyString, </span><span class="keyword">true</span><span class="default">);</span>
<a name="1770"><font size=-1>1770     </font></a><span class="default">}</span>
<a name="1771"><font size=-1>1771     </font></a><span class="default"></span>
<a name="1772"><font size=-1>1772     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::virtualDestructorError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;Base, </span><span class="keyword">const </span><span class="default">std::string &amp;Derived, </span><span class="keyword">bool </span><span class="default">inconclusive)</span>
<a name="1773"><font size=-1>1773     </font></a><span class="default">{</span>
<a name="1774"><font size=-1>1774     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(inconclusive) {</span>
<a name="1775"><font size=-1>1775     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="1776"><font size=-1>1776     </font></a><span class="default">            reportError(tok, Severity::warning, </span><span class="string">&quot;virtualDestructor&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ Base + </span><span class="string">&quot;\nClass '$symbol' which has virtual members does not have a virtual destructor.&quot;</span><span class="default">, CWE404, </span><span class="keyword">true</span><span class="default">);</span>
<a name="1777"><font size=-1>1777     </font></a><span class="default">    } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1778"><font size=-1>1778     </font></a><span class="default">        reportError(tok, Severity::error, </span><span class="string">&quot;virtualDestructor&quot;</span><span class="default">,</span>
<a name="1779"><font size=-1>1779     </font></a><span class="default">                    </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ Base +</span><span class="string">&quot;\n&quot;</span>
<a name="1780"><font size=-1>1780     </font></a><span class="string">                    &quot;$symbol:&quot; </span><span class="default">+ Derived +</span><span class="string">&quot;\n&quot;</span>
<a name="1781"><font size=-1>1781     </font></a><span class="string">                    &quot;Class '&quot; </span><span class="default">+ Base + </span><span class="string">&quot;' which is inherited by class '&quot; </span><span class="default">+ Derived + </span><span class="string">&quot;' does not have a virtual destructor.\n&quot;</span>
<a name="1782"><font size=-1>1782     </font></a><span class="string">                    &quot;Class '&quot; </span><span class="default">+ Base + </span><span class="string">&quot;' which is inherited by class '&quot; </span><span class="default">+ Derived + </span><span class="string">&quot;' does not have a virtual destructor. &quot;</span>
<a name="1783"><font size=-1>1783     </font></a><span class="string">                    &quot;If you destroy instances of the derived class by deleting a pointer that points to the base class, only &quot;</span>
<a name="1784"><font size=-1>1784     </font></a><span class="string">                    &quot;the destructor of the base class is executed. Thus, dynamic memory that is managed by the derived class &quot;</span>
<a name="1785"><font size=-1>1785     </font></a><span class="string">                    &quot;could leak. This can be avoided by adding a virtual destructor to the base class.&quot;</span><span class="default">, CWE404, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1786"><font size=-1>1786     </font></a><span class="default">    }</span>
<a name="1787"><font size=-1>1787     </font></a><span class="default">}</span>
<a name="1788"><font size=-1>1788     </font></a><span class="default"></span>
<a name="1789"><font size=-1>1789     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1790"><font size=-1>1790     </font></a><span class="comment">// warn for &quot;this-x&quot;. The indented code may be &quot;this-&gt;x&quot;</span>
<a name="1791"><font size=-1>1791     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1792"><font size=-1>1792     </font></a><span class="comment"></span>
<a name="1793"><font size=-1>1793     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::thisSubtraction()</span>
<a name="1794"><font size=-1>1794     </font></a><span class="default">{</span>
<a name="1795"><font size=-1>1795     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="1796"><font size=-1>1796     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1797"><font size=-1>1797     </font></a><span class="default"></span>
<a name="1798"><font size=-1>1798     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token *tok = mTokenizer-&gt;tokens();</span>
<a name="1799"><font size=-1>1799     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(;;) {</span>
<a name="1800"><font size=-1>1800     </font></a><span class="default">        tok = Token::findmatch(tok, </span><span class="string">&quot;this - %name%&quot;</span><span class="default">);</span>
<a name="1801"><font size=-1>1801     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!tok)</span>
<a name="1802"><font size=-1>1802     </font></a><span class="default">            </span><span class="keyword">break</span><span class="default">;</span>
<a name="1803"><font size=-1>1803     </font></a><span class="default"></span>
<a name="1804"><font size=-1>1804     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;strAt(-</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;*&quot;</span><span class="default">)</span>
<a name="1805"><font size=-1>1805     </font></a><span class="default">            thisSubtractionError(tok);</span>
<a name="1806"><font size=-1>1806     </font></a><span class="default"></span>
<a name="1807"><font size=-1>1807     </font></a><span class="default">        tok = tok-&gt;next();</span>
<a name="1808"><font size=-1>1808     </font></a><span class="default">    }</span>
<a name="1809"><font size=-1>1809     </font></a><span class="default">}</span>
<a name="1810"><font size=-1>1810     </font></a><span class="default"></span>
<a name="1811"><font size=-1>1811     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::thisSubtractionError(</span><span class="keyword">const </span><span class="default">Token *tok)</span>
<a name="1812"><font size=-1>1812     </font></a><span class="default">{</span>
<a name="1813"><font size=-1>1813     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;thisSubtraction&quot;</span><span class="default">, </span><span class="string">&quot;Suspicious pointer subtraction. Did you intend to write '-&gt;'?&quot;</span><span class="default">, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="1814"><font size=-1>1814     </font></a><span class="default">}</span>
<a name="1815"><font size=-1>1815     </font></a><span class="default"></span>
<a name="1816"><font size=-1>1816     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1817"><font size=-1>1817     </font></a><span class="comment">// can member function be const?</span>
<a name="1818"><font size=-1>1818     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="1819"><font size=-1>1819     </font></a><span class="comment"></span>
<a name="1820"><font size=-1>1820     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::checkConst()</span>
<a name="1821"><font size=-1>1821     </font></a><span class="default">{</span>
<a name="1822"><font size=-1>1822     </font></a><span class="default">    </span><span class="comment">// This is an inconclusive check. False positives: #3322.</span>
<a name="1823"><font size=-1>1823     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;inconclusive)</span>
<a name="1824"><font size=-1>1824     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1825"><font size=-1>1825     </font></a><span class="default"></span>
<a name="1826"><font size=-1>1826     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="1827"><font size=-1>1827     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="1828"><font size=-1>1828     </font></a><span class="default"></span>
<a name="1829"><font size=-1>1829     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="1830"><font size=-1>1830     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="1831"><font size=-1>1831     </font></a><span class="default">            </span><span class="comment">// does the function have a body?</span>
<a name="1832"><font size=-1>1832     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(func.type != Function::eFunction || !func.hasBody())</span>
<a name="1833"><font size=-1>1833     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1834"><font size=-1>1834     </font></a><span class="default">            </span><span class="comment">// don't warn for friend/static/virtual functions</span>
<a name="1835"><font size=-1>1835     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(func.isFriend() || func.isStatic() || func.hasVirtualSpecifier())</span>
<a name="1836"><font size=-1>1836     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1837"><font size=-1>1837     </font></a><span class="default">            </span><span class="comment">// get last token of return type</span>
<a name="1838"><font size=-1>1838     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token *previous = func.tokenDef-&gt;previous();</span>
<a name="1839"><font size=-1>1839     </font></a><span class="default"></span>
<a name="1840"><font size=-1>1840     </font></a><span class="default">            </span><span class="comment">// does the function return a pointer or reference?</span>
<a name="1841"><font size=-1>1841     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(Token::Match(previous, </span><span class="string">&quot;*|&amp;&quot;</span><span class="default">)) {</span>
<a name="1842"><font size=-1>1842     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(func.retDef-&gt;str() != </span><span class="string">&quot;const&quot;</span><span class="default">)</span>
<a name="1843"><font size=-1>1843     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1844"><font size=-1>1844     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(Token::Match(previous-&gt;previous(), </span><span class="string">&quot;*|&amp; &gt;&quot;</span><span class="default">)) {</span>
<a name="1845"><font size=-1>1845     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token *temp = previous-&gt;previous();</span>
<a name="1846"><font size=-1>1846     </font></a><span class="default"></span>
<a name="1847"><font size=-1>1847     </font></a><span class="default">                </span><span class="keyword">bool </span><span class="default">foundConst = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1848"><font size=-1>1848     </font></a><span class="default">                </span><span class="keyword">while </span><span class="default">(!Token::Match(temp-&gt;previous(), </span><span class="string">&quot;;|}|{|public:|protected:|private:&quot;</span><span class="default">)) {</span>
<a name="1849"><font size=-1>1849     </font></a><span class="default">                    temp = temp-&gt;previous();</span>
<a name="1850"><font size=-1>1850     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(temp-&gt;str() == </span><span class="string">&quot;const&quot;</span><span class="default">) {</span>
<a name="1851"><font size=-1>1851     </font></a><span class="default">                        foundConst = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1852"><font size=-1>1852     </font></a><span class="default">                        </span><span class="keyword">break</span><span class="default">;</span>
<a name="1853"><font size=-1>1853     </font></a><span class="default">                    }</span>
<a name="1854"><font size=-1>1854     </font></a><span class="default">                }</span>
<a name="1855"><font size=-1>1855     </font></a><span class="default"></span>
<a name="1856"><font size=-1>1856     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!foundConst)</span>
<a name="1857"><font size=-1>1857     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1858"><font size=-1>1858     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(func.isOperator() &amp;&amp; Token::Match(previous, </span><span class="string">&quot;;|{|}|public:|private:|protected:&quot;</span><span class="default">)) { </span><span class="comment">// Operator without return type: conversion operator</span>
<a name="1859"><font size=-1>1859     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">std::string&amp; opName = func.tokenDef-&gt;str();</span>
<a name="1860"><font size=-1>1860     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(opName.compare(</span><span class="number">8</span><span class="default">, </span><span class="number">5</span><span class="default">, </span><span class="string">&quot;const&quot;</span><span class="default">) != </span><span class="number">0 </span><span class="default">&amp;&amp; (endsWith(opName,</span><span class="string">'&amp;'</span><span class="default">) || endsWith(opName,</span><span class="string">'*'</span><span class="default">)))</span>
<a name="1861"><font size=-1>1861     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1862"><font size=-1>1862     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(mSettings-&gt;library.isSmartPointer(func.retDef)) {</span>
<a name="1863"><font size=-1>1863     </font></a><span class="default">                </span><span class="comment">// Don't warn if a std::shared_ptr etc is returned</span>
<a name="1864"><font size=-1>1864     </font></a><span class="comment">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1865"><font size=-1>1865     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="1866"><font size=-1>1866     </font></a><span class="default">                </span><span class="comment">// don't warn for unknown types..</span>
<a name="1867"><font size=-1>1867     </font></a><span class="comment">                // LPVOID, HDC, etc</span>
<a name="1868"><font size=-1>1868     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(previous-&gt;str().size() &gt; </span><span class="number">2 </span><span class="default">&amp;&amp; !previous-&gt;type() &amp;&amp; previous-&gt;isUpperCaseName())</span>
<a name="1869"><font size=-1>1869     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1870"><font size=-1>1870     </font></a><span class="default">            }</span>
<a name="1871"><font size=-1>1871     </font></a><span class="default"></span>
<a name="1872"><font size=-1>1872     </font></a><span class="default">            </span><span class="comment">// check if base class function is virtual</span>
<a name="1873"><font size=-1>1873     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;derivedFrom.empty() &amp;&amp; func.isImplicitlyVirtual(</span><span class="keyword">true</span><span class="default">))</span>
<a name="1874"><font size=-1>1874     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1875"><font size=-1>1875     </font></a><span class="default"></span>
<a name="1876"><font size=-1>1876     </font></a><span class="default">            </span><span class="keyword">bool </span><span class="default">memberAccessed = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1877"><font size=-1>1877     </font></a><span class="default">            </span><span class="comment">// if nothing non-const was found. write error..</span>
<a name="1878"><font size=-1>1878     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!checkConstFunc(scope, &amp;func, memberAccessed))</span>
<a name="1879"><font size=-1>1879     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1880"><font size=-1>1880     </font></a><span class="default"></span>
<a name="1881"><font size=-1>1881     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.isConst() &amp;&amp; (memberAccessed || func.isOperator()))</span>
<a name="1882"><font size=-1>1882     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="1883"><font size=-1>1883     </font></a><span class="default"></span>
<a name="1884"><font size=-1>1884     </font></a><span class="default">            std::string classname = scope-&gt;className;</span>
<a name="1885"><font size=-1>1885     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Scope *nest = scope-&gt;nestedIn;</span>
<a name="1886"><font size=-1>1886     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(nest &amp;&amp; nest-&gt;type != Scope::eGlobal) {</span>
<a name="1887"><font size=-1>1887     </font></a><span class="default">                classname = std::string(nest-&gt;className + </span><span class="string">&quot;::&quot; </span><span class="default">+ classname);</span>
<a name="1888"><font size=-1>1888     </font></a><span class="default">                nest = nest-&gt;nestedIn;</span>
<a name="1889"><font size=-1>1889     </font></a><span class="default">            }</span>
<a name="1890"><font size=-1>1890     </font></a><span class="default"></span>
<a name="1891"><font size=-1>1891     </font></a><span class="default">            </span><span class="comment">// get function name</span>
<a name="1892"><font size=-1>1892     </font></a><span class="comment">            </span><span class="default">std::string functionName = (func.tokenDef-&gt;isName() ? </span><span class="string">&quot;&quot; </span><span class="default">: </span><span class="string">&quot;operator&quot;</span><span class="default">) + func.tokenDef-&gt;str();</span>
<a name="1893"><font size=-1>1893     </font></a><span class="default"></span>
<a name="1894"><font size=-1>1894     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.tokenDef-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="1895"><font size=-1>1895     </font></a><span class="default">                functionName += </span><span class="string">&quot;)&quot;</span><span class="default">;</span>
<a name="1896"><font size=-1>1896     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(func.tokenDef-&gt;str() == </span><span class="string">&quot;[&quot;</span><span class="default">)</span>
<a name="1897"><font size=-1>1897     </font></a><span class="default">                functionName += </span><span class="string">&quot;]&quot;</span><span class="default">;</span>
<a name="1898"><font size=-1>1898     </font></a><span class="default"></span>
<a name="1899"><font size=-1>1899     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.isInline())</span>
<a name="1900"><font size=-1>1900     </font></a><span class="default">                checkConstError(func.token, classname, functionName, !memberAccessed &amp;&amp; !func.isOperator());</span>
<a name="1901"><font size=-1>1901     </font></a><span class="default">            </span><span class="keyword">else </span><span class="comment">// not inline</span>
<a name="1902"><font size=-1>1902     </font></a><span class="comment">                </span><span class="default">checkConstError2(func.token, func.tokenDef, classname, functionName, !memberAccessed &amp;&amp; !func.isOperator());</span>
<a name="1903"><font size=-1>1903     </font></a><span class="default">        }</span>
<a name="1904"><font size=-1>1904     </font></a><span class="default">    }</span>
<a name="1905"><font size=-1>1905     </font></a><span class="default">}</span>
<a name="1906"><font size=-1>1906     </font></a><span class="default"></span>
<a name="1907"><font size=-1>1907     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::isMemberVar(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Token *tok) </span><span class="keyword">const</span>
<a name="1908"><font size=-1>1908     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="1909"><font size=-1>1909     </font></a><span class="default">    </span><span class="keyword">bool </span><span class="default">again = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1910"><font size=-1>1910     </font></a><span class="default"></span>
<a name="1911"><font size=-1>1911     </font></a><span class="default">    </span><span class="comment">// try to find the member variable</span>
<a name="1912"><font size=-1>1912     </font></a><span class="comment">    </span><span class="keyword">do </span><span class="default">{</span>
<a name="1913"><font size=-1>1913     </font></a><span class="default">        again = </span><span class="keyword">false</span><span class="default">;</span>
<a name="1914"><font size=-1>1914     </font></a><span class="default"></span>
<a name="1915"><font size=-1>1915     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;this&quot;</span><span class="default">) {</span>
<a name="1916"><font size=-1>1916     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1917"><font size=-1>1917     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok-&gt;tokAt(-</span><span class="number">3</span><span class="default">), </span><span class="string">&quot;( * this )&quot;</span><span class="default">)) {</span>
<a name="1918"><font size=-1>1918     </font></a><span class="default">            </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1919"><font size=-1>1919     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;%name% . %name%&quot;</span><span class="default">)) {</span>
<a name="1920"><font size=-1>1920     </font></a><span class="default">            tok = tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">);</span>
<a name="1921"><font size=-1>1921     </font></a><span class="default">            again = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1922"><font size=-1>1922     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::Match(tok-&gt;tokAt(-</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;] . %name%&quot;</span><span class="default">)) {</span>
<a name="1923"><font size=-1>1923     </font></a><span class="default">            tok = tok-&gt;linkAt(-</span><span class="number">2</span><span class="default">)-&gt;previous();</span>
<a name="1924"><font size=-1>1924     </font></a><span class="default">            again = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1925"><font size=-1>1925     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;]&quot;</span><span class="default">) {</span>
<a name="1926"><font size=-1>1926     </font></a><span class="default">            tok = tok-&gt;link()-&gt;previous();</span>
<a name="1927"><font size=-1>1927     </font></a><span class="default">            again = </span><span class="keyword">true</span><span class="default">;</span>
<a name="1928"><font size=-1>1928     </font></a><span class="default">        }</span>
<a name="1929"><font size=-1>1929     </font></a><span class="default">    } </span><span class="keyword">while </span><span class="default">(again);</span>
<a name="1930"><font size=-1>1930     </font></a><span class="default"></span>
<a name="1931"><font size=-1>1931     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;var : scope-&gt;varlist) {</span>
<a name="1932"><font size=-1>1932     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(var.name() == tok-&gt;str()) {</span>
<a name="1933"><font size=-1>1933     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;varId() == </span><span class="number">0</span><span class="default">)</span>
<a name="1934"><font size=-1>1934     </font></a><span class="default">                mSymbolDatabase-&gt;debugMessage(tok, </span><span class="string">&quot;CheckClass::isMemberVar found used member variable \'&quot; </span><span class="default">+ tok-&gt;str() + </span><span class="string">&quot;\' with varid 0&quot;</span><span class="default">);</span>
<a name="1935"><font size=-1>1935     </font></a><span class="default"></span>
<a name="1936"><font size=-1>1936     </font></a><span class="default">            </span><span class="keyword">return </span><span class="default">!var.isStatic();</span>
<a name="1937"><font size=-1>1937     </font></a><span class="default">        }</span>
<a name="1938"><font size=-1>1938     </font></a><span class="default">    }</span>
<a name="1939"><font size=-1>1939     </font></a><span class="default"></span>
<a name="1940"><font size=-1>1940     </font></a><span class="default">    </span><span class="comment">// not found in this class</span>
<a name="1941"><font size=-1>1941     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;derivedFrom.empty()) {</span>
<a name="1942"><font size=-1>1942     </font></a><span class="default">        </span><span class="comment">// check each base class</span>
<a name="1943"><font size=-1>1943     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; i : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="1944"><font size=-1>1944     </font></a><span class="default">            </span><span class="comment">// find the base class</span>
<a name="1945"><font size=-1>1945     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Type *derivedFrom = i.type;</span>
<a name="1946"><font size=-1>1946     </font></a><span class="default"></span>
<a name="1947"><font size=-1>1947     </font></a><span class="default">            </span><span class="comment">// find the function in the base class</span>
<a name="1948"><font size=-1>1948     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(derivedFrom &amp;&amp; derivedFrom-&gt;classScope) {</span>
<a name="1949"><font size=-1>1949     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isMemberVar(derivedFrom-&gt;classScope, tok))</span>
<a name="1950"><font size=-1>1950     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1951"><font size=-1>1951     </font></a><span class="default">            }</span>
<a name="1952"><font size=-1>1952     </font></a><span class="default">        }</span>
<a name="1953"><font size=-1>1953     </font></a><span class="default">    }</span>
<a name="1954"><font size=-1>1954     </font></a><span class="default"></span>
<a name="1955"><font size=-1>1955     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1956"><font size=-1>1956     </font></a><span class="default">}</span>
<a name="1957"><font size=-1>1957     </font></a><span class="default"></span>
<a name="1958"><font size=-1>1958     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::isMemberFunc(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Token *tok) </span><span class="keyword">const</span>
<a name="1959"><font size=-1>1959     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="1960"><font size=-1>1960     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;function()) {</span>
<a name="1961"><font size=-1>1961     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="1962"><font size=-1>1962     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.name() == tok-&gt;str()) {</span>
<a name="1963"><font size=-1>1963     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Token* tok2 = tok-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="1964"><font size=-1>1964     </font></a><span class="default">                </span><span class="keyword">int </span><span class="default">argsPassed = tok2-&gt;str() == </span><span class="string">&quot;)&quot; </span><span class="default">? </span><span class="number">0 </span><span class="default">: </span><span class="number">1</span><span class="default">;</span>
<a name="1965"><font size=-1>1965     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(;;) {</span>
<a name="1966"><font size=-1>1966     </font></a><span class="default">                    tok2 = tok2-&gt;nextArgument();</span>
<a name="1967"><font size=-1>1967     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(tok2)</span>
<a name="1968"><font size=-1>1968     </font></a><span class="default">                        argsPassed++;</span>
<a name="1969"><font size=-1>1969     </font></a><span class="default">                    </span><span class="keyword">else</span>
<a name="1970"><font size=-1>1970     </font></a><span class="keyword">                        break</span><span class="default">;</span>
<a name="1971"><font size=-1>1971     </font></a><span class="default">                }</span>
<a name="1972"><font size=-1>1972     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(argsPassed == func.argCount() || (argsPassed &lt; func.argCount() &amp;&amp; argsPassed &gt;= func.minArgCount()))</span>
<a name="1973"><font size=-1>1973     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1974"><font size=-1>1974     </font></a><span class="default">            }</span>
<a name="1975"><font size=-1>1975     </font></a><span class="default">        }</span>
<a name="1976"><font size=-1>1976     </font></a><span class="default">    } </span><span class="keyword">else if </span><span class="default">(tok-&gt;function()-&gt;nestedIn == scope)</span>
<a name="1977"><font size=-1>1977     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">!tok-&gt;function()-&gt;isStatic();</span>
<a name="1978"><font size=-1>1978     </font></a><span class="default"></span>
<a name="1979"><font size=-1>1979     </font></a><span class="default">    </span><span class="comment">// not found in this class</span>
<a name="1980"><font size=-1>1980     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;derivedFrom.empty()) {</span>
<a name="1981"><font size=-1>1981     </font></a><span class="default">        </span><span class="comment">// check each base class</span>
<a name="1982"><font size=-1>1982     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; i : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="1983"><font size=-1>1983     </font></a><span class="default">            </span><span class="comment">// find the base class</span>
<a name="1984"><font size=-1>1984     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Type *derivedFrom = i.type;</span>
<a name="1985"><font size=-1>1985     </font></a><span class="default"></span>
<a name="1986"><font size=-1>1986     </font></a><span class="default">            </span><span class="comment">// find the function in the base class</span>
<a name="1987"><font size=-1>1987     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(derivedFrom &amp;&amp; derivedFrom-&gt;classScope) {</span>
<a name="1988"><font size=-1>1988     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isMemberFunc(derivedFrom-&gt;classScope, tok))</span>
<a name="1989"><font size=-1>1989     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="1990"><font size=-1>1990     </font></a><span class="default">            }</span>
<a name="1991"><font size=-1>1991     </font></a><span class="default">        }</span>
<a name="1992"><font size=-1>1992     </font></a><span class="default">    }</span>
<a name="1993"><font size=-1>1993     </font></a><span class="default"></span>
<a name="1994"><font size=-1>1994     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="1995"><font size=-1>1995     </font></a><span class="default">}</span>
<a name="1996"><font size=-1>1996     </font></a><span class="default"></span>
<a name="1997"><font size=-1>1997     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::isConstMemberFunc(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Token *tok) </span><span class="keyword">const</span>
<a name="1998"><font size=-1>1998     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="1999"><font size=-1>1999     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!tok-&gt;function())</span>
<a name="2000"><font size=-1>2000     </font></a><span class="default">        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2001"><font size=-1>2001     </font></a><span class="default">    </span><span class="keyword">else if </span><span class="default">(tok-&gt;function()-&gt;nestedIn == scope)</span>
<a name="2002"><font size=-1>2002     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">tok-&gt;function()-&gt;isConst();</span>
<a name="2003"><font size=-1>2003     </font></a><span class="default"></span>
<a name="2004"><font size=-1>2004     </font></a><span class="default">    </span><span class="comment">// not found in this class</span>
<a name="2005"><font size=-1>2005     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!scope-&gt;definedType-&gt;derivedFrom.empty()) {</span>
<a name="2006"><font size=-1>2006     </font></a><span class="default">        </span><span class="comment">// check each base class</span>
<a name="2007"><font size=-1>2007     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp; i : scope-&gt;definedType-&gt;derivedFrom) {</span>
<a name="2008"><font size=-1>2008     </font></a><span class="default">            </span><span class="comment">// find the base class</span>
<a name="2009"><font size=-1>2009     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Type *derivedFrom = i.type;</span>
<a name="2010"><font size=-1>2010     </font></a><span class="default"></span>
<a name="2011"><font size=-1>2011     </font></a><span class="default">            </span><span class="comment">// find the function in the base class</span>
<a name="2012"><font size=-1>2012     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(derivedFrom &amp;&amp; derivedFrom-&gt;classScope) {</span>
<a name="2013"><font size=-1>2013     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(isConstMemberFunc(derivedFrom-&gt;classScope, tok))</span>
<a name="2014"><font size=-1>2014     </font></a><span class="default">                    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2015"><font size=-1>2015     </font></a><span class="default">            }</span>
<a name="2016"><font size=-1>2016     </font></a><span class="default">        }</span>
<a name="2017"><font size=-1>2017     </font></a><span class="default">    }</span>
<a name="2018"><font size=-1>2018     </font></a><span class="default"></span>
<a name="2019"><font size=-1>2019     </font></a><span class="default">    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2020"><font size=-1>2020     </font></a><span class="default">}</span>
<a name="2021"><font size=-1>2021     </font></a><span class="default"></span>
<a name="2022"><font size=-1>2022     </font></a><span class="default"></span><span class="keyword">namespace </span><span class="default">{</span>
<a name="2023"><font size=-1>2023     </font></a><span class="default">    </span><span class="comment">// The container contains the STL types whose operator[] is not a const.</span>
<a name="2024"><font size=-1>2024     </font></a><span class="comment">    </span><span class="keyword">const </span><span class="default">std::set&lt;std::string&gt; stl_containers_not_const = { </span><span class="string">&quot;map&quot;</span><span class="default">, </span><span class="string">&quot;unordered_map&quot; </span><span class="default">};</span>
<a name="2025"><font size=-1>2025     </font></a><span class="default">}</span>
<a name="2026"><font size=-1>2026     </font></a><span class="default"></span>
<a name="2027"><font size=-1>2027     </font></a><span class="default"></span><span class="keyword">bool </span><span class="default">CheckClass::checkConstFunc(</span><span class="keyword">const </span><span class="default">Scope *scope, </span><span class="keyword">const </span><span class="default">Function *func, </span><span class="keyword">bool</span><span class="default">&amp; memberAccessed) </span><span class="keyword">const</span>
<a name="2028"><font size=-1>2028     </font></a><span class="keyword"></span><span class="default">{</span>
<a name="2029"><font size=-1>2029     </font></a><span class="default">    </span><span class="comment">// if the function doesn't have any assignment nor function call,</span>
<a name="2030"><font size=-1>2030     </font></a><span class="comment">    // it can be a const function..</span>
<a name="2031"><font size=-1>2031     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok1 = func-&gt;functionScope-&gt;bodyStart; tok1 &amp;&amp; tok1 != func-&gt;functionScope-&gt;bodyEnd; tok1 = tok1-&gt;next()) {</span>
<a name="2032"><font size=-1>2032     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok1-&gt;isName() &amp;&amp; isMemberVar(scope, tok1)) {</span>
<a name="2033"><font size=-1>2033     </font></a><span class="default">            memberAccessed = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2034"><font size=-1>2034     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable* v = tok1-&gt;variable();</span>
<a name="2035"><font size=-1>2035     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(v &amp;&amp; v-&gt;isMutable())</span>
<a name="2036"><font size=-1>2036     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2037"><font size=-1>2037     </font></a><span class="default"></span>
<a name="2038"><font size=-1>2038     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok1-&gt;str() == </span><span class="string">&quot;this&quot; </span><span class="default">&amp;&amp; tok1-&gt;previous()-&gt;isAssignmentOp())</span>
<a name="2039"><font size=-1>2039     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2040"><font size=-1>2040     </font></a><span class="default"></span>
<a name="2041"><font size=-1>2041     </font></a><span class="default"></span>
<a name="2042"><font size=-1>2042     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* lhs = tok1-&gt;previous();</span>
<a name="2043"><font size=-1>2043     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(lhs-&gt;str() == </span><span class="string">&quot;&amp;&quot;</span><span class="default">) {</span>
<a name="2044"><font size=-1>2044     </font></a><span class="default">                lhs = lhs-&gt;previous();</span>
<a name="2045"><font size=-1>2045     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(lhs-&gt;isAssignmentOp() &amp;&amp; lhs-&gt;previous()-&gt;variable()) {</span>
<a name="2046"><font size=-1>2046     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(lhs-&gt;previous()-&gt;variable()-&gt;typeStartToken()-&gt;strAt(-</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;const&quot; </span><span class="default">&amp;&amp; lhs-&gt;previous()-&gt;variable()-&gt;isPointer())</span>
<a name="2047"><font size=-1>2047     </font></a><span class="default">                        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2048"><font size=-1>2048     </font></a><span class="default">                }</span>
<a name="2049"><font size=-1>2049     </font></a><span class="default">            } </span><span class="keyword">else if </span><span class="default">(lhs-&gt;str() == </span><span class="string">&quot;:&quot; </span><span class="default">&amp;&amp; lhs-&gt;astParent() &amp;&amp; lhs-&gt;astParent()-&gt;str() == </span><span class="string">&quot;(&quot; </span><span class="default">&amp;&amp; tok1-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;)&quot;</span><span class="default">) { </span><span class="comment">// range-based for-loop (C++11)</span>
<a name="2050"><font size=-1>2050     </font></a><span class="comment">                // TODO: We could additionally check what is done with the elements to avoid false negatives. Here we just rely on &quot;const&quot; keyword being used.</span>
<a name="2051"><font size=-1>2051     </font></a><span class="comment">                </span><span class="keyword">if </span><span class="default">(lhs-&gt;astParent()-&gt;strAt(</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;const&quot;</span><span class="default">)</span>
<a name="2052"><font size=-1>2052     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2053"><font size=-1>2053     </font></a><span class="default">            } </span><span class="keyword">else </span><span class="default">{</span>
<a name="2054"><font size=-1>2054     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(lhs-&gt;isAssignmentOp()) {</span>
<a name="2055"><font size=-1>2055     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable* lhsVar = lhs-&gt;previous()-&gt;variable();</span>
<a name="2056"><font size=-1>2056     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(lhsVar &amp;&amp; !lhsVar-&gt;isConst() &amp;&amp; lhsVar-&gt;isReference() &amp;&amp; lhs == lhsVar-&gt;nameToken()-&gt;next())</span>
<a name="2057"><font size=-1>2057     </font></a><span class="default">                        </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2058"><font size=-1>2058     </font></a><span class="default">                }</span>
<a name="2059"><font size=-1>2059     </font></a><span class="default">            }</span>
<a name="2060"><font size=-1>2060     </font></a><span class="default"></span>
<a name="2061"><font size=-1>2061     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* jumpBackToken = nullptr;</span>
<a name="2062"><font size=-1>2062     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *lastVarTok = tok1;</span>
<a name="2063"><font size=-1>2063     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *end = tok1;</span>
<a name="2064"><font size=-1>2064     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(;;) {</span>
<a name="2065"><font size=-1>2065     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(end-&gt;next(), </span><span class="string">&quot;. %name%&quot;</span><span class="default">)) {</span>
<a name="2066"><font size=-1>2066     </font></a><span class="default">                    end = end-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2067"><font size=-1>2067     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(end-&gt;varId())</span>
<a name="2068"><font size=-1>2068     </font></a><span class="default">                        lastVarTok = end;</span>
<a name="2069"><font size=-1>2069     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(end-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;[&quot;</span><span class="default">) {</span>
<a name="2070"><font size=-1>2070     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(end-&gt;varId()) {</span>
<a name="2071"><font size=-1>2071     </font></a><span class="default">                        </span><span class="keyword">const </span><span class="default">Variable *var = end-&gt;variable();</span>
<a name="2072"><font size=-1>2072     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(var &amp;&amp; var-&gt;isStlType(stl_containers_not_const))</span>
<a name="2073"><font size=-1>2073     </font></a><span class="default">                            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2074"><font size=-1>2074     </font></a><span class="default">                    }</span>
<a name="2075"><font size=-1>2075     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!jumpBackToken)</span>
<a name="2076"><font size=-1>2076     </font></a><span class="default">                        jumpBackToken = end-&gt;next(); </span><span class="comment">// Check inside the [] brackets</span>
<a name="2077"><font size=-1>2077     </font></a><span class="comment">                    </span><span class="default">end = end-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="2078"><font size=-1>2078     </font></a><span class="default">                } </span><span class="keyword">else if </span><span class="default">(end-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;)&quot;</span><span class="default">)</span>
<a name="2079"><font size=-1>2079     </font></a><span class="default">                    end = end-&gt;next();</span>
<a name="2080"><font size=-1>2080     </font></a><span class="default">                </span><span class="keyword">else</span>
<a name="2081"><font size=-1>2081     </font></a><span class="keyword">                    break</span><span class="default">;</span>
<a name="2082"><font size=-1>2082     </font></a><span class="default">            }</span>
<a name="2083"><font size=-1>2083     </font></a><span class="default"></span>
<a name="2084"><font size=-1>2084     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(end-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;(&quot;</span><span class="default">) {</span>
<a name="2085"><font size=-1>2085     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable *var = lastVarTok-&gt;variable();</span>
<a name="2086"><font size=-1>2086     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var)</span>
<a name="2087"><font size=-1>2087     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2088"><font size=-1>2088     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(var-&gt;isStlType() </span><span class="comment">// assume all std::*::size() and std::*::empty() are const</span>
<a name="2089"><font size=-1>2089     </font></a><span class="comment">                    </span><span class="default">&amp;&amp; (Token::Match(end, </span><span class="string">&quot;size|empty|cend|crend|cbegin|crbegin|max_size|length|count|capacity|get_allocator|c_str|str ( )&quot;</span><span class="default">) || Token::Match(end, </span><span class="string">&quot;rfind|copy&quot;</span><span class="default">)))</span>
<a name="2090"><font size=-1>2090     </font></a><span class="default">                    ;</span>
<a name="2091"><font size=-1>2091     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(!var-&gt;typeScope() || !isConstMemberFunc(var-&gt;typeScope(), end))</span>
<a name="2092"><font size=-1>2092     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2093"><font size=-1>2093     </font></a><span class="default">            }</span>
<a name="2094"><font size=-1>2094     </font></a><span class="default"></span>
<a name="2095"><font size=-1>2095     </font></a><span class="default">            </span><span class="comment">// Assignment</span>
<a name="2096"><font size=-1>2096     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(end-&gt;next()-&gt;isAssignmentOp())</span>
<a name="2097"><font size=-1>2097     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2098"><font size=-1>2098     </font></a><span class="default"></span>
<a name="2099"><font size=-1>2099     </font></a><span class="default">            </span><span class="comment">// Streaming</span>
<a name="2100"><font size=-1>2100     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(end-&gt;strAt(</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;&lt;&lt;&quot; </span><span class="default">&amp;&amp; tok1-&gt;strAt(-</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;&lt;&lt;&quot;</span><span class="default">)</span>
<a name="2101"><font size=-1>2101     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2102"><font size=-1>2102     </font></a><span class="default">            </span><span class="keyword">else if </span><span class="default">(isLikelyStreamRead(</span><span class="keyword">true</span><span class="default">, tok1-&gt;previous()))</span>
<a name="2103"><font size=-1>2103     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2104"><font size=-1>2104     </font></a><span class="default"></span>
<a name="2105"><font size=-1>2105     </font></a><span class="default">            </span><span class="comment">// ++/--</span>
<a name="2106"><font size=-1>2106     </font></a><span class="comment">            </span><span class="keyword">else if </span><span class="default">(end-&gt;next()-&gt;tokType() == Token::eIncDecOp || tok1-&gt;previous()-&gt;tokType() == Token::eIncDecOp)</span>
<a name="2107"><font size=-1>2107     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2108"><font size=-1>2108     </font></a><span class="default"></span>
<a name="2109"><font size=-1>2109     </font></a><span class="default"></span>
<a name="2110"><font size=-1>2110     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token* start = tok1;</span>
<a name="2111"><font size=-1>2111     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(tok1-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;)&quot;</span><span class="default">)</span>
<a name="2112"><font size=-1>2112     </font></a><span class="default">                tok1 = tok1-&gt;linkAt(-</span><span class="number">1</span><span class="default">);</span>
<a name="2113"><font size=-1>2113     </font></a><span class="default"></span>
<a name="2114"><font size=-1>2114     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(start-&gt;strAt(-</span><span class="number">1</span><span class="default">) == </span><span class="string">&quot;delete&quot;</span><span class="default">)</span>
<a name="2115"><font size=-1>2115     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2116"><font size=-1>2116     </font></a><span class="default"></span>
<a name="2117"><font size=-1>2117     </font></a><span class="default">            tok1 = jumpBackToken?jumpBackToken:end; </span><span class="comment">// Jump back to first [ to check inside, or jump to end of expression</span>
<a name="2118"><font size=-1>2118     </font></a><span class="comment">        </span><span class="default">}</span>
<a name="2119"><font size=-1>2119     </font></a><span class="default"></span>
<a name="2120"><font size=-1>2120     </font></a><span class="default">        </span><span class="comment">// streaming: &lt;&lt;</span>
<a name="2121"><font size=-1>2121     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok1-&gt;previous(), </span><span class="string">&quot;) &lt;&lt;&quot;</span><span class="default">) &amp;&amp;</span>
<a name="2122"><font size=-1>2122     </font></a><span class="default">                 isMemberVar(scope, tok1-&gt;tokAt(-</span><span class="number">2</span><span class="default">))) {</span>
<a name="2123"><font size=-1>2123     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Variable* var = tok1-&gt;tokAt(-</span><span class="number">2</span><span class="default">)-&gt;variable();</span>
<a name="2124"><font size=-1>2124     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var || !var-&gt;isMutable())</span>
<a name="2125"><font size=-1>2125     </font></a><span class="default">                </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2126"><font size=-1>2126     </font></a><span class="default">        }</span>
<a name="2127"><font size=-1>2127     </font></a><span class="default"></span>
<a name="2128"><font size=-1>2128     </font></a><span class="default">        </span><span class="comment">// streaming: &gt;&gt; *this</span>
<a name="2129"><font size=-1>2129     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok1, </span><span class="string">&quot;&gt;&gt; * this&quot;</span><span class="default">) &amp;&amp; isLikelyStreamRead(</span><span class="keyword">true</span><span class="default">, tok1)) {</span>
<a name="2130"><font size=-1>2130     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2131"><font size=-1>2131     </font></a><span class="default">        }</span>
<a name="2132"><font size=-1>2132     </font></a><span class="default"></span>
<a name="2133"><font size=-1>2133     </font></a><span class="default">        </span><span class="comment">// function call..</span>
<a name="2134"><font size=-1>2134     </font></a><span class="comment">        </span><span class="keyword">else if </span><span class="default">(Token::Match(tok1, </span><span class="string">&quot;%name% (&quot;</span><span class="default">) &amp;&amp; !tok1-&gt;isStandardType() &amp;&amp;</span>
<a name="2135"><font size=-1>2135     </font></a><span class="default">                 !Token::Match(tok1, </span><span class="string">&quot;return|if|string|switch|while|catch|for&quot;</span><span class="default">)) {</span>
<a name="2136"><font size=-1>2136     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(isMemberFunc(scope, tok1) &amp;&amp; tok1-&gt;strAt(-</span><span class="number">1</span><span class="default">) != </span><span class="string">&quot;.&quot;</span><span class="default">) {</span>
<a name="2137"><font size=-1>2137     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!isConstMemberFunc(scope, tok1))</span>
<a name="2138"><font size=-1>2138     </font></a><span class="default">                    </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2139"><font size=-1>2139     </font></a><span class="default">                memberAccessed = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2140"><font size=-1>2140     </font></a><span class="default">            }</span>
<a name="2141"><font size=-1>2141     </font></a><span class="default">            </span><span class="comment">// Member variable given as parameter</span>
<a name="2142"><font size=-1>2142     </font></a><span class="comment">            </span><span class="keyword">const </span><span class="default">Token *lpar = tok1-&gt;next();</span>
<a name="2143"><font size=-1>2143     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::simpleMatch(lpar, </span><span class="string">&quot;( ) (&quot;</span><span class="default">))</span>
<a name="2144"><font size=-1>2144     </font></a><span class="default">                lpar = lpar-&gt;tokAt(</span><span class="number">2</span><span class="default">);</span>
<a name="2145"><font size=-1>2145     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token* tok2 = lpar-&gt;next(); tok2 &amp;&amp; tok2 != tok1-&gt;next()-&gt;link(); tok2 = tok2-&gt;next()) {</span>
<a name="2146"><font size=-1>2146     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok2-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">)</span>
<a name="2147"><font size=-1>2147     </font></a><span class="default">                    tok2 = tok2-&gt;link();</span>
<a name="2148"><font size=-1>2148     </font></a><span class="default">                </span><span class="keyword">else if </span><span class="default">(tok2-&gt;isName() &amp;&amp; isMemberVar(scope, tok2)) {</span>
<a name="2149"><font size=-1>2149     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable* var = tok2-&gt;variable();</span>
<a name="2150"><font size=-1>2150     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(!var || !var-&gt;isMutable())</span>
<a name="2151"><font size=-1>2151     </font></a><span class="default">                        </span><span class="keyword">return false</span><span class="default">; </span><span class="comment">// TODO: Only bailout if function takes argument as non-const reference</span>
<a name="2152"><font size=-1>2152     </font></a><span class="comment">                </span><span class="default">}</span>
<a name="2153"><font size=-1>2153     </font></a><span class="default">            }</span>
<a name="2154"><font size=-1>2154     </font></a><span class="default">        } </span><span class="keyword">else if </span><span class="default">(Token::simpleMatch(tok1, </span><span class="string">&quot;&gt; (&quot;</span><span class="default">) &amp;&amp; (!tok1-&gt;link() || !Token::Match(tok1-&gt;link()-&gt;previous(), </span><span class="string">&quot;static_cast|const_cast|dynamic_cast|reinterpret_cast&quot;</span><span class="default">))) {</span>
<a name="2155"><font size=-1>2155     </font></a><span class="default">            </span><span class="keyword">return false</span><span class="default">;</span>
<a name="2156"><font size=-1>2156     </font></a><span class="default">        }</span>
<a name="2157"><font size=-1>2157     </font></a><span class="default">    }</span>
<a name="2158"><font size=-1>2158     </font></a><span class="default"></span>
<a name="2159"><font size=-1>2159     </font></a><span class="default">    </span><span class="keyword">return true</span><span class="default">;</span>
<a name="2160"><font size=-1>2160     </font></a><span class="default">}</span>
<a name="2161"><font size=-1>2161     </font></a><span class="default"></span>
<a name="2162"><font size=-1>2162     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkConstError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;funcname, </span><span class="keyword">bool </span><span class="default">suggestStatic)</span>
<a name="2163"><font size=-1>2163     </font></a><span class="default">{</span>
<a name="2164"><font size=-1>2164     </font></a><span class="default">    checkConstError2(tok, nullptr, classname, funcname, suggestStatic);</span>
<a name="2165"><font size=-1>2165     </font></a><span class="default">}</span>
<a name="2166"><font size=-1>2166     </font></a><span class="default"></span>
<a name="2167"><font size=-1>2167     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkConstError2(</span><span class="keyword">const </span><span class="default">Token *tok1, </span><span class="keyword">const </span><span class="default">Token *tok2, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;funcname, </span><span class="keyword">bool </span><span class="default">suggestStatic)</span>
<a name="2168"><font size=-1>2168     </font></a><span class="default">{</span>
<a name="2169"><font size=-1>2169     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; toks;</span>
<a name="2170"><font size=-1>2170     </font></a><span class="default">    toks.push_back(tok1);</span>
<a name="2171"><font size=-1>2171     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(tok2)</span>
<a name="2172"><font size=-1>2172     </font></a><span class="default">        toks.push_back(tok2);</span>
<a name="2173"><font size=-1>2173     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!suggestStatic)</span>
<a name="2174"><font size=-1>2174     </font></a><span class="default">        reportError(toks, Severity::style, </span><span class="string">&quot;functionConst&quot;</span><span class="default">,</span>
<a name="2175"><font size=-1>2175     </font></a><span class="default">                    </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ funcname +</span><span class="string">&quot;\n&quot;</span>
<a name="2176"><font size=-1>2176     </font></a><span class="string">                    &quot;Technically the member function '$symbol' can be const.\n&quot;</span>
<a name="2177"><font size=-1>2177     </font></a><span class="string">                    &quot;The member function '$symbol' can be made a const &quot;</span>
<a name="2178"><font size=-1>2178     </font></a><span class="string">                    &quot;function. Making this function 'const' should not cause compiler errors. &quot;</span>
<a name="2179"><font size=-1>2179     </font></a><span class="string">                    &quot;Even though the function can be made const function technically it may not make &quot;</span>
<a name="2180"><font size=-1>2180     </font></a><span class="string">                    &quot;sense conceptually. Think about your design and the task of the function first - is &quot;</span>
<a name="2181"><font size=-1>2181     </font></a><span class="string">                    &quot;it a function that must not change object internal state?&quot;</span><span class="default">, CWE398, </span><span class="keyword">true</span><span class="default">);</span>
<a name="2182"><font size=-1>2182     </font></a><span class="default">    </span><span class="keyword">else</span>
<a name="2183"><font size=-1>2183     </font></a><span class="keyword">        </span><span class="default">reportError(toks, Severity::performance, </span><span class="string">&quot;functionStatic&quot;</span><span class="default">,</span>
<a name="2184"><font size=-1>2184     </font></a><span class="default">                    </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ funcname +</span><span class="string">&quot;\n&quot;</span>
<a name="2185"><font size=-1>2185     </font></a><span class="string">                    &quot;Technically the member function '$symbol' can be static (but you may consider moving to unnamed namespace).\n&quot;</span>
<a name="2186"><font size=-1>2186     </font></a><span class="string">                    &quot;The member function '$symbol' can be made a static &quot;</span>
<a name="2187"><font size=-1>2187     </font></a><span class="string">                    &quot;function. Making a function static can bring a performance benefit since no 'this' instance is &quot;</span>
<a name="2188"><font size=-1>2188     </font></a><span class="string">                    &quot;passed to the function. This change should not cause compiler errors but it does not &quot;</span>
<a name="2189"><font size=-1>2189     </font></a><span class="string">                    &quot;necessarily make sense conceptually. Think about your design and the task of the function first - &quot;</span>
<a name="2190"><font size=-1>2190     </font></a><span class="string">                    &quot;is it a function that must not access members of class instances? And maybe it is more appropriate &quot;</span>
<a name="2191"><font size=-1>2191     </font></a><span class="string">                    &quot;to move this function to a unnamed namespace.&quot;</span><span class="default">, CWE398, </span><span class="keyword">true</span><span class="default">);</span>
<a name="2192"><font size=-1>2192     </font></a><span class="default">}</span>
<a name="2193"><font size=-1>2193     </font></a><span class="default"></span>
<a name="2194"><font size=-1>2194     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2195"><font size=-1>2195     </font></a><span class="comment">// ClassCheck: Check that initializer list is in declared order.</span>
<a name="2196"><font size=-1>2196     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2197"><font size=-1>2197     </font></a><span class="comment"></span>
<a name="2198"><font size=-1>2198     </font></a><span class="comment"></span><span class="keyword">namespace </span><span class="default">{ </span><span class="comment">// avoid one-definition-rule violation</span>
<a name="2199"><font size=-1>2199     </font></a><span class="comment">    </span><span class="keyword">struct </span><span class="default">VarInfo {</span>
<a name="2200"><font size=-1>2200     </font></a><span class="default">        VarInfo(</span><span class="keyword">const </span><span class="default">Variable *_var, </span><span class="keyword">const </span><span class="default">Token *_tok)</span>
<a name="2201"><font size=-1>2201     </font></a><span class="default">            : var(_var), tok(_tok) { }</span>
<a name="2202"><font size=-1>2202     </font></a><span class="default"></span>
<a name="2203"><font size=-1>2203     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Variable *var;</span>
<a name="2204"><font size=-1>2204     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *tok;</span>
<a name="2205"><font size=-1>2205     </font></a><span class="default">    };</span>
<a name="2206"><font size=-1>2206     </font></a><span class="default">}</span>
<a name="2207"><font size=-1>2207     </font></a><span class="default"></span>
<a name="2208"><font size=-1>2208     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::initializerListOrder()</span>
<a name="2209"><font size=-1>2209     </font></a><span class="default">{</span>
<a name="2210"><font size=-1>2210     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="2211"><font size=-1>2211     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2212"><font size=-1>2212     </font></a><span class="default"></span>
<a name="2213"><font size=-1>2213     </font></a><span class="default">    </span><span class="comment">// This check is not inconclusive.  However it only determines if the initialization</span>
<a name="2214"><font size=-1>2214     </font></a><span class="comment">    // order is incorrect.  It does not determine if being out of order causes</span>
<a name="2215"><font size=-1>2215     </font></a><span class="comment">    // a real error.  Out of order is not necessarily an error but you can never</span>
<a name="2216"><font size=-1>2216     </font></a><span class="comment">    // have an error if the list is in order so this enforces defensive programming.</span>
<a name="2217"><font size=-1>2217     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;inconclusive)</span>
<a name="2218"><font size=-1>2218     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2219"><font size=-1>2219     </font></a><span class="default"></span>
<a name="2220"><font size=-1>2220     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="2221"><font size=-1>2221     </font></a><span class="default"></span>
<a name="2222"><font size=-1>2222     </font></a><span class="default">        </span><span class="comment">// iterate through all member functions looking for constructors</span>
<a name="2223"><font size=-1>2223     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(std::list&lt;Function&gt;::const_iterator func = scope-&gt;functionList.begin(); func != scope-&gt;functionList.end(); ++func) {</span>
<a name="2224"><font size=-1>2224     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func-&gt;isConstructor() &amp;&amp; func-&gt;hasBody()) {</span>
<a name="2225"><font size=-1>2225     </font></a><span class="default">                </span><span class="comment">// check for initializer list</span>
<a name="2226"><font size=-1>2226     </font></a><span class="comment">                </span><span class="keyword">const </span><span class="default">Token *tok = func-&gt;arg-&gt;link()-&gt;next();</span>
<a name="2227"><font size=-1>2227     </font></a><span class="default"></span>
<a name="2228"><font size=-1>2228     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;:&quot;</span><span class="default">) {</span>
<a name="2229"><font size=-1>2229     </font></a><span class="default">                    std::vector&lt;VarInfo&gt; vars;</span>
<a name="2230"><font size=-1>2230     </font></a><span class="default">                    tok = tok-&gt;next();</span>
<a name="2231"><font size=-1>2231     </font></a><span class="default"></span>
<a name="2232"><font size=-1>2232     </font></a><span class="default">                    </span><span class="comment">// find all variable initializations in list</span>
<a name="2233"><font size=-1>2233     </font></a><span class="comment">                    </span><span class="keyword">while </span><span class="default">(tok &amp;&amp; tok != func-&gt;functionScope-&gt;bodyStart) {</span>
<a name="2234"><font size=-1>2234     </font></a><span class="default">                        </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;%name% (|{&quot;</span><span class="default">)) {</span>
<a name="2235"><font size=-1>2235     </font></a><span class="default">                            </span><span class="keyword">const </span><span class="default">Variable *var = scope-&gt;getVariable(tok-&gt;str());</span>
<a name="2236"><font size=-1>2236     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(var)</span>
<a name="2237"><font size=-1>2237     </font></a><span class="default">                                vars.emplace_back(var, tok);</span>
<a name="2238"><font size=-1>2238     </font></a><span class="default"></span>
<a name="2239"><font size=-1>2239     </font></a><span class="default">                            </span><span class="keyword">if </span><span class="default">(Token::Match(tok-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;%name% =&quot;</span><span class="default">)) {</span>
<a name="2240"><font size=-1>2240     </font></a><span class="default">                                var = scope-&gt;getVariable(tok-&gt;strAt(</span><span class="number">2</span><span class="default">));</span>
<a name="2241"><font size=-1>2241     </font></a><span class="default"></span>
<a name="2242"><font size=-1>2242     </font></a><span class="default">                                </span><span class="keyword">if </span><span class="default">(var)</span>
<a name="2243"><font size=-1>2243     </font></a><span class="default">                                    vars.emplace_back(var, tok-&gt;tokAt(</span><span class="number">2</span><span class="default">));</span>
<a name="2244"><font size=-1>2244     </font></a><span class="default">                            }</span>
<a name="2245"><font size=-1>2245     </font></a><span class="default">                            tok = tok-&gt;next()-&gt;link()-&gt;next();</span>
<a name="2246"><font size=-1>2246     </font></a><span class="default">                        } </span><span class="keyword">else</span>
<a name="2247"><font size=-1>2247     </font></a><span class="keyword">                            </span><span class="default">tok = tok-&gt;next();</span>
<a name="2248"><font size=-1>2248     </font></a><span class="default">                    }</span>
<a name="2249"><font size=-1>2249     </font></a><span class="default"></span>
<a name="2250"><font size=-1>2250     </font></a><span class="default">                    </span><span class="comment">// need at least 2 members to have out of order initialization</span>
<a name="2251"><font size=-1>2251     </font></a><span class="comment">                    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">int </span><span class="default">j = </span><span class="number">1</span><span class="default">; j &lt; vars.size(); j++) {</span>
<a name="2252"><font size=-1>2252     </font></a><span class="default">                        </span><span class="comment">// check for out of order initialization</span>
<a name="2253"><font size=-1>2253     </font></a><span class="comment">                        </span><span class="keyword">if </span><span class="default">(vars[j].var-&gt;index() &lt; vars[j - </span><span class="number">1</span><span class="default">].var-&gt;index())</span>
<a name="2254"><font size=-1>2254     </font></a><span class="default">                            initializerListError(vars[j].tok,vars[j].var-&gt;nameToken(), scope-&gt;className, vars[j].var-&gt;name());</span>
<a name="2255"><font size=-1>2255     </font></a><span class="default">                    }</span>
<a name="2256"><font size=-1>2256     </font></a><span class="default">                }</span>
<a name="2257"><font size=-1>2257     </font></a><span class="default">            }</span>
<a name="2258"><font size=-1>2258     </font></a><span class="default">        }</span>
<a name="2259"><font size=-1>2259     </font></a><span class="default">    }</span>
<a name="2260"><font size=-1>2260     </font></a><span class="default">}</span>
<a name="2261"><font size=-1>2261     </font></a><span class="default"></span>
<a name="2262"><font size=-1>2262     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::initializerListError(</span><span class="keyword">const </span><span class="default">Token *tok1, </span><span class="keyword">const </span><span class="default">Token *tok2, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">const </span><span class="default">std::string &amp;varname)</span>
<a name="2263"><font size=-1>2263     </font></a><span class="default">{</span>
<a name="2264"><font size=-1>2264     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; toks = { tok1, tok2 };</span>
<a name="2265"><font size=-1>2265     </font></a><span class="default">    reportError(toks, Severity::style, </span><span class="string">&quot;initializerList&quot;</span><span class="default">,</span>
<a name="2266"><font size=-1>2266     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;::&quot; </span><span class="default">+ varname +</span><span class="string">&quot;\n&quot;</span>
<a name="2267"><font size=-1>2267     </font></a><span class="string">                &quot;Member variable '$symbol' is in the wrong place in the initializer list.\n&quot;</span>
<a name="2268"><font size=-1>2268     </font></a><span class="string">                &quot;Member variable '$symbol' is in the wrong place in the initializer list. &quot;</span>
<a name="2269"><font size=-1>2269     </font></a><span class="string">                &quot;Members are initialized in the order they are declared, not in the &quot;</span>
<a name="2270"><font size=-1>2270     </font></a><span class="string">                &quot;order they are in the initializer list.  Keeping the initializer list &quot;</span>
<a name="2271"><font size=-1>2271     </font></a><span class="string">                &quot;in the same order that the members were declared prevents order dependent &quot;</span>
<a name="2272"><font size=-1>2272     </font></a><span class="string">                &quot;initialization errors.&quot;</span><span class="default">, CWE398, </span><span class="keyword">true</span><span class="default">);</span>
<a name="2273"><font size=-1>2273     </font></a><span class="default">}</span>
<a name="2274"><font size=-1>2274     </font></a><span class="default"></span>
<a name="2275"><font size=-1>2275     </font></a><span class="default"></span>
<a name="2276"><font size=-1>2276     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2277"><font size=-1>2277     </font></a><span class="comment">// Check for self initialization in initialization list</span>
<a name="2278"><font size=-1>2278     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2279"><font size=-1>2279     </font></a><span class="comment"></span>
<a name="2280"><font size=-1>2280     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::checkSelfInitialization()</span>
<a name="2281"><font size=-1>2281     </font></a><span class="default">{</span>
<a name="2282"><font size=-1>2282     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *scope : mSymbolDatabase-&gt;functionScopes) {</span>
<a name="2283"><font size=-1>2283     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function* function = scope-&gt;function;</span>
<a name="2284"><font size=-1>2284     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!function || !function-&gt;isConstructor())</span>
<a name="2285"><font size=-1>2285     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2286"><font size=-1>2286     </font></a><span class="default"></span>
<a name="2287"><font size=-1>2287     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token* tok = function-&gt;arg-&gt;link()-&gt;next();</span>
<a name="2288"><font size=-1>2288     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;:&quot;</span><span class="default">)</span>
<a name="2289"><font size=-1>2289     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2290"><font size=-1>2290     </font></a><span class="default"></span>
<a name="2291"><font size=-1>2291     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(; tok != scope-&gt;bodyStart; tok = tok-&gt;next()) {</span>
<a name="2292"><font size=-1>2292     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;[:,] %var% (|{ %var% )|}&quot;</span><span class="default">) &amp;&amp; tok-&gt;next()-&gt;varId() == tok-&gt;tokAt(</span><span class="number">3</span><span class="default">)-&gt;varId()) {</span>
<a name="2293"><font size=-1>2293     </font></a><span class="default">                selfInitializationError(tok, tok-&gt;strAt(</span><span class="number">1</span><span class="default">));</span>
<a name="2294"><font size=-1>2294     </font></a><span class="default">            }</span>
<a name="2295"><font size=-1>2295     </font></a><span class="default">        }</span>
<a name="2296"><font size=-1>2296     </font></a><span class="default">    }</span>
<a name="2297"><font size=-1>2297     </font></a><span class="default">}</span>
<a name="2298"><font size=-1>2298     </font></a><span class="default"></span>
<a name="2299"><font size=-1>2299     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::selfInitializationError(</span><span class="keyword">const </span><span class="default">Token* tok, </span><span class="keyword">const </span><span class="default">std::string&amp; varname)</span>
<a name="2300"><font size=-1>2300     </font></a><span class="default">{</span>
<a name="2301"><font size=-1>2301     </font></a><span class="default">    reportError(tok, Severity::error, </span><span class="string">&quot;selfInitialization&quot;</span><span class="default">, </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\nMember variable '$symbol' is initialized by itself.&quot;</span><span class="default">, CWE665, </span><span class="keyword">false</span><span class="default">);</span>
<a name="2302"><font size=-1>2302     </font></a><span class="default">}</span>
<a name="2303"><font size=-1>2303     </font></a><span class="default"></span>
<a name="2304"><font size=-1>2304     </font></a><span class="default"></span>
<a name="2305"><font size=-1>2305     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2306"><font size=-1>2306     </font></a><span class="comment">// Check for virtual function calls in constructor/destructor</span>
<a name="2307"><font size=-1>2307     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2308"><font size=-1>2308     </font></a><span class="comment"></span>
<a name="2309"><font size=-1>2309     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::checkVirtualFunctionCallInConstructor()</span>
<a name="2310"><font size=-1>2310     </font></a><span class="default">{</span>
<a name="2311"><font size=-1>2311     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(! mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="2312"><font size=-1>2312     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2313"><font size=-1>2313     </font></a><span class="default">    std::map&lt;</span><span class="keyword">const </span><span class="default">Function *, std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &gt; virtualFunctionCallsMap;</span>
<a name="2314"><font size=-1>2314     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope *scope : mSymbolDatabase-&gt;functionScopes) {</span>
<a name="2315"><font size=-1>2315     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scope-&gt;function == nullptr || !scope-&gt;function-&gt;hasBody() ||</span>
<a name="2316"><font size=-1>2316     </font></a><span class="default">            !(scope-&gt;function-&gt;isConstructor() ||</span>
<a name="2317"><font size=-1>2317     </font></a><span class="default">              scope-&gt;function-&gt;isDestructor()))</span>
<a name="2318"><font size=-1>2318     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2319"><font size=-1>2319     </font></a><span class="default"></span>
<a name="2320"><font size=-1>2320     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; virtualFunctionCalls = getVirtualFunctionCalls(*scope-&gt;function, virtualFunctionCallsMap);</span>
<a name="2321"><font size=-1>2321     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *callToken : virtualFunctionCalls) {</span>
<a name="2322"><font size=-1>2322     </font></a><span class="default">            std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; callstack(</span><span class="number">1</span><span class="default">, callToken);</span>
<a name="2323"><font size=-1>2323     </font></a><span class="default">            getFirstVirtualFunctionCallStack(virtualFunctionCallsMap, callToken, callstack);</span>
<a name="2324"><font size=-1>2324     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(callstack.empty())</span>
<a name="2325"><font size=-1>2325     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2326"><font size=-1>2326     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(callstack.back()-&gt;function()-&gt;isPure())</span>
<a name="2327"><font size=-1>2327     </font></a><span class="default">                pureVirtualFunctionCallInConstructorError(scope-&gt;function, callstack, callstack.back()-&gt;str());</span>
<a name="2328"><font size=-1>2328     </font></a><span class="default">            </span><span class="keyword">else</span>
<a name="2329"><font size=-1>2329     </font></a><span class="keyword">                </span><span class="default">virtualFunctionCallInConstructorError(scope-&gt;function, callstack, callstack.back()-&gt;str());</span>
<a name="2330"><font size=-1>2330     </font></a><span class="default">        }</span>
<a name="2331"><font size=-1>2331     </font></a><span class="default">    }</span>
<a name="2332"><font size=-1>2332     </font></a><span class="default">}</span>
<a name="2333"><font size=-1>2333     </font></a><span class="default"></span>
<a name="2334"><font size=-1>2334     </font></a><span class="default"></span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; CheckClass::getVirtualFunctionCalls(</span><span class="keyword">const </span><span class="default">Function &amp; function,</span>
<a name="2335"><font size=-1>2335     </font></a><span class="default">        std::map&lt;</span><span class="keyword">const </span><span class="default">Function *, std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &gt; &amp; virtualFunctionCallsMap)</span>
<a name="2336"><font size=-1>2336     </font></a><span class="default">{</span>
<a name="2337"><font size=-1>2337     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::map&lt;</span><span class="keyword">const </span><span class="default">Function *, std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &gt;::const_iterator found = virtualFunctionCallsMap.find(&amp;function);</span>
<a name="2338"><font size=-1>2338     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(found != virtualFunctionCallsMap.end())</span>
<a name="2339"><font size=-1>2339     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">found-&gt;second;</span>
<a name="2340"><font size=-1>2340     </font></a><span class="default"></span>
<a name="2341"><font size=-1>2341     </font></a><span class="default">    virtualFunctionCallsMap[&amp;function] = std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt;();</span>
<a name="2342"><font size=-1>2342     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; virtualFunctionCalls = virtualFunctionCallsMap.find(&amp;function)-&gt;second;</span>
<a name="2343"><font size=-1>2343     </font></a><span class="default"></span>
<a name="2344"><font size=-1>2344     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!function.hasBody())</span>
<a name="2345"><font size=-1>2345     </font></a><span class="default">        </span><span class="keyword">return </span><span class="default">virtualFunctionCalls;</span>
<a name="2346"><font size=-1>2346     </font></a><span class="default"></span>
<a name="2347"><font size=-1>2347     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = function.arg-&gt;link(); tok != function.functionScope-&gt;bodyEnd; tok = tok-&gt;next()) {</span>
<a name="2348"><font size=-1>2348     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(function.type != Function::eConstructor &amp;&amp;</span>
<a name="2349"><font size=-1>2349     </font></a><span class="default">            function.type != Function::eCopyConstructor &amp;&amp;</span>
<a name="2350"><font size=-1>2350     </font></a><span class="default">            function.type != Function::eMoveConstructor &amp;&amp;</span>
<a name="2351"><font size=-1>2351     </font></a><span class="default">            function.type != Function::eDestructor) {</span>
<a name="2352"><font size=-1>2352     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">((Token::simpleMatch(tok, </span><span class="string">&quot;) {&quot;</span><span class="default">) &amp;&amp; tok-&gt;link() &amp;&amp; Token::Match(tok-&gt;link()-&gt;previous(), </span><span class="string">&quot;if|switch&quot;</span><span class="default">)) ||</span>
<a name="2353"><font size=-1>2353     </font></a><span class="default">                Token::simpleMatch(tok, </span><span class="string">&quot;else {&quot;</span><span class="default">)) {</span>
<a name="2354"><font size=-1>2354     </font></a><span class="default">                </span><span class="comment">// Assume pure virtual function call is prevented by &quot;if|else|switch&quot; condition</span>
<a name="2355"><font size=-1>2355     </font></a><span class="comment">                </span><span class="default">tok = tok-&gt;linkAt(</span><span class="number">1</span><span class="default">);</span>
<a name="2356"><font size=-1>2356     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2357"><font size=-1>2357     </font></a><span class="default">            }</span>
<a name="2358"><font size=-1>2358     </font></a><span class="default">        }</span>
<a name="2359"><font size=-1>2359     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;scope()-&gt;type == Scope::eLambda)</span>
<a name="2360"><font size=-1>2360     </font></a><span class="default">            tok = tok-&gt;scope()-&gt;bodyEnd-&gt;next();</span>
<a name="2361"><font size=-1>2361     </font></a><span class="default"></span>
<a name="2362"><font size=-1>2362     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Function * callFunction = tok-&gt;function();</span>
<a name="2363"><font size=-1>2363     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!callFunction ||</span>
<a name="2364"><font size=-1>2364     </font></a><span class="default">            function.nestedIn != callFunction-&gt;nestedIn ||</span>
<a name="2365"><font size=-1>2365     </font></a><span class="default">            (tok-&gt;previous() &amp;&amp; tok-&gt;previous()-&gt;str() == </span><span class="string">&quot;.&quot;</span><span class="default">))</span>
<a name="2366"><font size=-1>2366     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2367"><font size=-1>2367     </font></a><span class="default"></span>
<a name="2368"><font size=-1>2368     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(tok-&gt;previous() &amp;&amp;</span>
<a name="2369"><font size=-1>2369     </font></a><span class="default">            tok-&gt;previous()-&gt;str() == </span><span class="string">&quot;(&quot;</span><span class="default">) {</span>
<a name="2370"><font size=-1>2370     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token * prev = tok-&gt;previous();</span>
<a name="2371"><font size=-1>2371     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(prev-&gt;previous() &amp;&amp;</span>
<a name="2372"><font size=-1>2372     </font></a><span class="default">                (mSettings-&gt;library.ignorefunction(tok-&gt;str())</span>
<a name="2373"><font size=-1>2373     </font></a><span class="default">                 || mSettings-&gt;library.ignorefunction(prev-&gt;previous()-&gt;str())))</span>
<a name="2374"><font size=-1>2374     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2375"><font size=-1>2375     </font></a><span class="default">        }</span>
<a name="2376"><font size=-1>2376     </font></a><span class="default"></span>
<a name="2377"><font size=-1>2377     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(callFunction-&gt;isImplicitlyVirtual()) {</span>
<a name="2378"><font size=-1>2378     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!callFunction-&gt;isPure() &amp;&amp; Token::simpleMatch(tok-&gt;previous(), </span><span class="string">&quot;::&quot;</span><span class="default">))</span>
<a name="2379"><font size=-1>2379     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2380"><font size=-1>2380     </font></a><span class="default">            virtualFunctionCalls.push_back(tok);</span>
<a name="2381"><font size=-1>2381     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2382"><font size=-1>2382     </font></a><span class="default">        }</span>
<a name="2383"><font size=-1>2383     </font></a><span class="default"></span>
<a name="2384"><font size=-1>2384     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; virtualFunctionCallsOfTok = getVirtualFunctionCalls(*callFunction, virtualFunctionCallsMap);</span>
<a name="2385"><font size=-1>2385     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!virtualFunctionCallsOfTok.empty())</span>
<a name="2386"><font size=-1>2386     </font></a><span class="default">            virtualFunctionCalls.push_back(tok);</span>
<a name="2387"><font size=-1>2387     </font></a><span class="default">    }</span>
<a name="2388"><font size=-1>2388     </font></a><span class="default">    </span><span class="keyword">return </span><span class="default">virtualFunctionCalls;</span>
<a name="2389"><font size=-1>2389     </font></a><span class="default">}</span>
<a name="2390"><font size=-1>2390     </font></a><span class="default"></span>
<a name="2391"><font size=-1>2391     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::getFirstVirtualFunctionCallStack(</span>
<a name="2392"><font size=-1>2392     </font></a><span class="default">    std::map&lt;</span><span class="keyword">const </span><span class="default">Function *, std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &gt; &amp; virtualFunctionCallsMap,</span>
<a name="2393"><font size=-1>2393     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * callToken,</span>
<a name="2394"><font size=-1>2394     </font></a><span class="default">    std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; pureFuncStack)</span>
<a name="2395"><font size=-1>2395     </font></a><span class="default">{</span>
<a name="2396"><font size=-1>2396     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Function *callFunction = callToken-&gt;function();</span>
<a name="2397"><font size=-1>2397     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(callFunction-&gt;isImplicitlyVirtual() &amp;&amp; (!callFunction-&gt;isPure() || !callFunction-&gt;hasBody())) {</span>
<a name="2398"><font size=-1>2398     </font></a><span class="default">        pureFuncStack.push_back(callFunction-&gt;tokenDef);</span>
<a name="2399"><font size=-1>2399     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2400"><font size=-1>2400     </font></a><span class="default">    }</span>
<a name="2401"><font size=-1>2401     </font></a><span class="default">    std::map&lt;</span><span class="keyword">const </span><span class="default">Function *, std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &gt;::const_iterator found = virtualFunctionCallsMap.find(callFunction);</span>
<a name="2402"><font size=-1>2402     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(found == virtualFunctionCallsMap.end() || found-&gt;second.empty()) {</span>
<a name="2403"><font size=-1>2403     </font></a><span class="default">        pureFuncStack.clear();</span>
<a name="2404"><font size=-1>2404     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2405"><font size=-1>2405     </font></a><span class="default">    }</span>
<a name="2406"><font size=-1>2406     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Token * firstCall = *found-&gt;second.begin();</span>
<a name="2407"><font size=-1>2407     </font></a><span class="default">    pureFuncStack.push_back(firstCall);</span>
<a name="2408"><font size=-1>2408     </font></a><span class="default">    getFirstVirtualFunctionCallStack(virtualFunctionCallsMap, firstCall, pureFuncStack);</span>
<a name="2409"><font size=-1>2409     </font></a><span class="default">}</span>
<a name="2410"><font size=-1>2410     </font></a><span class="default"></span>
<a name="2411"><font size=-1>2411     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::virtualFunctionCallInConstructorError(</span>
<a name="2412"><font size=-1>2412     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Function * scopeFunction,</span>
<a name="2413"><font size=-1>2413     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; tokStack,</span>
<a name="2414"><font size=-1>2414     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string &amp;funcname)</span>
<a name="2415"><font size=-1>2415     </font></a><span class="default">{</span>
<a name="2416"><font size=-1>2416     </font></a><span class="default">    </span><span class="keyword">const char </span><span class="default">* scopeFunctionTypeName = scopeFunction ? getFunctionTypeName(scopeFunction-&gt;type) : </span><span class="string">&quot;constructor&quot;</span><span class="default">;</span>
<a name="2417"><font size=-1>2417     </font></a><span class="default"></span>
<a name="2418"><font size=-1>2418     </font></a><span class="default">    ErrorPath errorPath;</span>
<a name="2419"><font size=-1>2419     </font></a><span class="default">    </span><span class="keyword">int </span><span class="default">lineNumber = </span><span class="number">1</span><span class="default">;</span>
<a name="2420"><font size=-1>2420     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok : tokStack)</span>
<a name="2421"><font size=-1>2421     </font></a><span class="default">        errorPath.emplace_back(tok, </span><span class="string">&quot;Calling &quot; </span><span class="default">+ tok-&gt;str());</span>
<a name="2422"><font size=-1>2422     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!errorPath.empty()) {</span>
<a name="2423"><font size=-1>2423     </font></a><span class="default">        lineNumber = errorPath.front().first-&gt;linenr();</span>
<a name="2424"><font size=-1>2424     </font></a><span class="default">        errorPath.back().second = funcname + </span><span class="string">&quot; is a virtual function&quot;</span><span class="default">;</span>
<a name="2425"><font size=-1>2425     </font></a><span class="default">    }</span>
<a name="2426"><font size=-1>2426     </font></a><span class="default"></span>
<a name="2427"><font size=-1>2427     </font></a><span class="default">    std::string constructorName;</span>
<a name="2428"><font size=-1>2428     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(scopeFunction) {</span>
<a name="2429"><font size=-1>2429     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">Token *endToken = scopeFunction-&gt;argDef-&gt;link()-&gt;next();</span>
<a name="2430"><font size=-1>2430     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(scopeFunction-&gt;type == Function::Type::eDestructor)</span>
<a name="2431"><font size=-1>2431     </font></a><span class="default">            constructorName = </span><span class="string">&quot;~&quot;</span><span class="default">;</span>
<a name="2432"><font size=-1>2432     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = scopeFunction-&gt;tokenDef; tok != endToken; tok = tok-&gt;next()) {</span>
<a name="2433"><font size=-1>2433     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!constructorName.empty() &amp;&amp; Token::Match(tok-&gt;previous(), </span><span class="string">&quot;%name%|%num% %name%|%num%&quot;</span><span class="default">))</span>
<a name="2434"><font size=-1>2434     </font></a><span class="default">                constructorName += </span><span class="string">' '</span><span class="default">;</span>
<a name="2435"><font size=-1>2435     </font></a><span class="default">            constructorName += tok-&gt;str();</span>
<a name="2436"><font size=-1>2436     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(tok-&gt;str() == </span><span class="string">&quot;)&quot;</span><span class="default">)</span>
<a name="2437"><font size=-1>2437     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2438"><font size=-1>2438     </font></a><span class="default">        }</span>
<a name="2439"><font size=-1>2439     </font></a><span class="default">    }</span>
<a name="2440"><font size=-1>2440     </font></a><span class="default"></span>
<a name="2441"><font size=-1>2441     </font></a><span class="default">    reportError(errorPath, Severity::warning, </span><span class="string">&quot;virtualCallInConstructor&quot;</span><span class="default">,</span>
<a name="2442"><font size=-1>2442     </font></a><span class="default">                </span><span class="string">&quot;Virtual function '&quot; </span><span class="default">+ funcname + </span><span class="string">&quot;' is called from &quot; </span><span class="default">+ scopeFunctionTypeName + </span><span class="string">&quot; '&quot; </span><span class="default">+ constructorName + </span><span class="string">&quot;' at line &quot; </span><span class="default">+ MathLib::toString(lineNumber) + </span><span class="string">&quot;. Dynamic binding is not used.&quot;</span><span class="default">, CWE(</span><span class="number">0U</span><span class="default">), </span><span class="keyword">false</span><span class="default">);</span>
<a name="2443"><font size=-1>2443     </font></a><span class="default">}</span>
<a name="2444"><font size=-1>2444     </font></a><span class="default"></span>
<a name="2445"><font size=-1>2445     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::pureVirtualFunctionCallInConstructorError(</span>
<a name="2446"><font size=-1>2446     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">Function * scopeFunction,</span>
<a name="2447"><font size=-1>2447     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::list&lt;</span><span class="keyword">const </span><span class="default">Token *&gt; &amp; tokStack,</span>
<a name="2448"><font size=-1>2448     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string &amp;purefuncname)</span>
<a name="2449"><font size=-1>2449     </font></a><span class="default">{</span>
<a name="2450"><font size=-1>2450     </font></a><span class="default">    </span><span class="keyword">const char </span><span class="default">* scopeFunctionTypeName = scopeFunction ? getFunctionTypeName(scopeFunction-&gt;type) : </span><span class="string">&quot;constructor&quot;</span><span class="default">;</span>
<a name="2451"><font size=-1>2451     </font></a><span class="default"></span>
<a name="2452"><font size=-1>2452     </font></a><span class="default">    ErrorPath errorPath;</span>
<a name="2453"><font size=-1>2453     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok : tokStack)</span>
<a name="2454"><font size=-1>2454     </font></a><span class="default">        errorPath.emplace_back(tok, </span><span class="string">&quot;Calling &quot; </span><span class="default">+ tok-&gt;str());</span>
<a name="2455"><font size=-1>2455     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!errorPath.empty())</span>
<a name="2456"><font size=-1>2456     </font></a><span class="default">        errorPath.back().second = purefuncname + </span><span class="string">&quot; is a pure virtual function without body&quot;</span><span class="default">;</span>
<a name="2457"><font size=-1>2457     </font></a><span class="default"></span>
<a name="2458"><font size=-1>2458     </font></a><span class="default">    reportError(errorPath, Severity::warning, </span><span class="string">&quot;pureVirtualCall&quot;</span><span class="default">,</span>
<a name="2459"><font size=-1>2459     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ purefuncname +</span><span class="string">&quot;\n&quot;</span>
<a name="2460"><font size=-1>2460     </font></a><span class="string">                &quot;Call of pure virtual function '$symbol' in &quot; </span><span class="default">+ scopeFunctionTypeName + </span><span class="string">&quot;.\n&quot;</span>
<a name="2461"><font size=-1>2461     </font></a><span class="string">                &quot;Call of pure virtual function '$symbol' in &quot; </span><span class="default">+ scopeFunctionTypeName + </span><span class="string">&quot;. The call will fail during runtime.&quot;</span><span class="default">, CWE(</span><span class="number">0U</span><span class="default">), </span><span class="keyword">false</span><span class="default">);</span>
<a name="2462"><font size=-1>2462     </font></a><span class="default">}</span>
<a name="2463"><font size=-1>2463     </font></a><span class="default"></span>
<a name="2464"><font size=-1>2464     </font></a><span class="default"></span>
<a name="2465"><font size=-1>2465     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2466"><font size=-1>2466     </font></a><span class="comment">// Check for members hiding inherited members with the same name</span>
<a name="2467"><font size=-1>2467     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2468"><font size=-1>2468     </font></a><span class="comment"></span>
<a name="2469"><font size=-1>2469     </font></a><span class="comment"></span><span class="keyword">void </span><span class="default">CheckClass::checkDuplInheritedMembers()</span>
<a name="2470"><font size=-1>2470     </font></a><span class="default">{</span>
<a name="2471"><font size=-1>2471     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="2472"><font size=-1>2472     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2473"><font size=-1>2473     </font></a><span class="default"></span>
<a name="2474"><font size=-1>2474     </font></a><span class="default">    </span><span class="comment">// Iterate over all classes</span>
<a name="2475"><font size=-1>2475     </font></a><span class="comment">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type &amp;classIt : mSymbolDatabase-&gt;typeList) {</span>
<a name="2476"><font size=-1>2476     </font></a><span class="default">        </span><span class="comment">// Iterate over the parent classes</span>
<a name="2477"><font size=-1>2477     </font></a><span class="comment">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Type::BaseInfo &amp;parentClassIt : classIt.derivedFrom) {</span>
<a name="2478"><font size=-1>2478     </font></a><span class="default">            </span><span class="comment">// Check if there is info about the 'Base' class</span>
<a name="2479"><font size=-1>2479     </font></a><span class="comment">            </span><span class="keyword">if </span><span class="default">(!parentClassIt.type || !parentClassIt.type-&gt;classScope)</span>
<a name="2480"><font size=-1>2480     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2481"><font size=-1>2481     </font></a><span class="default">            </span><span class="comment">// Check if they have a member variable in common</span>
<a name="2482"><font size=-1>2482     </font></a><span class="comment">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;classVarIt : classIt.classScope-&gt;varlist) {</span>
<a name="2483"><font size=-1>2483     </font></a><span class="default">                </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Variable &amp;parentClassVarIt : parentClassIt.type-&gt;classScope-&gt;varlist) {</span>
<a name="2484"><font size=-1>2484     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(classVarIt.name() == parentClassVarIt.name() &amp;&amp; !parentClassVarIt.isPrivate()) { </span><span class="comment">// Check if the class and its parent have a common variable</span>
<a name="2485"><font size=-1>2485     </font></a><span class="comment">                        </span><span class="default">duplInheritedMembersError(classVarIt.nameToken(), parentClassVarIt.nameToken(),</span>
<a name="2486"><font size=-1>2486     </font></a><span class="default">                                                  classIt.name(), parentClassIt.type-&gt;name(), classVarIt.name(),</span>
<a name="2487"><font size=-1>2487     </font></a><span class="default">                                                  classIt.classScope-&gt;type == Scope::eStruct,</span>
<a name="2488"><font size=-1>2488     </font></a><span class="default">                                                  parentClassIt.type-&gt;classScope-&gt;type == Scope::eStruct);</span>
<a name="2489"><font size=-1>2489     </font></a><span class="default">                    }</span>
<a name="2490"><font size=-1>2490     </font></a><span class="default">                }</span>
<a name="2491"><font size=-1>2491     </font></a><span class="default">            }</span>
<a name="2492"><font size=-1>2492     </font></a><span class="default">        }</span>
<a name="2493"><font size=-1>2493     </font></a><span class="default">    }</span>
<a name="2494"><font size=-1>2494     </font></a><span class="default">}</span>
<a name="2495"><font size=-1>2495     </font></a><span class="default"></span>
<a name="2496"><font size=-1>2496     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::duplInheritedMembersError(</span><span class="keyword">const </span><span class="default">Token *tok1, </span><span class="keyword">const </span><span class="default">Token* tok2,</span>
<a name="2497"><font size=-1>2497     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::string &amp;derivedName, </span><span class="keyword">const </span><span class="default">std::string &amp;baseName,</span>
<a name="2498"><font size=-1>2498     </font></a><span class="default">        </span><span class="keyword">const </span><span class="default">std::string &amp;variableName, </span><span class="keyword">bool </span><span class="default">derivedIsStruct, </span><span class="keyword">bool </span><span class="default">baseIsStruct)</span>
<a name="2499"><font size=-1>2499     </font></a><span class="default">{</span>
<a name="2500"><font size=-1>2500     </font></a><span class="default">    ErrorPath errorPath;</span>
<a name="2501"><font size=-1>2501     </font></a><span class="default">    errorPath.emplace_back(tok2, </span><span class="string">&quot;Parent variable '&quot; </span><span class="default">+ baseName + </span><span class="string">&quot;::&quot; </span><span class="default">+ variableName + </span><span class="string">&quot;'&quot;</span><span class="default">);</span>
<a name="2502"><font size=-1>2502     </font></a><span class="default">    errorPath.emplace_back(tok1, </span><span class="string">&quot;Derived variable '&quot; </span><span class="default">+ derivedName + </span><span class="string">&quot;::&quot; </span><span class="default">+ variableName + </span><span class="string">&quot;'&quot;</span><span class="default">);</span>
<a name="2503"><font size=-1>2503     </font></a><span class="default"></span>
<a name="2504"><font size=-1>2504     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string symbols = </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ derivedName + </span><span class="string">&quot;\n$symbol:&quot; </span><span class="default">+ variableName + </span><span class="string">&quot;\n$symbol:&quot; </span><span class="default">+ baseName;</span>
<a name="2505"><font size=-1>2505     </font></a><span class="default"></span>
<a name="2506"><font size=-1>2506     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string message = </span><span class="string">&quot;The &quot; </span><span class="default">+ std::string(derivedIsStruct ? </span><span class="string">&quot;struct&quot; </span><span class="default">: </span><span class="string">&quot;class&quot;</span><span class="default">) + </span><span class="string">&quot; '&quot; </span><span class="default">+ derivedName +</span>
<a name="2507"><font size=-1>2507     </font></a><span class="default">                                </span><span class="string">&quot;' defines member variable with name '&quot; </span><span class="default">+ variableName + </span><span class="string">&quot;' also defined in its parent &quot; </span><span class="default">+</span>
<a name="2508"><font size=-1>2508     </font></a><span class="default">                                std::string(baseIsStruct ? </span><span class="string">&quot;struct&quot; </span><span class="default">: </span><span class="string">&quot;class&quot;</span><span class="default">) + </span><span class="string">&quot; '&quot; </span><span class="default">+ baseName + </span><span class="string">&quot;'.&quot;</span><span class="default">;</span>
<a name="2509"><font size=-1>2509     </font></a><span class="default">    reportError(errorPath, Severity::warning, </span><span class="string">&quot;duplInheritedMember&quot;</span><span class="default">, symbols + </span><span class="string">'\n' </span><span class="default">+ message, CWE398, </span><span class="keyword">false</span><span class="default">);</span>
<a name="2510"><font size=-1>2510     </font></a><span class="default">}</span>
<a name="2511"><font size=-1>2511     </font></a><span class="default"></span>
<a name="2512"><font size=-1>2512     </font></a><span class="default"></span>
<a name="2513"><font size=-1>2513     </font></a><span class="default"></span><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2514"><font size=-1>2514     </font></a><span class="comment">// Check that copy constructor and operator defined together</span>
<a name="2515"><font size=-1>2515     </font></a><span class="comment">//---------------------------------------------------------------------------</span>
<a name="2516"><font size=-1>2516     </font></a><span class="comment"></span>
<a name="2517"><font size=-1>2517     </font></a><span class="comment"></span><span class="keyword">enum class </span><span class="default">CtorType {</span>
<a name="2518"><font size=-1>2518     </font></a><span class="default">    NO,</span>
<a name="2519"><font size=-1>2519     </font></a><span class="default">    WITHOUT_BODY,</span>
<a name="2520"><font size=-1>2520     </font></a><span class="default">    WITH_BODY</span>
<a name="2521"><font size=-1>2521     </font></a><span class="default">};</span>
<a name="2522"><font size=-1>2522     </font></a><span class="default"></span>
<a name="2523"><font size=-1>2523     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkCopyCtorAndEqOperator()</span>
<a name="2524"><font size=-1>2524     </font></a><span class="default">{</span>
<a name="2525"><font size=-1>2525     </font></a><span class="default">    </span><span class="comment">// This is disabled because of #8388</span>
<a name="2526"><font size=-1>2526     </font></a><span class="comment">    // The message must be clarified. How is the behaviour different?</span>
<a name="2527"><font size=-1>2527     </font></a><span class="comment">    </span><span class="keyword">return</span><span class="default">;</span>
<a name="2528"><font size=-1>2528     </font></a><span class="default"></span>
<a name="2529"><font size=-1>2529     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="2530"><font size=-1>2530     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2531"><font size=-1>2531     </font></a><span class="default"></span>
<a name="2532"><font size=-1>2532     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * scope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="2533"><font size=-1>2533     </font></a><span class="default"></span>
<a name="2534"><font size=-1>2534     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">hasNonStaticVars = </span><span class="keyword">false</span><span class="default">;</span>
<a name="2535"><font size=-1>2535     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(std::list&lt;Variable&gt;::const_iterator var = scope-&gt;varlist.begin(); var != scope-&gt;varlist.end(); ++var) {</span>
<a name="2536"><font size=-1>2536     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!var-&gt;isStatic()) {</span>
<a name="2537"><font size=-1>2537     </font></a><span class="default">                hasNonStaticVars = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2538"><font size=-1>2538     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2539"><font size=-1>2539     </font></a><span class="default">            }</span>
<a name="2540"><font size=-1>2540     </font></a><span class="default">        }</span>
<a name="2541"><font size=-1>2541     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!hasNonStaticVars)</span>
<a name="2542"><font size=-1>2542     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2543"><font size=-1>2543     </font></a><span class="default"></span>
<a name="2544"><font size=-1>2544     </font></a><span class="default">        CtorType copyCtors = CtorType::NO;</span>
<a name="2545"><font size=-1>2545     </font></a><span class="default">        </span><span class="keyword">bool </span><span class="default">moveCtor = </span><span class="keyword">false</span><span class="default">;</span>
<a name="2546"><font size=-1>2546     </font></a><span class="default">        CtorType assignmentOperators = CtorType::NO;</span>
<a name="2547"><font size=-1>2547     </font></a><span class="default"></span>
<a name="2548"><font size=-1>2548     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : scope-&gt;functionList) {</span>
<a name="2549"><font size=-1>2549     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(copyCtors == CtorType::NO &amp;&amp; func.type == Function::eCopyConstructor) {</span>
<a name="2550"><font size=-1>2550     </font></a><span class="default">                copyCtors = func.hasBody() ? CtorType::WITH_BODY : CtorType::WITHOUT_BODY;</span>
<a name="2551"><font size=-1>2551     </font></a><span class="default">            }</span>
<a name="2552"><font size=-1>2552     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(assignmentOperators == CtorType::NO &amp;&amp; func.type == Function::eOperatorEqual) {</span>
<a name="2553"><font size=-1>2553     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable * variable = func.getArgumentVar(</span><span class="number">0</span><span class="default">);</span>
<a name="2554"><font size=-1>2554     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(variable &amp;&amp; variable-&gt;type() &amp;&amp; variable-&gt;type()-&gt;classScope == scope) {</span>
<a name="2555"><font size=-1>2555     </font></a><span class="default">                    assignmentOperators = func.hasBody() ? CtorType::WITH_BODY : CtorType::WITHOUT_BODY;</span>
<a name="2556"><font size=-1>2556     </font></a><span class="default">                }</span>
<a name="2557"><font size=-1>2557     </font></a><span class="default">            }</span>
<a name="2558"><font size=-1>2558     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.type == Function::eMoveConstructor) {</span>
<a name="2559"><font size=-1>2559     </font></a><span class="default">                moveCtor = </span><span class="keyword">true</span><span class="default">;</span>
<a name="2560"><font size=-1>2560     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2561"><font size=-1>2561     </font></a><span class="default">            }</span>
<a name="2562"><font size=-1>2562     </font></a><span class="default">        }</span>
<a name="2563"><font size=-1>2563     </font></a><span class="default"></span>
<a name="2564"><font size=-1>2564     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(moveCtor)</span>
<a name="2565"><font size=-1>2565     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2566"><font size=-1>2566     </font></a><span class="default"></span>
<a name="2567"><font size=-1>2567     </font></a><span class="default">        </span><span class="comment">// No method defined</span>
<a name="2568"><font size=-1>2568     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(copyCtors != CtorType::WITH_BODY &amp;&amp; assignmentOperators != CtorType::WITH_BODY)</span>
<a name="2569"><font size=-1>2569     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2570"><font size=-1>2570     </font></a><span class="default"></span>
<a name="2571"><font size=-1>2571     </font></a><span class="default">        </span><span class="comment">// both methods are defined</span>
<a name="2572"><font size=-1>2572     </font></a><span class="comment">        </span><span class="keyword">if </span><span class="default">(copyCtors != CtorType::NO &amp;&amp; assignmentOperators != CtorType::NO)</span>
<a name="2573"><font size=-1>2573     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2574"><font size=-1>2574     </font></a><span class="default"></span>
<a name="2575"><font size=-1>2575     </font></a><span class="default">        copyCtorAndEqOperatorError(scope-&gt;classDef, scope-&gt;className, scope-&gt;type == Scope::eStruct, copyCtors == CtorType::WITH_BODY);</span>
<a name="2576"><font size=-1>2576     </font></a><span class="default">    }</span>
<a name="2577"><font size=-1>2577     </font></a><span class="default">}</span>
<a name="2578"><font size=-1>2578     </font></a><span class="default"></span>
<a name="2579"><font size=-1>2579     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::copyCtorAndEqOperatorError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;classname, </span><span class="keyword">bool </span><span class="default">isStruct, </span><span class="keyword">bool </span><span class="default">hasCopyCtor)</span>
<a name="2580"><font size=-1>2580     </font></a><span class="default">{</span>
<a name="2581"><font size=-1>2581     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string message = </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ classname + </span><span class="string">&quot;\n&quot;</span>
<a name="2582"><font size=-1>2582     </font></a><span class="string">                                &quot;The &quot; </span><span class="default">+ std::string(isStruct ? </span><span class="string">&quot;struct&quot; </span><span class="default">: </span><span class="string">&quot;class&quot;</span><span class="default">) + </span><span class="string">&quot; '$symbol' has '&quot; </span><span class="default">+</span>
<a name="2583"><font size=-1>2583     </font></a><span class="default">                                getFunctionTypeName(hasCopyCtor ? Function::eCopyConstructor : Function::eOperatorEqual) +</span>
<a name="2584"><font size=-1>2584     </font></a><span class="default">                                </span><span class="string">&quot;' but lack of '&quot; </span><span class="default">+ getFunctionTypeName(hasCopyCtor ? Function::eOperatorEqual : Function::eCopyConstructor) +</span>
<a name="2585"><font size=-1>2585     </font></a><span class="default">                                </span><span class="string">&quot;'.&quot;</span><span class="default">;</span>
<a name="2586"><font size=-1>2586     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;copyCtorAndEqOperator&quot;</span><span class="default">, message);</span>
<a name="2587"><font size=-1>2587     </font></a><span class="default">}</span>
<a name="2588"><font size=-1>2588     </font></a><span class="default"></span>
<a name="2589"><font size=-1>2589     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkUnsafeClassDivZero(</span><span class="keyword">bool </span><span class="default">test)</span>
<a name="2590"><font size=-1>2590     </font></a><span class="default">{</span>
<a name="2591"><font size=-1>2591     </font></a><span class="default">    </span><span class="comment">// style severity: it is a style decision if classes should be safe or</span>
<a name="2592"><font size=-1>2592     </font></a><span class="comment">    // if users should be required to be careful. I expect that many users</span>
<a name="2593"><font size=-1>2593     </font></a><span class="comment">    // will disagree about these reports.</span>
<a name="2594"><font size=-1>2594     </font></a><span class="comment">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="2595"><font size=-1>2595     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2596"><font size=-1>2596     </font></a><span class="default"></span>
<a name="2597"><font size=-1>2597     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * classScope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="2598"><font size=-1>2598     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!test &amp;&amp; classScope-&gt;classDef-&gt;fileIndex() != </span><span class="number">1</span><span class="default">)</span>
<a name="2599"><font size=-1>2599     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2600"><font size=-1>2600     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : classScope-&gt;functionList) {</span>
<a name="2601"><font size=-1>2601     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.access != AccessControl::Public)</span>
<a name="2602"><font size=-1>2602     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2603"><font size=-1>2603     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!func.hasBody())</span>
<a name="2604"><font size=-1>2604     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2605"><font size=-1>2605     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.name().compare(</span><span class="number">0</span><span class="default">,</span><span class="number">8</span><span class="default">,</span><span class="string">&quot;operator&quot;</span><span class="default">)==</span><span class="number">0</span><span class="default">)</span>
<a name="2606"><font size=-1>2606     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2607"><font size=-1>2607     </font></a><span class="default">            </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Token *tok = func.functionScope-&gt;bodyStart; tok; tok = tok-&gt;next()) {</span>
<a name="2608"><font size=-1>2608     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(tok, </span><span class="string">&quot;if|switch|while|for|do|}&quot;</span><span class="default">))</span>
<a name="2609"><font size=-1>2609     </font></a><span class="default">                    </span><span class="keyword">break</span><span class="default">;</span>
<a name="2610"><font size=-1>2610     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(tok-&gt;str() != </span><span class="string">&quot;/&quot;</span><span class="default">)</span>
<a name="2611"><font size=-1>2611     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2612"><font size=-1>2612     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok-&gt;valueType() || !tok-&gt;valueType()-&gt;isIntegral())</span>
<a name="2613"><font size=-1>2613     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2614"><font size=-1>2614     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!tok-&gt;astOperand2())</span>
<a name="2615"><font size=-1>2615     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2616"><font size=-1>2616     </font></a><span class="default">                </span><span class="keyword">const </span><span class="default">Variable *var = tok-&gt;astOperand2()-&gt;variable();</span>
<a name="2617"><font size=-1>2617     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(!var || !var-&gt;isArgument())</span>
<a name="2618"><font size=-1>2618     </font></a><span class="default">                    </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2619"><font size=-1>2619     </font></a><span class="default">                unsafeClassDivZeroError(tok, classScope-&gt;className, func.name(), var-&gt;name());</span>
<a name="2620"><font size=-1>2620     </font></a><span class="default">                </span><span class="keyword">break</span><span class="default">;</span>
<a name="2621"><font size=-1>2621     </font></a><span class="default">            }</span>
<a name="2622"><font size=-1>2622     </font></a><span class="default">        }</span>
<a name="2623"><font size=-1>2623     </font></a><span class="default">    }</span>
<a name="2624"><font size=-1>2624     </font></a><span class="default">}</span>
<a name="2625"><font size=-1>2625     </font></a><span class="default"></span>
<a name="2626"><font size=-1>2626     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::unsafeClassDivZeroError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;className, </span><span class="keyword">const </span><span class="default">std::string &amp;methodName, </span><span class="keyword">const </span><span class="default">std::string &amp;varName)</span>
<a name="2627"><font size=-1>2627     </font></a><span class="default">{</span>
<a name="2628"><font size=-1>2628     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string symbols = </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ className + </span><span class="string">&quot;\n$symbol:&quot; </span><span class="default">+ methodName + </span><span class="string">&quot;\n$symbol:&quot; </span><span class="default">+ varName + </span><span class="string">'\n'</span><span class="default">;</span>
<a name="2629"><font size=-1>2629     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string s = className + </span><span class="string">&quot;::&quot; </span><span class="default">+ methodName + </span><span class="string">&quot;()&quot;</span><span class="default">;</span>
<a name="2630"><font size=-1>2630     </font></a><span class="default">    reportError(tok, Severity::style, </span><span class="string">&quot;unsafeClassDivZero&quot;</span><span class="default">, symbols + </span><span class="string">&quot;Public interface of &quot; </span><span class="default">+ className + </span><span class="string">&quot; is not safe. When calling &quot; </span><span class="default">+ s + </span><span class="string">&quot;, if parameter &quot; </span><span class="default">+ varName + </span><span class="string">&quot; is 0 that leads to division by zero.&quot;</span><span class="default">);</span>
<a name="2631"><font size=-1>2631     </font></a><span class="default">}</span>
<a name="2632"><font size=-1>2632     </font></a><span class="default"></span>
<a name="2633"><font size=-1>2633     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkOverride()</span>
<a name="2634"><font size=-1>2634     </font></a><span class="default">{</span>
<a name="2635"><font size=-1>2635     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;isEnabled(Settings::STYLE))</span>
<a name="2636"><font size=-1>2636     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2637"><font size=-1>2637     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(mSettings-&gt;standards.cpp &lt; Standards::CPP11)</span>
<a name="2638"><font size=-1>2638     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2639"><font size=-1>2639     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * classScope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="2640"><font size=-1>2640     </font></a><span class="default">        </span><span class="keyword">if </span><span class="default">(!classScope-&gt;definedType || classScope-&gt;definedType-&gt;derivedFrom.empty())</span>
<a name="2641"><font size=-1>2641     </font></a><span class="default">            </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2642"><font size=-1>2642     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : classScope-&gt;functionList) {</span>
<a name="2643"><font size=-1>2643     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(func.hasOverrideSpecifier() || func.hasFinalSpecifier())</span>
<a name="2644"><font size=-1>2644     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2645"><font size=-1>2645     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Function *baseFunc = func.getOverriddenFunction();</span>
<a name="2646"><font size=-1>2646     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(baseFunc)</span>
<a name="2647"><font size=-1>2647     </font></a><span class="default">                overrideError(baseFunc, &amp;func);</span>
<a name="2648"><font size=-1>2648     </font></a><span class="default">        }</span>
<a name="2649"><font size=-1>2649     </font></a><span class="default">    }</span>
<a name="2650"><font size=-1>2650     </font></a><span class="default">}</span>
<a name="2651"><font size=-1>2651     </font></a><span class="default"></span>
<a name="2652"><font size=-1>2652     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::overrideError(</span><span class="keyword">const </span><span class="default">Function *funcInBase, </span><span class="keyword">const </span><span class="default">Function *funcInDerived)</span>
<a name="2653"><font size=-1>2653     </font></a><span class="default">{</span>
<a name="2654"><font size=-1>2654     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string functionName = funcInDerived ? ((funcInDerived-&gt;isDestructor() ? </span><span class="string">&quot;~&quot; </span><span class="default">: </span><span class="string">&quot;&quot;</span><span class="default">) + funcInDerived-&gt;name()) : </span><span class="string">&quot;&quot;</span><span class="default">;</span>
<a name="2655"><font size=-1>2655     </font></a><span class="default">    </span><span class="keyword">const </span><span class="default">std::string funcType = (funcInDerived &amp;&amp; funcInDerived-&gt;isDestructor()) ? </span><span class="string">&quot;destructor&quot; </span><span class="default">: </span><span class="string">&quot;function&quot;</span><span class="default">;</span>
<a name="2656"><font size=-1>2656     </font></a><span class="default"></span>
<a name="2657"><font size=-1>2657     </font></a><span class="default">    ErrorPath errorPath;</span>
<a name="2658"><font size=-1>2658     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(funcInBase &amp;&amp; funcInDerived) {</span>
<a name="2659"><font size=-1>2659     </font></a><span class="default">        errorPath.push_back(ErrorPathItem(funcInBase-&gt;tokenDef, </span><span class="string">&quot;Virtual &quot; </span><span class="default">+ funcType + </span><span class="string">&quot; in base class&quot;</span><span class="default">));</span>
<a name="2660"><font size=-1>2660     </font></a><span class="default">        errorPath.push_back(ErrorPathItem(funcInDerived-&gt;tokenDef, </span><span class="keyword">char</span><span class="default">(std::toupper(funcType[</span><span class="number">0</span><span class="default">])) + funcType.substr(</span><span class="number">1</span><span class="default">) + </span><span class="string">&quot; in derived class&quot;</span><span class="default">));</span>
<a name="2661"><font size=-1>2661     </font></a><span class="default">    }</span>
<a name="2662"><font size=-1>2662     </font></a><span class="default"></span>
<a name="2663"><font size=-1>2663     </font></a><span class="default">    reportError(errorPath, Severity::style, </span><span class="string">&quot;missingOverride&quot;</span><span class="default">,</span>
<a name="2664"><font size=-1>2664     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ functionName + </span><span class="string">&quot;\n&quot;</span>
<a name="2665"><font size=-1>2665     </font></a><span class="string">                &quot;The &quot; </span><span class="default">+ funcType + </span><span class="string">&quot; '$symbol' overrides a &quot; </span><span class="default">+ funcType + </span><span class="string">&quot; in a base class but is not marked with a 'override' specifier.&quot;</span><span class="default">,</span>
<a name="2666"><font size=-1>2666     </font></a><span class="default">                CWE(</span><span class="number">0U</span><span class="default">) </span><span class="comment">/* Unknown CWE! */</span><span class="default">,</span>
<a name="2667"><font size=-1>2667     </font></a><span class="default">                </span><span class="keyword">false</span><span class="default">);</span>
<a name="2668"><font size=-1>2668     </font></a><span class="default">}</span>
<a name="2669"><font size=-1>2669     </font></a><span class="default"></span>
<a name="2670"><font size=-1>2670     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::checkUnsafeClassRefMember()</span>
<a name="2671"><font size=-1>2671     </font></a><span class="default">{</span>
<a name="2672"><font size=-1>2672     </font></a><span class="default">    </span><span class="keyword">if </span><span class="default">(!mSettings-&gt;safeChecks.classes || !mSettings-&gt;isEnabled(Settings::WARNING))</span>
<a name="2673"><font size=-1>2673     </font></a><span class="default">        </span><span class="keyword">return</span><span class="default">;</span>
<a name="2674"><font size=-1>2674     </font></a><span class="default">    </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Scope * classScope : mSymbolDatabase-&gt;classAndStructScopes) {</span>
<a name="2675"><font size=-1>2675     </font></a><span class="default">        </span><span class="keyword">for </span><span class="default">(</span><span class="keyword">const </span><span class="default">Function &amp;func : classScope-&gt;functionList) {</span>
<a name="2676"><font size=-1>2676     </font></a><span class="default">            </span><span class="keyword">if </span><span class="default">(!func.hasBody() || !func.isConstructor())</span>
<a name="2677"><font size=-1>2677     </font></a><span class="default">                </span><span class="keyword">continue</span><span class="default">;</span>
<a name="2678"><font size=-1>2678     </font></a><span class="default"></span>
<a name="2679"><font size=-1>2679     </font></a><span class="default">            </span><span class="keyword">const </span><span class="default">Token *initList = func.constructorMemberInitialization();</span>
<a name="2680"><font size=-1>2680     </font></a><span class="default">            </span><span class="keyword">while </span><span class="default">(Token::Match(initList, </span><span class="string">&quot;[:,] %name% (&quot;</span><span class="default">)) {</span>
<a name="2681"><font size=-1>2681     </font></a><span class="default">                </span><span class="keyword">if </span><span class="default">(Token::Match(initList-&gt;tokAt(</span><span class="number">2</span><span class="default">), </span><span class="string">&quot;( %var% )&quot;</span><span class="default">)) {</span>
<a name="2682"><font size=-1>2682     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">memberVar = initList-&gt;next()-&gt;variable();</span>
<a name="2683"><font size=-1>2683     </font></a><span class="default">                    </span><span class="keyword">const </span><span class="default">Variable * </span><span class="keyword">const </span><span class="default">argVar = initList-&gt;tokAt(</span><span class="number">3</span><span class="default">)-&gt;variable();</span>
<a name="2684"><font size=-1>2684     </font></a><span class="default">                    </span><span class="keyword">if </span><span class="default">(memberVar &amp;&amp; argVar &amp;&amp; memberVar-&gt;isConst() &amp;&amp; memberVar-&gt;isReference() &amp;&amp; argVar-&gt;isArgument() &amp;&amp; argVar-&gt;isConst() &amp;&amp; argVar-&gt;isReference())</span>
<a name="2685"><font size=-1>2685     </font></a><span class="default">                        unsafeClassRefMemberError(initList-&gt;next(), classScope-&gt;className + </span><span class="string">&quot;::&quot; </span><span class="default">+ memberVar-&gt;name());</span>
<a name="2686"><font size=-1>2686     </font></a><span class="default">                }</span>
<a name="2687"><font size=-1>2687     </font></a><span class="default">                initList = initList-&gt;linkAt(</span><span class="number">2</span><span class="default">)-&gt;next();</span>
<a name="2688"><font size=-1>2688     </font></a><span class="default">            }</span>
<a name="2689"><font size=-1>2689     </font></a><span class="default">        }</span>
<a name="2690"><font size=-1>2690     </font></a><span class="default">    }</span>
<a name="2691"><font size=-1>2691     </font></a><span class="default">}</span>
<a name="2692"><font size=-1>2692     </font></a><span class="default"></span>
<a name="2693"><font size=-1>2693     </font></a><span class="default"></span><span class="keyword">void </span><span class="default">CheckClass::unsafeClassRefMemberError(</span><span class="keyword">const </span><span class="default">Token *tok, </span><span class="keyword">const </span><span class="default">std::string &amp;varname)</span>
<a name="2694"><font size=-1>2694     </font></a><span class="default">{</span>
<a name="2695"><font size=-1>2695     </font></a><span class="default">    reportError(tok, Severity::warning, </span><span class="string">&quot;unsafeClassRefMember&quot;</span><span class="default">,</span>
<a name="2696"><font size=-1>2696     </font></a><span class="default">                </span><span class="string">&quot;$symbol:&quot; </span><span class="default">+ varname + </span><span class="string">&quot;\n&quot;</span>
<a name="2697"><font size=-1>2697     </font></a><span class="string">                &quot;Unsafe class: The const reference member '$symbol' is initialized by a const reference constructor argument. You need to be careful about lifetime issues.\n&quot;</span>
<a name="2698"><font size=-1>2698     </font></a><span class="string">                &quot;Unsafe class checking: The const reference member '$symbol' is initialized by a const reference constructor argument. You need to be careful about lifetime issues. If you pass a local variable or temporary value in this constructor argument, be extra careful. If the argument is always some global object that is never destroyed then this is safe usage. However it would be defensive to make the member '$symbol' a non-reference variable or a smart pointer.&quot;</span><span class="default">,</span>
<a name="2699"><font size=-1>2699     </font></a><span class="default">                CWE(</span><span class="number">0</span><span class="default">), </span><span class="keyword">false</span><span class="default">);</span>
<a name="2700"><font size=-1>2700     </font></a><span class="default">}</span>
<a name="2701"><font size=-1>2701     </font></a><span class="default"></span>
</pre></body></html>
